<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hello World</title>
    <url>/2020/05/1589344022000/1589344022000/</url>
    <content><![CDATA[<h2 id="『你好-世界』"><a href="#『你好-世界』" class="headerlink" title="『你好,世界』"></a>『你好,世界』</h2><h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">public class HelloWorld</span><br><span class="line">{</span><br><span class="line">    public static void main(String[] args)</span><br><span class="line">    { </span><br><span class="line">      System.out.println( <span class="string">"Hello, World!"</span> );</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello, World!"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Python-3"><a href="#Python-3" class="headerlink" title="Python 3"></a>Python 3</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Hello, World!"</span>)</span><br></pre></td></tr></tbody></table></figure></div>
<p>可以使用单引号’’，双引号”” 或三引号””” “””或’’’ ‘’’</p>
<h3 id="C-1"><a href="#C-1" class="headerlink" title="C++"></a>C++</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">{</span><br><span class="line">    cout&lt;&lt;<span class="string">"Hello, World!"</span>&lt;&lt;endl;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="C-2"><a href="#C-2" class="headerlink" title="C#"></a>C#</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">namespace HelloWorld</span><br><span class="line">{</span><br><span class="line">    class Program</span><br><span class="line">    {</span><br><span class="line">        static void Main(string[] args)</span><br><span class="line">        {</span><br><span class="line">            System.Console.Write(<span class="string">"Hello, World!"</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="VB"><a href="#VB" class="headerlink" title="VB"></a>VB</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">Module MainFrm</span><br><span class="line">    Sub Main()</span><br><span class="line">        System.Console.WriteLine(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    End Sub</span><br><span class="line">End Module</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">alert (<span class="string">"Hello, World!"</span>);</span><br></pre></td></tr></tbody></table></figure></div>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">document.write(<span class="string">"Hello, World!"</span>);</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">&lt;?php    </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">'Hello, world!'</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line">SELECT 列名称 FROM 表名称</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Object-C"><a href="#Object-C" class="headerlink" title="Object-C"></a>Object-C</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#import &lt;stdio.h&gt;</span></span><br><span class="line">int main(int argc,const char *argv[])</span><br><span class="line">{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Hello World"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>other</tag>
      </tags>
  </entry>
  <entry>
    <title>在idea中创建项目与github关联</title>
    <url>/2020/05/1590142873000/1590142873000/</url>
    <content><![CDATA[<h3 id="在IDEA中配置git"><a href="#在IDEA中配置git" class="headerlink" title="在IDEA中配置git"></a>在IDEA中配置git</h3><p>在IDEA中设置Git，在File–&gt;Setting-&gt;Version Control–&gt;Git ，git安装环境变量成功会自动识别安装路径，点击Test，测试是否设置成功<br><img src="/2020/05/1590142873000/1590142873000/20200522184825.png" alt="20200522184825"></p>
<h3 id="在IDEA中连接github中心"><a href="#在IDEA中连接github中心" class="headerlink" title="在IDEA中连接github中心"></a>在IDEA中连接github中心</h3><p>在IDEA中，File–&gt;Setting-&gt;Version Control–&gt;GibHub，点击右侧 “ + “ 按钮，建议在Server的中添加[https://]，Login为Github的账户，Password为Github的密码，点击Log In，成功则显示，<br><img src="/2020/05/1590142873000/1590142873000/20200522190224.png" alt="20200522190224"></p>
<h3 id="创建本地仓库"><a href="#创建本地仓库" class="headerlink" title="创建本地仓库"></a>创建本地仓库</h3><p>在IDEA中，VCS–&gt;Import into Version Control–&gt;Create Git Repository<br><img src="/2020/05/1590142873000/1590142873000/20200522201913.png" alt="20200522201913"></p>
<p>在弹窗中选择项目所在的位置<br><img src="/2020/05/1590142873000/1590142873000/20200522210238.png" alt="20200522210238"></p>
<p>点击OK，此时项目文件全部变成红色，同时在项目目录下生成一个隐藏的.git的文件目录<br><img src="/2020/05/1590142873000/1590142873000/20200522211507.png" alt="20200522211507"></p>
<h3 id="上传文件到本地仓库"><a href="#上传文件到本地仓库" class="headerlink" title="上传文件到本地仓库"></a>上传文件到本地仓库</h3><p>在IDEA中，选择项目鼠标右键–&gt; git –&gt; Add，此时项目文件变成绿色，<span style="color:red">此时文件只处于本地库的暂存区，并没有同步到github版本库中</span><br><img src="/2020/05/1590142873000/1590142873000/20200522212221.png" alt="20200522212221"></p>
<p><img src="/2020/05/1590142873000/1590142873000/20200522212334.png" alt="20200522212334"></p>
<h3 id="同步到本地github版本"><a href="#同步到本地github版本" class="headerlink" title="同步到本地github版本"></a>同步到本地github版本</h3><p>在IDEA中，选择项目鼠标右键–&gt; git –&gt; Commit Directory，出现提交弹窗，在弹窗勾掉.idea排除不必要的文件，在弹窗中输入Commit Message，否则不允许提交，点击commit，此时项目文件从暂存区真正进入本地github版本库中，项目文件变成白色<br><img src="/2020/05/1590142873000/1590142873000/20200522213206.png" alt="20200522213206"></p>
<p><img src="/2020/05/1590142873000/1590142873000/20200522214833.png" alt="20200522214833"></p>
<p><img src="/2020/05/1590142873000/1590142873000/20200522215358.png" alt="20200522215358"></p>
<h3 id="上传项目到GitHub中"><a href="#上传项目到GitHub中" class="headerlink" title="上传项目到GitHub中"></a>上传项目到GitHub中</h3><p>在IDEA中，选择项目，VCS–&gt;Import into Version Control–&gt;Share Project on GitHub，在弹框中自动输入仓库名，输入描述，选择要Share的链接， 点击Share，即可上传，中间会弹窗输入GitHub的用户名和密码（已输入过用户名和密码并记住的不会再次弹框输入），上传成功后IDEA右下角会给出提示<br><img src="/2020/05/1590142873000/1590142873000/20200522223429.png" alt="20200522223429"></p>
<p><img src="/2020/05/1590142873000/1590142873000/20200522223534.png" alt="20200522223534"></p>
<h3 id="同步结束"><a href="#同步结束" class="headerlink" title="同步结束"></a>同步结束</h3><p>此至，可访问github上查看<br><img src="/2020/05/1590142873000/1590142873000/20200522223633.png" alt="20200522223633"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows上安装git-v2.26.2</title>
    <url>/2020/05/1590132000000/1590132000000/</url>
    <content><![CDATA[<h3 id="下载git"><a href="#下载git" class="headerlink" title="下载git"></a>下载git</h3><p>官网下载并安装 <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">git</a> 进入自动识别系统， 点击自动弹出下载窗口<br><img src="/2020/05/1590132000000/1590132000000/20200524135151.png" alt="20200524135151"></p>
<p>安装包下载地址：<a href="https://gitforwindows.org/" target="_blank" rel="noopener">https://gitforwindows.org/</a><br>官网慢，可以用国内的镜像：<a href="https://npm.taobao.org/mirrors/git-for-windows/" target="_blank" rel="noopener">https://npm.taobao.org/mirrors/git-for-windows/</a></p>
<h3 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h3><p>下载结束后，双击进行安装，如已安装点击运行则为修复版本<br><img src="/2020/05/1590132000000/1590132000000/20200524154530.png" alt="20200524154530"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524154634.png" alt="20200524154634"></p>
<p>是否显示桌面图，可不勾选，在安装结束后鼠标右键有选项显示<br><img src="/2020/05/1590132000000/1590132000000/20200524154845.png" alt="20200524154845"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524154934.png" alt="20200524154934"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524155123.png" alt="20200524155123"></p>
<p>此项完全不修改PATH变量值，仅在Git Bash中使用Git，绝对安全，所以cmd的git –version 无效<br> <img src="/2020/05/1590132000000/1590132000000/20200524155406.png" alt="20200524155406"></p>
<p>Git命令与Linux一样，所以最好在OpenSSL中操作命令<br><img src="/2020/05/1590132000000/1590132000000/20200524155810.png" alt="20200524155810"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524155830.png" alt="20200524155830"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524155858.png" alt="20200524155858"></p>
<p> 启用文件缓存<br><img src="/2020/05/1590132000000/1590132000000/20200524155947.png" alt="20200524155947"></p>
<p><img src="/2020/05/1590132000000/1590132000000/20200524160043.png" alt="20200524160043"></p>
<p>在桌面或者文件目录空白处点击鼠标右键，选择 Git Bash Here 选项，即可打开命令界面<br><img src="/2020/05/1590132000000/1590132000000/20200524160313.png" alt="20200524160313"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>使本地git与Github连接</title>
    <url>/2020/05/1590309165000/1590309165000/</url>
    <content><![CDATA[<h3 id="创建github账号"><a href="#创建github账号" class="headerlink" title="创建github账号"></a>创建github账号</h3><p>在 <a href="https://github.com/join?source=login" target="_blank" rel="noopener">github</a> 中创建一个账号，如有账号则不需创建</p>
<h3 id="配置github账户"><a href="#配置github账户" class="headerlink" title="配置github账户"></a>配置github账户</h3><p>安装成功后打开Git Bash Here，执行命令 git config –global -e 操作进入全局配置文件  </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git config --global -e</span><br></pre></td></tr></tbody></table></figure></div>
<p>按 i 进行编辑以下内容：</p>
<pre><code>[user]
name = zhuqiaolun     # github的Username
email =zhuqlchina@163.com     # github的Email</code></pre><p>按下ESC，输入 :wq 保存退出</p>
<p>输入以下命令禁用自动转换，防止 Git 提交时报错warning: LF will be replaced by CRLF in</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git config --global core.autocrlf false</span><br></pre></td></tr></tbody></table></figure></div>

<p>输入以下命令查看配置</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git config -l</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生成ssh认证"><a href="#生成ssh认证" class="headerlink" title="生成ssh认证"></a>生成ssh认证</h3><p>输入以下命令，回车会让你输入存放保存ssh key的地址，它给了一个默认地址就是括号了那里，再回车就是你选择了默认地址，<br>然后会让你输入密码并且确认密码，ok生成了，过程如下图</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C "zhuqlchina@163.com"            # github的Email</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524170915.png" alt="20200524170915"></p>
<p>按照你存放ssk key的地址，去复制key，比如我的在下图这个位置，打开id_rsa.pub,复制里面的key<br><img src="/2020/05/1590309165000/1590309165000/20200524182540.png" alt="20200524182540"></p>
<h3 id="配置ssh认证"><a href="#配置ssh认证" class="headerlink" title="配置ssh认证"></a>配置ssh认证</h3><p>登录 <a href="https://github.com/login" target="_blank" rel="noopener">github</a>  ,setting -&gt; SSH and GPG keys -&gt; new SSH key<br><img src="/2020/05/1590309165000/1590309165000/20200524183321.png" alt="20200524183321"><br>输入key后 点击 Add SSH key 完成<br><img src="/2020/05/1590309165000/1590309165000/20200524183322.png" alt="20200524183322"></p>
<h3 id="验证ssh认证"><a href="#验证ssh认证" class="headerlink" title="验证ssh认证"></a>验证ssh认证</h3><p>在git bash 下输入命令，如在前面设置过密码则会提示输入密码，那输入设置的密码即可</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524183707.png" alt="20200524183707"></p>
<h3 id="拉去github文件到本地仓库"><a href="#拉去github文件到本地仓库" class="headerlink" title="拉去github文件到本地仓库"></a>拉去github文件到本地仓库</h3><div>
<p>选好本地仓库的目录，进去鼠标右键-&gt;Git Bash Here,输入以下命令拉去github上面的代码并进入拉去的代码目录</p>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git clone https://github.com/zhuqiaolun/spring-boot-code  # repositories的url</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524195556.png" alt="20200524195556"></p>
<p><img src="/2020/05/1590309165000/1590309165000/20200524195557.png" alt="20200524195557"><br>修改内容后则需要提交文件</p>
<h3 id="提交代码到远程仓库"><a href="#提交代码到远程仓库" class="headerlink" title="提交代码到远程仓库"></a>提交代码到远程仓库</h3><p>输入命令，查看修改了哪些文件，出现的红色字则为修改了内容的文件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524200142.png" alt="20200524200142"><br>修改文件状态，将本地文件更新全部提交到暂缓区</p>
<p>1.全部修改</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git add .  # 更新文件状态，将文件添加到暂存区，注意后面一个点</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524203126.png" alt="20200524203126"></p>
<p>2.修改只提交的文件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">touch .gitignore   # 创建忽略提交的文件</span><br></pre></td></tr></tbody></table></figure></div>

<p>在里面添加 不必要提交的文件路径或者文件名，<br>过滤文件夹设置：<br>.idea 表示过滤这个文件夹<br>过滤文件设置：<br>*.iml</p>
<p>输入命令：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git add .gitignore      # 更新单个文件状态</span><br></pre></td></tr></tbody></table></figure></div>
<p>当前需要的文件变成绿色后，就可以提交了，先提交本地在提交远程，中间有可能要输入用户密码验证<br><img src="/2020/05/1590309165000/1590309165000/20200524203127.png" alt="20200524203127"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">git commit -m '相关注释文字'        #提交到本地仓库</span><br><span class="line">git push origin master              #提交到远程仓库</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2020/05/1590309165000/1590309165000/20200524203743.png" alt="20200524203743"></p>
<p>查看远程github<br><img src="/2020/05/1590309165000/1590309165000/20200524203946.png" alt="20200524203946"></p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>从本地上传代码到github上操作：<br>在git bash 下输入命令<br>1、仓库初始化<br>git init<br>2、连接仓库，没有则需新建<br>git remote add origin 仓库地址<br>3、查看状态<br>git status<br>4、将文件添加到暂存区<br>git add 状态里的新文件<br>5、将文件添加到仓库<br>git commit -m’相关注释文字’<br>6、将本地代码提交到远程仓库<br>git push origin master</p>
<p>ssh和https提交代码时其实都需要验证，ssh用的是key， https用的是登录名和密码的方式</p>
</div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>如何让hexo博客被百度收录</title>
    <url>/2020/05/1590766728000/1590766728000/</url>
    <content><![CDATA[<h3 id="​前言"><a href="#​前言" class="headerlink" title="​前言"></a>​前言</h3><p>​博客，分享才是真理。</p>
<h3 id="HTTPS认证"><a href="#HTTPS认证" class="headerlink" title="HTTPS认证"></a>HTTPS认证</h3><p>​找到 <a href="https://ziyuan.baidu.com/" target="_blank" rel="noopener">百度站长平台</a> -&gt; HTTPS认证<br><img src="/2020/05/1590766728000/1590766728000/20200529235838.png" alt="20200529235838"><br><span style="color:red;">认证似乎能加速百度收录速度</span><br>在认证中，需要下载百度的专属识别文件，放在项目根目录，然后进行测试验证即可<br>配置301</p>
<pre><code>server {
    listen       80;
    server_name  www.zhuqiaolun.com;
    if ($scheme = http ) {
        return 301 https://www.zhuqiaolun.com$request_uri;
    }
    location / {
        root   html;
        index  index.html index.htm;
    }
}</code></pre><p>认证结果：<br><img src="/2020/05/1590766728000/1590766728000/20200529235839.png" alt="20200529235839"></p>
<h3 id="安装网站地图插件"><a href="#安装网站地图插件" class="headerlink" title="安装网站地图插件"></a>安装网站地图插件</h3><p>先安装sitemap插件，生成网站地图</p>
<pre><code>npm install hexo-generator-sitemap --save     
npm install hexo-generator-baidu-sitemap --save12</code></pre><h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>​修改博客根路径下的_config.yml配置文件中的url站点地址</p>
<pre><code>url: https://www.zhuqiaolun.com/                    # 在这儿填写你的博客域名
root: /
permalink: :year/:month/:day/:title/
permalink_defaults:
pretty_urls:
  trailing_index: true # Set to false to remove trailing 'index.html' from permalinks
  trailing_html: true # Set to false to remove trailing '.html' from permalinks</code></pre><h3 id="验证xml文件"><a href="#验证xml文件" class="headerlink" title="验证xml文件"></a>验证xml文件</h3><p>​执行命令 hexo s 完之后就会在博客路径下生成 sitemap.xml 文件和 baidusitemap.xml 文件，可以通过 <a href="https://www.zhuqiaolun.com/baidusitemap.xml">https://www.zhuqiaolun.com/baidusitemap.xml</a> 查看该文件是否生成<br>sitemap.xml文件是搜索引擎通用的文件<br>baidusitemap.xml是百度专用的sitemap文件</p>
<h3 id="向百度提交链接"><a href="#向百度提交链接" class="headerlink" title="向百度提交链接"></a>向百度提交链接</h3><p>​找到 <a href="https://ziyuan.baidu.com/" target="_blank" rel="noopener">百度站长平台</a>-&gt;普通收录 -&gt; 资源提交 -&gt; sitemap<br><img src="/2020/05/1590766728000/1590766728000/20200530000410.png" alt="20200530000410"><br>在其中填写百度专用的baidusitemap.xml的请求路径 <a href="https://www.zhuqiaolun.com/baidusitemap.xml">https://www.zhuqiaolun.com/baidusitemap.xml</a><br><img src="/2020/05/1590766728000/1590766728000/20200530001048.png" alt="20200530001048"></p>
<h3 id="收录结果"><a href="#收录结果" class="headerlink" title="收录结果"></a>收录结果</h3><p><img src="/2020/05/1590766728000/1590766728000/20200530001050.png" alt="20200530001050"><br>通过认证之后进入baidusitemap提交，响应速度超快，不到5分钟就把链接收录完成</p>
<h3 id="查询收录结果"><a href="#查询收录结果" class="headerlink" title="查询收录结果"></a>查询收录结果</h3><p>访问 <a href="https://tool.chinaz.com/baidu/" target="_blank" rel="noopener">百度站长工具</a> 输入网址地址，点击查询，即可看到结果<br><img src="/2020/05/1590766728000/1590766728000/20200530004503.png" alt="20200530004503"></p>
<p><a href="https://tool.chinaz.com/baidu/?lm=0&amp;wd=www.zhuqiaolun.com&amp;pn=0&amp;rn=10&amp;btime=&amp;etime=" target="_blank" rel="noopener">快捷查看</a><br><a href="https://www.baidu.com/s?ie=utf-8&amp;csq=1&amp;pstg=20&amp;mod=2&amp;isbd=1&amp;wd=site%3Awww.zhuqiaolun.com&amp;oq=site%www.zhuqiaolun.com&amp;ie=utf-8&amp;usm=1&amp;rsv_idx=1&amp;bs=www.zhuqiaolun.com&amp;pn=0&amp;rn=10&amp;gpc=stf=,|stftype=2" target="_blank" rel="noopener">百度网站</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux中安装Nginx环境</title>
    <url>/2020/05/1590376771000/1590376771000/</url>
    <content><![CDATA[<h3 id="下载nginx"><a href="#下载nginx" class="headerlink" title="下载nginx"></a>下载nginx</h3><p>nginx 官网下载地址：<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">http://nginx.org/en/download.html</a><br>nginx 文件下载地址：<a href="https://nginx.org/download/" target="_blank" rel="noopener">https://nginx.org/download/</a></p>
<p>下载稳定（Stable version）版本即可:<br>Windows：<a href="http://nginx.org/download/nginx-1.18.0.zip" target="_blank" rel="noopener">http://nginx.org/download/nginx-1.18.0.zip</a><br>Linux：<a href="http://nginx.org/download/nginx-1.18.0.tar.gz" target="_blank" rel="noopener">http://nginx.org/download/nginx-1.18.0.tar.gz</a><br><img src="/2020/05/1590376771000/1590376771000/20200525112627.png" alt="20200525112627"></p>
<h3 id="上传nginx"><a href="#上传nginx" class="headerlink" title="上传nginx"></a>上传nginx</h3><pre><code>mkdir /usr/local/software           # 创建软件安装目录
cd /usr/local/software              # 进入软件安装目录
rz                                  # 上传nginx文件，需要安装 yum install lrzsz
ll                                  # 查看上传文件
tar -zxvf nginx-1.18.0.tar.gz       # 解压文件到当前目录</code></pre><p><img src="/2020/05/1590376771000/1590376771000/20200525130653.png" alt="20200525130653"></p>
<h3 id="检测nginx环境"><a href="#检测nginx环境" class="headerlink" title="检测nginx环境"></a>检测nginx环境</h3><p>在安装nginx前首先要确认系统中安装了gcc、zlib 、zlib-devel、pcre、pcre-devel、openssl、openssl-devel<br>Linux下检查是否安装过某软件包：</p>
<pre><code>yum list installed | grep gcc                     # 查看是否安装了gcc
yum list installed | grep pcre
yum list installed | grep pcre-devel
yum list installed | grep zlib
yum list installed | grep zlib-devel
yum list installed | grep openssl
yum list installed | grep openssl-devel      </code></pre><p><img src="/2020/05/1590376771000/1590376771000/20200525132249.png" alt="20200525132249">    </p>
<p>在此发现只安装了gcc和openssl，其他都没有安装，所以需要安装前置环境，输入以下命令：</p>
<pre><code>yum -y install zlib zlib-devel pcre pcre-devel openssl openssl-devel   # 一键安装</code></pre><p><img src="/2020/05/1590376771000/1590376771000/20200525133307.png" alt="20200525133307"></p>
<p>至此前置软件安装结束，下面进入正式安装nginx</p>
<h3 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h3><pre><code>cd /usr/local/software/nginx-1.18.0             # 进入nginx的安装根目录</code></pre><p><img src="/2020/05/1590376771000/1590376771000/20200525133513.png" alt="20200525133513"></p>
<h4 id="配置nginx安装目录"><a href="#配置nginx安装目录" class="headerlink" title="配置nginx安装目录"></a>配置nginx安装目录</h4><pre><code>./configure --prefix=/usr/local/nginx           # 配置nginx安装目录，执行完成后不会产生nginx目录</code></pre><p>执行完成后会出现一个 Makefile 的文件<br><img src="/2020/05/1590376771000/1590376771000/20200525134359.png" alt="20200525134359"> </p>
<h4 id="编译并安装"><a href="#编译并安装" class="headerlink" title="编译并安装"></a>编译并安装</h4><pre><code>make &amp;&amp; make install                             # 编译、安装，执行完成后会产生nginx目录
cd /usr/local/nginx/                             # 进入nginx目录</code></pre><p>nginx目录内容<br><img src="/2020/05/1590376771000/1590376771000/20200525143235.png" alt="20200525143235"> </p>
<h4 id="测试是否安装成功"><a href="#测试是否安装成功" class="headerlink" title="测试是否安装成功"></a>测试是否安装成功</h4><pre><code>./sbin/nginx -t</code></pre><p>出现 test is successful 表示安装成功，同时会生成一些文件<br><img src="/2020/05/1590376771000/1590376771000/20200525144949.png" alt="20200525144949"> </p>
<h3 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h3><pre><code>cd /usr/local/nginx/sbin                        # 进入启动目录
./nginx                                         # 启动nginx，默认读取 /usr/local/nginx/conf 目录下的 nginx.conf 配置文件
ps -ef | grep nginx                             # 查看nginx是否启动</code></pre><p>当出现 worker process 则表示运行成功<br><img src="/2020/05/1590376771000/1590376771000/20200525145522.png" alt="20200525145522"></p>
<p>另 执行命令： ps -A | grep nginx ，如果返回结果的话，也说明有nginx在运行，服务已经启动<br><img src="/2020/05/1590376771000/1590376771000/20200525150655.png" alt="20200525150655"></p>
<h3 id="访问nginx"><a href="#访问nginx" class="headerlink" title="访问nginx"></a>访问nginx</h3><pre><code>curl http://localhost                           # 默认端口为：80</code></pre><p>当出现 Welcome to nginx! 则表示访问成功<br><img src="/2020/05/1590376771000/1590376771000/20200525150656.png" alt="20200525150656"></p>
<h3 id="修改nginx-conf"><a href="#修改nginx-conf" class="headerlink" title="修改nginx.conf"></a>修改nginx.conf</h3><pre><code>cd /usr/local/nginx/conf/                       # 进入nginx配置文件目录
vim nginx.conf                                  # 进入编辑文件模式</code></pre><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log /usr/local/nginx/logs/nginx_error.log crit; </span><br><span class="line">events {</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">http {</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    # 开启gzip压缩</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_comp_level  5;</span><br><span class="line">    gzip_min_length  1024;</span><br><span class="line">    gzip_types   text/plain application/x-javascript text/css application/xml text/javascript  image/jpeg image/gif image/png;</span><br><span class="line">    # 隐藏nginx版本信息</span><br><span class="line">    server_tokens off;</span><br><span class="line"></span><br><span class="line">    server {</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.zhuqiaolun.com;</span><br><span class="line">		charset utf-8;</span><br><span class="line"></span><br><span class="line">        if ($scheme = http ) {</span><br><span class="line">            return  301 https://www.zhuqiaolun.com$request_uri;</span><br><span class="line">        }</span><br><span class="line">        location / {</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line"></span><br><span class="line">        location = /50x.html {</span><br><span class="line">            root   html;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    server {</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        server_name    www.zhuqiaolun.com;</span><br><span class="line">        root html; </span><br><span class="line">        index index.html index.htm;   </span><br><span class="line">        ssl_certificate www.zhuqiaolun.com.pem;</span><br><span class="line">        ssl_certificate_key www.zhuqiaolun.com.key;</span><br><span class="line">        ssl_session_timeout    5m;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_session_cache shared:SSL:5m;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">            root   html/blog/;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">			#try_files $uri $uri/ /index.html;</span><br><span class="line">        }</span><br><span class="line">		</span><br><span class="line">		location /video/ {</span><br><span class="line">			root /usr/local/nginx/html/video/;</span><br><span class="line">			mp4;</span><br><span class="line">			mp4_buffer_size 1m;#处理mp4初始内存大小</span><br><span class="line">			mp4_max_buffer_size 50m;#处理mp4最大内存大小</span><br><span class="line">			limit_rate 150k; #限速</span><br><span class="line">			limit_rate_after 20m;   #在20m后限速</span><br><span class="line">	   }</span><br><span class="line"></span><br><span class="line">	  </span><br><span class="line">		location /file {</span><br><span class="line">			charset utf-8;</span><br><span class="line">			alias  html/file/; #目录文件服务器根目录</span><br><span class="line">			if ($request_filename ~* ^.*?\.(html|doc|pdf|zip|docx|txt|mp4|rar)$) {</span><br><span class="line">				add_header Content-Disposition attachment;</span><br><span class="line">				add_header Content-Type application/octet-stream;</span><br><span class="line">			}</span><br><span class="line">            autoindex on;  # 开启目录文件列表</span><br><span class="line">            autoindex_exact_size on;  # 显示出文件的确切大小，单位是bytes</span><br><span class="line">            autoindex_localtime on;  # 显示的文件时间为文件的服务器时间</span><br><span class="line">		}</span><br><span class="line">		</span><br><span class="line">		location /picture {</span><br><span class="line">			charset utf-8;</span><br><span class="line">			alias  html/picture/; #目录文件服务器根目录</span><br><span class="line">			autoindex on; # 如果你想列出文件夹中的文件，可以打开这个选项</span><br><span class="line">			expires 30d;  # 设置浏览器缓存过期时间</span><br><span class="line">		}</span><br><span class="line">		</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>修改完成后使用 /usr/local/nginx/sbin/nginx -t 命令检测语句是否修改正确，如出现 test is successful，则表示正确<br><img src="/2020/05/1590376771000/1590376771000/20200525152320.png" alt="20200525152320"> </p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><pre><code>/usr/local/nginx/sbin/nginx                     # 启动服务
/usr/local/nginx/sbin/nginx -s stop             # 停止服务
/usr/local/nginx/sbin/nginx -s reload           # 重启服务
/usr/local/nginx/sbin/nginx -t                  # 检测语句</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>安装Java环境</title>
    <url>/2020/05/1590236390000/1590236390000/</url>
    <content><![CDATA[<h3 id="下载JDK"><a href="#下载JDK" class="headerlink" title="下载JDK"></a>下载JDK</h3><p>由于是安装在服务器，所以只需jre即可，选择对应的系统版本点击<a href="https://www.oracle.com/webapps/redirect/signon?nexturl=https://download.oracle.com/otn/java/jdk/8u251-b08/3d5a2bb8f8d4428bbe94aed7ec7ae784/server-jre-8u251-linux-x64.tar.gz" target="_blank" rel="noopener">下载</a>，没有登陆则跳转登陆页面，<br>账号：<a href="mailto:1097305826@qq.com">1097305826@qq.com</a><br>密码：Qwert@123456 </p>
<h1 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h1><h3 id="新建JAVA-HOME-变量"><a href="#新建JAVA-HOME-变量" class="headerlink" title="新建JAVA_HOME 变量"></a>新建JAVA_HOME 变量</h3><p><img src="/2020/05/1590236390000/1590236390000/20210712110116.png" alt="20210712110116"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">变量名：JAVA_HOME</span><br><span class="line">变量值：电脑上JDK安装的绝对路径，如：C:\Java\jdk1.8.0_45</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="新建-修改-CLASSPATH-变量"><a href="#新建-修改-CLASSPATH-变量" class="headerlink" title="新建/修改 CLASSPATH 变量"></a>新建/修改 CLASSPATH 变量</h3><p><img src="/2020/05/1590236390000/1590236390000/20210712110130.png" alt="20210712110130"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">变量名：CLASSPATH</span><br><span class="line">变量值：.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="修改Path-变量"><a href="#修改Path-变量" class="headerlink" title="修改Path 变量"></a>修改Path 变量</h3><p>新建两条路径：<br><img src="/2020/05/1590236390000/1590236390000/20210712110228.png" alt="20210712110228"></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">%JAVA_HOME%\bin</span><br><span class="line">%JAVA_HOME%\jre\bin</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="验证JDK环境变量"><a href="#验证JDK环境变量" class="headerlink" title="验证JDK环境变量"></a>验证JDK环境变量</h3><p>使用 java -version 查看环境是否安装完全<br><img src="/2020/05/1590236390000/1590236390000/20210712110521.png" alt="20210712110521"></p>
<h1 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h1><h3 id="上传JDK到服务器"><a href="#上传JDK到服务器" class="headerlink" title="上传JDK到服务器"></a>上传JDK到服务器</h3><p>安装命令 yum install -y lrzsz 工具，此为在Xshell下使用，rz:上传，sz:下载<br>在local下创建java目录，在弹出的窗口中选择要上传的jdk压缩文件，上传文件到Linux上java安装目录并解压，此时安装目录为：/usr/local/java/jdk1.8.0_231</p>
<pre><code>mkdir /use/local/java   # 创建目录
cd /use/local/java  # 进入目录
rz  # 上传文件
tar -zxvf jdk-8u231-linux-x64.tar.gz    # 解压文件</code></pre><p><img src="/2020/05/1590236390000/1590236390000/20200523211855.png" alt="20200523211855"></p>
<h3 id="配置JDK环境变量"><a href="#配置JDK环境变量" class="headerlink" title="配置JDK环境变量"></a>配置JDK环境变量</h3><p>使用 vim /etc/profile 命令进入编辑器，添加以下内容：</p>
<pre><code>set java environment
JAVA_HOME=/usr/local/java/jdk1.8.0_231
JRE_HOME=$JAVA_HOME/jre     
CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib
PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin
export JAVA_HOME JRE_HOME CLASS_PATH PATH</code></pre><p><img src="/2020/05/1590236390000/1590236390000/20200523212145.png" alt="20200523212145"><br>使用 Esc wq 对内容保存并退出<br>使用 source /etc/profile 让内容生效 </p>
<h3 id="验证JDK环境变量-1"><a href="#验证JDK环境变量-1" class="headerlink" title="验证JDK环境变量"></a>验证JDK环境变量</h3><p>使用 java -version 查看环境是否安装完全<br><img src="/2020/05/1590236390000/1590236390000/20200523221606.png" alt="20200523221606"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java反射机制</title>
    <url>/2020/05/1590300096000/1590300096000/</url>
    <content><![CDATA[<h3 id="什么是反射"><a href="#什么是反射" class="headerlink" title="什么是反射"></a>什么是反射</h3><p>JAVA反射机制是在运行状态中，对于任意一个类。都能都知道这个类的所有属性和方法，对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称之为java语言的反射机制；</p>
<h3 id="反射的作用"><a href="#反射的作用" class="headerlink" title="反射的作用"></a>反射的作用</h3><p>反射类： java.lang.reflect<br>反编译： .class –à .java<br>通过反射机制可以访问java对象中的属性，方法，构造方法，自定义方法</p>
<h3 id="创建Class对象的三种方式"><a href="#创建Class对象的三种方式" class="headerlink" title="创建Class对象的三种方式"></a>创建Class对象的三种方式</h3><p>实例对象：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">public class Person {</span><br><span class="line">   private String name;</span><br><span class="line">   private int age ;</span><br><span class="line">   // 构造方法（无参，有参）</span><br><span class="line">   // get 方法··</span><br><span class="line">   // set 方法··</span><br><span class="line">   </span><br><span class="line">   // 自定义一个执行方法，方法名称：execute，</span><br><span class="line">   // 参数1：name，类型：String.class</span><br><span class="line">   // 参数2：age，类型：int.class</span><br><span class="line">   public String execute(String name, int age) {</span><br><span class="line">       return "姓名:" + name + "；年龄："+ age;</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="创建Class对象的方式一"><a href="#创建Class对象的方式一" class="headerlink" title="创建Class对象的方式一"></a>创建Class对象的方式一</h4><p>对象.getClass()，获取Person类中的字节码文件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">Class&lt;?&gt; class1 = new Person().getClass();</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="创建Class对象的方式二"><a href="#创建Class对象的方式二" class="headerlink" title="创建Class对象的方式二"></a>创建Class对象的方式二</h4><p>.class，一个明确的类，任意一个类型都有一个静态的class属性</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">Class&lt;?&gt; class2 = Person.class;</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="创建Class对象的方式三-（推荐）"><a href="#创建Class对象的方式三-（推荐）" class="headerlink" title="创建Class对象的方式三 （推荐）"></a>创建Class对象的方式三 （推荐）</h4><p>必须是全路径名称，如：com.demon.hello.Person，如找不到则出现异常：ClassNotFoundException</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    Class&lt;?&gt; class3 = Class.forName(classPath);</span><br><span class="line">  } catch (ClassNotFoundException e) {</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="获取类的实例"><a href="#获取类的实例" class="headerlink" title="获取类的实例"></a>获取类的实例</h3><p>获取class类型之后，可以创建该类型的对象，如：class3.newInstance()</p>
<h3 id="执行类的方法"><a href="#执行类的方法" class="headerlink" title="执行类的方法"></a>执行类的方法</h3><p>获得class类型的Method对象，根据方法参数定义填写参数类型<br>说明 参数类型与需要反射的类的参数类型保持一致，如int.class不要写成Integer.class<br>invoke方法，参数为cls实例对象，和想要调用的方法参数<br>输出invoke方法的返回值(返回值类型可为方法定义的返回值类型，强制转化即可)</p>
<pre><code>// 第一个参数为方法名,第二个参数为参数name的类型Class对象，第三个参数为参数age的类型Class对象
Method method2 = class3.getMethod("execute", String.class, int.class);  
Object obj = method1.invoke(c1s.newInstance(), "张三", 30);
System.out.println("execute方法的返回值：" + value);   // 姓名:张三；年龄：30</code></pre><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>在获取创建类型的对象后，获取根据类的方法判断该执行类是否满足执行条件，如<br>是否有实现接口：c1s.getInterfaces()，返回是一个数组，<br>是否有注解类：c1s.getAnnotation(aCls.class)，参数为注解类.class，<br>更多查看 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/package-summary.html" target="_blank" rel="noopener">api</a> ···</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>kafka单机搭建 - 使用内置Zookeeper</title>
    <url>/2020/07/1595581721604/1595581721604/</url>
    <content><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>在刚开始学习Kafka的时候，安装Kafka时说Kafka依赖ZooKeeper，所以想要安装Kafka必须先安装ZooKeeper。<br>但是在下载Kafka的时候，官网上说，Kafka 0.5.x版本以上已经自带ZooKeeper，不需要自己安装ZooKeeper。<br>但在使用自带ZooKeeper也没有啥缺陷，反倒针对特定版本人家 Kafka 已经验证过其稳定性了。</p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网下载地址：<a href="http://kafka.apache.org/downloads.html" target="_blank" rel="noopener">http://kafka.apache.org/downloads.html</a><br><img src="/2020/07/1595581721604/1595581721604/20200724172452.png" alt="20200724172452"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>解压文件<br>打开 kafka_2.12-2.5.0\config<br>从文本编辑器里打开 server.properties,添加或者修改内容</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">listeners=PLAINTEXT://10.200.47.142:9092</span><br><span class="line">log.dirs=D:\\kafka_2.12-2.5.0\\logs\\kafka</span><br><span class="line">num.partitions=4</span><br><span class="line">zookeeper.connect=127.0.0.1:2181</span><br><span class="line">zookeeper.connection.timeout.ms=30000</span><br></pre></td></tr></tbody></table></figure></div>
<p>端口号可以被任意修改。如果端口号设置为小于1024，那么kafka需要以root身份启动，不指定的话，按照默认9092<br>【service.properties】port = 19092<br>【connect-distributed.properties 】bootstrap.servers=localhost:19092<br>【producer.properties 】bootstrap.servers=localhost:19092<br>【connect-standalone.properties 】bootstrap.servers=localhost:19092<br>【consumer.properties 】bootstrap.servers=localhost:19092</p>
<p>从文本编辑器里打开 zookeeper.properties,添加或者修改内容</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">dataDir=D:\\kafka_2.12-2.5.0\\data\\zookeeper</span><br><span class="line">dataLogDir=D:\\kafka_2.12-2.5.0\\logs\\zookeeper</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>在根目录下编写bat文件启动：</p>
<p>1.start-zookeeper.bat内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start cmd /c "title zookeeper-21810 &amp;&amp; .\bin\windows\zookeeper-server-start .\config\zookeeper.properties"</span><br></pre></td></tr></tbody></table></figure></div>
<p>2.start-kafka.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start cmd /c "title kafka_2.11-2.4.1-9092 &amp;&amp; .\bin\windows\kafka-server-start.bat .\config\server.properties"</span><br></pre></td></tr></tbody></table></figure></div>
<p>按照顺序启动，即可执行，</p>
<p><img src="/2020/07/1595581721604/1595581721604/20200724175212.png" alt="20200724175212"><br><img src="/2020/07/1595581721604/1595581721604/20200724175232.png" alt="20200724175232"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>kafka集群搭建 - 使用内置Zookeeper</title>
    <url>/2020/07/1595582052033/1595582052033/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网下载地址：<a href="http://kafka.apache.org/downloads.html" target="_blank" rel="noopener">http://kafka.apache.org/downloads.html</a><br>下载完成后复制一式三份，完成集群部署至少需要三台以及三台以上的服务。</p>
<p>kafka版本:kafka_2.12-2.5.0<br>三台主机IP 127.0.0.1、127.0.0.2、127.0.0.3</p>
<h3 id="kafka配置"><a href="#kafka配置" class="headerlink" title="kafka配置"></a>kafka配置</h3><h4 id="第一台"><a href="#第一台" class="headerlink" title="第一台"></a>第一台</h4><p>server.properties：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 唯一值</span><br><span class="line">broker.id=1</span><br><span class="line">listeners=PLAINTEXT://127.0.0.1:9092</span><br><span class="line"># 建议填写服务器的数量值</span><br><span class="line">num.partitions=3 </span><br><span class="line"># 其他zk服务的连接</span><br><span class="line">zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181</span><br><span class="line">zookeeper.connection.timeout.ms=30000</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="第二台"><a href="#第二台" class="headerlink" title="第二台"></a>第二台</h4><p>server.properties：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 唯一值</span><br><span class="line">broker.id=2</span><br><span class="line">listeners=PLAINTEXT://127.0.0.2:9092</span><br><span class="line"># 建议填写服务器的数量值</span><br><span class="line">num.partitions=3 </span><br><span class="line"># 其他zk服务的连接</span><br><span class="line">zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181</span><br><span class="line">zookeeper.connection.timeout.ms=30000</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="第三台"><a href="#第三台" class="headerlink" title="第三台"></a>第三台</h4><p>server.properties：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 唯一值</span><br><span class="line">broker.id=3</span><br><span class="line">listeners=PLAINTEXT://127.0.0.3:9092</span><br><span class="line"># 建议填写服务器的数量值</span><br><span class="line">num.partitions=3 </span><br><span class="line"># 其他zk服务的连接</span><br><span class="line">zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181</span><br><span class="line">zookeeper.connection.timeout.ms=30000</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="zookeeper配置"><a href="#zookeeper配置" class="headerlink" title="zookeeper配置"></a>zookeeper配置</h3><p>zookeeper可统一配置，zookeeper.properties：<br> </p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">dataDir=D:\\kafka_2.12-2.5.0\\data\\zookeeper</span><br><span class="line">dataLogDir=D:\\kafka_2.12-2.5.0\\logs\\zookeeper</span><br><span class="line">clientPort=2181</span><br><span class="line"># maxClientCnxns = 0 # 注释掉该配置</span><br><span class="line">admin.enableServer=false</span><br><span class="line">#设置连接参数，添加如下配置</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">#设置broker Id的服务地址</span><br><span class="line">server.1=127.0.0.1:2888:3888</span><br><span class="line">server.2=127.0.0.2:2888:3888</span><br><span class="line">server.3=127.0.0.3:2888:3888</span><br></pre></td></tr></tbody></table></figure></div><br>同时在zookeeper数据目录dataDir下添加id配置，在各台服务的zookeeper数据目录添加myid文件且无后缀名，写入各自服务broker.id属性值，<br><img src="/2020/07/1595582052033/1595582052033/20200725114405.png" alt="20200725114405"><br><img src="/2020/07/1595582052033/1595582052033/20200725114520.png" alt="20200725114520"><br><img src="/2020/07/1595582052033/1595582052033/20200725114552.png" alt="20200725114552"><p></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka使用 （Java普通调用）</title>
    <url>/2020/07/1595649722982/1595649722982/</url>
    <content><![CDATA[<h3 id="依赖引入"><a href="#依赖引入" class="headerlink" title="依赖引入"></a>依赖引入</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-nop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.58<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Topic操作"><a href="#Topic操作" class="headerlink" title="Topic操作"></a>Topic操作</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line">import org.apache.kafka.clients.CommonClientConfigs;</span><br><span class="line">import org.apache.kafka.clients.admin.AdminClient;</span><br><span class="line">import org.apache.kafka.clients.admin.CreateTopicsResult;</span><br><span class="line">import org.apache.kafka.clients.admin.DeleteTopicsResult;</span><br><span class="line">import org.apache.kafka.clients.admin.ListTopicsResult;</span><br><span class="line">import org.apache.kafka.clients.admin.NewTopic;</span><br><span class="line">import org.junit.After;</span><br><span class="line">import org.junit.Before;</span><br><span class="line">import org.junit.Test;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Topic操作</span><br><span class="line"> */</span><br><span class="line">public class CreateTopics {</span><br><span class="line">	private static AdminClient adminClient = null;</span><br><span class="line">	/**</span><br><span class="line">	 * 初始化adminClient</span><br><span class="line">	 */</span><br><span class="line">	@Before</span><br><span class="line">	public  void getAdminClient() {</span><br><span class="line">		Properties props = new Properties();</span><br><span class="line">		props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, "127.0.0.1:9092");</span><br><span class="line">		adminClient = AdminClient.create(props);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 获取所有Topic</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public void getTopicList() {</span><br><span class="line">		try {</span><br><span class="line">			ListTopicsResult listTopics = adminClient.listTopics();</span><br><span class="line">			Set<span class="tag">&lt;<span class="name">String</span>&gt;</span> topics = listTopics.names().get();</span><br><span class="line">			for (String topic : topics) {</span><br><span class="line">				System.out.println(topic);</span><br><span class="line">			}</span><br><span class="line">		} catch (InterruptedException | ExecutionException e) {</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 创建Topic 创建了3个名为"first", "second","third"，分区数为1，复制因子为1的Topic.</span><br><span class="line">	 * 创建完成，返回null</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public  void getCreateTopic() {</span><br><span class="line">		ArrayList<span class="tag">&lt;<span class="name">NewTopic</span>&gt;</span> topics = new ArrayList<span class="tag">&lt;<span class="name">NewTopic</span>&gt;</span>();</span><br><span class="line">		topics.add(new NewTopic("test", 4, (short) 1));</span><br><span class="line">        topics.add(new NewTopic("first", 4, (short) 1));</span><br><span class="line">		topics.add(new NewTopic("second", 4, (short) 1));</span><br><span class="line">		topics.add(new NewTopic("third", 4, (short) 1));</span><br><span class="line">		CreateTopicsResult result = adminClient.createTopics(topics);</span><br><span class="line">		try {</span><br><span class="line">			System.out.println(result.all().get());</span><br><span class="line">		} catch (InterruptedException e) {</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		} catch (ExecutionException e) {</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 删除Topic</span><br><span class="line">	 */</span><br><span class="line">	@Test</span><br><span class="line">	public  void getDeleteTopic() {</span><br><span class="line">		DeleteTopicsResult deleteTopicsResult =adminClient.deleteTopics(Collections.singleton("test"));</span><br><span class="line">		System.out.println(JSONObject.toJSONString(deleteTopicsResult));</span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">	 * 关闭连接</span><br><span class="line">	 */</span><br><span class="line">	@After</span><br><span class="line">	public  void afterClass() {</span><br><span class="line">		adminClient.close();</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h3><h4 id="普通生产者"><a href="#普通生产者" class="headerlink" title="普通生产者"></a>普通生产者</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">public static void testProducer(String topic) {</span><br><span class="line">    Properties props = new Properties();</span><br><span class="line">    props.put("bootstrap.servers", "127.0.0.1:9092");</span><br><span class="line">    props.put("acks", "all");</span><br><span class="line">    props.put("retries", 0);</span><br><span class="line">    props.put("batch.size", 16384);</span><br><span class="line">    props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");</span><br><span class="line">    props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");</span><br><span class="line">    KafkaProducer<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> producer = new KafkaProducer<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span>(props);</span><br><span class="line">    for (int i = 0; i <span class="tag">&lt; <span class="attr">10</span>; <span class="attr">i</span>++) {</span></span><br><span class="line">        producer.send(new ProducerRecord&lt;String, String&gt;(topic, Integer.toString(i), Integer.toString(i)));</span><br><span class="line">    }</span><br><span class="line">    producer.close();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="事务生产者"><a href="#事务生产者" class="headerlink" title="事务生产者"></a>事务生产者</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">public static void testTransactionProducer(String topic) {</span><br><span class="line">    Properties props = new Properties();</span><br><span class="line">    props.put("bootstrap.servers", "127.0.0.1:9092");</span><br><span class="line">    props.put("transactional.id", "my-transactional-id");</span><br><span class="line">    props.put("acks", "all");</span><br><span class="line">    props.put("batch.size", 16384);</span><br><span class="line">    KafkaProducer<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> producer = new KafkaProducer<span class="tag">&lt;&gt;</span>(props, new StringSerializer(),new StringSerializer());</span><br><span class="line">    producer.initTransactions();</span><br><span class="line">    try {</span><br><span class="line">        producer.beginTransaction();</span><br><span class="line">        for (int i = 0; i <span class="tag">&lt; <span class="attr">3</span>; <span class="attr">i</span>++) {</span></span><br><span class="line">            producer.send(new ProducerRecord&lt;&gt;(topic, Integer.toString(i), Integer.toString(i)));</span><br><span class="line">        }</span><br><span class="line">        producer.commitTransaction();</span><br><span class="line">    } catch (ProducerFencedException | OutOfOrderSequenceException | AuthorizationException e) {</span><br><span class="line">        // We can't recover from these exceptions, so our only option is to close the</span><br><span class="line">        // producer and exit.</span><br><span class="line">        producer.close();</span><br><span class="line">    } catch (KafkaException e) {</span><br><span class="line">        // For all other exceptions, just abort the transaction and try again.</span><br><span class="line">        producer.abortTransaction();</span><br><span class="line">    } finally {</span><br><span class="line">        producer.close();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.time.Duration;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.Properties;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line">import org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line"></span><br><span class="line">public class CustomConsumer {</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) {</span><br><span class="line">		Properties props = new Properties();</span><br><span class="line">		// 定义kakfa 服务的地址，不需要将所有broker指定上 </span><br><span class="line">		props.put("bootstrap.servers", "127.0.0.1:9092");</span><br><span class="line">		// 制定consumer group </span><br><span class="line">		props.put("group.id", "custom_group_id");</span><br><span class="line">		// 是否自动确认offset </span><br><span class="line">		props.put("enable.auto.commit", "true");</span><br><span class="line">		// 自动确认offset的时间间隔 </span><br><span class="line">		props.put("auto.commit.interval.ms", "1000");</span><br><span class="line">		// key的序列化类</span><br><span class="line">		props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</span><br><span class="line">		// value的序列化类 </span><br><span class="line">		props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");</span><br><span class="line">		// 定义consumer </span><br><span class="line">		KafkaConsumer<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> consumer = new KafkaConsumer<span class="tag">&lt;&gt;</span>(props);</span><br><span class="line">		// 消费者订阅的topic, 可同时订阅多个 </span><br><span class="line">		consumer.subscribe(Arrays.asList("test","first", "second","third"));</span><br><span class="line">		while (true) {</span><br><span class="line">			// 读取数据，读取超时时间为100ms </span><br><span class="line">			ConsumerRecords<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> records = consumer.poll(Duration.ofMillis(100));</span><br><span class="line">			for (ConsumerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> record : records)</span><br><span class="line">				System.out.printf("offset = %d, key = %s, value = %s%n", record.offset(), record.key(), record.value());</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="集群使用"><a href="#集群使用" class="headerlink" title="集群使用"></a>集群使用</h3><p>在配置中将bootstrap.servers，修改以下方式即可，需要将所有broker指定写上<br> </p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">props.put("bootstrap.servers", "127.0.0.1:9092,127.0.0.2:9092,127.0.0.3:9092");</span><br></pre></td></tr></tbody></table></figure></div><p></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>Kafka使用 （SpringBoot调用）</title>
    <url>/2020/07/1595654393778/1595654393778/</url>
    <content><![CDATA[<h3 id="依赖引入"><a href="#依赖引入" class="headerlink" title="依赖引入"></a>依赖引入</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- kafka start --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- kafka end --&gt;</span>      </span><br><span class="line"><span class="comment">&lt;!-- fastjson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.62<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  #  基本配置</span><br><span class="line"> kafka:</span><br><span class="line">   # 以逗号分隔的地址列表，用于建立与 Kafka 集群的初始连接 (kafka 默认的端口号为 9092)</span><br><span class="line">   bootstrap-servers: 127.0.0.1:9092</span><br><span class="line">   # 定义生产者</span><br><span class="line">   producer:</span><br><span class="line">     client-id: kafka.client.id</span><br><span class="line">     # 发生错误后，消息重发的次数。</span><br><span class="line">     retries: 0</span><br><span class="line">     #当有多个消息需要被发送到同一个分区时，生产者会把它们放在同一个批次里。该参数指定了一个批次可以使用的内存大小，按照字节数计算。</span><br><span class="line">     batch-size: 16384</span><br><span class="line">     # 设置生产者内存缓冲区的大小。</span><br><span class="line">     buffer-memory: 33554432</span><br><span class="line">     # 键的序列化方式</span><br><span class="line">     key-serializer: org.apache.kafka.common.serialization.StringSerializer</span><br><span class="line">     # 值的序列化方式</span><br><span class="line">     value-serializer: org.apache.kafka.common.serialization.StringSerializer</span><br><span class="line">     # acks=0 ： 生产者在成功写入消息之前不会等待任何来自服务器的响应。</span><br><span class="line">     # acks=1 ： 只要集群的首领节点收到消息，生产者就会收到一个来自服务器成功响应。</span><br><span class="line">     # acks=all ：只有当所有参与复制的节点全部收到消息时，生产者才会收到一个来自服务器的成功响应。</span><br><span class="line">     acks: 1</span><br><span class="line">   # 定义消费者</span><br><span class="line">   consumer:</span><br><span class="line">     # 自动提交的时间间隔 在 spring boot 2.X 版本中这里采用的是值的类型为 Duration 需要符合特定的格式，如 1S,1M,2H,5D</span><br><span class="line">     auto-commit-interval: 3S</span><br><span class="line">     # 该属性指定了消费者在读取一个没有偏移量的分区或者偏移量无效的情况下该作何处理：</span><br><span class="line">     # latest（默认值）在偏移量无效的情况下，消费者将从最新的记录开始读取数据（在消费者启动之后生成的记录）</span><br><span class="line">     # earliest ：在偏移量无效的情况下，消费者将从起始位置读取分区的记录</span><br><span class="line">     auto-offset-reset: earliest</span><br><span class="line">     # 是否自动提交偏移量，默认值是 true,为了避免出现重复数据和数据丢失，可以把它设置为 false,然后手动提交偏移量</span><br><span class="line">     enable-auto-commit: true</span><br><span class="line">     # 键的反序列化方式</span><br><span class="line">     key-deserializer: org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">     # 值的反序列化方式</span><br><span class="line">     value-deserializer: org.apache.kafka.common.serialization.StringDeserializer</span><br><span class="line">   listener:</span><br><span class="line">     # 在侦听器容器中运行的线程数(消费者个数即可)</span><br><span class="line">     concurrency: 5</span><br><span class="line">     </span><br><span class="line">demon:</span><br><span class="line">  #消费者配置</span><br><span class="line">  mqConfig: </span><br><span class="line">    # 监听的主题topic</span><br><span class="line">    topics: test,first,second,third   </span><br><span class="line">    topic:</span><br><span class="line">      # 监听的主题first的消息执行类</span><br><span class="line">      first: com.demon.springbootkafka.listener.consumer.message.FirstMessage</span><br><span class="line">      # 监听的主题second的消息执行类</span><br><span class="line">      second: com.demon.springbootkafka.listener.consumer.message.SecondMessage</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="类配置"><a href="#类配置" class="headerlink" title="类配置"></a>类配置</h3><p>mq的消费者配置类：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @className: MqProperties.java</span><br><span class="line"> * @description:  mq的消费者配置类，映射 配置文件里面的值</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2020/6/16 18:00</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = "demon.mqConfig")</span><br><span class="line">@Data</span><br><span class="line">public class MqConsumerTopicConfig {</span><br><span class="line">    Map&lt;String,Class&lt;?&gt;&gt; topic;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h3><p>KafKaProducerService</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.service;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line">import java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: KafKaProducerService</span><br><span class="line"> * @Description: 生产者service</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/4/23 13:38</span><br><span class="line"> */</span><br><span class="line">public interface KafKaProducerService {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 发送标准消息没有回执</span><br><span class="line">     * @param topic 主题</span><br><span class="line">     * @param key key</span><br><span class="line">     * @param data 内容</span><br><span class="line">     */</span><br><span class="line">    void sendStandardMessage(String topic, String key, String data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 发送标准消息同步有阻塞</span><br><span class="line">     * @param topic 主题</span><br><span class="line">     * @param key key</span><br><span class="line">     * @param data 内容</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws InterruptedException 异常</span><br><span class="line">     * @throws ExecutionException 异常</span><br><span class="line">     * @throws TimeoutException 异常</span><br><span class="line">     */</span><br><span class="line">    Long sendStandardMessageSync(String topic, String key, String data) throws InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 发送标准消息异步无阻塞</span><br><span class="line">     * @param topic 主题</span><br><span class="line">     * @param key key</span><br><span class="line">     * @param data 内容</span><br><span class="line">     */</span><br><span class="line">    void sendStandardMessageAsync(String topic, String key, String data);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>KafKaProducerServiceImpl:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.service.impl;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line">import org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line">import org.springframework.kafka.support.SendResult;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.util.concurrent.ListenableFuture;</span><br><span class="line">import org.springframework.util.concurrent.ListenableFutureCallback;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line">import java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: KafKaProducerServiceImpl</span><br><span class="line"> * @Description: 生产者service的实现，负责执行消息发送</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/4/23 13:38</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Service</span><br><span class="line">public class KafKaProducerServiceImpl implements com.demon.springbootkafka.service.KafKaProducerService {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private KafkaTemplate<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *  构建待发送的消息</span><br><span class="line">     * @param topic topic</span><br><span class="line">     * @param key key</span><br><span class="line">     * @param data data</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    private ProducerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> getRecord(String topic, String key, String data){</span><br><span class="line">        if(key == null){</span><br><span class="line">            return  new ProducerRecord<span class="tag">&lt;&gt;</span>(topic,data);</span><br><span class="line">        }else{</span><br><span class="line">            return new ProducerRecord<span class="tag">&lt;&gt;</span>(topic,key,data);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sendStandardMessage(String topic, String key, String data){</span><br><span class="line">        kafkaTemplate.send(getRecord(topic,key,data));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Long sendStandardMessageSync(String topic, String key, String data) throws InterruptedException, ExecutionException, TimeoutException {</span><br><span class="line">        SendResult<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> stringStringSendResult = kafkaTemplate.send(getRecord(topic, key, data)).get(1, TimeUnit.SECONDS);</span><br><span class="line">        System.out.println(stringStringSendResult.getProducerRecord().timestamp());</span><br><span class="line">        return stringStringSendResult.getProducerRecord().timestamp();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void sendStandardMessageAsync(String topic, String key, String data) {</span><br><span class="line">        ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; sendResultListenableFuture = kafkaTemplate.send(getRecord(topic,key,data));</span><br><span class="line">        // 发送消息回调</span><br><span class="line">        //noinspection NullableProblems</span><br><span class="line">        sendResultListenableFuture.addCallback(new ListenableFutureCallback&lt;SendResult&lt;String, String&gt;&gt;() {</span><br><span class="line">            /** 发送成功回调方法 */</span><br><span class="line">            @Override</span><br><span class="line">            public void onSuccess(SendResult<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> sendResultMap) {</span><br><span class="line">                log.debug("发送消息成功：" + sendResultMap);</span><br><span class="line">            }</span><br><span class="line">            /** 发送失败回调方法 */</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Throwable throwable) {</span><br><span class="line">                log.debug("发送消息失败："+ throwable.getMessage());</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生产者监听"><a href="#生产者监听" class="headerlink" title="生产者监听"></a>生产者监听</h3><p>KafkaSendResultHandler：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.listener.producer;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line">import org.apache.kafka.clients.producer.RecordMetadata;</span><br><span class="line">import org.springframework.kafka.support.ProducerListener;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: KafkaSendResultHandler</span><br><span class="line"> * @Description: 发送消息结果回调</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/4/23 13:55</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class KafkaSendResultHandler implements ProducerListener {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onSuccess(ProducerRecord producerRecord, RecordMetadata recordMetadata) {</span><br><span class="line">        log.info("发送消息监听成功 : " + producerRecord.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onError(ProducerRecord producerRecord, Exception exception) {</span><br><span class="line">        log.info("发送消息监听失败 : " + exception);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h3><p>KafkaConsumerService：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.listener.consumer;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootkafka.config.MqConsumerTopicConfig;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: KafkaConsumerService</span><br><span class="line"> * @Description: 消费者监听消息,通过类的反射执行topic消息处理</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/4/23 14:44</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class KafkaConsumerService {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private MqConsumerTopicConfig mqConsumerTopicConfig;</span><br><span class="line"></span><br><span class="line">    @KafkaListener(topics = "#{'${demon.mqConfig.topics}'.split(',')}", groupId = "test-group")</span><br><span class="line">    public void receive(ConsumerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> record) {</span><br><span class="line">        String topic = record.topic();</span><br><span class="line">        log.info("------ " + topic + " 消费者处理消息------");</span><br><span class="line">        try {</span><br><span class="line">            if (mqConsumerTopicConfig.getTopic().containsKey(topic)) {</span><br><span class="line">                String classPath = mqConsumerTopicConfig.getTopic().get(topic).getName();</span><br><span class="line">                try {</span><br><span class="line">                    Class<span class="php"><span class="meta">&lt;?</span>&gt; c1s = <span class="class"><span class="keyword">Class</span>.<span class="title">forName</span>(<span class="title">classPath</span>);</span></span></span><br><span class="line"><span class="php">                    <span class="comment">//判断是否有实现ConsumerMessageExecute消息处理接口，否则不予执行</span></span></span><br><span class="line"><span class="php">                    <span class="keyword">if</span> (c1s.getInterfaces().length &gt; <span class="number">0</span> &amp;&amp; c1s.getInterfaces()[<span class="number">0</span>].equals(ConsumerMessageExecute<span class="class">.<span class="keyword">class</span>)) </span>{</span></span><br><span class="line"><span class="php">                        <span class="comment">//获得Class的Method对象,参数为方法名,参数列表的类型Class对象</span></span></span><br><span class="line"><span class="php">                        Method method = c1s.getMethod(<span class="string">"execute"</span>, ConsumerRecord<span class="class">.<span class="keyword">class</span>);</span></span></span><br><span class="line"><span class="php">                        <span class="comment">//invoke方法，参数为cls实例对象，和想要调用的方法参数</span></span></span><br><span class="line"><span class="php">                        Boolean value = (Boolean) method.invoke(c1s.newInstance(), record);</span></span><br><span class="line"><span class="php">                        <span class="comment">//输出invoke方法的返回值</span></span></span><br><span class="line"><span class="php">                        System.out.println(<span class="string">"execute方法的返回值："</span> + value);</span></span><br><span class="line"><span class="php">                    } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="php">                        log.error(<span class="string">"============ 调用class：{} 错误:{}"</span>, classPath, <span class="string">"此类没有实现 MessageExecute 接口！！！"</span>);</span></span><br><span class="line"><span class="php">                    }</span></span><br><span class="line"><span class="php">                } <span class="keyword">catch</span> (<span class="keyword">Exception</span> e) {</span></span><br><span class="line"><span class="php">                    e.printStackTrace();</span></span><br><span class="line"><span class="php">                    log.error(<span class="string">"============ 调用class：{} 异常：{}"</span>, classPath, e);</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"><span class="php">            } <span class="keyword">else</span> {</span></span><br><span class="line"><span class="php">                log.error(<span class="string">"============ {}不存在"</span>, topic);</span></span><br><span class="line"><span class="php">            }</span></span><br><span class="line"><span class="php">        } <span class="keyword">catch</span> (<span class="keyword">Exception</span> e) {</span></span><br><span class="line"><span class="php">            e.printStackTrace();</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"><span class="php">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>ConsumerMessageExecute：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.listener.consumer;</span><br><span class="line"></span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 消息执行统一接口</span><br><span class="line"> * @ClassName: MessageExecute</span><br><span class="line"> * @Description: 消息实现接口，必须实现此接口，否则无法执行消息处理</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/5/24 12:55</span><br><span class="line"> */</span><br><span class="line">public interface ConsumerMessageExecute {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 消费者 消息执行方法</span><br><span class="line">     * @param record 消息体</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    boolean execute(ConsumerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> record);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>FirstMessage:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.listener.consumer.message;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootkafka.listener.consumer.ConsumerMessageExecute;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: FirstMessage</span><br><span class="line"> * @Description: 监听topic【first】的处理</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/6/17 19:14</span><br><span class="line"> */</span><br><span class="line">public class FirstMessage implements ConsumerMessageExecute {</span><br><span class="line">    @Override</span><br><span class="line">    public boolean execute(ConsumerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> record) {</span><br><span class="line">        System.out.println(String.format("topic = %s, key = %s, value = %s ",record.topic(), record.key(), record.value()));</span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>SecondMessage:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.listener.consumer.message;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootkafka.listener.consumer.ConsumerMessageExecute;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: MessageUrgent</span><br><span class="line"> * @Description: 监听topic【second】的处理</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/6/17 19:15</span><br><span class="line"> */</span><br><span class="line">public class SecondMessage implements ConsumerMessageExecute {</span><br><span class="line">    @Override</span><br><span class="line">    public boolean execute(ConsumerRecord<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> record) {</span><br><span class="line">        System.out.println(String.format("topic = %s, key = %s, value = %s ",record.topic(), record.key(), record.value()));</span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>SpringBootKafkaApplicationTests：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.demon.springbootkafka.service.KafKaProducerService;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.UUID;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line">import java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">class SpringBootKafkaApplicationTests {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private KafKaProducerService kafKaProducerService;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() {</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void sendStandardMessage() {</span><br><span class="line">        String topic = "test";</span><br><span class="line">        String key = UUID.randomUUID().toString();</span><br><span class="line">        String data = JSON.toJSONString(new JSONObject().put("time",System.currentTimeMillis()));</span><br><span class="line">        kafKaProducerService.sendStandardMessage(topic,key,data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void sendStandardMessageAsync() {</span><br><span class="line">        String topic = "test";</span><br><span class="line">        String key = UUID.randomUUID().toString();</span><br><span class="line">        String data = JSON.toJSONString(new JSONObject().put("time",System.currentTimeMillis()));</span><br><span class="line">        kafKaProducerService.sendStandardMessageAsync(topic,key,data);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void sendStandardMessageSync() {</span><br><span class="line">        String topic = "test";</span><br><span class="line">        String key = UUID.randomUUID().toString();</span><br><span class="line">        JSONObject jsonObject = new JSONObject(true);</span><br><span class="line">        jsonObject.put("time",System.currentTimeMillis());</span><br><span class="line">        String data = jsonObject.toJSONString();</span><br><span class="line">        try {</span><br><span class="line">            kafKaProducerService.sendStandardMessageSync(topic, key, data);</span><br><span class="line">        } catch (InterruptedException | TimeoutException | ExecutionException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>KafkaConfig:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka.config;</span><br><span class="line"></span><br><span class="line">import org.apache.kafka.clients.admin.AdminClient;</span><br><span class="line">import org.apache.kafka.clients.admin.AdminClientConfig;</span><br><span class="line">import org.springframework.boot.autoconfigure.kafka.KafkaProperties;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.kafka.annotation.EnableKafka;</span><br><span class="line">import org.springframework.kafka.core.KafkaAdmin;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: KafkaConfig</span><br><span class="line"> * @Description: KafkaConfig 配置,操作topic</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2020/4/23 18:28</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableKafka</span><br><span class="line">public class KafkaConfig {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private KafkaProperties kafkaProperties;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *     创建一个kafka管理类，相当于rabbitMQ的管理类rabbitAdmin,</span><br><span class="line">     *     没有此bean无法自定义的使用adminClient创建topic</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public KafkaAdmin kafkaAdmin() {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> props = new HashMap<span class="tag">&lt;&gt;</span>(1);</span><br><span class="line">        //配置Kafka实例的连接地址</span><br><span class="line">        //kafka的地址，不是zookeeper</span><br><span class="line">        props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaProperties.getBootstrapServers().get(0));</span><br><span class="line">        return new KafkaAdmin(props);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *     kafka客户端，在spring中创建这个bean之后可以注入并且创建topic,</span><br><span class="line">     *     用于集群环境，创建对个副本</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public AdminClient adminClient() {</span><br><span class="line">        return AdminClient.create(kafkaAdmin().getConfig());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>SpringBootKafkaApplicationTests_topic:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootkafka;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import org.apache.kafka.clients.admin.*;</span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.ExecutionException;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">class SpringBootKafkaApplicationTests_topic {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private AdminClient adminClient;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads() {</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void listTopics(){</span><br><span class="line">        try {</span><br><span class="line">            ListTopicsResult listTopics = adminClient.listTopics();</span><br><span class="line">            Set<span class="tag">&lt;<span class="name">String</span>&gt;</span> topics = listTopics.names().get();</span><br><span class="line">            for (String topic : topics) {</span><br><span class="line">                System.out.println(topic);</span><br><span class="line">            }</span><br><span class="line">        } catch (InterruptedException | ExecutionException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void createTopic() {</span><br><span class="line">        ArrayList<span class="tag">&lt;<span class="name">NewTopic</span>&gt;</span> topics = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        NewTopic newTopic = new NewTopic("test1", 2, (short) 1);</span><br><span class="line">        topics.add(newTopic);</span><br><span class="line">        CreateTopicsResult result = adminClient.createTopics(topics);</span><br><span class="line">        System.out.println( JSON.toJSONString(result));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void deleteTopics() {</span><br><span class="line">        DeleteTopicsResult deleteTopicsResult = adminClient.deleteTopics(Collections.singletonList("test1"));</span><br><span class="line">        System.out.println( JSON.toJSONString(deleteTopicsResult));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows下安装RabbitMQ及配置</title>
    <url>/2020/06/1591869892000/1591869892000/</url>
    <content><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>rabbitMQ是一个在AMQP协议标准基础上完整的，可服用的企业消息系统。它遵循Mozilla Public License开源协议，采用 Erlang 实现的工业级的消息队列(MQ)服务器，Rabbit MQ 是建立在Erlang OTP平台上。</p>
<h3 id="安装-Erlang"><a href="#安装-Erlang" class="headerlink" title="安装 Erlang"></a>安装 Erlang</h3><p>下载地址：​<a href="https://www.erlang.org/downloads" target="_blank" rel="noopener">https://www.erlang.org/downloads</a>，下载与系统对应的版本文件<br><img src="/2020/06/1591869892000/1591869892000/20200611182450.png" alt="20200611182450"><br>安装时，一路 next 即可安装完成<br>设置环境变量，<br>    &nbsp;&nbsp;变量名：ERLANG_HOME<br>    &nbsp;&nbsp;变量值：D:\erl-23.0（安装根目录）<br><img src="/2020/06/1591869892000/1591869892000/20200611182941.png" alt="20200611182941"></p>
<p>修改环境变量path，增加Erlang变量至path，%ERLANG_HOME%\bin;<br>打开cmd命令框，输入erl<br><img src="/2020/06/1591869892000/1591869892000/20200611183057.png" alt="20200611183057"><br>至此，Erlang 安装完成</p>
<h3 id="安装-RabbitMq"><a href="#安装-RabbitMq" class="headerlink" title="安装 RabbitMq"></a>安装 RabbitMq</h3><p>下载地址：<a href="https://www.rabbitmq.com/install-windows-manual.html" target="_blank" rel="noopener">https://www.rabbitmq.com/install-windows-manual.html</a><br>本文选择解压缩安装 <a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.8.4/rabbitmq-server-windows-3.8.4.zip" target="_blank" rel="noopener">rabbitmq-server-windows-3.8.4.zip</a><br>配置环境变量：<br>    &nbsp;&nbsp;变量名：RABBITMQ_SERVER<br>    &nbsp;&nbsp;变量值：D:\rabbitmq_server-3.8.4（安装根目录）<br>打开cmd命令框，进入 安装目录<br>安装插件，命令：rabbitmq-plugins.bat enable rabbitmq_management<br>启动：rabbitmq-server.bat<br><img src="/2020/06/1591869892000/1591869892000/20200611183733.png" alt="20200611183733"><br>rabbitmq启动成功，浏览器中<a href="http://localhost:15672" target="_blank" rel="noopener">http://localhost:15672</a>，<br><img src="/2020/06/1591869892000/1591869892000/20200611183828.png" alt="20200611183828"><br>输入guest,guest进入rabbitMQ管理控制台：<br><img src="/2020/06/1591869892000/1591869892000/20200611183930.png" alt="20200611183930"><br>至此，rabbitMQ安装部署完成。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>RabbitMq</category>
      </categories>
      <tags>
        <tag>rabbitMq</tag>
      </tags>
  </entry>
  <entry>
    <title>修改hexo文章目录位置</title>
    <url>/2020/06/1591760460000/1591760460000/</url>
    <content><![CDATA[<p>打开 根目录下的 node_modules 找到 hexo<br><img src="/2020/06/1591760460000/1591760460000/20200612114143.png" alt="20200612114143"></p>
<p><span style="color:red;">添加前缀时间戳</span><br><img src="/2020/06/1591760460000/1591760460000/20200612114144.png" alt="20200612114144"><br>新增文章操作： hexo new hello<br>INFO  Created: D:\workspace-webstorm\demon\blog\myblog\source_posts\1591933260490-hello.md</p>
<p><span style="color:red;">添加前缀路径</span><br><img src="/2020/06/1591760460000/1591760460000/20200925165826.png" alt="20200925165826"><br>新增文章操作： $ hexo new hello<br>D:\workspace-webstorm\demon\blog\myblog\source_posts\1601024145664/1601024145664<br>INFO  Created: D:\workspace-webstorm\demon\blog\myblog\source_posts\1601024145664\1601024145664.md</p>
<p><span style="color:red;">添加年月前缀路径</span><br><img src="/2020/06/1591760460000/1591760460000/20210311134100.png" alt="20210311134100"><br>新增文章操作： $ hexo new hello<br>D:\workspace-webstorm\demon\blog\myblog\source_posts\2021\03\1615440974493/1615440974493<br>INFO  Created: D:\workspace-webstorm\demon\blog\myblog\source_posts\2021\03\1615440974493\1615440974493.md</p>
<p>创建<br><img src="/2020/06/1591760460000/1591760460000/20200925165711.png" alt="20200925165711"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMq：使用交换机topic+routingKey的模式 - 优先级</title>
    <url>/2020/06/1591941634146/1591941634146/</url>
    <content><![CDATA[<p>引入的maven依赖</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.rabbitmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqp-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-simple<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.rabbitmq.client.AMQP;</span><br><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line">import com.rabbitmq.client.Connection;</span><br><span class="line">import com.rabbitmq.client.ConnectionFactory;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.UUID;</span><br><span class="line">import java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line">public class PriorityProducer {</span><br><span class="line">	public final static String QUEUENAME = "priority.topic_demo";// 队列名称</span><br><span class="line">	public final static String HOST = "localhost"; // 主机名</span><br><span class="line">	public final static String USERNAME = "guest"; //用户名</span><br><span class="line">	public final static String PASSWORD = "guest"; //密码</span><br><span class="line">	public final static String EXCHANGE_NAME = "priority.topic.exchange.name"; //交换机</span><br><span class="line">	public final static String ROUTING_KEY = "priority.topic.routingKey"; //路由</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] arggs) throws IOException, TimeoutException {</span><br><span class="line">		ConnectionFactory connectionFactory = new ConnectionFactory();</span><br><span class="line">		connectionFactory.setPassword(USERNAME);</span><br><span class="line">		connectionFactory.setUsername(PASSWORD);</span><br><span class="line">		connectionFactory.setPort(5672);</span><br><span class="line">		connectionFactory.setHost(HOST);</span><br><span class="line">		Connection connection = connectionFactory.newConnection();</span><br><span class="line">		Channel channel = connection.createChannel();</span><br><span class="line">		// 创建交换机</span><br><span class="line">		channel.exchangeDeclare(EXCHANGE_NAME, "topic", true);</span><br><span class="line">		// 创建优先级</span><br><span class="line">		Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> args = new HashMap<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span>();</span><br><span class="line">		args.put("x-max-priority", 255);//定义优先级最大值</span><br><span class="line">		channel.queueDeclare(QUEUENAME, true, false, false, args);</span><br><span class="line">		channel.queueBind(QUEUENAME, EXCHANGE_NAME, ROUTING_KEY);</span><br><span class="line">		// 发送优先级消息</span><br><span class="line">		for (int i = 0; i <span class="tag">&lt; <span class="attr">10</span>; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">			<span class="attr">AMQP.BasicProperties.Builder</span> <span class="attr">builder</span> = <span class="string">new</span> <span class="attr">AMQP.BasicProperties.Builder</span>();</span></span><br><span class="line"><span class="tag">            <span class="attr">builder.messageId</span>(<span class="attr">UUID.randomUUID</span>()<span class="attr">.toString</span>());</span></span><br><span class="line"><span class="tag">            <span class="attr">if</span> (<span class="attr">i</span> % <span class="attr">2</span> != <span class="string">0)</span> {</span></span><br><span class="line"><span class="tag">                <span class="attr">builder.priority</span>(<span class="attr">i</span>); 	//判断 新增 优先级</span></span><br><span class="line"><span class="tag">            }<span class="attr">else</span>{</span></span><br><span class="line"><span class="tag">                <span class="attr">builder.priority</span>(<span class="attr">0</span>);</span></span><br><span class="line"><span class="tag">            }</span></span><br><span class="line"><span class="tag">			<span class="attr">AMQP.BasicProperties</span> <span class="attr">properties</span> = <span class="string">builder.build();</span></span></span><br><span class="line"><span class="tag">			<span class="attr">System.out.println</span>( ("<span class="attr">messages-</span>" + <span class="attr">i</span>));</span></span><br><span class="line"><span class="tag">			<span class="attr">channel.basicPublish</span>(<span class="attr">EXCHANGE_NAME</span>, <span class="attr">ROUTING_KEY</span>, <span class="attr">properties</span>, ("<span class="attr">messages-</span>" + <span class="attr">i</span>)<span class="attr">.getBytes</span>());</span></span><br><span class="line"><span class="tag">		}</span></span><br><span class="line"><span class="tag">		<span class="attr">channel.close</span>();</span></span><br><span class="line"><span class="tag">		<span class="attr">connection.close</span>();</span></span><br><span class="line"><span class="tag">		<span class="attr">System.out.println</span>("客户端信息发送完毕！");</span></span><br><span class="line"><span class="tag">	}</span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.rabbitmq.client.AMQP.BasicProperties;</span><br><span class="line">import com.rabbitmq.client.Channel;</span><br><span class="line">import com.rabbitmq.client.Connection;</span><br><span class="line">import com.rabbitmq.client.ConnectionFactory;</span><br><span class="line">import com.rabbitmq.client.DefaultConsumer;</span><br><span class="line">import com.rabbitmq.client.Envelope;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line">public class PriorityConsumer {</span><br><span class="line">	public final static String QUEUENAME = "priority.topic_demo";// 队列名称</span><br><span class="line">	public final static String HOST = "localhost"; // 主机名</span><br><span class="line">	public final static String USERNAME = "guest";</span><br><span class="line">	public final static String PASSWORD = "guest";</span><br><span class="line">	public final static String EXCHANGE_NAME = "priority.topic.exchange.name";</span><br><span class="line">	public final static String ROUTING_KEY = "priority.topic.routingKey";</span><br><span class="line">	public static void main(String[] args) throws IOException, TimeoutException, InterruptedException {</span><br><span class="line">		ConnectionFactory connectionFactory = new ConnectionFactory();</span><br><span class="line">		connectionFactory.setPassword(PASSWORD);</span><br><span class="line">		connectionFactory.setUsername(USERNAME);</span><br><span class="line">		connectionFactory.setPort(5672);</span><br><span class="line">		connectionFactory.setHost(HOST);</span><br><span class="line">		Connection connection = connectionFactory.newConnection();</span><br><span class="line">		Channel channel = connection.createChannel();</span><br><span class="line">		DefaultConsumer c = new DefaultConsumer(channel) {</span><br><span class="line">			@Override</span><br><span class="line">			public void handleDelivery(String consumerTag, Envelope envelope, BasicProperties properties, byte[] body)</span><br><span class="line">					throws IOException {</span><br><span class="line">				System.out.println(properties.getMessageId()+" - "+properties.getPriority()+" - "+ new String(body));</span><br><span class="line">			}</span><br><span class="line">		};</span><br><span class="line">		channel.basicConsume(QUEUENAME, true, c);</span><br><span class="line">		System.out.println("消费端开启···");</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>结果：<br>生产者：<br><img src="/2020/06/1591941634146/1591941634146/20200612143312.png" alt="20200612143312"></p>
<p>消费者：<br>当生产者在适度发送消息消费时 <span style="color:red">(没有消息积累)</span><br><img src="/2020/06/1591941634146/1591941634146/20200612143421.png" alt="20200612143421"></p>
<p>当生产者在过度发送消息消费时 <span style="color:red">(有消息积累)</span><br><img src="/2020/06/1591941634146/1591941634146/20200612144440.png" alt="20200612143421"></p>
<p>具有优先级的先执行操作，先进后出。<br>消费者可多个，当交换机和路由和队列名相同时则不会进行重复消费，在生产者发出消息后会进行轮询分发消费。</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>RabbitMq</category>
      </categories>
      <tags>
        <tag>rabbitMq</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMq：使用交换机topic+routingKey的模式 - 优先级 (spring-boot)</title>
    <url>/2020/06/1591944668470/1591944668470/</url>
    <content><![CDATA[<h3 id="引入的maven依赖"><a href="#引入的maven依赖" class="headerlink" title="引入的maven依赖"></a>引入的maven依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    addresses: 127.0.0.1:5672</span><br><span class="line">    username: guest</span><br><span class="line">    password: guest</span><br><span class="line">    connection-timeout: 15000</span><br><span class="line">    virtual-host: /</span><br><span class="line">    # 开启消息发送到交换器（Exchange）后触发回调</span><br><span class="line">    publisher-confirm-type: simple</span><br><span class="line">    # 开启消息发送到队列（Queue）后触发回调</span><br><span class="line">    publisher-returns: true</span><br><span class="line">    listener:</span><br><span class="line">      direct:</span><br><span class="line">        # 开启ACK</span><br><span class="line">        acknowledge-mode: manual  # 开启手动 ，否则confirm自动确认</span><br><span class="line">      simple:</span><br><span class="line">        # 开启ACK</span><br><span class="line">        # 消息接收确认，可选模式：NONE（不确认）、AUTO（自动确认）、MANUAL（手动确认）</span><br><span class="line">        acknowledge-mode: manual</span><br><span class="line">        # 最小线程数量</span><br><span class="line">        concurrency: 10</span><br><span class="line">        # 最大线程数量</span><br><span class="line">        max-concurrency: 10</span><br><span class="line">        # 每个消费者可能未完成的最大未确认消息数量</span><br><span class="line">        prefetch: 1</span><br><span class="line">    template:</span><br><span class="line">      # 交换机找不到QUEUE时，会调用Basic.Return 命令将消息返回给生产者</span><br><span class="line">      mandatory: true</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="声明绑定关系"><a href="#声明绑定关系" class="headerlink" title="声明绑定关系"></a>声明绑定关系</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 初始化项目 就会创建 交换器，路由，队列，如果在服务中存在交换器的属性或者队列的属性不同，则会出现异常</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class RabbitMqConfig {</span><br><span class="line"></span><br><span class="line">    private static final String PRIORITY_QUEUE_NAME = "priority.topic_demo";</span><br><span class="line">    private static final String PRIORITY_TOPIC_ROUTING_KEY = "priority.topic.routingKey";</span><br><span class="line">    private static final String PRIORITY_EXCHANGE_NAME = "priority.topic.exchange.name";</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 声明消息队列</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean(PRIORITY_QUEUE_NAME)</span><br><span class="line">    public Queue priorityTopicDemo(){</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> arguments = new HashMap<span class="tag">&lt;&gt;</span>(1);</span><br><span class="line">        arguments.put("x-max-priority", 255);</span><br><span class="line">        return new Queue(PRIORITY_QUEUE_NAME,true, false, false,arguments);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 声明了一个Topic类型的交换机，durable是持久化（重启rabbitmq这个交换机不会被自动删除）</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean(PRIORITY_EXCHANGE_NAME)</span><br><span class="line">    public Exchange priorityTopicExchangeName(){</span><br><span class="line">        return ExchangeBuilder.topicExchange(PRIORITY_EXCHANGE_NAME).durable(true).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 声明队列和交换机绑定关系，并且指定RoutingKey</span><br><span class="line">     * @param queue 队列</span><br><span class="line">     * @param exchange 交换机</span><br><span class="line">     * @return  返回</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Binding queueBindingTopic(@Qualifier(PRIORITY_QUEUE_NAME) Queue queue,@Qualifier(PRIORITY_EXCHANGE_NAME) Exchange exchange){</span><br><span class="line">        return BindingBuilder.bind(queue).to(exchange).with(PRIORITY_TOPIC_ROUTING_KEY).noargs();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="生产者"><a href="#生产者" class="headerlink" title="生产者"></a>生产者</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloSender {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过exchange和routingKey的方式</span><br><span class="line">     * rabbitTemplate.sendAndReceive(String exchange, String routingKey, Message message)</span><br><span class="line">     * @param messageId  消息ID</span><br><span class="line">     * @param exchange  交换机</span><br><span class="line">     * @param routingKey 路由</span><br><span class="line">     * @param priority 优先级</span><br><span class="line">     * @param content 内容</span><br><span class="line">     */</span><br><span class="line">    public void sendAndReceive(String messageId, String exchange, String routingKey, Integer priority, String content) {</span><br><span class="line">        Message message = MessageBuilder.withBody(content.getBytes(Charset.forName("UTF-8")))</span><br><span class="line">              .setContentType(MessageProperties.CONTENT_TYPE_TEXT_PLAIN)</span><br><span class="line">              .setMessageId(messageId)</span><br><span class="line">              .setPriority(priority)</span><br><span class="line">              .build();</span><br><span class="line">        CorrelationData correlationData = new CorrelationData();</span><br><span class="line">        correlationData.setId(messageId);</span><br><span class="line">        this.rabbitTemplate.convertAndSend(exchange, routingKey, message,correlationData);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="消费者"><a href="#消费者" class="headerlink" title="消费者"></a>消费者</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class HelloReceiver {</span><br><span class="line">      /**</span><br><span class="line">        * @param message 队列消息对象</span><br><span class="line">        */</span><br><span class="line">       @RabbitListener(queues = TopicData.PRIORITY_QUEUE_NAME)</span><br><span class="line">       public void queueNameTest1(Channel channel, Message message) {</span><br><span class="line">           try {</span><br><span class="line">               String stringBuilder = "消息ID: " + message.getMessageProperties().getMessageId() + "；" +</span><br><span class="line">                       "优先级: " + message.getMessageProperties().getPriority() + "；" +</span><br><span class="line">                       "消息内容: " + new String(message.getBody(), StandardCharsets.UTF_8);</span><br><span class="line">               //告诉服务器收到这条消息 已经被我消费了 可以在队列删掉 这样以后就不会再发了 否则消息服务器以为这条消息没处理掉 后续还会在发</span><br><span class="line">               channel.basicAck(message.getMessageProperties().getDeliveryTag(),true);</span><br><span class="line">               log.info(stringBuilder);</span><br><span class="line">           } catch (IOException e) {</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">               try {</span><br><span class="line">                   //当发生异常时丢弃这条消息，或者 另行处理</span><br><span class="line">                   channel.basicNack(message.getMessageProperties().getDeliveryTag(), false,false);</span><br><span class="line">                   System.out.println("receiver fail");</span><br><span class="line">               } catch (IOException e1) {</span><br><span class="line">                   e1.printStackTrace();</span><br><span class="line">               }</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h3><p>自定义 RabbitTemplate.ConfirmCallback 实现类</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">public class RabbitConfirmCallBack implements RabbitTemplate.ConfirmCallback{</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void confirm(CorrelationData correlationData, boolean ack, String cause) {</span><br><span class="line">        log.info("收到回调，成功发送到broker");</span><br><span class="line">        log.info("消息唯一标识: {}", correlationData.getId());</span><br><span class="line">        log.info("确认状态: {}", ack);</span><br><span class="line">        log.info("造成原因: {}", cause);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>自定义 RabbitTemplate.ConfirmCallback 实现类</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">public class RabbitReturnCallback  implements RabbitTemplate.ReturnCallback{</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) {</span><br><span class="line">        log.info("收到回调，交换机找不到队列");</span><br><span class="line">        log.info("消息主体: {}", message);</span><br><span class="line">        log.info("回复编码: {}", replyCode);</span><br><span class="line">        log.info("回复内容: {}", replyText);</span><br><span class="line">        log.info("交换器: {}", exchange);</span><br><span class="line">        log.info("路由键: {}", routingKey);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>添加回调，配置 rabbitTemplate</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Component</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class RabbitTemplateInitializingBean implements InitializingBean {</span><br><span class="line"></span><br><span class="line">    private final RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void afterPropertiesSet(){</span><br><span class="line">        rabbitTemplate.setConfirmCallback(new RabbitConfirmCallBack());</span><br><span class="line">        rabbitTemplate.setReturnCallback(new RabbitReturnCallback());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@SpringBootTest</span><br><span class="line">class SpringBootRabbitmqExampleApplicationTest {</span><br><span class="line">    @Resource</span><br><span class="line">    private HelloSender helloSender;</span><br><span class="line">    @Test</span><br><span class="line">    void content(){</span><br><span class="line">        Random r = new Random();</span><br><span class="line">        int number = 1;</span><br><span class="line">        for (int i = 0; i <span class="tag">&lt; <span class="attr">number</span> ; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">            <span class="attr">String</span> <span class="attr">messageId</span> = <span class="string">UUID.randomUUID().toString().replace(</span>"<span class="attr">-</span>","");</span></span><br><span class="line"><span class="tag">            <span class="attr">String</span> <span class="attr">exchange</span> = <span class="string">"priority.topic.exchange.name"</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">String</span> <span class="attr">routingKey</span> = <span class="string">"priority.topic.routingKey"</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">Integer</span> <span class="attr">priority</span> = <span class="string">r.nextInt(255);</span></span></span><br><span class="line"><span class="tag">            <span class="attr">String</span> <span class="attr">content</span> = <span class="string">"这是第["</span>+<span class="attr">i</span>+"]个消息";</span></span><br><span class="line"><span class="tag">            <span class="attr">helloSender.sendAndReceive</span>(<span class="attr">messageId</span>, <span class="attr">exchange</span>, <span class="attr">routingKey</span>, <span class="attr">priority</span>, <span class="attr">content</span>);</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>结果：<br><img src="/2020/06/1591944668470/1591944668470/20200612180958.png" alt="20200612180958"></p>
<p>当删除交换机时的执行错误<br><img src="/2020/06/1591944668470/1591944668470/20200615110247.png" alt="20200615110247"></p>
<p>当删除队列时的执行错误<br><img src="/2020/06/1591944668470/1591944668470/20200615111036.png" alt="20200615111036"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>RabbitMq</category>
      </categories>
      <tags>
        <tag>rabbitMq</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot配置RestTemplate</title>
    <url>/2020/06/1592881660483/1592881660483/</url>
    <content><![CDATA[<p>以下为2种配置方式,均可实现实现远程调用，jar引入只要其一即可；</p>
<blockquote>
<p>方式一：RestTemplate + HttpClients</p>
</blockquote>
<blockquote>
<p>方式二：RestTemplate + OkHttp3</p>
</blockquote>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>&gt;2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  不需要版本号  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="RestTemplate-HttpClients"><a href="#RestTemplate-HttpClients" class="headerlink" title="RestTemplate + HttpClients"></a>RestTemplate + HttpClients</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.http.conn.ssl.SSLConnectionSocketFactory;</span><br><span class="line">import org.apache.http.conn.ssl.TrustStrategy;</span><br><span class="line">import org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line">import org.apache.http.impl.client.HttpClients;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import java.security.KeyManagementException;</span><br><span class="line">import java.security.KeyStoreException;</span><br><span class="line">import java.security.NoSuchAlgorithmException;</span><br><span class="line">import java.security.cert.X509Certificate;</span><br><span class="line">/**</span><br><span class="line"> * className    RestTemplateConfig</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/6/8 13:09</span><br><span class="line"> * description  RestTemplate + HttpClients 实现远程调用</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">class RestTemplateConfig {</span><br><span class="line">    @Bean</span><br><span class="line">    public RestTemplate restTemplate() throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException {</span><br><span class="line">        TrustStrategy acceptingTrustStrategy = (X509Certificate[] chain, String authType) -&gt; true;</span><br><span class="line">        SSLContext sslContext = org.apache.http.ssl.SSLContexts.custom().loadTrustMaterial(null, acceptingTrustStrategy).build();</span><br><span class="line">        SSLConnectionSocketFactory csf = new SSLConnectionSocketFactory(sslContext);</span><br><span class="line">        CloseableHttpClient httpClient = HttpClients.custom().setSSLSocketFactory(csf).build();</span><br><span class="line">        //使用httpclient的factory</span><br><span class="line">        HttpComponentsClientHttpRequestFactory requestFactory = new HttpComponentsClientHttpRequestFactory();</span><br><span class="line">        // 请求连接超时时间  毫秒</span><br><span class="line">        requestFactory.setConnectTimeout(1000 * 60);</span><br><span class="line">        // 从链接池获取连接超时时间  毫秒</span><br><span class="line">        requestFactory.setConnectionRequestTimeout(6000);</span><br><span class="line">        // 获取数据超时时间 毫秒</span><br><span class="line">        requestFactory.setReadTimeout(1000 * 360);</span><br><span class="line">        requestFactory.setHttpClient(httpClient);</span><br><span class="line">        return new RestTemplate(requestFactory);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="RestTemplate-OkHttp3"><a href="#RestTemplate-OkHttp3" class="headerlink" title="RestTemplate + OkHttp3"></a>RestTemplate + OkHttp3</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import okhttp3.ConnectionPool;</span><br><span class="line">import okhttp3.OkHttpClient;</span><br><span class="line">import org.springframework.boot.web.client.RestTemplateBuilder;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.http.HttpHeaders;</span><br><span class="line">import org.springframework.http.HttpMethod;</span><br><span class="line">import org.springframework.http.client.ClientHttpRequestInterceptor;</span><br><span class="line">import org.springframework.http.client.ClientHttpResponse;</span><br><span class="line">import org.springframework.http.client.OkHttp3ClientHttpRequestFactory;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.client.ResponseErrorHandler;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import javax.net.ssl.SSLSocketFactory;</span><br><span class="line">import javax.net.ssl.TrustManager;</span><br><span class="line">import javax.net.ssl.X509TrustManager;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.URI;</span><br><span class="line">import java.security.KeyManagementException;</span><br><span class="line">import java.security.NoSuchAlgorithmException;</span><br><span class="line">import java.security.SecureRandom;</span><br><span class="line">import java.security.cert.X509Certificate;</span><br><span class="line">import java.time.Instant;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.time.ZoneId;</span><br><span class="line">import java.time.format.DateTimeFormatter;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    RestTemplateConfig</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/6/8 13:09</span><br><span class="line"> * description  RestTemplate + OkHttp3 实现远程调用</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class RestTemplateConfig {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 基于OkHttp3配置RestTemplate</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) {</span><br><span class="line">        RestTemplate restTemplate = restTemplateBuilder</span><br><span class="line">                .errorHandler(new ResponseErrorHandler() {</span><br><span class="line">                    @Override</span><br><span class="line">                    public boolean hasError(ClientHttpResponse clientHttpResponse) throws IOException {</span><br><span class="line">                        return clientHttpResponse.getStatusCode().value() != 200 &amp;&amp; clientHttpResponse.getStatusCode().value() != 302;</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void handleError(ClientHttpResponse clientHttpResponse) {</span><br><span class="line"></span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    public void handleError(URI url, HttpMethod method, ClientHttpResponse response) throws IOException {</span><br><span class="line">                        log.error("=======================ERROR============================");</span><br><span class="line">                        log.error("DateTime：{}", LocalDateTime.ofInstant(Instant.ofEpochMilli(response.getHeaders().getDate()), ZoneId.systemDefault()).format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss")));</span><br><span class="line">                        log.error("HOST:{}，URI：{}", url.getHost(), url.getPath());</span><br><span class="line">                        log.error("Method：{}", method.name());</span><br><span class="line">                        log.error("Exception：{}", response.getStatusCode());</span><br><span class="line">                        log.error("========================================================");</span><br><span class="line">                    }</span><br><span class="line">                })</span><br><span class="line">                .interceptors((ClientHttpRequestInterceptor) (httpRequest, bytes, clientHttpRequestExecution) -&gt; {</span><br><span class="line">                    HttpHeaders headers = httpRequest.getHeaders();</span><br><span class="line">                    // 加入自定义字段</span><br><span class="line">                    headers.add("Content-Type", "application/json;charset=UTF-8");</span><br><span class="line">                    return clientHttpRequestExecution.execute(httpRequest, bytes);</span><br><span class="line">                })</span><br><span class="line">                .build();</span><br><span class="line">        restTemplate.setRequestFactory(new OkHttp3ClientHttpRequestFactory(new OkHttpClient.Builder()</span><br><span class="line">                // 整个流程耗费的超时时间</span><br><span class="line">                .callTimeout(180, TimeUnit.SECONDS)</span><br><span class="line">                // 读取耗时</span><br><span class="line">                .readTimeout(60, TimeUnit.SECONDS)</span><br><span class="line">                // 写入耗时</span><br><span class="line">                .writeTimeout(60, TimeUnit.SECONDS)</span><br><span class="line">                // 三次握手 + SSL建立耗时</span><br><span class="line">                .connectTimeout(60, TimeUnit.SECONDS)</span><br><span class="line">                .sslSocketFactory(sslSocketFactory(), x509TrustManager())</span><br><span class="line">                // 当连接失败，尝试重连</span><br><span class="line">                .retryOnConnectionFailure(true)</span><br><span class="line">                // 最大空闲连接数及连接的保活时间进行配置</span><br><span class="line">                .connectionPool(new ConnectionPool(200, 5, TimeUnit.MINUTES))</span><br><span class="line">                // 绕过需要SSL证书验证的HTTPS的请求</span><br><span class="line">                .hostnameVerifier((s, sslSession) -&gt; true)</span><br><span class="line">                .build()));</span><br><span class="line">        return restTemplate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public SSLSocketFactory sslSocketFactory() {</span><br><span class="line">        try {</span><br><span class="line">            // 信任任何链接</span><br><span class="line">            SSLContext sslContext = SSLContext.getInstance("TLS");</span><br><span class="line">            sslContext.init(null, new TrustManager[]{x509TrustManager()}, new SecureRandom());</span><br><span class="line">            return sslContext.getSocketFactory();</span><br><span class="line">        } catch (NoSuchAlgorithmException | KeyManagementException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public X509TrustManager x509TrustManager() {</span><br><span class="line">        return new X509TrustManager() {</span><br><span class="line">            @Override</span><br><span class="line">            public void checkClientTrusted(X509Certificate[] x509Certificates, String s) {</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void checkServerTrusted(X509Certificate[] x509Certificates, String s) {</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public X509Certificate[] getAcceptedIssuers() {</span><br><span class="line">                return new X509Certificate[0];</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@SpringBootTest</span><br><span class="line">class SpringBootApiApplicationTests {</span><br><span class="line">    @Resource</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line">    @Test</span><br><span class="line">    void contextLoads(){</span><br><span class="line">        String url = "https://www.baidu.com/";</span><br><span class="line">        String resp = restTemplate.getForObject(url, String.class);</span><br><span class="line">        System.out.println(resp);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="/2020/06/1592881660483/1592881660483/20200623115758.png" alt="20200623115758"></p>
<p><a href="/2021/03/1614741214844/1614741214844/">RestTemplate简单使用</a><br><a href="/2021/07/1625194440104/1625194440104/">RestTemplate封装使用</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>RestTemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>发布Java程序为Windows服务 （不含有Java环境）二</title>
    <url>/2020/06/1592898236483/1592898236483/</url>
    <content><![CDATA[<p>前面在有Java环境的情况下的设置，现在假设我们不存在Java运行环境，也就是没有JRE与JDK，<br>所以需要拷贝java安装目录下的JRE（包含bin目录和相关lib）目录到需要的服务目录下</p>
<h3 id="拷贝JRE"><a href="#拷贝JRE" class="headerlink" title="拷贝JRE"></a>拷贝JRE</h3><p>JRE目录<br><img src="/2020/06/1592898236483/1592898236483/20200623154737.png" alt="20200623154737"><br>拷贝JRE目录到服务目录<br><img src="/2020/06/1592898236483/1592898236483/20200623154926.png" alt="20200623154926"></p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>利用拷贝过去的jre目录下的jar包和bin\java.exe，修改wrapper.java.command的值</p>
<pre><code>wrapper.java.command=../jre1.8.0_45/bin/java.exe</code></pre><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a href="/2020/06/1592889892770/1592889892770/">发布Java程序为Windows服务 （含有Java环境）一</a><br><a href="/2020/06/1592899073321/1592899073321/">发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三</a><br><a href="/2020/11/1604299054941/1604299054941/">发布Java程序为Windows服务 - Windows Service Wrapper 四</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>winsw</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx 服务器证书SSL安装</title>
    <url>/2020/09/1599456487885/1599456487885/</url>
    <content><![CDATA[<h3 id="检测"><a href="#检测" class="headerlink" title="检测"></a>检测</h3><p>初始安装nginx的时候没有开启ssl功能 </p>
<p>查看是否开启ssl模块</p>
<pre><code>/usr/local/nginx/sbin/nginx -V</code></pre><p><img src="/2020/09/1599456487885/1599456487885/20200907133809.png" alt="20200907133809"><br>当未出现红框内的内部分，则表示没有开启ssl功能 </p>
<h3 id="开启ssl模块"><a href="#开启ssl模块" class="headerlink" title="开启ssl模块"></a>开启ssl模块</h3><p>找到安装的源码包(带有版本号的位置)</p>
<pre><code>cd /usr/local/software/nginx-1.18.0
./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
make    # 这里不要进行make install，否则就是覆盖安装
cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak       # 备份
/usr/local/nginx/sbin/nginx -s stop # 停止服务
cp ./objs/nginx /usr/local/nginx/sbin/  # 将刚刚编译好的nginx覆盖掉原有的nginx</code></pre><p><img src="/2020/09/1599456487885/1599456487885/20200907135626.png" alt="20200907135626"><br>当在此查看 /usr/local/nginx/sbin/nginx -V ，则表示开启成功</p>
<h3 id="下载SSL证书"><a href="#下载SSL证书" class="headerlink" title="下载SSL证书"></a>下载SSL证书</h3><p>将已获取到的 1.证书文件和 2.私钥文件从本地目录拷贝到 Nginx 服务器的 /usr/local/nginx/conf 目录下<br>此处为 Nginx 默认安装目录，请根据实际情况操作</p>
<h3 id="配置Https"><a href="#配置Https" class="headerlink" title="配置Https"></a>配置Https</h3><p>以下为本机配置为例</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">user  root;</span><br><span class="line">worker_processes  1;</span><br><span class="line">error_log /usr/local/nginx/logs/nginx_error.log crit; </span><br><span class="line">events {</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">http {</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    # 开启gzip压缩</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_comp_level  5;</span><br><span class="line">    gzip_min_length  1024;</span><br><span class="line">    gzip_types   text/plain application/x-javascript text/css application/xml text/javascript  image/jpeg image/gif image/png;</span><br><span class="line">    # 隐藏nginx版本信息</span><br><span class="line">    server_tokens off;</span><br><span class="line"></span><br><span class="line">    server {</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  www.zhuqiaolun.com;</span><br><span class="line"></span><br><span class="line">        if ($scheme = http ) {</span><br><span class="line">            return  301 https://www.zhuqiaolun.com$request_uri;</span><br><span class="line">        }</span><br><span class="line">        location / {</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line"></span><br><span class="line">        location = /50x.html {</span><br><span class="line">            root   html;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    server {</span><br><span class="line">        listen 443 ssl;</span><br><span class="line">        server_name    www.zhuqiaolun.com;</span><br><span class="line">        root html; </span><br><span class="line">        index index.html index.htm;   </span><br><span class="line">        ssl_certificate www.zhuqiaolun.com.crt;</span><br><span class="line">        ssl_certificate_key www.zhuqiaolun.com.key;</span><br><span class="line">        ssl_session_timeout    10m;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">        ssl_session_cache shared:SSL:10m;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">            root   html/blog/;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            #try_files $uri $uri/ /index.html;</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        location /file {</span><br><span class="line">            alias  html/file/; #目录文件服务器根目录</span><br><span class="line">            if ($request_filename ~* ^.*?\.(html|doc|pdf|zip|docx|txt|mp4|rar)$) {</span><br><span class="line">                add_header Content-Disposition attachment;</span><br><span class="line">                add_header Content-Type application/octet-stream;</span><br><span class="line">            }</span><br><span class="line">            sendfile on;   # 开启高效文件传输模式</span><br><span class="line">            autoindex on;  # 开启目录文件列表</span><br><span class="line">            autoindex_exact_size on;  # 显示出文件的确切大小，单位是bytes</span><br><span class="line">            autoindex_localtime on;  # 显示的文件时间为文件的服务器时间</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>




<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>Nginx SSL性能调优</p>
<pre><code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM;
ssl_prefer_server_ciphers on;
ssl_session_cache shared:SSL:10m;
ssl_session_timeout 10m;</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>发布Java程序为Windows服务 （含有Java环境）一</title>
    <url>/2020/06/1592889892770/1592889892770/</url>
    <content><![CDATA[<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>有时候我们希望我们java写的程序作为服务注册到系统中，Java Service Wrapper 是目前较为流行的将Java程序部署成Windows服务的解决方案</p>
<h3 id="下载serviceWrapper包"><a href="#下载serviceWrapper包" class="headerlink" title="下载serviceWrapper包"></a>下载serviceWrapper包</h3><p>网址：<a href="https://www.krenger.ch/blog/category/windows/" target="_blank" rel="noopener">https://www.krenger.ch/blog/category/windows/</a><br><img src="/2020/06/1592889892770/1592889892770/20200623133038.png" alt="20200623133038"></p>
<p>下载zip压缩文件<br><img src="/2020/06/1592889892770/1592889892770/20200623133123.png" alt="20200623133123"></p>
<h3 id="解压serviceWrapper包"><a href="#解压serviceWrapper包" class="headerlink" title="解压serviceWrapper包"></a>解压serviceWrapper包</h3><p>解压wrapper-windows-x86-64-3.5.43.zip<br><img src="/2020/06/1592889892770/1592889892770/20200623133832.png" alt="20200623133832"><br>解压出来的文件多，但有些不是必须要的</p>
<h3 id="注册一个简单的服务"><a href="#注册一个简单的服务" class="headerlink" title="注册一个简单的服务"></a>注册一个简单的服务</h3><p>准备一个目录 建议在非中文且不含有空格的目录下<br>目录结构如下：<br><img src="/2020/06/1592889892770/1592889892770/20200623134921.png" alt="20200623134921"><br>lang目录是存放支持其他语言的语言包，一般用不到<br>mylib目录是存放我们的程序包</p>
<p>然后将下载的wrapper目录下的文件拷贝到我们上面建的目录:</p>
<pre><code>···\bin\InstallTestWrapper-NT.bat           -&gt; D:\test\java-service-hello\bin\InstallTestWrapper-NT.bat
···\bin\StartTestWrapper-NT.bat             -&gt; D:\test\java-service-hello\bin\StartTestWrapper-NT.bat
···\bin\StopTestWrapper-NT.bat              -&gt; D:\test\java-service-hello\bin\StopTestWrapper-NT.bat
···\bin\TestWrapper.bat                     -&gt; D:\test\java-service-hello\bin\TestWrapper.bat
···\bin\UninstallTestWrapper-NT.bat         -&gt; D:\test\java-service-hello\bin\UninstallTestWrapper-NT.bat
···\bin\wrapper.exe                         -&gt; D:\test\java-service-hello\bin\wrapper.exe
···\conf\wrapper.conf                       -&gt; D:\test\java-service-hello\conf\wrapper.conf
···\lib\wrapper.jar                         -&gt; D:\test\java-service-hello\lib\wrapper.jar
···\lib\wrapper.dll                         -&gt; D:\test\java-service-hello\lib\wrapper.dll</code></pre><h3 id="java程序"><a href="#java程序" class="headerlink" title="java程序"></a>java程序</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.io.File;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line">import cn.hutool.core.date.DateUtil;</span><br><span class="line">import cn.hutool.core.io.file.FileAppender;</span><br><span class="line">import cn.hutool.core.lang.UUID;</span><br><span class="line">public class JarHelloApp {</span><br><span class="line">	public static void main(String[] args) {</span><br><span class="line">		while (true) {</span><br><span class="line">			try {</span><br><span class="line">				System.out.println("Hello World!");</span><br><span class="line">				String str = UUID.fastUUID().toString();</span><br><span class="line">				System.out.println(str);</span><br><span class="line">				//每隔3秒创建文件并写入内容</span><br><span class="line">				FileAppender appender = new FileAppender(new File("D:\\test\\jar\\"+str+".txt"), 16, true);</span><br><span class="line">				TimeUnit.SECONDS.sleep(3);</span><br><span class="line">				appender.append(DateUtil.now());</span><br><span class="line">				appender.flush();</span><br><span class="line">				appender.toString();</span><br><span class="line">			} catch (Exception e) {</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>引入的依赖</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="java程序打包"><a href="#java程序打包" class="headerlink" title="java程序打包"></a>java程序打包</h3><p>由于采用eclipse所有打包流程：项目邮件 -&gt; Export -&gt; Java/Runnable JAR file -&gt; Next<br><img src="/2020/06/1592889892770/1592889892770/20200623142924.png" alt="20200623142924"></p>
<p>导出项目设置<br><img src="/2020/06/1592889892770/1592889892770/20200623143420.png" alt="20200623143420"></p>
<p>导出项目文件<br><img src="/2020/06/1592889892770/1592889892770/20200623144319.png" alt="20200623144319"></p>
<p>将程序打成的包以及自己程序依赖的包放到mylib<br><img src="/2020/06/1592889892770/1592889892770/20200623144449.png" alt="20200623144449"></p>
<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>文件路径：D:\test\java-service-hello\conf\wrapper.conf<br>内容如下：</p>
<pre><code># jdk或者jre的java.exe路径，可通过环境变量获取
wrapper.java.command=%JAVA_HOME%/bin/java.exe
# wrapper.java.command=C:\Java\jre1.8.0_45\bin\java
# 日志级别
wrapper.java.command.loglevel=INFO
wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperSimpleApp
# 执行的程序的main方法的类的路径
wrapper.app.parameter.1=com.demon.jar_hello.JarHelloApp
# 依赖的包，第一个是wrapper包，第二个是自己打的包以及程序依赖包
wrapper.java.classpath.1=../lib/wrapper.jar
wrapper.java.classpath.2=../mylib/*.jar
# 固定写法，依赖的wrapper的包
wrapper.java.library.path.1=../lib
# 日志配置 按照日期每天创建文件
wrapper.logfile=../logs/wrapper.YYYYMMDD.log
wrapper.logfile.rollmode=DATE
# 服务名称以及描述信息
wrapper.console.title=jar hello Server
wrapper.name=jarhelloserver
wrapper.displayname=jar hello Server
wrapper.description=jar hello Server
# 更多配置可对 jvm 配置</code></pre><h3 id="测试注册服务"><a href="#测试注册服务" class="headerlink" title="测试注册服务"></a>测试注册服务</h3><p>在服务目录下的bin目录下双击 TestWrapper.bat 文件，当程序执行正确时则表示可以注册服务<br>控制台测试<br><img src="/2020/06/1592889892770/1592889892770/20200623150257.png" alt="20200623150257"></p>
<h3 id="注册服务"><a href="#注册服务" class="headerlink" title="注册服务"></a>注册服务</h3><p>在服务目录下执行（管理员模式）</p>
<pre><code>注册服务命令
bin\wrapper.exe -i ..\conf\wrapper.conf</code></pre><p>cmd结果<br><img src="/2020/06/1592889892770/1592889892770/20200623151136.png" alt="20200623151136"><br>服务结果<br><img src="/2020/06/1592889892770/1592889892770/20200623151201.png" alt="20200623151201"></p>
<pre><code>启动服务命令
net start jarhelloserver
或者
bin\wrapper.exe -t ..\conf\wrapper.conf</code></pre><p>cmd结果<br><img src="/2020/06/1592889892770/1592889892770/20200623151449.png" alt="20200623151449"><br>服务结果<br><img src="/2020/06/1592889892770/1592889892770/20200623151518.png" alt="20200623151518"></p>
<pre><code>停止服务命令
net stop jarhelloserver
或者
bin\wrapper.exe -p ..\conf\wrapper.conf</code></pre><p> cmd结果<br> <img src="/2020/06/1592889892770/1592889892770/20200623151717.png" alt="20200623151717"><br> 服务结果<br> <img src="/2020/06/1592889892770/1592889892770/20200623151743.png" alt="20200623151743">  </p>
<pre><code>删除服务命令
sc delete jarhelloserver
或者
bin\wrapper.exe -r ..\conf\wrapper.conf</code></pre><p>  cmd结果<br>  <img src="/2020/06/1592889892770/1592889892770/20200623151956.png" alt="20200623151956"></p>
<h3 id="扩展-一"><a href="#扩展-一" class="headerlink" title="扩展 一"></a>扩展 一</h3><p>由于使用命名操作复杂，故在服务目录创建bat文件</p>
<p>install-service.bat</p>
<pre><code>@echo off
start cmd /c "title install-service &amp;&amp; bin\wrapper.exe -i ..\conf\wrapper.conf"</code></pre><p>uninstall-service.bat</p>
<pre><code>@echo off
start cmd /c "title uninstall-service &amp;&amp; bin\wrapper.exe -r ..\conf\wrapper.conf"</code></pre><p>start-service.bat</p>
<pre><code>@echo off
start cmd /c "title start-service &amp;&amp; bin\wrapper.exe -t ..\conf\wrapper.conf"</code></pre><p>stop-service.bat</p>
<pre><code>@echo off
start cmd /c "title stop-service &amp;&amp; bin\wrapper.exe -p ..\conf\wrapper.conf"</code></pre><h3 id="扩展-二"><a href="#扩展-二" class="headerlink" title="扩展 二"></a>扩展 二</h3><p>我们可以用上面的service wrapper的bin包中的bat文件进行服务操作<br>将下载解压后的wrapper-windows\bin中的部分文件复制到我们的服务\bin目录下<br><img src="/2020/06/1592889892770/1592889892770/20200623161942.png" alt="20200623161942"><br>我们只需要点击上面的bat文件即可实现上面的操作：</p>
<pre><code>安装服务：InstallTestWrapper-NT.bat
查询服务：QueryTestWrapper-NT.bat
开启服务：StartTestWrapper-NT.bat
停止服务：StopTestWrapper-NT.bat
测试服务：TestWrapper.bat
卸载服务：UninstallTestWrapper-NT.bat</code></pre><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a href="/2020/06/1592898236483/1592898236483/">发布Java程序为Windows服务 （不含有Java环境）二</a><br><a href="/2020/06/1592899073321/1592899073321/">发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三</a><br><a href="/2020/11/1604299054941/1604299054941/">发布Java程序为Windows服务 - Windows Service Wrapper 四</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>winsw</tag>
      </tags>
  </entry>
  <entry>
    <title>配置tomcat下的conf目录下的文件</title>
    <url>/2020/09/1599535661189/1599535661189/</url>
    <content><![CDATA[<h3 id="启用manager"><a href="#启用manager" class="headerlink" title="启用manager"></a>启用manager</h3><p>1.打开conf目录下的文件 tomcat-users.xml，在尾部添加一下内容:</p>
<pre><code>&lt;role rolename="tomcat"/&gt;
&lt;role rolename="role1"/&gt;
&lt;role rolename="manager-script"/&gt;
&lt;role rolename="manager-gui"/&gt;
&lt;role rolename="manager-status"/&gt; 
&lt;role rolename="admin-gui"/&gt;
&lt;role rolename="admin-script"/&gt; 
&lt;user username="tomcat" password="tomcat" roles="manager-gui,manager-script,tomcat,admin-gui,admin-script"/&gt;</code></pre><p>2.修改webapps文件夹manager和host-mananger两个项目下META-INF中的context.xml文件：</p>
<pre><code>vim /usr/local/tomcat/apache-tomcat-9.0.27/webapps/host-manager/META-INF
vim /usr/local/tomcat/apache-tomcat-9.0.27/webapps/manager/META-INF/context.xml</code></pre><p>修改为（或者注释掉）： </p>
<pre><code>&lt;Valve className="org.apache.catalina.valves.RemoteAddrValve" allow="^.*$" /&gt;</code></pre><p>无须重启tomcat即可生效</p>
<h3 id="配置日志打印"><a href="#配置日志打印" class="headerlink" title="配置日志打印"></a>配置日志打印</h3><p>打开conf目录下的文件 logging.properties；修改以下内容</p>
<pre><code>1catalina.org.apache.juli.AsyncFileHandler.level = FINE
1catalina.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs
1catalina.org.apache.juli.AsyncFileHandler.prefix = catalina.
1catalina.org.apache.juli.AsyncFileHandler.maxDays = 7
1catalina.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter

2localhost.org.apache.juli.AsyncFileHandler.level = FINE
2localhost.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs
2localhost.org.apache.juli.AsyncFileHandler.prefix = localhost.
2localhost.org.apache.juli.AsyncFileHandler.maxDays = 7
2localhost.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter

3manager.org.apache.juli.AsyncFileHandler.level = FINE
3manager.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs
3manager.org.apache.juli.AsyncFileHandler.prefix = manager.
3manager.org.apache.juli.AsyncFileHandler.maxDays = 7
3manager.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter

4host-manager.org.apache.juli.AsyncFileHandler.level = FINE
4host-manager.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs
4host-manager.org.apache.juli.AsyncFileHandler.prefix = host-manager.
4host-manager.org.apache.juli.AsyncFileHandler.maxDays = 7
4host-manager.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter

java.util.logging.ConsoleHandler.level = FINE
java.util.logging.ConsoleHandler.formatter = org.apache.juli.OneLineFormatter
java.util.logging.SimpleFormatter.format = %1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS.%1$tL [%4$s] [%3$s] %2$s %5$s %6$s%n</code></pre><h3 id="配置日志存储"><a href="#配置日志存储" class="headerlink" title="配置日志存储"></a>配置日志存储</h3><pre><code>&lt;Host name="localhost"  appBase="webapps"  unpackWARs="true" autoDeploy="true"&gt;
       &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;
       &lt;Valve className="org.apache.catalina.valves.AccessLogValve" 
           directory="logs/localhost_access_log" prefix="localhost_access_log" suffix=".txt" 
           pattern="%h %l %u %t &amp;quot;%r&amp;quot; %s %b" /&gt;
 &lt;/Host&gt;</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三</title>
    <url>/2020/06/1592899073321/1592899073321/</url>
    <content><![CDATA[<p>前面是使用的配置会导致JVM不断重启，需要加JVM参数以及设置，同时设置服务开机启动；</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>新增配置参数如下：</p>
<pre><code>wrapper.jmx=false
wrapper.on_exit.0=SHUTDOWN
wrapper.on_exit.default=RESTART
wrapper.ntservice.interactive = true
# 服务开机启动
wrapper.ntservice.starttype=AUTO_START
wrapper.tray = true
# 监测JVM死锁
wrapper.java.monitor.deadlock = true
wrapper.java.monitor.heap = true
wrapper.java.monitor.gc.restart = true
# Java Heap 初始化大小(单位：MB)
wrapper.java.initmemory=128
# Java Heap 最大值(单位：MB)
wrapper.java.maxmemory=128
# 32/64位选择，true为自动选择
wrapper.java.additional.auto_bits=TRUE</code></pre><h3 id="检测JVM参数"><a href="#检测JVM参数" class="headerlink" title="检测JVM参数"></a>检测JVM参数</h3><p>可以用jps+jmap监测即可<br>jps:<br><img src="/2020/06/1592899073321/1592899073321/20200623161416.png" alt="20200623161416"><br>jmap -heap xxxxx<br><img src="/2020/06/1592899073321/1592899073321/20200623161506.png" alt="20200623161506"></p>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a href="/2020/06/1592889892770/1592889892770/">发布Java程序为Windows服务 （含有Java环境）一</a><br><a href="/2020/06/1592898236483/1592898236483/">发布Java程序为Windows服务 （不含有Java环境）二</a><br><a href="/2020/11/1604299054941/1604299054941/">发布Java程序为Windows服务 - Windows Service Wrapper 四</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>winsw</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux中安装Tomcat环境</title>
    <url>/2020/09/1599532777229/1599532777229/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>tomcat 官网地址：<a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a><br>tomcat 官网版本文件地址：<a href="https://archive.apache.org/dist/tomcat/" target="_blank" rel="noopener">https://archive.apache.org/dist/tomcat/</a><br>tomcat 指定版本下载地址：<a href="https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/" target="_blank" rel="noopener">https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/</a><br>Linux在线下载：</p>
<pre><code>wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/apache-tomcat-9.0.27.tar.gz</code></pre><p><img src="/2020/09/1599532777229/1599532777229/20200908111621.png" alt="20200908111621"></p>
<p>下载离线版本：<br>点击红框区域,即可下载文件（免安装版本）<br><img src="/2020/09/1599532777229/1599532777229/20200908110142.png" alt="20200908110142"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>创建安装目录，并进入安装目录</p>
<pre><code>mkdir /usr/local/tomcat
cd /usr/local/tomcat/
rz apache-tomcat-9.0.27.tar.gz # 上传文件（如采用在线下载，则无需此步骤）
tar -zxvf apache-tomcat-9.0.27.tar.gz # 解压文件
cd /usr/local/tomcat/apache-tomcat-9.0.27 # 进入目录</code></pre><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>启动：</p>
<pre><code>/usr/local/tomcat/apache-tomcat-9.0.27/bin/startup.sh</code></pre><p>停止：</p>
<pre><code>/usr/local/tomcat/apache-tomcat-9.0.27/bin/shutdown.sh</code></pre><p>实时日志</p>
<pre><code>cd /usr/local/tomcat/apache-tomcat-9.0.27/logs
tail -f catalina.out</code></pre><h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><pre><code>curl -I http://127.0.0.1:8080</code></pre><p>返回以下内容则表示启动成功</p>
<pre><code>HTTP/1.1 200 
Content-Type: text/html;charset=UTF-8
Transfer-Encoding: chunked
Date: Tue, 08 Sep 2020 03:22:06 GMT</code></pre><h3 id="上传项目"><a href="#上传项目" class="headerlink" title="上传项目"></a>上传项目</h3><pre><code>cd /usr/local/tomcat/apache-tomcat-9.0.27/webapps</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcat配置https访问</title>
    <url>/2020/09/1599632929241/1599632929241/</url>
    <content><![CDATA[<h3 id="生成安全证书"><a href="#生成安全证书" class="headerlink" title="生成安全证书"></a>生成安全证书</h3><p>因为SUN公司提供了制作证书的工具keytool。<br>在JDK 1.4以后的版本中都包含了这一工具，它的位置为<java_home>\bin\keytool.exe。</java_home></p>
<h3 id="创建证书的命令"><a href="#创建证书的命令" class="headerlink" title="创建证书的命令"></a>创建证书的命令</h3><pre><code>keytool -genkeypair -alias "tomcat" -keyalg "RSA" -keystore "e:\tomcat.keystore"  </code></pre><p>这里密码我输的是123456，名字与姓氏为域名，其它的根据具体情况输入<br>以上命令将生产一对非对称密钥和自我签名的证书 e:\tomcat.keystore.<br>将证书保存到<tomcat_home>\conf 的目录下，<br>注意：“名字与姓氏”应该是域名，输成了姓名，和真正运行的时候域名不符，会出问题<br><img src="/2020/09/1599632929241/1599632929241/20200909144433.png" alt="20200909144433"></tomcat_home></p>
<h3 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h3><p>找到conf下的server.xml文件，添加以下内容，</p>
<pre><code>&lt;Connector port="8451" protocol="HTTP/1.1" SSLEnabled="true"  
              maxThreads="150" scheme="https" secure="true"  
              clientAuth="false" sslProtocol="TLS"   
       keystoreFile="conf/tomcat.keystore"  
       keystorePass="123456" 
 /&gt; </code></pre><p>端口port可自定义，keystorePass为密匙库密码</p>
<p>启动tomcat<br><img src="/2020/09/1599632929241/1599632929241/20200909161043.png" alt="20200909161043"><br>如换成apr模式 将protocol=”HTTP/1.1”替换为protocol=”org.apache.coyote.http11.Http11Protocol”即可</p>
<h3 id="访问结果"><a href="#访问结果" class="headerlink" title="访问结果"></a>访问结果</h3><p>http访问 - 8080 ：<a href="http://localhost:8088/" target="_blank" rel="noopener">http://localhost:8088/</a><br><img src="/2020/09/1599632929241/1599632929241/20200909160048.png" alt="20200909160048"></p>
<p>https访问 - 8451 ：<a href="https://localhost:8451/" target="_blank" rel="noopener">https://localhost:8451/</a><br><img src="/2020/09/1599632929241/1599632929241/20200909160135.png" alt="20200909160135"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcat开启APR运行模式，优化并发性能 - Windows</title>
    <url>/2020/09/1599628352134/1599628352134/</url>
    <content><![CDATA[<p>Tomcat的APR运行2种模式，结合下载的版本进行配置，以 Tomcat 9 为例，建立选择第二种版本<br><img src="/2020/09/1599628352134/1599628352134/20230725161936.png" alt="20230725161936"></p>
<h3 id="第一个版本"><a href="#第一个版本" class="headerlink" title="第一个版本"></a>第一个版本</h3><p>下载tcnative-1.dll文件<br>官网地址：<a href="https://tomcat.apache.org/download-native.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-native.cgi</a><br>软件下载地址：<a href="https://mirror.bit.edu.cn/apache/tomcat/tomcat-connectors/native/1.2.25/binaries/tomcat-native-1.2.25-openssl-1.1.1g-win32-bin.zip" target="_blank" rel="noopener">点击下载</a><br><img src="/2020/09/1599628352134/1599628352134/20200909131752.png" alt="20200909131752"></p>
<p>文件解压后，将 x64/tcnative-1.dll 文件复制到C:\Windows\System32目录下<br><img src="/2020/09/1599628352134/1599628352134/20200909132118.png" alt="20200909132118"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>找到下面代码</p>
<pre><code>&lt;Connector connectionTimeout="20000" port="8086" protocol="HTTP/1.1" redirectPort="8443"/&gt;</code></pre><p>修改为</p>
<pre><code>&lt;Connector connectionTimeout="20000" port="8086" protocol="org.apache.coyote.http11.Http11AprProtocol" redirectPort="8443"/&gt;</code></pre><p>结果<br><img src="/2020/09/1599628352134/1599628352134/20200909133359.png" alt="20200909133359"></p>
<h3 id="第二个版本"><a href="#第二个版本" class="headerlink" title="第二个版本"></a>第二个版本</h3><p>下载的此版本，无需复制tcnative-1.dll文件到C:\Windows\System32目录下，仅需配置即可；<br>找到代码 protocol=”HTTP/1.1” -&gt; protocol=”org.apache.coyote.http11.Http11AprProtocol”</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>tomcat开启APR运行模式，优化并发性能 - Linux</title>
    <url>/2020/09/1599545396773/1599545396773/</url>
    <content><![CDATA[<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>Tomcat支持三种接收请求的处理方式：BIO、NIO、APR </p>
<p>BIO模式：阻塞式I/O操作，表示Tomcat使用的是传统Java I/O操作(即java.io包及其子包)。<br>Tomcat7以下版本默认情况下是以bio模式运行的，由于每个请求都要创建一个线程来处理，线程开销较大，不能处理高并发的场景，在三种模式中性能也最低。</p>
<p>NIO模式：是Java SE 1.4及后续版本提供的一种新的I/O操作方式(即java.nio包及其子包)。<br>是一个基于缓冲区、并能提供非阻塞I/O操作的Java API，它拥有比传统I/O操作(bio)更好的并发运行性能。<br>Tomcat8以上版本，默认使用的就是NIO模式，不需要额外修改。</p>
<p>APR模式：简单理解，就是从操作系统级别解决异步IO问题，大幅度的提高服务器的处理和响应性能， 也是Tomcat运行高并发应用的首选模式。 </p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><pre><code>yum install -y apr-devel openssl-devel gcc make expat-devel libtool</code></pre><h3 id="下载软件"><a href="#下载软件" class="headerlink" title="下载软件"></a>下载软件</h3><p>所需软件的下载地址：<br><a href="https://mirrors.cnnic.cn/apache/apr/" target="_blank" rel="noopener">https://mirrors.cnnic.cn/apache/apr/</a><br><a href="https://tomcat.apache.org/download-native.cgi" target="_blank" rel="noopener">https://tomcat.apache.org/download-native.cgi</a></p>
<p>点击下载：<br><a href="https://mirrors.cnnic.cn/apache/apr/apr-1.7.0.tar.gz" target="_blank" rel="noopener">https://mirrors.cnnic.cn/apache/apr/apr-1.7.0.tar.gz</a><br><a href="https://mirrors.cnnic.cn/apache/apr/apr-iconv-1.2.2.tar.gz" target="_blank" rel="noopener">https://mirrors.cnnic.cn/apache/apr/apr-iconv-1.2.2.tar.gz</a><br><a href="https://mirrors.cnnic.cn/apache/apr/apr-util-1.6.1.tar.gz" target="_blank" rel="noopener">https://mirrors.cnnic.cn/apache/apr/apr-util-1.6.1.tar.gz</a><br><a href="https://mirrors.bfsu.edu.cn/apache/tomcat/tomcat-connectors/native/1.2.25/source/tomcat-native-1.2.25-src.tar.gz" target="_blank" rel="noopener">https://mirrors.bfsu.edu.cn/apache/tomcat/tomcat-connectors/native/1.2.25/source/tomcat-native-1.2.25-src.tar.gz</a></p>
<h3 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h3><p><img src="/2020/09/1599545396773/1599545396773/20200908153142.png" alt="20200908153142"></p>
<p>apr</p>
<pre><code>cd /usr/local/tomcat/src/apr-1.7.0
./configure --prefix=/usr/local/tomcat/src/apr
make &amp;&amp; make install</code></pre><p>apr-iconv</p>
<pre><code>cd /usr/local/tomcat/src/apr-iconv-1.2.2
./configure --with-apr=/usr/local/tomcat/src/apr --prefix=/usr/local/tomcat/src/apr-iconv
make &amp;&amp; make install</code></pre><p>apr-util</p>
<pre><code>cd apr-util-1.6.1/
./configure --with-apr=/usr/local/tomcat/src/apr --with-apr-iconv=/usr/local/tomcat/src/apr-iconv/bin/apriconv --prefix=/usr/local/tomcat/src/apr-util
make &amp;&amp; make install</code></pre><p>tomcat-native</p>
<pre><code>cd /usr/local/tomcat/src/tomcat-native-1.2.25-src/native
./configure --with-apr=/usr/local/tomcat/src/apr --with-java-home=/usr/local/java/jdk1.8.0_231
make &amp;&amp; make install</code></pre><p>profile</p>
<pre><code>echo -e 'export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/tomcat/src/apr/lib\nexport LD_RUN_PATH=$LD_RUN_PATH:/usr/local/tomcat/src/apr/lib' &gt;&gt; /etc/profile
source /etc/profile</code></pre><h3 id="配置APR"><a href="#配置APR" class="headerlink" title="配置APR"></a>配置APR</h3><p>打开 server.xml</p>
<pre><code>vim /usr/local/tomcat/apache-tomcat-9.0.27/conf/server.xml</code></pre><p>修改内容如下：</p>
<pre><code>&lt;Executor name="tomcatThreadPool" 
         namePrefix="catalina-exec-"
         maxThreads="300" 
         minSpareThreads="30"/&gt;
​
&lt;Connector executor="tomcatThreadPool" 
              port="8080" 
              protocol="org.apache.coyote.http11.Http11AprProtocol"
              connectionTimeout="20000"
              redirectPort="8443"
              acceptCount="900"
              disableUploadTimeout="true"
              URIEncoding="UTF-8"
              enableLookups="false"
              compression="on"
              compressionMinSize="1024"
              /&gt;
​
&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt; ##注释掉下面那行，如果不用apache
&lt;!-- &lt;Connector port="8009" protocol="AJP/1.3" redirectPort="8443" /&gt; --&gt;</code></pre><p>结果：<br><img src="/2020/09/1599545396773/1599545396773/20200908160528.png" alt="20200908160528"><br>注：如果非root用户启动失败，把apr环境变量在当前用户的.bash_profile中写一份</p>
<h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><p>Executor参数说明</p>
<pre><code>name：共享线程池的名字。这是Connector为了共享线程池要引用的名字，该名字必须唯一。默认值：None；

namePrefix:在JVM上，每个运行线程都可以有一个name 字符串。这一属性为线程池中每个线程的name字符串设置了一个前缀，
            Tomcat将把线程号追加到这一前缀的后面。默认值：catalina-exec-；

maxThreads：该线程池可以容纳的最大线程数。默认值：150；

maxIdleTime：在Tomcat关闭一个空闲线程之前，允许空闲线程持续的时间(以毫秒为单位)。

            只有当前活跃的线程数大于minSpareThread的值，才会关闭空闲线程。默认值：60000(一分钟)。

minSpareThreads：Tomcat应该始终打开的最小不活跃线程数。默认值：4。

threadPriority：线程的等级。默认是Thread.NORM_PRIORITY</code></pre><p>Connector参数说明</p>
<pre><code>maxThreads :Tomcat 使用线程来处理接收的每个请求，这个值表示 Tomcat 可创建的最大的线程数，默认值是 200

minSpareThreads：最小空闲线程数，Tomcat 启动时的初始化的线程数，表示即使没有人使用也开这么多空线程等待，默认值是 10。

maxSpareThreads：最大备用线程数，一旦创建的线程超过这个值，Tomcat 就会关闭不再需要的 socket 线程。
​
上边配置的参数，最大线程 500（一般服务器足以），要根据自己的实际情况合理设置，设置越大会耗费内存和 CPU，
因为 CPU 疲于线程上下文切换，没有精力提供请求服务了，最小空闲线程数 20，线程最大空闲时间 60 秒，
当然允许的最大线程连接数还受制于操作系统的内核参数设置，设置多大要根据自己的需求与环境。
当然线程可以配置在“tomcatThreadPool”中，也可以直接配置在“Connector”中，但不可以重复配置。
​
URIEncoding：指定 Tomcat 容器的 URL 编码格式，语言编码格式这块倒不如其它 WEB 服务器软件配置方便，需要分别指定。

connnectionTimeout： 网络连接超时，单位：毫秒，设置为 0 表示永不超时，这样设置有隐患的。通常可设置为 30000 毫秒，可根据检测实际情况，适当修改。

enableLookups： 是否反查域名，以返回远程主机的主机名，取值为：true 或 false，如果设置为false，则直接返回IP地址，为了提高处理能力，应设置为 false。

disableUploadTimeout：上传时是否使用超时机制。

connectionUploadTimeout：上传超时时间，毕竟文件上传可能需要消耗更多的时间，这个根据你自己的业务需要自己调，
            以使Servlet有较长的时间来完成它的执行，需要与上一个参数一起配合使用才会生效。

acceptCount：指定当所有可以使用的处理请求的线程数都被使用时，可传入连接请求的最大队列长度，超过这个数的请求将不予处理，默认为100个。

keepAliveTimeout：长连接最大保持时间（毫秒），表示在下次请求过来之前，Tomcat 保持该连接多久，默认是使用 connectionTimeout 时间，-1 为不限制超时。

maxKeepAliveRequests：表示在服务器关闭之前，该连接最大支持的请求数。
            超过该请求数的连接也将被关闭，1表示禁用，-1表示不限制个数，默认100个，一般设置在100~200之间。

compression：是否对响应的数据进行 GZIP 压缩，off：表示禁止压缩；on：表示允许压缩（文本将被压缩）、force：表示所有情况下都进行压缩，默认值为off，
            压缩数据后可以有效的减少页面的大小，一般可以减小1/3左右，节省带宽。

compressionMinSize：表示压缩响应的最小值，只有当响应报文大小大于这个值的时候才会对报文进行压缩，如果开启了压缩功能，默认值就是2048。

compressableMimeType：压缩类型，指定对哪些类型的文件进行数据压缩。

noCompressionUserAgents="gozilla, traviata"： 对于以下的浏览器，不启用压缩。

如果已经对代码进行了动静分离，静态页面和图片等数据就不需要 Tomcat 处理了，那么也就不需要配置在 Tomcat 中配置压缩了。</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx 根据 不同Tomcat项目 配置访问路径</title>
    <url>/2020/09/1600763525872/1600763525872/</url>
    <content><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>在Nginx 中 配置 upstream 代理服务器，<br>由于  $scheme = http （return  301 ）会导致http的请求链接跳转https请求，故在http中不用配置。</p>
<p>在配置路径中使用根据URL请求不通的访问，需要保持顺序问题</p>
<p>第一访问tomcat里面的项目名《a》</p>
<pre><code>location ~* .*tomcat-a.* {
    proxy_pass http://tomcat;
    proxy_set_header Host $http_host;
}</code></pre><p>第二访问tomcat里面的项目名《b》</p>
<pre><code>location ~* .*tomcat-b.* { 
    proxy_pass http://tomcat;
    proxy_set_header Host $http_host;
}</code></pre><p>第三访问nginx里面html文件夹的内容</p>
<pre><code>location / { 
    root   html;
    index  index.html index.htm;
}</code></pre><p>在https中进行代理访问需要添加 proxy_set_header Host $http_host; </p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><pre><code>user  root;
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;

    keepalive_timeout  65;

    # 开启gzip压缩
    gzip  on;
    gzip_comp_level  5;
    gzip_min_length  1024;
    gzip_types   text/plain application/x-javascript text/css application/xml text/javascript  image/jpeg image/gif image/png;

    # 隐藏nginx版本信息
    server_tokens off;

    upstream tomcat{
        server www.zhuqiaolun.com:8080;
    }

    server {
        listen       80;
        server_name  www.zhuqiaolun.com;

        if ($scheme = http ) {
            return  301 https://www.zhuqiaolun.com$request_uri;
        }

        #charset koi8-r;
        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;

        location = /50x.html {
            root   html;
        }

    }

    # HTTPS server
    #
    server {
        listen 443 ssl;
        server_name    www.zhuqiaolun.com;
        #网站主页路径。此路径仅供参考，具体请您按照实际目录操作。
        root html; 
        index index.html index.htm;   
        ssl_certificate 1_www.zhuqiaolun.com_bundle.crt;
        ssl_certificate_key 2_www.zhuqiaolun.com.key;
        ssl_session_timeout    5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers  on;

        location ~* .*tomcat-a.* {

            proxy_pass http://tomcat;

            expires 24h;
            add_header Cache-Control no-store;
            #Proxy Settings 
            proxy_redirect off; 

            proxy_set_header Host $http_host; 
            proxy_set_header Cookie $http_cookie; 
            proxy_set_header X-Real-IP $remote_addr; 
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 

            proxy_set_header X-Forwarded-Proto $scheme;             
            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; 
            proxy_max_temp_file_size 0; 
            proxy_connect_timeout 90; 
            proxy_send_timeout 90; 
            proxy_read_timeout 90; 
            proxy_buffer_size 4k; 
            proxy_buffers 4 32k; 
            proxy_busy_buffers_size 64k; 
            proxy_temp_file_write_size 64k;
            # 上传文件限制大小
            client_max_body_size 100M;
            client_body_buffer_size 128k;
        }

        location ~* .*tomcat-b.* {

            proxy_pass http://tomcat;

            expires 24h;
            add_header Cache-Control no-store;
            #Proxy Settings 
            proxy_redirect off; 

            proxy_set_header Host $http_host; 
            proxy_set_header Cookie $http_cookie; 
            proxy_set_header X-Real-IP $remote_addr; 
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 

            proxy_set_header X-Forwarded-Proto $scheme;             
            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; 
            proxy_max_temp_file_size 0; 
            proxy_connect_timeout 90; 
            proxy_send_timeout 90; 
            proxy_read_timeout 90; 
            proxy_buffer_size 4k; 
            proxy_buffers 4 32k; 
            proxy_busy_buffers_size 64k; 
            proxy_temp_file_write_size 64k;
            # 上传文件限制大小
            client_max_body_size 100M;
            client_body_buffer_size 128k;
        }


        location / {

            root   html;
            index  index.html index.htm;

            expires 24h;
            add_header Cache-Control no-store;
            #Proxy Settings 
            proxy_redirect off; 

            proxy_set_header Host $http_host; 
            proxy_set_header Cookie $http_cookie; 
            proxy_set_header X-Real-IP $remote_addr; 
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 

            proxy_set_header X-Forwarded-Proto $scheme;             
            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; 
            proxy_max_temp_file_size 0; 
            proxy_connect_timeout 90; 
            proxy_send_timeout 90; 
            proxy_read_timeout 90; 
            proxy_buffer_size 4k; 
            proxy_buffers 4 32k; 
            proxy_busy_buffers_size 64k; 
            proxy_temp_file_write_size 64k;
            # 上传文件限制大小
            client_max_body_size 100M;
            client_body_buffer_size 128k;
        }
    }

}</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven项目的结构定义</title>
    <url>/2020/09/1600931110662/1600931110662/</url>
    <content><![CDATA[<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。</p>
<p>maven的遵循约定大于配置，约定了如下的目录结构：</p>
<pre><code>${basedir}：存放pom.xml和所有的子目录
${basedir}/src/main/java：项目的java源代码
${basedir}/src/main/resources：项目的资源文件，比如说properties文件、xml文件、application.yml等
${basedir}/src/test/java：项目的测试类，比如说Junit代码
${basedir}/src/test/resources：测试用的资源
${basedir}/src/main/webapp/WEB-INF：web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面，在springboot中无此目录
${basedir}/target：打包输出目录，在IDEA中需要设置
${basedir}/target/classes：编译输出目录
${basedir}/target/test-classes：测试编译输出目录</code></pre><p>以下的内容属于根元素和必要配置</p>
<pre><code>&lt;!-- 模型版本 --&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

&lt;!-- 公司或者组织的唯一标志，也是打包成jar包路径的依据 --&gt;
&lt;!-- 例如com.demon.project，maven打包jar包的路径：/com/demon/project --&gt;
&lt;groupId&gt;com.demon.project&lt;/groupId&gt;

&lt;!-- 项目的唯一ID，一个groupId下面可能多个项目，就是靠artifactId来区分的 --&gt;
&lt;artifactId&gt;demo&lt;/artifactId&gt;

&lt;!-- 项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt;
&lt;version&gt;1.0.0&lt;/version&gt;

&lt;!--项目产生的构件类型，包括jar、war、pom等 --&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>pom</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows下安装Maven环境</title>
    <url>/2020/09/1600927625377/1600927625377/</url>
    <content><![CDATA[<h3 id="下载Maven"><a href="#下载Maven" class="headerlink" title="下载Maven"></a>下载Maven</h3><p>maven 官网下载地址：<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener">https://maven.apache.org/download.cgi</a><br>maven 文件下载地址：<a href="https://archive.apache.org/dist/maven/maven-3/" target="_blank" rel="noopener">https://archive.apache.org/dist/maven/maven-3/</a><br>下载 Binary 版本，点击箭头所指的链接进行下载<br>传送门：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.zip" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.zip</a><br><img src="/2020/09/1600927625377/1600927625377/20200924141314.png" alt="20200924141314"></p>
<h3 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h3><p><img src="/2020/09/1600927625377/1600927625377/20200924142131.png" alt="20200924142131"></p>
<h3 id="配置Maven环境变量"><a href="#配置Maven环境变量" class="headerlink" title="配置Maven环境变量"></a>配置Maven环境变量</h3><p>打开环境变量界面：</p>
<p>新建系统变量：MAVEN_HOME，值为maven的根目录<br><img src="/2020/09/1600927625377/1600927625377/20200924143005.png" alt="20200924143005"></p>
<p>修改系统变量：path,点击新建添加  %MAVEN_HOME%\bin<br><img src="/2020/09/1600927625377/1600927625377/20200924143243.png" alt="20200924143243"></p>
<h3 id="验证Maven环境变量"><a href="#验证Maven环境变量" class="headerlink" title="验证Maven环境变量"></a>验证Maven环境变量</h3><p>然后win+R 运行cmd 输入 mvn -version，如图所示则配置成功<br><img src="/2020/09/1600927625377/1600927625377/20200924143311.png" alt="20200924143311"></p>
<h3 id="修改本地仓库地址"><a href="#修改本地仓库地址" class="headerlink" title="修改本地仓库地址"></a>修改本地仓库地址</h3><p>在maven根目录下打开conf目录可以找到settings文件，找到第53行，这里是maven默认的仓库，默认的仓库地址为当前用户的 .m文件夹下的repository目录内，<br>在settings文件中有一个 localRepository 标签<br><img src="/2020/09/1600927625377/1600927625377/20200924144010.png" alt="20200924144010"><br>复制第53行，将它拿到注释外并将中间的内容改成你需要的路径，如图<br><img src="/2020/09/1600927625377/1600927625377/20200924144258.png" alt="20200924144258"></p>
<pre><code>&lt;localRepository&gt;D:\apache\Repositories\Maven&lt;/localRepository&gt;</code></pre><p>表示本地仓库地址为D盘的xxxx目录下</p>
<h3 id="配置Maven镜像"><a href="#配置Maven镜像" class="headerlink" title="配置Maven镜像"></a>配置Maven镜像</h3><p>在maven根目录下打开conf目录可以找到settings文件，找到第147行，Maven自身默认镜像<br><img src="/2020/09/1600927625377/1600927625377/20200924150053.png" alt="20200924150053"></p>
<pre><code>&lt;mirror&gt;
  &lt;id&gt;mirrorId&lt;/id&gt;
  &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;
  &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;
  &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;
&lt;/mirror&gt;</code></pre><p>由于默认镜像属于国外，下载jar很慢；所以需要配置国内的镜像</p>
<p><a href="https://maven.aliyun.com/mvn/guide" target="_blank" rel="noopener">阿里云仓库</a>（推荐）：</p>
<pre><code>&lt;mirror&gt;
  &lt;id&gt;aliyunmaven&lt;/id&gt;
  &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
  &lt;name&gt;阿里云公共仓库&lt;/name&gt;
  &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt;
&lt;/mirror&gt;</code></pre><p><a href="https://repo.spring.io/libs-snapshot/" target="_blank" rel="noopener">spring.io仓库</a>:</p>
<pre><code>&lt;mirror&gt;
    &lt;id&gt;sprintio&lt;/id&gt;
    &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;
    &lt;url&gt;https://repo.spring.io/libs-snapshot/&lt;/url&gt;
&lt;/mirror&gt;</code></pre><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>Jackson 的 使用</title>
    <url>/2020/09/1601024145664/1601024145664/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>jackson-databind 依赖 jackson-core 和 jackson-annotations，当添加 jackson-databind 之后， jackson-core 和 jackson-annotations 也随之添加到 Java 项目工程中。<br>在添加相关依赖包之后，就可以使用 Jackson。</p>
<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><pre><code>//在反序列化时忽略在 json 中存在但 Java 对象不存在的属性 
mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false); 

//在序列化时日期格式默认为 yyyy-MM-dd'T'HH:mm:ss.SSSZ 
mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,false) 

//在序列化时忽略值为 null 的属性 
mapper.setSerializationInclusion(Include.NON_NULL); 

//忽略值为默认值的属性 
mapper.setDefaultPropertyInclusion(Include.NON_DEFAULT);</code></pre><p>更多配置信息可以查看 Jackson 的 DeserializationFeature，SerializationFeature 和 Include。</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p>Jackson 根据它的默认方式序列化和反序列化 java 对象，若根据实际需要，灵活的调整它的默认方式，可以使用 Jackson 的注解。<br>常用的注解及用法如下：</p>
<p>@JsonProperty：用于属性，把属性的名称序列化时转换为另外一个名称。</p>
<pre><code>@JsonProperty("birth_date")
 private Date birthDate;</code></pre><p>@JsonFormat：用于属性或者方法，把属性的格式序列化时转换成指定的格式。</p>
<pre><code>@JsonFormat(timezone = "GMT+8", pattern = "yyyy-MM-dd HH:mm:ss")
 public Date birthDate;</code></pre><p>@JsonPropertyOrder：用于类，指定属性在序列化时 json 中的顺序。</p>
<pre><code>@JsonPropertyOrder({ "birth_date", "name" })
 public class Person{}</code></pre><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>Jackson 最常用的 API 就是基于”对象绑定” 的 ObjectMapper。<br>writeValue：将 java 对 象序列化 为 json，并 将 json 存 储成不同的格式，String（writeValueAsString），Byte Array（writeValueAsString），Writer， File，OutStream 和 DataOutput。<br>readValue：将不同的数据源像 String ， Byte Array， Reader，File，URL， InputStream 将 json 反序列化为 java 对象。</p>
<h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line">import com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line">import com.fasterxml.jackson.core.JsonParser;</span><br><span class="line">import com.fasterxml.jackson.databind.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/11/2 11:18</span><br><span class="line"> * desc ：</span><br><span class="line"> */</span><br><span class="line">public class ObjectMapperUtil {</span><br><span class="line"></span><br><span class="line">    private static ObjectMapperUtil objectMapperUtil;</span><br><span class="line">    private ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    private ObjectMapperUtil() {</span><br><span class="line">        System.out.println("初始化-ObjectMapper-");</span><br><span class="line">        objectMapper = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">        // json不进行换行缩进等操作  默认就是不进行操作，写了这行和没写的效果一样</span><br><span class="line">        objectMapper.disable(SerializationFeature.INDENT_OUTPUT);</span><br><span class="line"></span><br><span class="line">        // 属性为Null的不进行序列化，只对pojo起作用，对map和list不起作用</span><br><span class="line">        objectMapper.setSerializationInclusion(JsonInclude.Include.ALWAYS);</span><br><span class="line"></span><br><span class="line">        // json是否允许属性名没有引号 ，默认是false</span><br><span class="line">        objectMapper.configure(JsonParser.Feature.ALLOW_UNQUOTED_FIELD_NAMES, true);</span><br><span class="line">        // json是否允许属性名为单引号 ，默认是false</span><br><span class="line">        objectMapper.configure(JsonParser.Feature.ALLOW_SINGLE_QUOTES, true);</span><br><span class="line">        // 反序列化的时候如果多了其他属性,不抛出异常</span><br><span class="line">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span><br><span class="line">        // 如果是空对象的时候,不抛异常</span><br><span class="line">        objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false);</span><br><span class="line"></span><br><span class="line">        //属性为null的转换</span><br><span class="line">        objectMapper.getSerializerProvider().setNullValueSerializer(new JsonSerializer<span class="tag">&lt;<span class="name">Object</span>&gt;</span>() {</span><br><span class="line">            @Override</span><br><span class="line">            public void serialize(Object arg0, JsonGenerator arg1, SerializerProvider arg2) throws IOException {</span><br><span class="line">                arg1.writeString("");</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        // 取消时间的转化格式,默认是时间戳,可以取消,同时需要设置要表现的时间格式</span><br><span class="line">        // objectMapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);</span><br><span class="line">        // objectMapper.setDateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static ObjectMapperUtil getInstance() {</span><br><span class="line">        if (objectMapperUtil == null) {</span><br><span class="line">            objectMapperUtil = ObjectMapperUtilLoader.instance;</span><br><span class="line">        }</span><br><span class="line">        return objectMapperUtil;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public ObjectMapper getObjectMapper() {</span><br><span class="line">        return objectMapper;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static class ObjectMapperUtilLoader {</span><br><span class="line">        private static final ObjectMapperUtil instance = new ObjectMapperUtil();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="实体对象转化字符串"><a href="#实体对象转化字符串" class="headerlink" title="实体对象转化字符串"></a>实体对象转化字符串</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    String jsonString = ObjectMapperUtil.getInstance().getObjectMapper().writerWithDefaultPrettyPrinter().writeValueAsString(new 实体对象());</span><br><span class="line">} catch (JsonProcessingException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="字符串转化键值对象"><a href="#字符串转化键值对象" class="headerlink" title="字符串转化键值对象"></a>字符串转化键值对象</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    Map&lt;String, Object&gt; jsonMap = ObjectMapperUtil.getInstance().getObjectMapper().readValue(jsonString, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});</span><br><span class="line">} catch (JsonProcessingException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line"></span><br><span class="line">ObjectNode objectNode = objectMapper.createObjectNode();</span><br><span class="line">objectNode.put("name", "张三");</span><br><span class="line">objectNode.put("age", 30);</span><br><span class="line"></span><br><span class="line">ArrayNode arrayNode = objectMapper.createArrayNode();</span><br><span class="line">arrayNode.add("Java");</span><br><span class="line">arrayNode.add("Python");</span><br><span class="line">objectNode.set("job", arrayNode);</span><br><span class="line"></span><br><span class="line">System.out.println(objectNode.toString());  // {"name":"张三","age":30,"job":["Java","Python"]}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Jackson</tag>
      </tags>
  </entry>
  <entry>
    <title>Window10安装 Redis - 绿色版</title>
    <url>/2020/09/1601194986992/1601194986992/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>Redis下载地址：<a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases</a><br>传送门：<a href="https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.zip" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.zip</a></p>
<p><img src="/2020/09/1601194986992/1601194986992/20200927163042.png" alt="20200927163042"></p>
<p>对文件进行一个说明：<br>Redis-x64-3.2.100.msi ：图形化安装文件<br>Redis-x64-3.2.100.zip ：压缩文件安装包，需要解压安装<br>Redis-x64-3.2.100.zip ：.zip压缩格式源码<br>Redis-x64-3.2.100.tar.gz ：.gz压缩格式源码</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>点击下载后，需要先进行解压，解压文件如下：<br><img src="/2020/09/1601194986992/1601194986992/20200928150337.png" alt="20200928150337"></p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>双击运行目录下的 redis-server.exe，会加载自身存在的 conf 文件配置，采取默认的配置运行；出现以下画面即成功：</p>
<p><img src="/2020/09/1601194986992/1601194986992/20200928151238.png" alt="20200928151238"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>修改为加载目录下的 redis.windows.conf 文件配置，由于我修改了配置文件端口为 6377，<br>故执行：Win+R –&gt; 运行cmd –&gt; 进入Redis的根目录下：</p>
<pre><code>D:\Redis-x64-3.2.100&gt;redis-server.exe redis.windows.conf</code></pre><p><img src="/2020/09/1601194986992/1601194986992/20200928151952.png" alt="20200928151952"></p>
<h3 id="bat启动"><a href="#bat启动" class="headerlink" title="bat启动"></a>bat启动</h3><p>创建快捷启动，在根目录下，新建txt文件，填写以下内容，保存后修改txt的文件后缀为bat，双击即可启动；</p>
<pre><code>@echo off
redis-server.exe redis.windows.conf
@pause</code></pre><h3 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h3><p>创建服务启动，可保存跟随系统启动自运行；执行：Win+R –&gt; 运行cmd –&gt; 进入Redis的根目录下：</p>
<pre><code>redis-server.exe --service-install redis.windows.conf</code></pre><p><img src="/2020/09/1601194986992/1601194986992/20200928152934.png" alt="20200928152934"><br>出现 #Redis successfully installed as a service.即完成；可在服务列表中查看名称为【Rides】的服务；</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>常用的redis服务命令，需在进入Redis的根目录下执行；<br>安装服务：redis-server.exe –service-install redis.windows.conf<br>开启服务：redis-server –service-start<br>停止服务：redis-server –service-stop<br>卸载服务：redis-server –service-uninstall</p>
<p><img src="/2020/09/1601194986992/1601194986992/20200928153643.png" alt="20200928153643"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Window10安装 Redis - 安装版</title>
    <url>/2020/09/1601194890597/1601194890597/</url>
    <content><![CDATA[<p>Redis中文官方网站：<a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>Redis下载地址：<a href="https://github.com/microsoftarchive/redis/releases" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases</a><br>传送门：<a href="https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi" target="_blank" rel="noopener">https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi</a></p>
<p><img src="/2020/09/1601194890597/1601194890597/20200927163042.png" alt="20200927163042"></p>
<p>对文件进行一个说明：<br>Redis-x64-3.2.100.msi ：图形化安装文件<br>Redis-x64-3.2.100.zip ：压缩文件安装包，需要解压安装<br>Redis-x64-3.2.100.zip ：.zip压缩格式源码<br>Redis-x64-3.2.100.tar.gz ：.gz压缩格式源码</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>运行下载的msi文件，点击next;</p>
<p>1.勾选 I accept the terms in the License Agreement，点击next;<br><img src="/2020/09/1601194890597/1601194890597/20200927164140.png" alt="20200927164140"></p>
<p>2.更换安装目录，以及添加到环境变量path,以便开机启动，命名执行<br><img src="/2020/09/1601194890597/1601194890597/20200927164718.png" alt="20200927164718"></p>
<p>3.redis默认是 6379 端口，如果你不想用 6379 或者 6379 已经被其他程序占用，可以修改成其他端口。<br>添加到windows防火墙的选项保持默认就好。<br><img src="/2020/09/1601194890597/1601194890597/20200927165702.png" alt="20200927165702"></p>
<p>4.设置redis最大内存限制。默认100MB内存，但是可能是不够用的，所以改大一点，我这里修改成了1024MB。<br>可以根据自己的实际情况来更改设置。<br><img src="/2020/09/1601194890597/1601194890597/20200927170049.png" alt="20200927170049"></p>
<p>5.点击install即可<br><img src="/2020/09/1601194890597/1601194890597/20200927170251.png" alt="20200927170251"></p>
<p>至此安装结束。</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>打开任务管理器，点击服务，查看服务列表中是否有一个名字叫做Redis的服务正在运行，如果有，说明安装并启动成功，<br><img src="/2020/09/1601194890597/1601194890597/20200927171019.png" alt="20200927171019"></p>
<p>进入安装目录下，执行 redis-cli命令：<br><img src="/2020/09/1601194890597/1601194890597/20200927170726.png" alt="20200927170726"></p>
<p>如果没有或者未成功启动，请删除服务之后对照如上步骤重新安装。<br>删除redis服务命令为 sc delete 服务名 ，需要注意删除服务需要使用管理员身份打开命令行窗口执行命令。</p>
<pre><code>sc delete Redis</code></pre><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>使用的时候提示连不上，可以关闭保护模式：在redis安装目录找到“redis.windows-service.conf”：<br>查找protected-mode yes 改为 protected-mode no</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven项目的Pom配置</title>
    <url>/2020/09/1600933059831/1600933059831/</url>
    <content><![CDATA[<h3 id="属性配置"><a href="#属性配置" class="headerlink" title="属性配置"></a>属性配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 过滤测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="依赖引入"><a href="#依赖引入" class="headerlink" title="依赖引入"></a>依赖引入</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="打包配置"><a href="#打包配置" class="headerlink" title="打包配置"></a>打包配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>项目名称<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="/2022/03/1646127631469/1646127631469/">插件</a></p>
<h3 id="代理仓库配置"><a href="#代理仓库配置" class="headerlink" title="代理仓库配置"></a>代理仓库配置</h3><p>开启项目本身的代理仓库配置</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/spring<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>但有时，跟着上面的设置方法并不奏效，仍然还是从之前的镜像站中去下载。<br>此时，我们需要去检查下 Maven 安装目录下的settings.xml：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>可以看到，在设置镜像时，mirrorOf设置为了“*”，意味所有的依赖都是从这个镜像上下载。完全不给Spring Snapshots机会了。</p>
<p>解决方法也简单，改为下面的方式：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*,!spring-snapshots<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>mirrorOf设置为了“*,!spring-snapshots”，表示除了Spring Snapshots外，所有的依赖都将从这个镜像上下载。</p>
<p>mirrorOf的配置支持如下场景：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">*：所有依赖；</span><br><span class="line">external:*：所有不再本地和不是基于文件的依赖；</span><br><span class="line">repo,repo1：所有来自repo或者repo1仓库的依赖；</span><br><span class="line">*,!repo1：除了repo1外的所有依赖。即上面示例中的场景。</span><br></pre></td></tr></tbody></table></figure></div>












<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>pom</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux中安装MyCat环境</title>
    <url>/2020/08/1596536908607/1596536908607/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网：<a href="http://www.mycat.org.cn/" target="_blank" rel="noopener">Mycat数据库分库分表中间件</a>，点击下载1.6.7.3 的Linux稳定版本<br>链接：<a href="http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-linux.tar.gz" target="_blank" rel="noopener">http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-linux.tar.gz</a></p>
<p>待续···</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyCat</category>
      </categories>
      <tags>
        <tag>MyCat</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis配置 之  设置密码</title>
    <url>/2020/09/1601271269577/1601271269577/</url>
    <content><![CDATA[<p>默认安装后的redis是没有密码的，这明显有很大的安全隐患，所以需要设置密码。这里提供2中方式</p>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><p><span style="color:red">注：使用第二种，不知道怎么回滚为空密码</span></p>
<p>1.第一种方式（推荐）：<br>修改配置文件“redis.windows-service.conf”，大约在 443 行：<br><img src="/2020/09/1601271269577/1601271269577/20200927172058.png" alt="20200927172058"><br>添加一下内容：</p>
<pre><code>requirepass 123456</code></pre><p>然后重启Redis服务，即可生效。如若去掉此行代码即属于设置密码为空。</p>
<p>2.第二种方式：<br>使用命令方式进入链接后，输入 config set requirepass “你的密码”，本例为 123456，进行回车；<br><img src="/2020/09/1601271269577/1601271269577/20200927172450.png" alt="20200927172450"></p>
<p>当显示为OK后，需要进行auth认证，当输入 auth后会出现 auth password，不用管password的出现，敲一下空格再输入密码(123456)回车即可；<br><img src="/2020/09/1601271269577/1601271269577/20200927172545.png" alt="20200927172545"></p>
<p>更换密码输入命令：config set requirepass “” ；当密码为空时不用auth认证；且密码任意输入都可连接；</p>
<h3 id="查看密码"><a href="#查看密码" class="headerlink" title="查看密码"></a>查看密码</h3><p>输入命令：config get requirepass<br><img src="/2020/09/1601271269577/1601271269577/20200927173752.png" alt="20200927173752"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>MyCat 分库配置</title>
    <url>/2020/08/1596694227482/1596694227482/</url>
    <content><![CDATA[<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>分别创建三个数据库：testdb_0，testdb_1，testdb_2</p>
<h3 id="MyCat配置"><a href="#MyCat配置" class="headerlink" title="MyCat配置"></a>MyCat配置</h3><p>server.xml配置不变，</p>
<pre><code>&lt;user name="root" defaultAccount="true"&gt;
    &lt;property name="password"&gt;123456&lt;/property&gt;
    &lt;property name="schemas"&gt;TESTDB&lt;/property&gt;
&lt;/user&gt;</code></pre><p>schema.xml配置如下：</p>
<pre><code>&lt;!-- 设置表的存储方式.schema name="TESTDB" 与 server.xml中的 TESTDB 设置一致  --&gt;  
&lt;schema name="TESTDB" checkSQLschema="true" sqlMaxLimit="100"&gt;  
    &lt;!-- 分片规则：sharding-by-intfile  --&gt;  
    &lt;table name="t_users" dataNode="node_db00,node_db01,node_db02" rule="sharding-by-intfile"&gt;&lt;/table&gt;
&lt;/schema&gt;  

&lt;!-- 设置dataNode 对应的数据库,及 mycat 连接的地址dataHost --&gt;  
&lt;dataNode name="node_db00" dataHost="dataHost01" database="testdb_0" /&gt;  
&lt;dataNode name="node_db01" dataHost="dataHost01" database="testdb_1" /&gt;  
&lt;dataNode name="node_db02" dataHost="dataHost01" database="testdb_2" /&gt; 

&lt;!-- mycat 逻辑主机dataHost对应的物理主机.其中也设置对应的mysql登陆信息 --&gt;  
&lt;dataHost name="dataHost01" maxCon="1000" minCon="10" balance="1" writeType="0" dbType="mysql" dbDriver="native"&gt;  
        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;  
        &lt;writeHost host="hostM1" url="127.0.0.1:3306" user="root" password="root"/&gt;
&lt;/dataHost&gt;  </code></pre><p>rule.xml配置如下：</p>
<pre><code>&lt;tableRule name="sharding-by-intfile"&gt;
    &lt;rule&gt;
        &lt;!-- columns:对应需要进行匹配规则的字段  --&gt;  
        &lt;columns&gt;sex&lt;/columns&gt;
        &lt;algorithm&gt;hash-int&lt;/algorithm&gt;
    &lt;/rule&gt;
&lt;/tableRule&gt;

&lt;function name="hash-int" class="io.mycat.route.function.PartitionByFileMap"&gt;
    &lt;property name="mapFile"&gt;partition-hash-int.txt&lt;/property&gt;
    &lt;property name="type"&gt;1&lt;/property&gt; 
    &lt;property name="defaultNode"&gt;0&lt;/property&gt;
&lt;/function&gt;</code></pre><p>说明：函数配置中，type默认值为0，0表示Integer，非零表示String， 所有的节点配置都是从defaultNode=0开始，及0代表第一个节点。<br>defaultNode 默认节点:小于0表示不设置默认节点，大于等于0表示设置默认节点,默认节点的作用;<br>枚举分片时,如果碰到不识别的枚举值，就让它路由到默认节点;<br>如果不配置默认节点（defaultNode值小于0表示不配置默认节点），碰到不识别的枚举值就会报错;</p>
<p>partition-hash-int.txt</p>
<pre><code>#10000=0
#10010=1
m=1
w=2</code></pre><p>说明：[sex=m]的数据放入node_db01，[sex=w]的数据放入node_db02，其它的数据[mw]放入node_db00，<br>0：表示第一个dataNode[name=node_db00]节点，以下标选择<br>1：表示第二个dataNode[name=node_db01]节点，以下标选择<br>2：表示第三个dataNode[name=node_db02]节点，以下标选择<br>注意以中文的分片规则，后续，</p>
<p>修改配置完成后，重启mycat服务，通过mycat插入数据即可看到结果</p>
<h3 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h3><pre><code>mysql -uroot -p123456 -P8066 -h 127.0.0.1</code></pre><p><img src="/2020/08/1596694227482/1596694227482/20200806151330.png" alt="20200806151330"></p>
<pre><code>mysql&gt; show databases;</code></pre><p><img src="/2020/08/1596694227482/1596694227482/20200806151352.png" alt="20200806151352"></p>
<pre><code>mysql&gt;  use TESTDB;</code></pre><p><img src="/2020/08/1596694227482/1596694227482/20200806151541.png" alt="20200806151541"></p>
<pre><code>mysql&gt; DROP TABLE IF EXISTS `t_users`;
mysql&gt; CREATE TABLE `t_users` (
   `id` int(11) NOT NULL AUTO_INCREMENT,
   `name` varchar(50) DEFAULT NULL,
   `sex` varchar(10) DEFAULT NULL,
   PRIMARY KEY (`id`)
 ) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><img src="/2020/08/1596694227482/1596694227482/20200806151603.png" alt="20200806151603">   </p>
<pre><code>mysql&gt; set names gbk;
mysql&gt; insert into t_users(`name`,sex)values('张三','m');
mysql&gt; insert into t_users(`name`,sex)values('李四','w');
mysql&gt; insert into t_users(`name`,sex)values('王五','mw');</code></pre><p><img src="/2020/08/1596694227482/1596694227482/20200806151636.png" alt="20200806151636">  </p>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>分片实现<br><img src="/2020/08/1596694227482/1596694227482/20200806155344.png" alt="20200806155344"></p>
<p>数据结果<br><img src="/2020/08/1596694227482/1596694227482/20200806154946.png" alt="20200806154946"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyCat</category>
      </categories>
      <tags>
        <tag>myCat</tag>
      </tags>
  </entry>
  <entry>
    <title>在Windows10中安装MyCat环境</title>
    <url>/2020/08/1596610285582/1596610285582/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网：<a href="http://www.mycat.org.cn/" target="_blank" rel="noopener">Mycat数据库分库分表中间件</a>，点击下载1.6.7.3 的Windows稳定版本<br>链接：<a href="http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-win.tar.gz" target="_blank" rel="noopener">http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-win.tar.gz</a></p>
<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><p>目录如下：<br><img src="/2020/08/1596610285582/1596610285582/20200806110425.png" alt="20200806110425"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>由于软件本身就是绿色版本，只需放在指定目录下即可，</p>
<pre><code>mycat：
    bin：命令文件
    catlet：空的,扩展
    conf：配置文件(server.xml,schema.xml,rule.xml等)
    lib：依赖的jar包
    logs：启动日志</code></pre><h3 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><p>在DB中创建数据库（test_mycat），创建表（t_user）<br><img src="/2020/08/1596610285582/1596610285582/20200806113753.png" alt="20200806113753"></p>
<h4 id="修改xml配置"><a href="#修改xml配置" class="headerlink" title="修改xml配置"></a>修改xml配置</h4><p>server.xml，rule.xml 不改变，<br>schema.xml改动如下：</p>
<pre><code>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;
&lt;mycat:schema xmlns:mycat="http://io.mycat/"&gt;

    &lt;!-- 设置表的存储方式.schema name="TESTDB" 与 server.xml中的 TESTDB 设置一致  --&gt;  
    &lt;schema name="TESTDB" checkSQLschema="true" sqlMaxLimit="100"&gt;
        &lt;!-- auto sharding by id (long) --&gt;
        &lt;table name="t_user" dataNode="dn1"/&gt;
    &lt;/schema&gt;

    &lt;!-- 设置dataNode 对应的数据库,及 mycat 连接的地址dataHost --&gt;  
    &lt;dataNode name="dn1" dataHost="localhost1" database="test_mycat" /&gt;

    &lt;!-- mycat 逻辑主机dataHost对应的物理主机.其中也设置对应的mysql登陆信息 --&gt;  
    &lt;dataHost name="localhost1" maxCon="1000" minCon="10" balance="0" writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100"&gt;
        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;
        &lt;!-- can have multi write hosts --&gt;
        &lt;writeHost host="hostM1" url="127.0.0.1:3306" user="root"  password="root"&gt;

        &lt;/writeHost&gt;
    &lt;/dataHost&gt;

&lt;/mycat:schema&gt;</code></pre><h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><h4 id="本地启动"><a href="#本地启动" class="headerlink" title="本地启动"></a>本地启动</h4><p>双击bin目录下的startup_nowrap.bat文件<br><img src="/2020/08/1596610285582/1596610285582/20200806112437.png" alt="20200806112437"></p>
<p>出现以下界面提示则启动成功：<br><img src="/2020/08/1596610285582/1596610285582/20200806112633.png" alt="20200806112633"></p>
<h4 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h4><p>以管理员的模式打开CMD命令,进入根目录下<br><img src="/2020/08/1596610285582/1596610285582/20200806130746.png" alt="20200806130746"></p>
<h5 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h5><p><img src="/2020/08/1596610285582/1596610285582/20200806130757.png" alt="20200806130757"></p>
<h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><p><img src="/2020/08/1596610285582/1596610285582/20200806135609.png" alt="20200806135609"></p>
<p>当出现此启动错误：<br><img src="/2020/08/1596610285582/1596610285582/20200806135125.png" alt="20200806135125"><br>则需要将 -XX:MaxPermSize=512M 移除，该参数在jdk1.8版本中已放弃使用，<br><img src="/2020/08/1596610285582/1596610285582/20200806135305.png" alt="20200806135305"></p>
<h5 id="服务命令"><a href="#服务命令" class="headerlink" title="服务命令"></a>服务命令</h5><pre><code>mycat.bat { 
    console :       Wrapper控制台
    start :         服务启动
    pause :         服务暂停
    resume :        服务恢复
    stop :          服务停止
    restart :       服务重启
    install :       服务安装
    remove :        服务移除
    status :        服务状态
}</code></pre><h3 id="Navicat连接"><a href="#Navicat连接" class="headerlink" title="Navicat连接"></a>Navicat连接</h3><p>默认端口：8066<br>用户名：root<br>密码：server.xml的user配置，本次为 123456<br><img src="/2020/08/1596610285582/1596610285582/20200806114232.png" alt="20200806114232"></p>
<p>查看连接：<br><img src="/2020/08/1596610285582/1596610285582/20200806114126.png" alt="20200806114126"></p>
<p>查看数据：<br><img src="/2020/08/1596610285582/1596610285582/20200806130103.png" alt="20200806130103"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyCat</category>
      </categories>
      <tags>
        <tag>myCat</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot2.3.x 整合 Thymeleaf</title>
    <url>/2020/08/1597306338000/1597306338000/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>Thymeleaf (主推)<br>轻量级的模板引擎（负责逻辑业务的不推荐，解析DOM或者XML会占用多的内存）<br>可以直接在浏览器中打开且正确显示模板页面<br>直接是html结尾，直接编辑</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-boot-thymeleaf</span><br><span class="line">  jackson:</span><br><span class="line">    default-property-inclusion: non_null</span><br><span class="line">  # 配置模版引擎, 是否开启thymeleaf缓存,本地为false，生产建议为true</span><br><span class="line">  thymeleaf: </span><br><span class="line">    # 是否启用模板缓存,开发时关闭缓存,不然没法看到实时页面</span><br><span class="line">    cache: false</span><br><span class="line">    # 是否检查模板位置是否存在。</span><br><span class="line">    check-template: true</span><br><span class="line">    # 是否为Web框架启用Thymeleaf视图分辨率。</span><br><span class="line">    enabled: true</span><br><span class="line">    # 编码格式, 默认UTF-8</span><br><span class="line">    encoding: UTF-8</span><br><span class="line">    # 应用于模板的模板模式。另请参阅Thymeleaf的TemplateMode枚举。</span><br><span class="line">    mode: HTML</span><br><span class="line">    servlet:</span><br><span class="line">      content-type: text/html</span><br><span class="line">    # 后缀 默认 .html</span><br><span class="line">    suffix: .html</span><br><span class="line">    # 模板文件存放位置  , 默认 classpath:/templates/</span><br><span class="line">    prefix: classpath:/templates/</span><br></pre></td></tr></tbody></table></figure></div>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">src/main/java/com/demon/freemarker/controller</span><br><span class="line">    IndexController.java</span><br><span class="line">src/main/resources/templates</span><br><span class="line">    index2.html</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>IndexController.java</p>
<pre><code>@Controller
public class IndexController {
    /**
     * 路由 /index2
     * 返回 index2 这里默认配置自动映射到目录(templages/)下的index2.html
     */
    @GetMapping("/index2")
    public String index(Model model){
        model.addAttribute("content","hello thymeleaf");
        return "index2";
    }
}</code></pre><p>index.html</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Thymeleaf&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
this is welcome &lt;span th:text="${content}"&gt;&lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><h3 id="运行示例"><a href="#运行示例" class="headerlink" title="运行示例"></a>运行示例</h3><p><img src="/2020/08/1597306338000/1597306338000/20200813175610.png" alt="20200813175610"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Thymeleaf</tag>
      </tags>
  </entry>
  <entry>
    <title>Java发送邮件</title>
    <url>/2021/01/1611916009068/1611916009068/</url>
    <content><![CDATA[<p>本文以 Java 发送邮件功能，采用commons-email模式执行</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 发送邮件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-email<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.apache.commons.mail.EmailException;</span><br><span class="line">import org.apache.commons.mail.HtmlEmail;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: MailUtil.java</span><br><span class="line"> * @description: 邮件工具类</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2020/10/27 17:09</span><br><span class="line"> */</span><br><span class="line">public class MailUtil {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构建器</span><br><span class="line">     */</span><br><span class="line">    public static class EmailInfo {</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * SMTP 服务器 端口</span><br><span class="line">         */</span><br><span class="line">        private String mailServer;</span><br><span class="line">        private Integer mailPort;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 发件人 账号</span><br><span class="line">         */</span><br><span class="line">        private String mailNick;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 发件人 账号</span><br><span class="line">         */</span><br><span class="line">        private String mailUsername;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 发件人 密码</span><br><span class="line">         */</span><br><span class="line">        private String mailPassword;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * 邮件标题</span><br><span class="line">         */</span><br><span class="line">        private String title;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * 邮件内容</span><br><span class="line">         */</span><br><span class="line">        private String content;</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * 收件人</span><br><span class="line">         */</span><br><span class="line">        private List<span class="tag">&lt;<span class="name">String</span>&gt;</span> receivers;</span><br><span class="line"></span><br><span class="line">        boolean ssl;</span><br><span class="line"></span><br><span class="line">        public EmailInfo(String mailServer,Integer mailPort,String mailNick,String mailUsername,</span><br><span class="line">            String mailPassword,String title,String content,List<span class="tag">&lt;<span class="name">String</span>&gt;</span> receivers,boolean ssl) {</span><br><span class="line">            this.mailServer = mailServer;</span><br><span class="line">            this.mailPort = mailPort;</span><br><span class="line">            this.mailNick = mailNick;</span><br><span class="line">            this.mailUsername = mailUsername;</span><br><span class="line">            this.mailPassword = mailPassword;</span><br><span class="line">            this.title = title;</span><br><span class="line">            this.content = content;</span><br><span class="line">            this.receivers = receivers;</span><br><span class="line">            this.ssl = ssl;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public MailUtil send() throws Exception {</span><br><span class="line">            return new MailUtil(this);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private MailUtil(EmailInfo emailInfo) throws Exception {</span><br><span class="line">        HtmlEmail email = new HtmlEmail();</span><br><span class="line">        // 通过Server 发送邮件</span><br><span class="line">        email.setHostName(emailInfo.mailServer);</span><br><span class="line">        email.setSmtpPort(emailInfo.mailPort);</span><br><span class="line">        //设定smtp服务器的认证资料信息</span><br><span class="line">        email.setAuthentication(emailInfo.mailUsername, emailInfo.mailPassword);</span><br><span class="line">        email.setStartTLSEnabled(false);</span><br><span class="line">        email.setSSLOnConnect(emailInfo.ssl);</span><br><span class="line">        try {</span><br><span class="line">            // 设定发件人</span><br><span class="line">            email.setFrom(emailInfo.mailUsername,emailInfo.mailNick);</span><br><span class="line">            // 设定收件人 （多人）</span><br><span class="line">            int size = emailInfo.receivers.size();</span><br><span class="line">            email.addTo(emailInfo.receivers.toArray(new String[size]));</span><br><span class="line">            // 设定内容的语言集</span><br><span class="line">            email.setCharset("UTF-8");</span><br><span class="line">            email.setDebug(false);</span><br><span class="line">            // 设定主题</span><br><span class="line">            email.setSubject(emailInfo.title);</span><br><span class="line">            // 设定邮件内容</span><br><span class="line">            email.setHtmlMsg(emailInfo.content);</span><br><span class="line">            // 发送邮件</span><br><span class="line">            email.send();</span><br><span class="line">            System.out.println("邮件发送成功！");</span><br><span class="line">        } catch (EmailException e) {</span><br><span class="line">            System.out.println("邮件发送失败！");</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h3><h4 id="新浪"><a href="#新浪" class="headerlink" title="新浪"></a>新浪</h4><p><img src="/2021/01/1611916009068/1611916009068/20210129184031.png" alt="20210129184031"><br>String mailServer = smtp.sinanet.com<br>Integer mailPort = 25<br>boolean ssl = false</p>
<h4 id="网易"><a href="#网易" class="headerlink" title="网易"></a>网易</h4><p><img src="/2021/01/1611916009068/1611916009068/20210129184347.png" alt="20210129184347"><br><img src="/2021/01/1611916009068/1611916009068/20210129184412.png" alt="20210129184412"><br>如若开启了授权密码，请以授权密码当做用户密码使用<br>String mailServer = smtp.163.com<br>Integer mailPort = 25<br>boolean ssl = false</p>
<h4 id="QQ"><a href="#QQ" class="headerlink" title="QQ"></a>QQ</h4><p><img src="/2021/01/1611916009068/1611916009068/20210129190030.png" alt="20210129190030"><br>如若开启了授权密码，请以授权密码当做用户密码使用<br>String mailServer = smtp.qq.com<br>Integer mailPort = 465<br>boolean ssl = true</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void 测试邮件() {</span><br><span class="line">    try {</span><br><span class="line">        String content = "<span class="meta">&lt;!doctypehtml&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">en</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">UTF-8</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>";</span><br><span class="line">        // 发送邮件信息</span><br><span class="line">        String mailServer = "smtp.sinanet.com";</span><br><span class="line">        Integer mailPort = 25;</span><br><span class="line">        String mailNick = "demon";</span><br><span class="line">        String mailUsername = "demon@xxxxxxxxx";</span><br><span class="line">        String mailPassword = "123456789";</span><br><span class="line">        String title = "本地测试";</span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> receivers = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        receivers.add("1097305826@qq.com");</span><br><span class="line">        MailUtil.EmailInfo emailInfo = new MailUtil.EmailInfo(mailServer,mailPort,</span><br><span class="line">                mailNick,mailUsername,mailPassword,title, content,receivers,false);</span><br><span class="line">        // 发送邮件</span><br><span class="line">        emailInfo.send();</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Email</tag>
      </tags>
  </entry>
  <entry>
    <title>一款现代化的博客 - Halo</title>
    <url>/2021/02/1614323515573/1614323515573/</url>
    <content><![CDATA[<h3 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h3><p>Halo：<a href="https://halo.run/" target="_blank" rel="noopener">https://halo.run/</a><br>下载资源：<a href="https://dl.halo.run/" target="_blank" rel="noopener">https://dl.halo.run/</a><br>说明：从 1.4.3 起，版本要求为 11 以上的版本。1.4.3 以下需要 1.8 以上的版本。<br>所以下载 1.4.2 版本即可：Windows 点击下载 , Linux wget下载</p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>Windows：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">java -jar halo-1.4.2.jar</span><br></pre></td></tr></tbody></table></figure></div>
<p>Linux：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">java -jar halo-1.4.2.jar</span><br><span class="line">或</span><br><span class="line">nohup java -jar halo-1.4.2.jar &amp;</span><br><span class="line">或</span><br><span class="line">nohup java -jar halo-1.4.2.jar --server.port=8083 &amp;</span><br><span class="line"></span><br><span class="line">关闭：</span><br><span class="line">lsof -i:8090 或 lsof -i:8083</span><br><span class="line">kill -9 PID</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><p>访问路径：/<br>默认端口：8090</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Halo：</span><br><span class="line">    http://127.0.0.1:8090</span><br><span class="line">Halo admin：</span><br><span class="line">    http://127.0.0.1:8090/admin</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>第一次访问会进行初始化信息信息存在<br>在系统当前用户目录下产生一个 .halo 的文件夹，绝对路径为 ~/.halo、/root/.halo/<br><img src="/2021/02/1614323515573/1614323515573/20210226155924.png" alt="20210226155924"><br>填写内容，一路下一步即可，直至到登录页面。<br><img src="/2021/02/1614323515573/1614323515573/20210226165723.png" alt="20210226165723"></p>
<p><a href="http://www.zhuqiaolun.com:8090">我的Halo博客</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>halo</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot2.3.x整合Freemarker</title>
    <url>/2020/08/1597309130215/1597309130215/</url>
    <content><![CDATA[<p>Freemarker<br>FreeMarker Template Language（FTL）  文件一般保存为 xxx.ftl<br>严格依赖MVC模式，不依赖Servlet容器（不占用JVM内存）<br>内建函数</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 将freemarker的html内容写入生成的文件中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>yml内容：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-boot-freemarker</span><br><span class="line">  jackson:</span><br><span class="line">    default-property-inclusion: non_null</span><br><span class="line">  # 配置模版引擎</span><br><span class="line">  freemarker:</span><br><span class="line">    cache: false #是否启用模板缓存</span><br><span class="line">    enabled: true #是否启用freemarker</span><br><span class="line">    template-loader-path: classpath:/templates/ #设定模板的加载路径，多个以逗号分隔</span><br><span class="line">    suffix: .ftl #设定模板的后缀</span><br><span class="line">    content-type: text/html</span><br><span class="line">    check-template-location: true #是否检查模板位置是否存在</span><br><span class="line">    charset: UTF-8 #模板编码</span><br><span class="line">    #一些常用配置</span><br><span class="line">    allow-request-override: false #是否允许HttpServletRequest属性覆盖(隐藏)控制器生成的同名模型属性</span><br><span class="line">    allow-session-override: false #是否允许HttpSession属性覆盖(隐藏)控制器生成的同名模型属性</span><br><span class="line">    expose-request-attributes: false #设定所有request的属性在merge到模板的时候，是否要都添加到model中</span><br><span class="line">    expose-session-attributes: false #是否在merge模板的时候，将HttpSession属性都添加到model中</span><br><span class="line">    expose-spring-macro-helpers: true #设定是否以springMacroRequestContext的形式暴露RequestContext给Spring’s macro library使用</span><br><span class="line">    prefer-file-system-access: true #是否优先从文件系统加载template，以支持热加载，默认为true</span><br></pre></td></tr></tbody></table></figure></div>
<h2 id="数据应用"><a href="#数据应用" class="headerlink" title="数据应用"></a>数据应用</h2><p> <a href="/2021/07/1625196322877/1625196322877/">☞传送门</a></p>
<h2 id="页面使用"><a href="#页面使用" class="headerlink" title="页面使用"></a>页面使用</h2><p>文件路径：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">src/main/java/com/demon/freemarker/controller</span><br><span class="line">    IndexController.java</span><br><span class="line">src/main/resources/templates</span><br><span class="line">    index1.ftl</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>IndexController.java</p>
<pre><code>@Controller
public class IndexController {
    /**
     * 路由 /index1
     * 返回 index1 这里默认配置自动映射到目录(templages/)下的index1.ftl
     */
    @GetMapping("/index1")
    public String index(Model model){
        model.addAttribute("content","hello freemarker");
        return "index1";
    }
}</code></pre><p>index.ftl</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;freemarker&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
this is welcome ${content}
&lt;/body&gt;
&lt;/html&gt;</code></pre><h3 id="运行示例"><a href="#运行示例" class="headerlink" title="运行示例"></a>运行示例</h3><p><img src="/2020/08/1597309130215/1597309130215/20200813175553.png" alt="20200813175553"></p>
<p><a href="/2021/07/1625196322877/1625196322877/">更多</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>freemarker</tag>
      </tags>
  </entry>
  <entry>
    <title>Java原生URL模拟工具</title>
    <url>/2021/02/1612419197069/1612419197069/</url>
    <content><![CDATA[<p>采用原始URL进行模拟请求</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.net.HttpURLConnection;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: HttpClientUtil</span><br><span class="line"> * @Description: Java原生URL模拟请求</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2021/2/4 10:45</span><br><span class="line"> */</span><br><span class="line">public class HttpClientUtil {</span><br><span class="line"></span><br><span class="line">    public static String doGet(String httpUrl) {</span><br><span class="line">        HttpURLConnection connection;</span><br><span class="line">        try {</span><br><span class="line">            // 创建远程url连接对象</span><br><span class="line">            URL url = new URL(httpUrl);</span><br><span class="line">            // 通过远程url连接对象打开一个连接，强转成httpURLConnection类</span><br><span class="line">            connection = (HttpURLConnection) url.openConnection();</span><br><span class="line">            // 设置连接方式：get</span><br><span class="line">            connection.setRequestMethod("GET");</span><br><span class="line">            // 设置连接主机服务器的超时时间：15000毫秒</span><br><span class="line">            connection.setConnectTimeout(15000);</span><br><span class="line">            // 设置读取远程返回的数据时间：60000毫秒</span><br><span class="line">            connection.setReadTimeout(60000);</span><br><span class="line">            // 发送请求</span><br><span class="line">            connection.connect();</span><br><span class="line">            return getResult(null,connection);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static String doPost(String httpUrl, String param) {</span><br><span class="line">        HttpURLConnection connection;</span><br><span class="line">        OutputStream os;</span><br><span class="line">        try {</span><br><span class="line">            URL url = new URL(httpUrl);</span><br><span class="line">            // 通过远程url连接对象打开连接</span><br><span class="line">            connection = (HttpURLConnection) url.openConnection();</span><br><span class="line">            // 设置连接请求方式</span><br><span class="line">            connection.setRequestMethod("POST");</span><br><span class="line">            // 设置连接主机服务器超时时间：15000毫秒</span><br><span class="line">            connection.setConnectTimeout(15000);</span><br><span class="line">            // 设置读取主机服务器返回数据超时时间：60000毫秒</span><br><span class="line">            connection.setReadTimeout(60000);</span><br><span class="line">            // 默认值为：false，当向远程服务器传送数据/写数据时，需要设置为true</span><br><span class="line">            connection.setDoOutput(true);</span><br><span class="line">            // 默认值为：true，当前向远程服务读取数据时，设置为true，该参数可有可无</span><br><span class="line">            connection.setDoInput(true);</span><br><span class="line">            // 设置传入参数的格式:请求参数应该是 name1=value1&amp;name2=value2 的形式。</span><br><span class="line">            connection.setRequestProperty("Content-Type", "application/x-www-form-urlencoded");</span><br><span class="line">            // 通过连接对象获取一个输出流</span><br><span class="line">            os = connection.getOutputStream();</span><br><span class="line">            // 通过输出流对象将参数写出去/传输出去,它是通过字节数组写出的</span><br><span class="line">            os.write(param.getBytes());</span><br><span class="line">            return getResult(os,connection);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static String getResult(OutputStream os,HttpURLConnection connection){</span><br><span class="line">        int responseCode = 200;</span><br><span class="line">        InputStream is = null;</span><br><span class="line">        BufferedReader br = null;</span><br><span class="line">        try {</span><br><span class="line">            String result = null;</span><br><span class="line">            if (connection.getResponseCode() == responseCode) {</span><br><span class="line">                is = connection.getInputStream();</span><br><span class="line">                br = new BufferedReader(new InputStreamReader(is, StandardCharsets.UTF_8));</span><br><span class="line">                StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">                String temp;</span><br><span class="line">                while ((temp = br.readLine()) != null) {</span><br><span class="line">                    stringBuilder.append(temp);</span><br><span class="line">                }</span><br><span class="line">                result = stringBuilder.toString();</span><br><span class="line">            }</span><br><span class="line">            return result;</span><br><span class="line">        } catch (Exception e){</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        } finally {</span><br><span class="line">            getClose(br,os,is,connection);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static void getClose(BufferedReader br,OutputStream os, InputStream is,HttpURLConnection connection ){</span><br><span class="line">        // 关闭资源</span><br><span class="line">        if (null != br) {</span><br><span class="line">            try {</span><br><span class="line">                br.close();</span><br><span class="line">            } catch (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        if (null != os) {</span><br><span class="line">            try {</span><br><span class="line">                os.close();</span><br><span class="line">            } catch (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        if (null != is) {</span><br><span class="line">            try {</span><br><span class="line">                is.close();</span><br><span class="line">            } catch (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        if(connection != null){</span><br><span class="line">            connection.disconnect();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">String doGet = HttpClientUtil.doGet("https://www.baidu.com/");</span><br><span class="line">System.out.println(doGet);</span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>解决IE浏览器  @ResponseBody 返回json的时候提示下载问题</title>
    <url>/2020/11/1605076219103/1605076219103/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.http.MediaType;</span><br><span class="line">import org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line">import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: WebMvcConfig.java</span><br><span class="line"> * @description:  WebMvc配置</span><br><span class="line"> * @author: Demon</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {</span><br><span class="line">        MappingJackson2HttpMessageConverter jsonConverter = new MappingJackson2HttpMessageConverter();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">MediaType</span>&gt;</span> supportedMediaTypes = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        MediaType media = new MediaType(MediaType.TEXT_HTML, Charset.forName("UTF-8"));</span><br><span class="line">        supportedMediaTypes.add(media);</span><br><span class="line">        jsonConverter.setSupportedMediaTypes(supportedMediaTypes);</span><br><span class="line">        converters.add(jsonConverter);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>发布Java程序为Windows服务 - Windows Service Wrapper 四</title>
    <url>/2020/11/1604299054941/1604299054941/</url>
    <content><![CDATA[<h3 id="Windows-Service-Wrapper"><a href="#Windows-Service-Wrapper" class="headerlink" title="Windows Service Wrapper"></a>Windows Service Wrapper</h3><p>Windows Service Wrapper 可以将 Java 的 jar 包注册为 windows 服务。<br>项目：<a href="https://github.com/winsw/winsw" target="_blank" rel="noopener">https://github.com/winsw/winsw</a><br>地址：<a href="https://github.com/winsw/winsw/releases" target="_blank" rel="noopener">https://github.com/winsw/winsw/releases</a></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官方 GitHub下载 WinSW.NET4.exe 和 sample-minimal.xml<br>选择 WinSW <a href="https://github.com/winsw/winsw/releases/tag/v2.10.3" target="_blank" rel="noopener">v2.10.3</a> 版本下载<br>WinSW.NET4.exe ：<a href="https://github.com/winsw/winsw/releases/download/v2.10.3/WinSW.NET4.exe" target="_blank" rel="noopener">https://github.com/winsw/winsw/releases/download/v2.10.3/WinSW.NET4.exe</a><br>sample-minimal.xml ：<a href="https://github.com/winsw/winsw/releases/download/v2.10.3/sample-minimal.xml" target="_blank" rel="noopener">https://github.com/winsw/winsw/releases/download/v2.10.3/sample-minimal.xml</a></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>新建目录，例如： MyApp<br><img src="/2020/11/1604299054941/1604299054941/20201102145318.png" alt="20201102145318"></p>
<p>文件内容：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">bin: 属于服务的命名以及配置</span><br><span class="line">    - MyApp.exe</span><br><span class="line">    - MyApp.xml</span><br><span class="line"></span><br><span class="line">conf：一些需要的文件配置</span><br><span class="line">    </span><br><span class="line">jre：属于Java的运行环境</span><br><span class="line"></span><br><span class="line">lib：属于程序的执行包</span><br><span class="line"></span><br><span class="line">log：输出日志文件夹</span><br></pre></td></tr></tbody></table></figure></div>

<p>MyApp.xml<br>配置过程中注意目录情况，%BASE% 是以exe所在的目录为根目录</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 服务名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>MyApp<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 服务显示名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>My App Service<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 服务描述 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>通过wapper注册成Windows服务<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- java环境变量 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--当前电脑配置了java环境变量，直接写成“java”就行；你也可以写成类似这样：C:\jdk1.8\jre\bin\java--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">executable</span>&gt;</span>%BASE%\..\jre\bin\java<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!--启动参数--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-jar %BASE%\..\lib\MyApp.jar"<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 开机启动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">startmode</span>&gt;</span>Automatic<span class="tag">&lt;/<span class="name">startmode</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 日志配置 &lt;logmode&gt;rotate&lt;/logmode&gt; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">logpath</span>&gt;</span>%BASE%\..\log<span class="tag">&lt;/<span class="name">logpath</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">log</span> <span class="attr">mode</span>=<span class="string">"roll-by-time"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pattern</span>&gt;</span>yyyyMMdd<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">log</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>以管理员身份运行 bat文件，进行 windows 服务操作</p>
<h3 id="bat"><a href="#bat" class="headerlink" title="bat"></a>bat</h3><p>注册服务 service install.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe install</span><br></pre></td></tr></tbody></table></figure></div>

<p>卸载服务 service uninstall.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe uninstall</span><br></pre></td></tr></tbody></table></figure></div>

<p>启动服务 service start.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe start</span><br></pre></td></tr></tbody></table></figure></div>

<p>停止服务 service stop.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe stop</span><br></pre></td></tr></tbody></table></figure></div>

<p>重启服务 service restart.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe restart</span><br></pre></td></tr></tbody></table></figure></div>

<p>服务状态 service status.bat</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">start bin\MyApp.exe status</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p><a href="/2020/06/1592889892770/1592889892770/">发布Java程序为Windows服务 （含有Java环境）一</a><br><a href="/2020/06/1592898236483/1592898236483/">发布Java程序为Windows服务 （不含有Java环境）二</a><br><a href="/2020/06/1592899073321/1592899073321/">发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>winsw</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot 静态资源处理</title>
    <url>/2020/11/1605076979058/1605076979058/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.util.ResourceUtils;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: WebMvcConfig.java</span><br><span class="line"> * @description:  WebMvc配置</span><br><span class="line"> * @author: Demon</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addResourceHandlers(ResourceHandlerRegistry registry) {</span><br><span class="line">        // 配置模板资源路径</span><br><span class="line">        registry.addResourceHandler("/templates/**").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+"/templates/");</span><br><span class="line">        registry.addResourceHandler("/static/**").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+"/static/");</span><br><span class="line">        registry.addResourceHandler("/public/**").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+"/public/");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>实体对象与Map之间的转换工具类</title>
    <url>/2020/11/1605077732135/1605077732135/</url>
    <content><![CDATA[<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: EntityUtil</span><br><span class="line"> * @Description: 实体对象与Map之间的转换工具类</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">public class EntityUtil {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 实体类转Map</span><br><span class="line">     * @param object 对象</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> entityToMap(Object object) {</span><br><span class="line">        if (object == null) {</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        for (Field field : object.getClass().getDeclaredFields()){</span><br><span class="line">            try {</span><br><span class="line">                boolean flag = field.isAccessible();</span><br><span class="line">                field.setAccessible(true);</span><br><span class="line">                Object o = field.get(object);</span><br><span class="line">                map.put(field.getName(), o);</span><br><span class="line">                field.setAccessible(flag);</span><br><span class="line">            } catch (Exception e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Map转实体类</span><br><span class="line">     * @param map 需要初始化的数据，key字段必须与实体类的成员名字一样，否则赋值为空</span><br><span class="line">     * @param entity  需要转化成的实体类</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T mapToEntity(Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map, Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> entity) {</span><br><span class="line">        T t = null;</span><br><span class="line">        try {</span><br><span class="line">            t = entity.newInstance();</span><br><span class="line">            for(Field field : entity.getDeclaredFields()) {</span><br><span class="line">                if (map.containsKey(field.getName())) {</span><br><span class="line">                    boolean flag = field.isAccessible();</span><br><span class="line">                    field.setAccessible(true);</span><br><span class="line">                    Object object = map.get(field.getName());</span><br><span class="line">                    if (object!= null &amp;&amp; field.getType().isAssignableFrom(object.getClass())) {</span><br><span class="line">                        field.set(t, object);</span><br><span class="line">                    }</span><br><span class="line">                    field.setAccessible(flag);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return t;</span><br><span class="line">        } catch (InstantiationException | IllegalAccessException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">        return t;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>MD5加密工具</title>
    <url>/2020/11/1605078934677/1605078934677/</url>
    <content><![CDATA[<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.security.MessageDigest;</span><br><span class="line">/**</span><br><span class="line"> * @ClassName: MD5Util</span><br><span class="line"> * @Description: MD5加密工具</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">public class MD5Util {</span><br><span class="line"></span><br><span class="line">    private static final String SALT = "demon";</span><br><span class="line"></span><br><span class="line">    public static String encode(String password) {</span><br><span class="line">        password = password + SALT;</span><br><span class="line">        MessageDigest md5;</span><br><span class="line">        try {</span><br><span class="line">            md5 = MessageDigest.getInstance("MD5");</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        }</span><br><span class="line">        char[] charArray = password.toCharArray();</span><br><span class="line">        byte[] byteArray = new byte[charArray.length];</span><br><span class="line">        for (int i = 0; i <span class="tag">&lt; <span class="attr">charArray.length</span>; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">            <span class="attr">byteArray</span>[<span class="attr">i</span>] = <span class="string">(byte)</span> <span class="attr">charArray</span>[<span class="attr">i</span>];</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">byte</span>[] <span class="attr">md5Bytes</span> = <span class="string">md5.digest(byteArray);</span></span></span><br><span class="line"><span class="tag">        <span class="attr">StringBuilder</span> <span class="attr">hexValue</span> = <span class="string">new</span> <span class="attr">StringBuilder</span>();</span></span><br><span class="line"><span class="tag">        <span class="attr">for</span> (<span class="attr">byte</span> <span class="attr">md5Byte</span> <span class="attr">:</span> <span class="attr">md5Bytes</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">int</span> <span class="attr">val</span> = <span class="string">((int)</span> <span class="attr">md5Byte</span>) &amp; <span class="attr">0xff</span>;</span></span><br><span class="line">            if (val &lt; 16) {</span><br><span class="line">                hexValue.append("0");</span><br><span class="line">            }</span><br><span class="line">            hexValue.append(Integer.toHexString(val));</span><br><span class="line">        }</span><br><span class="line">        return hexValue.toString();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>获取当前登录用户IP(web)</title>
    <url>/2020/11/1605078705487/1605078705487/</url>
    <content><![CDATA[<p>此方法采用的 HttpServletRequest 获取，故使用web项目，<br>说明，当存在使用 虚拟机 的情况，会导致获取的IP为 以太网适配器 的IP</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.net.InetAddress;</span><br><span class="line">import java.net.UnknownHostException;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: IpUtil</span><br><span class="line"> * @Description: 获取当前登录用户IP</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">public class IpUtil {</span><br><span class="line"></span><br><span class="line">    private static final String[] LOCAL_IP = {"127.0.0.1","localhost","0:0:0:0:0:0:0:1"};</span><br><span class="line">    private static final String UNKNOWN = "unknown";</span><br><span class="line"></span><br><span class="line">    public static String getIpAddr(HttpServletRequest request) {</span><br><span class="line">        String ipAddress;</span><br><span class="line">        try {</span><br><span class="line">            ipAddress = request.getHeader("x-forwarded-for");</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) {</span><br><span class="line">                ipAddress = request.getHeader("Proxy-Client-IP");</span><br><span class="line">            }</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) {</span><br><span class="line">                ipAddress = request.getHeader("WL-Proxy-Client-IP");</span><br><span class="line">            }</span><br><span class="line">            if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) {</span><br><span class="line">                ipAddress = request.getRemoteAddr();</span><br><span class="line">                if (Arrays.asList(LOCAL_IP).contains(ipAddress)) {</span><br><span class="line">                    // 根据网卡取本机配置的IP</span><br><span class="line">                    InetAddress inet = null;</span><br><span class="line">                    try {</span><br><span class="line">                        inet = InetAddress.getLocalHost();</span><br><span class="line">                    } catch (UnknownHostException e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                    assert inet != null;</span><br><span class="line">                    ipAddress = inet.getHostAddress();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割</span><br><span class="line">            // "***.***.***.***".length()</span><br><span class="line">            if (ipAddress != null &amp;&amp; ipAddress.length() &gt; 15) {</span><br><span class="line">                // = 15</span><br><span class="line">                if (ipAddress.indexOf(",") &gt; 0) {</span><br><span class="line">                    ipAddress = ipAddress.substring(0, ipAddress.indexOf(","));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            ipAddress = "";</span><br><span class="line">        }</span><br><span class="line">        return ipAddress;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断IP地址的合法性，这里采用了正则表达式的方法来判断</span><br><span class="line">     * return true，合法</span><br><span class="line">     * */</span><br><span class="line">    public static boolean ipCheck(String text) {</span><br><span class="line">        if (text != null &amp;&amp; !text.isEmpty()) {</span><br><span class="line">            // 定义正则表达式</span><br><span class="line">            String regex = "^(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|[1-9])\\."+</span><br><span class="line">            "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."+</span><br><span class="line">            "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)\\."+</span><br><span class="line">            "(1\\d{2}|2[0-4]\\d|25[0-5]|[1-9]\\d|\\d)$";</span><br><span class="line">            // 判断ip地址是否与正则表达式匹配</span><br><span class="line">            // 返回判断信息</span><br><span class="line">            // 返回判断信息</span><br><span class="line">            return text.matches(regex);</span><br><span class="line">        }</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Java的普通类获取注册的bean</title>
    <url>/2020/11/1605079105126/1605079105126/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.springframework.beans.BeansException;</span><br><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.ApplicationContextAware;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: ApplicationContextHelper.java</span><br><span class="line"> * @description:  获取 ApplicationContext</span><br><span class="line"> * @author: Demon</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">public class ApplicationContextHelper implements ApplicationContextAware {</span><br><span class="line"></span><br><span class="line">	private static ApplicationContext appCtx;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {</span><br><span class="line">		System.out.println("初始化applicationContext："+applicationContext.getBeanDefinitionNames().length);</span><br><span class="line">		appCtx = applicationContext;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 通过name获取 Bean.</span><br><span class="line">	 * @param name bean名</span><br><span class="line">	 * @return 返回</span><br><span class="line">	 */</span><br><span class="line">	public static Object getBean(String name) {</span><br><span class="line">		return appCtx.getBean(name);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 通过class获取Bean.</span><br><span class="line">	 * @param clazz bean类</span><br><span class="line">	 * @return 返回</span><br><span class="line">	 */</span><br><span class="line">	public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T getBean(Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> clazz) {</span><br><span class="line">		return appCtx.getBean(clazz);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * 通过name,以及Clazz返回指定的Bean</span><br><span class="line">	 * @param name bean名</span><br><span class="line">	 * @param clazz bean类</span><br><span class="line">	 * @return 返回</span><br><span class="line">	 */</span><br><span class="line">	public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T getBean(String name, Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> clazz) {</span><br><span class="line">		return appCtx.getBean(name, clazz);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>获取 RestTemplate 的 bean</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">RestTemplate  restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>对响应值Response的封装使用(可格式化Json格式数据)</title>
    <url>/2020/11/1605079334142/1605079334142/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>返回的json中忽略null属性值，不传递<br>pom引入:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- lombok --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jackson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>第一种，在yml中写入（全局）：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    default-property-inclusion: non_null</span><br></pre></td></tr></tbody></table></figure></div>
<p>第二种，在应用类上写入（局部）：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@JsonInclude(JsonInclude.Include.NON_NULL)</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>ResponseBean：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2021/3/8 13:27</span><br><span class="line"> * @description: 返回的JSON数据结构标准</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">public class ResponseBean implements Serializable {</span><br><span class="line"></span><br><span class="line">    private boolean success = false;</span><br><span class="line">    private Object data;</span><br><span class="line">    private String msg;</span><br><span class="line">    private String errCode;</span><br><span class="line">    private String errMsg;</span><br><span class="line"></span><br><span class="line">    @JsonIgnore</span><br><span class="line">    private boolean dataFormat = false;</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    @Override</span><br><span class="line">    public String toString() {</span><br><span class="line">        ObjectMapper objectMapper = new ObjectMapper();</span><br><span class="line">        objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">        ResponseBeanVo responseBeanVo = new ResponseBeanVo()</span><br><span class="line">                .setSuccess(this.isSuccess()).setData(this.getData()).setMsg(this.getMsg())</span><br><span class="line">                .setErrCode(this.getErrCode()).setErrMsg(this.getErrMsg());</span><br><span class="line">        if (this.isDataFormat()) {</span><br><span class="line">            return objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(responseBeanVo);</span><br><span class="line">        } else {</span><br><span class="line">            return objectMapper.writer().writeValueAsString(responseBeanVo);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">class ResponseBeanVo implements Serializable {</span><br><span class="line">    private boolean success;</span><br><span class="line">    private Object data;</span><br><span class="line">    private String msg;</span><br><span class="line">    private String errCode;</span><br><span class="line">    private String errMsg;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="BaseController"><a href="#BaseController" class="headerlink" title="BaseController"></a>BaseController</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @className: BaseController.java</span><br><span class="line"> * @description:  基本</span><br><span class="line"> * @author: Demon</span><br><span class="line"> */</span><br><span class="line">public abstract class BaseController {</span><br><span class="line">  /**</span><br><span class="line">    * 使用response输出JSON</span><br><span class="line">    * @param response response</span><br><span class="line">    * @param str 响应对应</span><br><span class="line">    */</span><br><span class="line">   protected void out(HttpServletResponse response, Object str) {</span><br><span class="line">       PrintWriter out = null;</span><br><span class="line">       try {</span><br><span class="line">           response.setCharacterEncoding("UTF-8");</span><br><span class="line">           response.setContentType("application/json");</span><br><span class="line">           out = response.getWriter();</span><br><span class="line">           out.print(str);</span><br><span class="line">       } catch (Exception e) {</span><br><span class="line">           log.error("输出JSON出错",e.getMessage());</span><br><span class="line">       } finally {</span><br><span class="line">           if (out != null) {</span><br><span class="line">               out.flush();</span><br><span class="line">               out.close();</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: IndexController</span><br><span class="line"> * @Description: 控制层测试</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">public class TestController extends BaseController {</span><br><span class="line"></span><br><span class="line">   @RequestMapping(method = {RequestMethod.GET,RequestMethod.POST})</span><br><span class="line">   public @ResponseBody void getIndex(HttpServletResponse response) {</span><br><span class="line">       ResponseBean responseBean = new ResponseBean();</span><br><span class="line">       responseBean.setSuccess(true);</span><br><span class="line">       responseBean.setDataFormat(true);</span><br><span class="line">       this.out(response,responseBean);</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>结果：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">  "success" : true</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>POI(3.17)解析Excel2007 - 可解析公式数据</title>
    <url>/2020/11/1605159781717/1605159781717/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml-schemas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.apache.commons.lang3.StringUtils;</span><br><span class="line">import org.apache.poi.hssf.usermodel.HSSFWorkbook;</span><br><span class="line">import org.apache.poi.ss.usermodel.Cell;</span><br><span class="line">import org.apache.poi.ss.usermodel.FormulaEvaluator;</span><br><span class="line">import org.apache.poi.ss.usermodel.Sheet;</span><br><span class="line">import org.apache.poi.ss.usermodel.Workbook;</span><br><span class="line">import org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"></span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.text.NumberFormat;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    ExcelUtil</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/6/25 11:32</span><br><span class="line"> */</span><br><span class="line">public class ExcelUtil {</span><br><span class="line"></span><br><span class="line">    private static NumberFormat numberFormat = NumberFormat.getNumberInstance();</span><br><span class="line"></span><br><span class="line">    static {</span><br><span class="line">        numberFormat.setGroupingUsed(false);</span><br><span class="line">        // 最大小数保留位数</span><br><span class="line">        numberFormat.setMaximumFractionDigits(9);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据读取，文件流解析Excel文件</span><br><span class="line">     *</span><br><span class="line">     * @param fileName   文件名</span><br><span class="line">     * @param sheetIndex sheet页码</span><br><span class="line">     * @param input      文件流</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws IOException 异常</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;Map&lt;String, String&gt;&gt; getDataToInput(String fileName, int sheetIndex, FileInputStream input) throws IOException {</span><br><span class="line">        return getData(fileName, sheetIndex, input);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据文件绝对路径，解析Excel文件</span><br><span class="line">     *</span><br><span class="line">     * @param fileName   文件名</span><br><span class="line">     * @param sheetIndex sheet页码</span><br><span class="line">     * @param filePath   文件路径</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws IOException 异常</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;Map&lt;String, String&gt;&gt; getDataToFilePath(String fileName, int sheetIndex, String filePath) throws IOException {</span><br><span class="line">        return getData(fileName, sheetIndex, new FileInputStream(filePath));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 解析数据</span><br><span class="line">     */</span><br><span class="line">    private static List&lt;Map&lt;String, String&gt;&gt; getData(String fileName, int sheetIndex, FileInputStream input) throws IOException {</span><br><span class="line">        List&lt;Map&lt;String, String&gt;&gt; mapList = new ArrayList&lt;&gt;();</span><br><span class="line">        if (ExcelUtil.isExcel2003(fileName)) {</span><br><span class="line">            Workbook workbook = new HSSFWorkbook(input);</span><br><span class="line">            // 拿到计算公式</span><br><span class="line">            getDataToExcel(workbook, sheetIndex, input, mapList);</span><br><span class="line">        } else if (ExcelUtil.isExcel2007(fileName)) {</span><br><span class="line">            Workbook workbook = new XSSFWorkbook(input);</span><br><span class="line">            getDataToExcel(workbook, sheetIndex, input, mapList);</span><br><span class="line">        } else {</span><br><span class="line">            System.err.println("未知文件");</span><br><span class="line">         }</span><br><span class="line">        System.out.println(mapList);</span><br><span class="line">        return mapList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static void getDataToExcel(Workbook workbook, int sheetIndex, FileInputStream input, List&lt;Map&lt;String, String&gt;&gt; mapList) throws IOException {</span><br><span class="line">        try {</span><br><span class="line">            FormulaEvaluator formulaEvaluator = workbook.getCreationHelper().createFormulaEvaluator();</span><br><span class="line">            // 获得第一个表单</span><br><span class="line">            Sheet sheet = workbook.getSheetAt(sheetIndex);</span><br><span class="line">            // 获得第一行表头，计算列数</span><br><span class="line">            int columnNum = sheet.getRow(0).getPhysicalNumberOfCells();</span><br><span class="line">            // 遍历数据 行</span><br><span class="line">            sheet.rowIterator().forEachRemaining(row -&gt; {</span><br><span class="line">                Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> jsonMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                // 遍历列</span><br><span class="line">                for (int i = 0; i <span class="tag">&lt; <span class="attr">columnNum</span>; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">                    <span class="attr">Cell</span> <span class="attr">cell</span> = <span class="string">row.getCell(i);</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">if</span> (<span class="attr">cell</span> != <span class="string">null)</span> {</span></span><br><span class="line"><span class="tag">                        // 读取值</span></span><br><span class="line"><span class="tag">                        <span class="attr">jsonMap.put</span>(<span class="attr">String.valueOf</span>(<span class="attr">i</span>), <span class="attr">getCellFormatValue</span>(<span class="attr">formulaEvaluator</span>, <span class="attr">cell</span>));</span></span><br><span class="line"><span class="tag">                    } <span class="attr">else</span> {</span></span><br><span class="line"><span class="tag">                        <span class="attr">jsonMap.put</span>(<span class="attr">String.valueOf</span>(<span class="attr">i</span>), "");</span></span><br><span class="line"><span class="tag">                    }</span></span><br><span class="line"><span class="tag">                }</span></span><br><span class="line"><span class="tag">                <span class="attr">mapList.add</span>(<span class="attr">jsonMap</span>);</span></span><br><span class="line"><span class="tag">            });</span></span><br><span class="line"><span class="tag">        } <span class="attr">catch</span> (<span class="attr">Exception</span> <span class="attr">e</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">System.out.println</span>("解析<span class="attr">xlsx</span>文件错误");</span></span><br><span class="line"><span class="tag">            <span class="attr">throw</span> <span class="attr">new</span> <span class="attr">IOException</span>(<span class="attr">e</span>);</span></span><br><span class="line"><span class="tag">        } <span class="attr">finally</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">if</span> (<span class="attr">input</span> != <span class="string">null)</span> {</span></span><br><span class="line"><span class="tag">                <span class="attr">try</span> {</span></span><br><span class="line"><span class="tag">                    <span class="attr">input.close</span>();</span></span><br><span class="line"><span class="tag">                } <span class="attr">catch</span> (<span class="attr">Exception</span> <span class="attr">e</span>) {</span></span><br><span class="line"><span class="tag">                    <span class="attr">e.printStackTrace</span>();</span></span><br><span class="line"><span class="tag">                }</span></span><br><span class="line"><span class="tag">            }</span></span><br><span class="line"><span class="tag">            <span class="attr">if</span> (<span class="attr">workbook</span> != <span class="string">null)</span> {</span></span><br><span class="line"><span class="tag">                <span class="attr">try</span> {</span></span><br><span class="line"><span class="tag">                    <span class="attr">workbook.close</span>();</span></span><br><span class="line"><span class="tag">                } <span class="attr">catch</span> (<span class="attr">Exception</span> <span class="attr">e</span>) {</span></span><br><span class="line"><span class="tag">                    <span class="attr">e.printStackTrace</span>();</span></span><br><span class="line"><span class="tag">                }</span></span><br><span class="line"><span class="tag">            }</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 判断是否为老版本的<span class="attr">excel</span></span></span><br><span class="line"><span class="tag">     *</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">filePath</span> *<span class="attr">.xls</span></span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> 返回</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">private</span> <span class="attr">static</span> <span class="attr">boolean</span> <span class="attr">isExcel2003</span>(<span class="attr">String</span> <span class="attr">filePath</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">StringUtils.isNotEmpty</span>(<span class="attr">filePath</span>) &amp;&amp; <span class="attr">filePath.matches</span>("^<span class="attr">.</span>+\\<span class="attr">.</span>(?<span class="attr">i</span>)(<span class="attr">xls</span>)$");</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 判断是否为新版本的<span class="attr">excel</span></span></span><br><span class="line"><span class="tag">     *</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">filePath</span> *<span class="attr">.xlsx</span></span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> 返回</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">private</span> <span class="attr">static</span> <span class="attr">boolean</span> <span class="attr">isExcel2007</span>(<span class="attr">String</span> <span class="attr">filePath</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">StringUtils.isNotEmpty</span>(<span class="attr">filePath</span>) &amp;&amp; <span class="attr">filePath.matches</span>("^<span class="attr">.</span>+\\<span class="attr">.</span>(?<span class="attr">i</span>)(<span class="attr">xlsx</span>)$");</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">private</span> <span class="attr">static</span> <span class="attr">String</span> <span class="attr">getCellFormatValue</span>(<span class="attr">FormulaEvaluator</span> <span class="attr">formulaEvaluator</span>, <span class="attr">Cell</span> <span class="attr">cell</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">String</span> <span class="attr">val</span>;</span></span><br><span class="line"><span class="tag">        // 根据<span class="attr">cell</span>中的类型来输出数据</span></span><br><span class="line"><span class="tag">        <span class="attr">switch</span> (<span class="attr">cell.getCellTypeEnum</span>()) {</span></span><br><span class="line"><span class="tag">            <span class="attr">case</span> <span class="attr">NUMERIC:</span></span></span><br><span class="line"><span class="tag">                // 数字</span></span><br><span class="line"><span class="tag">                <span class="attr">if</span> (<span class="attr">org.apache.poi.ss.usermodel.DateUtil.isCellDateFormatted</span>(<span class="attr">cell</span>)) {</span></span><br><span class="line"><span class="tag">                    // 时间类型</span></span><br><span class="line"><span class="tag">                    <span class="attr">val</span> = <span class="string">Long.toString(cell.getDateCellValue().getTime());</span></span></span><br><span class="line"><span class="tag">                } <span class="attr">else</span> {</span></span><br><span class="line"><span class="tag">                    // 数字类型 <span class="attr">-</span> 普通数字<span class="attr">33</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">val</span> = <span class="string">numberFormat.format(cell.getNumericCellValue());</span></span></span><br><span class="line"><span class="tag">                }</span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">case</span> <span class="attr">STRING:</span></span></span><br><span class="line"><span class="tag">                // 字符串类型</span></span><br><span class="line"><span class="tag">                <span class="attr">val</span> = <span class="string">cell.getStringCellValue();</span></span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">case</span> <span class="attr">BOOLEAN:</span></span></span><br><span class="line"><span class="tag">                // 布尔类型</span></span><br><span class="line"><span class="tag">                <span class="attr">val</span> = <span class="string">Boolean.toString(cell.getBooleanCellValue());</span></span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">case</span> <span class="attr">FORMULA:</span></span></span><br><span class="line"><span class="tag">                // 计算公式</span></span><br><span class="line"><span class="tag">                <span class="attr">val</span> = <span class="string">formulaEvaluator.evaluate(cell).formatAsString();</span></span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">case</span> <span class="attr">BLANK:</span></span></span><br><span class="line"><span class="tag">                // 空</span></span><br><span class="line"><span class="tag">                <span class="attr">val</span> = <span class="string">cell.getStringCellValue();</span></span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">            <span class="attr">default:</span></span></span><br><span class="line"><span class="tag">                //如果是不知道的类型， 首先强制设置成<span class="attr">string</span>类型，再取值</span></span><br><span class="line"><span class="tag">                <span class="attr">val</span> = <span class="string">cell.getStringCellValue();</span></span></span><br><span class="line"><span class="tag">                <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">val</span>;</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>第一种：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    String fileName = "test.xlsx";</span><br><span class="line">    String filePath = "D:\\test\\test.xlsx";</span><br><span class="line">    List&lt;Map&lt;String,String&gt;&gt; mapList = ExcelUtil.getDataToInput(fileName,0,new FileInputStream(new File(filePath)));</span><br><span class="line">    System.out.println(mapList.size());</span><br><span class="line">} catch (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>第二种：    </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    String fileName = "test.xlsx";</span><br><span class="line">    String filePath = "D:\\test\\test.xlsx";</span><br><span class="line">    List&lt;Map&lt;String,String&gt;&gt; mapList = ExcelUtil.getDataToFilePath(fileName,0,filePath);</span><br><span class="line">    System.out.println(mapList.size());</span><br><span class="line">} catch (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">String fileName = "test.xlsx";</span><br><span class="line">String filePath = "D:\\test\\test.xlsx";</span><br><span class="line">try {</span><br><span class="line">    List&lt;Map&lt;String, String&gt;&gt; dataToInput = ExcelUtil.getDataToFilePath(fileName, 0, filePath);</span><br><span class="line">    List&lt;Map&lt;String, String&gt;&gt; dataList = dataToInput.subList(1, dataToInput.size());</span><br><span class="line">    Set<span class="tag">&lt;<span class="name">String</span>&gt;</span> 编号Set = new LinkedHashSet<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    for (Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> stringMap : dataList) {</span><br><span class="line">        String documentNo = stringMap.get("0");</span><br><span class="line">        if (StringUtils.isNotBlank(documentNo)) {</span><br><span class="line">            // 转化公式值</span><br><span class="line">            String[] replaceStr = {"3","4","6","7","11","13","19","22"};</span><br><span class="line">            for (String s : replaceStr) {</span><br><span class="line">                String replaceStrVal = stringMap.get(s).replace("\"", "");</span><br><span class="line">                stringMap.put(s, replaceStrVal);</span><br><span class="line">            }</span><br><span class="line">            // 转化数字值</span><br><span class="line">            String[] doubleStr = {"0","9"};</span><br><span class="line">            for (String s : doubleStr) {</span><br><span class="line">                String doubleStrVal = new DecimalFormat("0").format(new Double(stringMap.get(s)));</span><br><span class="line">                stringMap.put(s, doubleStrVal);</span><br><span class="line">            }</span><br><span class="line">        } else {</span><br><span class="line">            continue;</span><br><span class="line">        }</span><br><span class="line">        编号Set.add(stringMap.get("0"));</span><br><span class="line">    }</span><br><span class="line">    System.out.println(JSON.toJSONString(编号Set));</span><br><span class="line">    System.out.println(JSON.toJSONString(dataList));</span><br><span class="line">} catch (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis遍历map</title>
    <url>/2020/11/1605605257925/1605605257925/</url>
    <content><![CDATA[<p>MyBatis是可以遍历map的，</p>
<h3 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h3><p>注意：要加@Param注解，否则不行</p>
<p>Map&lt;String,Object&gt; map = new LinkedHashMap&lt;&gt;();<br>map.put(“USER_NAME”,”张三”);<br>map.put(“USER_STATUS”,”0”);<br>map.put(“UPDATE_TIME”,new Date());</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">int insertData(@Param("params") Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map);</span><br></pre></td></tr></tbody></table></figure></div>
<p>Map&lt;String,Object&gt; map = new LinkedHashMap&lt;&gt;();<br>map.put(“1”,”张三”);<br>map.put(“2”,”李四”);</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">int deleteBatch(@Param("params") Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map);</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h3><p>注意：collection=”params.entrySet()” 或者 collection=”params” 都行</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertData"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.Map"</span>&gt;</span></span><br><span class="line">    insert into user_table</span><br><span class="line">         <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"params.entrySet()"</span> <span class="attr">index</span>=<span class="string">"key"</span> <span class="attr">separator</span>=<span class="string">","</span>  <span class="attr">item</span>=<span class="string">"value"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">            #{key}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">     values </span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"params.entrySet()"</span> <span class="attr">index</span>=<span class="string">"key"</span> <span class="attr">separator</span>=<span class="string">","</span>  <span class="attr">item</span>=<span class="string">"value"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">           #{value}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"deleteBatch"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.Map"</span>&gt;</span></span><br><span class="line">    delete from user_table where USER_ID in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"params.entrySet()"</span> <span class="attr">index</span>=<span class="string">"key"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">item</span>=<span class="string">"value"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #{key}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis的几种批量操作 - MySql</title>
    <url>/2020/11/1605601494695/1605601494695/</url>
    <content><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>此处针对MySql的数据库操作,<br>datasource.url：jdbc:mysql://127.0.0.1:3306/data?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true</p>
<h3 id="批量新增"><a href="#批量新增" class="headerlink" title="批量新增"></a>批量新增</h3><h4 id="dao"><a href="#dao" class="headerlink" title="dao"></a>dao</h4><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 批量新增</span><br><span class="line"> * @param params  参数1</span><br><span class="line"> * @param list 参数2</span><br><span class="line"> */</span><br><span class="line">void saveBatchData(@Param("params")Map&lt;String, Object&gt; map, @Param("list")List&lt;Map&lt;String, Object&gt;&gt; list);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h4><p>此处的 “list” 为 dao里面的 @Param(“list”) 的 list</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"saveBatchData"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span> &gt;</span></span><br><span class="line">    insert into user_table</span><br><span class="line">    ( USER_NAME,USER_STATUS,CREATE_TIME,UPDATE_TIME ) values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">        ( #{item.userName},#{item.userStatus},#{item.createDate},#{item.updateDate} )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><h4 id="dao-1"><a href="#dao-1" class="headerlink" title="dao"></a>dao</h4><p>数组:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">List<span class="tag">&lt;<span class="name">String</span>&gt;</span> list = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">list.add("1");</span><br><span class="line">String[] stringArray = new String[list.size()];</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 批量删除</span><br><span class="line"> * @param stringArray 参数</span><br><span class="line"> */</span><br><span class="line">void deleteBatchDataByArray(String[] stringArray);</span><br></pre></td></tr></tbody></table></figure></div>

<p>集合:</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 批量删除</span><br><span class="line"> * @param list 参数</span><br><span class="line"> */</span><br><span class="line">void deleteBatchDataByList(@Param("list")List&lt;Map&lt;String, Object&gt;&gt; list);</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Mapper-1"><a href="#Mapper-1" class="headerlink" title="Mapper"></a>Mapper</h4><p>数组:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteBatchDataByArray"</span>&gt;</span></span><br><span class="line">    delete from user_table  where USER_ID in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #{item}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>集合:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteBatchDataByList"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span>&gt;</span></span><br><span class="line">    delete from user_table where</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span>  <span class="attr">separator</span>=<span class="string">"or"</span>&gt;</span></span><br><span class="line">        ( USER_ID = #{item.userId} )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="批量更新"><a href="#批量更新" class="headerlink" title="批量更新"></a>批量更新</h3><h4 id="dao-2"><a href="#dao-2" class="headerlink" title="dao"></a>dao</h4><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 批量更新</span><br><span class="line"> * @param params  参数1</span><br><span class="line"> * @param list 参数2</span><br><span class="line"> */</span><br><span class="line">void updateBatchData(@Param("params")Map&lt;String, Object&gt; params, @Param("list")List&lt;Map&lt;String, Object&gt;&gt; list);</span><br></pre></td></tr></tbody></table></figure>

<h4 id="Mapper-2"><a href="#Mapper-2" class="headerlink" title="Mapper"></a>Mapper</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateBatchData"</span> <span class="attr">parameterType</span>=<span class="string">"java.util.List"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">separator</span>=<span class="string">";"</span>&gt;</span></span><br><span class="line">        update user_table</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            USER_NAME = #{item.userName},</span><br><span class="line">            USER_STATUS = #{item.userStatus},</span><br><span class="line">            UPDATE_TIME = #{item.updateDate}</span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where</span><br><span class="line">            USER_ID = #{item.userId}</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot之自定义Redis配置</title>
    <url>/2020/11/1605606341401/1605606341401/</url>
    <content><![CDATA[<p>修改原生的yml配置，采取自定义模式，</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.lettuce<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lettuce-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>创建Bean的注入方式，使用 @ConditionalOnMissingClass 注解 进行判断bean是否存在，<br>如不存在则加载当前默认bean，如存在则使用配置bean.</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Data</span><br><span class="line">@Component(value = "redisDataConfig")</span><br><span class="line">@ConditionalOnMissingClass(value = "redisDataConfig")</span><br><span class="line">public class RedisDataConfig {</span><br><span class="line"></span><br><span class="line">    // 服务器地址</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">String</span>&gt;</span> hostname = Collections.singletonList("127.0.0.1:6379");</span><br><span class="line">    // 数据库索引（默认为0）</span><br><span class="line">    private Integer database = 0;</span><br><span class="line">    // 服务器连接密码（默认为空）</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    /* 哨兵 */</span><br><span class="line">    // 哨兵监听的 master名称（mymaster）</span><br><span class="line">    private String master;</span><br><span class="line"></span><br><span class="line">    /* 集群 */</span><br><span class="line">    private Integer maxRedirects = 3;</span><br><span class="line">    private Integer refreshTime = 60;</span><br><span class="line"></span><br><span class="line">    /* 其他 */</span><br><span class="line">    // 服务器连接名称（默认为空）</span><br><span class="line">    private String username;</span><br><span class="line">    // 连接超时时间（毫秒）默认是2000ms</span><br><span class="line">    private Long timeout = 10000L;</span><br><span class="line">    // 连接池最大连接数（使用负值表示没有限制）</span><br><span class="line">    private Integer maxTotal = 200;</span><br><span class="line">    // 连接池中的最大空闲连接</span><br><span class="line">    private Integer maxIdle = 20;</span><br><span class="line">    // 连接池中的最小空闲连接</span><br><span class="line">    private Integer minIdle = 0;</span><br><span class="line">    // 连接池最大阻塞等待时间（使用负值表示没有限制）</span><br><span class="line">    private Long maxWaitMillis = 10000L;</span><br><span class="line"></span><br><span class="line">    // 调用validated方法进行校验,若校验失败，连接会从连接池中移除并销毁，同时会尝试重新借一个新的连接对象。</span><br><span class="line">    private Boolean testOnBorrow = true;</span><br><span class="line">    // 归还连接时，会进行检查，检查不通过，销毁。</span><br><span class="line">    private Boolean testOnReturn = true;</span><br><span class="line">    // 检测本次获取redis链接是否可用，若不可用，则取到可用链接为止</span><br><span class="line">    private Boolean testWhileIdle = true;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line">import com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import com.fasterxml.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator;</span><br><span class="line">import io.lettuce.core.ReadFrom;</span><br><span class="line">import io.lettuce.core.cluster.ClusterClientOptions;</span><br><span class="line">import io.lettuce.core.cluster.ClusterTopologyRefreshOptions;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.commons.pool2.impl.GenericObjectPoolConfig;</span><br><span class="line">import org.springframework.cache.CacheManager;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line">import org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line">import org.springframework.data.redis.cache.RedisCacheWriter;</span><br><span class="line">import org.springframework.data.redis.connection.*;</span><br><span class="line">import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.RedisSerializationContext;</span><br><span class="line">import org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.time.Duration;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: RedisConfig.java</span><br><span class="line"> * @description: Redis配置</span><br><span class="line"> * @author: Demon</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@EnableCaching</span><br><span class="line">public class RedisConfig {</span><br><span class="line"></span><br><span class="line">    @Resource(name = "redisDataConfig")</span><br><span class="line">    private RedisDataConfig redisDataConfig;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisConnectionFactory lettuceConnectionFactory() {</span><br><span class="line"></span><br><span class="line">        GenericObjectPoolConfig genericObjectPoolConfig = new GenericObjectPoolConfig();</span><br><span class="line">        genericObjectPoolConfig.setMaxTotal(redisDataConfig.getMaxTotal());</span><br><span class="line">        genericObjectPoolConfig.setMaxWaitMillis(redisDataConfig.getMaxWaitMillis());</span><br><span class="line">        genericObjectPoolConfig.setMaxIdle(redisDataConfig.getMaxIdle());</span><br><span class="line">        genericObjectPoolConfig.setMinIdle(redisDataConfig.getMinIdle());</span><br><span class="line">        genericObjectPoolConfig.setTestOnBorrow(redisDataConfig.getTestOnBorrow());</span><br><span class="line">        genericObjectPoolConfig.setTestOnReturn(redisDataConfig.getTestOnReturn());</span><br><span class="line">        genericObjectPoolConfig.setTestWhileIdle(redisDataConfig.getTestWhileIdle());</span><br><span class="line"></span><br><span class="line">        LettucePoolingClientConfiguration.LettucePoolingClientConfigurationBuilder lettucePoolingClientConfigurationBuilder = LettucePoolingClientConfiguration.builder()</span><br><span class="line">                .poolConfig(genericObjectPoolConfig).commandTimeout(Duration.ofMillis(redisDataConfig.getTimeout())).shutdownTimeout(Duration.ZERO);</span><br><span class="line"></span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> hostname = redisDataConfig.getHostname();</span><br><span class="line">        if (hostname.size() &gt; 1) {</span><br><span class="line">            String master = redisDataConfig.getMaster();</span><br><span class="line">            if (master != null &amp;&amp; master.length() &gt; 0) {</span><br><span class="line">                // 哨兵模式</span><br><span class="line">                log.info("Redis模式：哨兵（{}）", Collections.singletonList(hostname).toArray());</span><br><span class="line">                RedisSentinelConfiguration redisSentinelConfiguration = new RedisSentinelConfiguration();</span><br><span class="line">                redisSentinelConfiguration.setMaster(master);</span><br><span class="line">                redisSentinelConfiguration.setDatabase(redisDataConfig.getDatabase());</span><br><span class="line">                redisSentinelConfiguration.setUsername(redisDataConfig.getUsername());</span><br><span class="line">                if (redisDataConfig.getPassword() != null &amp;&amp; !"".equals(redisDataConfig.getPassword())) {</span><br><span class="line">                    redisSentinelConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword()));</span><br><span class="line">                }</span><br><span class="line">                for (String sentinelNode : hostname) {</span><br><span class="line">                    String[] split = sentinelNode.split(":");</span><br><span class="line">                    redisSentinelConfiguration.addSentinel(new RedisNode(split[0], Integer.parseInt(split[1])));</span><br><span class="line">                }</span><br><span class="line">                return new LettuceConnectionFactory(redisSentinelConfiguration, lettucePoolingClientConfigurationBuilder.build());</span><br><span class="line">            } else {</span><br><span class="line">                // 集群模式</span><br><span class="line">                log.info("Redis模式：集群（{}）", Collections.singletonList(hostname).toArray());</span><br><span class="line">                RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration();</span><br><span class="line">                redisClusterConfiguration.setUsername(redisDataConfig.getUsername());</span><br><span class="line">                redisClusterConfiguration.setMaxRedirects(redisDataConfig.getMaxRedirects());</span><br><span class="line">                if (redisDataConfig.getPassword() != null &amp;&amp; !"".equals(redisDataConfig.getPassword())) {</span><br><span class="line">                    redisClusterConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword()));</span><br><span class="line">                }</span><br><span class="line">                for (String clusterNode : hostname) {</span><br><span class="line">                    String[] split = clusterNode.split(":");</span><br><span class="line">                    redisClusterConfiguration.addClusterNode(new RedisNode(split[0], Integer.parseInt(split[1])));</span><br><span class="line">                }</span><br><span class="line">                //支持自适应集群拓扑刷新和静态刷新源</span><br><span class="line">                ClusterTopologyRefreshOptions clusterTopologyRefreshOptions = ClusterTopologyRefreshOptions.builder()</span><br><span class="line">                        .enablePeriodicRefresh().enableAllAdaptiveRefreshTriggers().refreshPeriod(Duration.ofSeconds(redisDataConfig.getRefreshTime()))</span><br><span class="line">                        .build();</span><br><span class="line">                ClusterClientOptions clusterClientOptions = ClusterClientOptions.builder().topologyRefreshOptions(clusterTopologyRefreshOptions).build();</span><br><span class="line">                //从优先，读写分离，读从可能存在不一致，最终一致性CP</span><br><span class="line">                lettucePoolingClientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED).clientOptions(clusterClientOptions).build();</span><br><span class="line">                LettucePoolingClientConfiguration clientConfig = lettucePoolingClientConfigurationBuilder.build();</span><br><span class="line">                return new LettuceConnectionFactory(redisClusterConfiguration, clientConfig);</span><br><span class="line">            }</span><br><span class="line">        } else {</span><br><span class="line">            // 单机模式</span><br><span class="line">            String redisStandaloneHostname = hostname.get(0);</span><br><span class="line">            log.info("Redis模式：单机（{}）", Collections.singletonList(redisStandaloneHostname).toArray());</span><br><span class="line">            String[] split = redisStandaloneHostname.split(":");</span><br><span class="line">            RedisStandaloneConfiguration redisStandaloneConfiguration = new RedisStandaloneConfiguration(split[0], Integer.parseInt(split[1]));</span><br><span class="line">            redisStandaloneConfiguration.setDatabase(redisDataConfig.getDatabase());</span><br><span class="line">            if (redisDataConfig.getPassword() != null &amp;&amp; !"".equals(redisDataConfig.getPassword())) {</span><br><span class="line">                redisStandaloneConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword()));</span><br><span class="line">            }</span><br><span class="line">            redisStandaloneConfiguration.setUsername(redisDataConfig.getUsername());</span><br><span class="line">            return new LettuceConnectionFactory(redisStandaloneConfiguration, lettucePoolingClientConfigurationBuilder.build());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 配置自定义redisTemplate</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> redisTemplate(RedisConnectionFactory redisConnectionFactory) {</span><br><span class="line">        System.out.println("★★★★★加载 bean - RedisTemplate<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> ★★★★★");</span><br><span class="line">        RedisTemplate<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> redisTemplate = new RedisTemplate<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        //使用Jackson2JsonRedisSerializer来序列化和反序列化redis的value值 替换默认序列化</span><br><span class="line">        Jackson2JsonRedisSerializer<span class="tag">&lt;<span class="name">Object</span>&gt;</span> jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<span class="tag">&lt;&gt;</span>(Object.class);</span><br><span class="line">        ObjectMapper objectMapper = new ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.WRAPPER_ARRAY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line">        //使用StringRedisSerializer来序列化和反序列化redis的key值</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashKeySerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        //事务支持</span><br><span class="line">        redisTemplate.setEnableTransactionSupport(true);</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 缓存配置管理器</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) {</span><br><span class="line">        System.out.println("★★★★★加载 bean - cacheManager ★★★★★");</span><br><span class="line">        RedisSerializer<span class="tag">&lt;<span class="name">String</span>&gt;</span> redisSerializer = new StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer<span class="tag">&lt;<span class="name">Object</span>&gt;</span> jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer<span class="tag">&lt;&gt;</span>(Object.class);</span><br><span class="line">        //以锁写入的方式创建RedisCacheWriter对象</span><br><span class="line">        RedisCacheWriter writer = RedisCacheWriter.lockingRedisCacheWriter(redisConnectionFactory);</span><br><span class="line">        //创建缓存配置对象</span><br><span class="line">        RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig().serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer));</span><br><span class="line">        return RedisCacheManager.builder(redisConnectionFactory).cacheDefaults(redisCacheConfiguration).cacheWriter(writer).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Resource</span><br><span class="line">private RedisTemplate<span class="tag">&lt;<span class="name">String,Object</span>&gt;</span> redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ValueOperations<span class="tag">&lt;<span class="name">String,Object</span>&gt;</span> valueOperations = redisTemplate.opsForValue();</span><br><span class="line">valueOperations.set("admin","");</span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>POI(3.17)生成Excel2007 - 可计算公式数据</title>
    <url>/2020/11/1605601181571/1605601181571/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml-schemas<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h3> <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.poi.ss.usermodel.*;</span><br><span class="line">import org.apache.poi.xssf.streaming.SXSSFWorkbook;</span><br><span class="line">import org.apache.poi.xssf.usermodel.XSSFWorkbook;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/10/1 12:18</span><br><span class="line"> * desc ：Excel 导出工具</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * InputStream inputStream = xxx.class.getResourceAsStream("/example.xlsx");</span><br><span class="line"> */</span><br><span class="line">public class ExcelUtil2 {</span><br><span class="line"></span><br><span class="line">    private boolean isNew = false;</span><br><span class="line">    private int sheetIndex = 0;</span><br><span class="line">    private String sheetName = "Sheet1";</span><br><span class="line">    private String[] removeSheet = {};</span><br><span class="line">    private XSSFWorkbook workbook;</span><br><span class="line">    private OutputStream outputStream;</span><br><span class="line"></span><br><span class="line">    public ExcelUtil2() {</span><br><span class="line">        this.isNew = true;</span><br><span class="line">        this.workbook = new XSSFWorkbook();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public ExcelUtil2(InputStream inputFile) throws IOException {</span><br><span class="line">        this.workbook = new XSSFWorkbook(inputFile);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public ExcelUtil2(int sheetIndex, InputStream inputFile) throws IOException {</span><br><span class="line">        this.workbook = new XSSFWorkbook(inputFile);</span><br><span class="line">        this.sheetIndex = sheetIndex;</span><br><span class="line">        this.sheetName = this.workbook.getSheetName(sheetIndex);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public ExcelUtil2(String sheetName, InputStream inputFile) throws IOException {</span><br><span class="line">        this.workbook = new XSSFWorkbook(inputFile);</span><br><span class="line">        this.sheetIndex = this.workbook.getSheetIndex(sheetName);</span><br><span class="line">        this.sheetName = sheetName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public XSSFWorkbook getWorkbook() {</span><br><span class="line">        return workbook;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public int getSheetIndex() {</span><br><span class="line">        return this.sheetIndex;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getSheetName() {</span><br><span class="line">        return this.sheetName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /* 修改指定Sheet的名称 */</span><br><span class="line">    public void setSheetName(int sheetIndex, String sheetName) {</span><br><span class="line">        if (sheetName != null) {</span><br><span class="line">            this.workbook.setSheetName(sheetIndex, sheetName);</span><br><span class="line">        } else {</span><br><span class="line">            this.workbook.setSheetName(sheetIndex, "Sheet1");</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /* 删除Sheet */</span><br><span class="line">    public void removeSheet(String[] sheetName) {</span><br><span class="line">        this.removeSheet = sheetName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加行信息</span><br><span class="line">     *</span><br><span class="line">     * @param cellRow    行计数</span><br><span class="line">     * @param columnList 列数据</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public Map&lt;String, Object&gt; addRowData(int cellRow, List&lt;Map&lt;String, Object&gt;&gt; columnList) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        map.put("cellRow", cellRow);</span><br><span class="line">        map.put("cellData", columnList);</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加列</span><br><span class="line">     *</span><br><span class="line">     * @param cellColumn 列计数</span><br><span class="line">     * @param cellTitle  列标题</span><br><span class="line">     * @param cellValue  列值</span><br><span class="line">     * @param cellType   列类型</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        map.put("cellColumn", cellColumn);</span><br><span class="line">        map.put("cellTitle", cellTitle);</span><br><span class="line">        map.put("cellValue", cellValue);</span><br><span class="line">        map.put("cellType", cellType);</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加列</span><br><span class="line">     *</span><br><span class="line">     * @param cellColumn 列计数</span><br><span class="line">     * @param cellTitle  列标题</span><br><span class="line">     * @param cellValue  列值</span><br><span class="line">     * @param cellType   列类型</span><br><span class="line">     * @param cellStyle  列格式</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, String cellStyle) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>(this.addColumnData(cellColumn, cellTitle, cellValue, cellType));</span><br><span class="line">        map.put("cellStyle", cellStyle);</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加列 指定宽度</span><br><span class="line">     *</span><br><span class="line">     * @param cellColumn      列计数</span><br><span class="line">     * @param cellTitle       列标题</span><br><span class="line">     * @param cellValue       列值</span><br><span class="line">     * @param cellType        列类型</span><br><span class="line">     * @param cellColumnWidth 列长度</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, int cellColumnWidth) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>(this.addColumnData(cellColumn, cellTitle, cellValue, cellType));</span><br><span class="line">        map.put("cellColumnWidth", cellColumnWidth);</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, String cellStyle, int cellColumnWidth) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>(this.addColumnData(cellColumn, cellTitle, cellValue, cellType));</span><br><span class="line">        map.put("cellStyle", cellStyle);</span><br><span class="line">        map.put("cellColumnWidth", cellColumnWidth);</span><br><span class="line">        return map;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生成文件 - 写入绝对路径</span><br><span class="line">     *</span><br><span class="line">     * @param dataList    数据</span><br><span class="line">     * @param outFilePath 保存文件</span><br><span class="line">     * @throws Exception 异常</span><br><span class="line">     */</span><br><span class="line">    public void createWorkbook(List&lt;Map&lt;String, Object&gt;&gt; dataList, File outFilePath) throws Exception {</span><br><span class="line">        try (SXSSFWorkbook sxssfWorkbook = new SXSSFWorkbook(workbook, dataList.size())) {</span><br><span class="line">            if (this.isNew) {</span><br><span class="line">                try {</span><br><span class="line">                    Sheet sheet = sxssfWorkbook.createSheet(this.sheetName != null ? this.sheetName : "Sheet1");</span><br><span class="line">                    this.setRowData(sheet, 0, dataList);</span><br><span class="line">                    outputStream = new FileOutputStream(outFilePath.getAbsolutePath());</span><br><span class="line">                    //强制让改Sheet执行公式</span><br><span class="line">                    sheet.setForceFormulaRecalculation(true);</span><br><span class="line">                    sxssfWorkbook.write(outputStream);</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    throw new Exception("导出新创建的Excel文件异常", e);</span><br><span class="line">                }</span><br><span class="line">            } else {</span><br><span class="line">                try {</span><br><span class="line">                    Sheet sheet = sxssfWorkbook.getSheetAt(this.sheetIndex);</span><br><span class="line">                    this.setRowData(sheet, sheetIndex, dataList);</span><br><span class="line">                    outputStream = new FileOutputStream(outFilePath.getAbsolutePath());</span><br><span class="line">                    //强制让改Sheet执行公式</span><br><span class="line">                    sheet.setForceFormulaRecalculation(true);</span><br><span class="line">                    sxssfWorkbook.write(outputStream);</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    throw new Exception("导出带模板的Excel文件异常", e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        } finally {</span><br><span class="line">            if (workbook != null) {</span><br><span class="line">                workbook.close();</span><br><span class="line">            }</span><br><span class="line">            if (outputStream != null) {</span><br><span class="line">                outputStream.flush();</span><br><span class="line">                outputStream.close();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生成文件 - 返回流</span><br><span class="line">     *</span><br><span class="line">     * @param dataList 数据</span><br><span class="line">     * @throws Exception 异常</span><br><span class="line">     */</span><br><span class="line">    public byte[] createWorkbook(List&lt;Map&lt;String, Object&gt;&gt; dataList) throws Exception {</span><br><span class="line">        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();</span><br><span class="line">        try (SXSSFWorkbook sxssfWorkbook = new SXSSFWorkbook(this.workbook, dataList.size())) {</span><br><span class="line">            if (this.isNew) {</span><br><span class="line">                try {</span><br><span class="line">                    Sheet sheet = sxssfWorkbook.createSheet(this.sheetName != null ? this.sheetName : "Sheet1");</span><br><span class="line">                    this.setRowData(sheet, 0, dataList);</span><br><span class="line">                    //强制让改Sheet执行公式</span><br><span class="line">                    sheet.setForceFormulaRecalculation(true);</span><br><span class="line">                    sxssfWorkbook.write(byteArrayOutputStream);</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    throw new Exception("导出新创建的Excel文件异常", e);</span><br><span class="line">                }</span><br><span class="line">            } else {</span><br><span class="line">                try {</span><br><span class="line">                    Sheet sheet = sxssfWorkbook.getSheetAt(this.sheetIndex);</span><br><span class="line">                    this.setRowData(sheet, sheetIndex, dataList);</span><br><span class="line">                    //强制让改Sheet执行公式</span><br><span class="line">                    sheet.setForceFormulaRecalculation(true);</span><br><span class="line">                    sxssfWorkbook.write(byteArrayOutputStream);</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    throw new Exception("导出带模板的Excel文件异常", e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return byteArrayOutputStream.toByteArray();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        } finally {</span><br><span class="line">            byteArrayOutputStream.flush();</span><br><span class="line">            byteArrayOutputStream.close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private void setRowData(Sheet sheet, int sheetIndex, List&lt;Map&lt;String, Object&gt;&gt; dataList) throws Exception {</span><br><span class="line">        try {</span><br><span class="line">            if (dataList != null) {</span><br><span class="line">                // 赋值内容</span><br><span class="line">                for (Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> rowMap : dataList) {</span><br><span class="line">                    Row row = sheet.createRow(Integer.parseInt(String.valueOf(rowMap.get("cellRow"))));</span><br><span class="line">                    List&lt;Map&lt;String, Object&gt;&gt; cellDataList = (List&lt;Map&lt;String, Object&gt;&gt;) rowMap.get("cellData");</span><br><span class="line">                    this.executeCellValue(sheetIndex, row, cellDataList);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            if (this.removeSheet.length &gt; 0) {</span><br><span class="line">                // 删除页</span><br><span class="line">                for (String s : this.removeSheet) {</span><br><span class="line">                    this.workbook.removeSheetAt(this.workbook.getSheetIndex(s));</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void executeCellValue(int sheetIndex, Row row, List&lt;Map&lt;String, Object&gt;&gt; cellDataList) {</span><br><span class="line">        for (Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> rowCellData : cellDataList) {</span><br><span class="line">            Cell cell = row.createCell(Integer.parseInt(String.valueOf(rowCellData.get("cellColumn"))));</span><br><span class="line">            Object cellValue = rowCellData.get("cellValue");</span><br><span class="line">            switch (String.valueOf(rowCellData.get("cellType"))) {</span><br><span class="line">                case "-1":</span><br><span class="line">                    //未知类型，不填值</span><br><span class="line">                    cell.setCellType(CellType._NONE);</span><br><span class="line">                    break;</span><br><span class="line">                case "0":</span><br><span class="line">                    // 数字- 整数：如：0</span><br><span class="line">                    cell.setCellType(CellType.NUMERIC);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellValue(String.valueOf(cellValue));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "1":</span><br><span class="line">                    // 数字- 小数：如：0.01</span><br><span class="line">                    cell.setCellType(CellType.NUMERIC);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellValue(Double.parseDouble(String.valueOf(cellValue)));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "2":</span><br><span class="line">                    // 数字- 日期：如：2021-09-03</span><br><span class="line">                    cell.setCellType(CellType.NUMERIC);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellValue(String.valueOf(cellValue));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "3":</span><br><span class="line">                    // 字符串类型</span><br><span class="line">                    cell.setCellType(CellType.STRING);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellValue(String.valueOf(cellValue));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "4":</span><br><span class="line">                    // 计算公式</span><br><span class="line">                    cell.setCellType(CellType.FORMULA);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellFormula(String.valueOf(cellValue));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "5":</span><br><span class="line">                    // 布尔类型</span><br><span class="line">                    cell.setCellType(CellType.BOOLEAN);</span><br><span class="line">                    if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) {</span><br><span class="line">                        cell.setCellValue(Boolean.parseBoolean(String.valueOf(cellValue)));</span><br><span class="line">                    }</span><br><span class="line">                    break;</span><br><span class="line">                case "6":</span><br><span class="line">                    // 空</span><br><span class="line">                    cell.setCellType(CellType.BLANK);</span><br><span class="line">                    break;</span><br><span class="line">                case "7":</span><br><span class="line">                    // 错误</span><br><span class="line">                    cell.setCellType(CellType.ERROR);</span><br><span class="line">                    cell.setCellErrorValue(new Byte(String.valueOf(cellValue)));</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    //其他一律string类型，在赋值</span><br><span class="line">                    cell.setCellType(CellType.STRING);</span><br><span class="line">                    cell.setCellValue(String.valueOf(cellValue));</span><br><span class="line">                    break;</span><br><span class="line">            }</span><br><span class="line">            // 设置列格式</span><br><span class="line">            if (rowCellData.containsKey("cellStyle")) {</span><br><span class="line">                switch (String.valueOf(rowCellData.get("cellStyle"))) {</span><br><span class="line">                    case "1":</span><br><span class="line">                        // 常规</span><br><span class="line">                        break;</span><br><span class="line">                    case "8":</span><br><span class="line">                        // 百分比</span><br><span class="line">                        CellStyle style = this.workbook.createCellStyle();</span><br><span class="line">                        style.setDataFormat(this.workbook.createDataFormat().getFormat("0.000%"));</span><br><span class="line">                        cell.setCellStyle(style);</span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        break;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            // 设置自定义的宽度</span><br><span class="line">            if (rowCellData.containsKey("cellColumnWidth")) {</span><br><span class="line">                int cellColumn = Integer.parseInt(String.valueOf(rowCellData.get("cellColumn")));</span><br><span class="line">                int cellColumnWidth = Integer.parseInt(String.valueOf(rowCellData.get("cellColumnWidth")));</span><br><span class="line">                this.workbook.getSheetAt(sheetIndex).setColumnWidth(cellColumn, cellColumnWidth);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void 测试Excel导出_创建新文件() {</span><br><span class="line">    try {</span><br><span class="line">        ExcelUtil2 excelUtil2 = new ExcelUtil2();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;();</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(0,"编号","编号", "3",1000));</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(1,"代码","代码", "3"));</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(2,"名称","代码", "3"));</span><br><span class="line">        dataList.add(excelUtil2.addRowData(0, columnList));</span><br><span class="line">        excelUtil2.createWorkbook(dataList, new File("D:\\test\\334.xlsx"));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void 测试Excel导出_模板文件续写() {</span><br><span class="line">    try {</span><br><span class="line">        FileInputStream fileInputStream = FileUtils.openInputStream(new File("D:\\test\\334.xlsx"));</span><br><span class="line">        ExcelUtil2 excelUtil2 = new ExcelUtil2(0, fileInputStream);</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;();</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(0,"编号","0", "1"));</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(1,"代码","CC", "3"));</span><br><span class="line">        columnList.add(excelUtil2.addColumnData(2,"名称","123", "0"));</span><br><span class="line">        dataList.add(excelUtil2.addRowData(1, columnList));</span><br><span class="line">        excelUtil2.createWorkbook(dataList, new File("D:\\test\\334.xlsx"));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void 获取Excel模板文件的公式() {</span><br><span class="line">    try {</span><br><span class="line">        FileInputStream fileInputStream = FileUtils.openInputStream(new File("D:\\test\\334.xlsx"));</span><br><span class="line">        Workbook workbook = new XSSFWorkbook(fileInputStream);</span><br><span class="line">        Sheet sheetAt = workbook.getSheetAt(0);</span><br><span class="line">        Cell cell1 = sheetAt.getRow(0).getCell(12);</span><br><span class="line">        System.out.println(cell1.getStringCellValue());</span><br><span class="line">    } catch (IOException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void 测试Excel模板导出2_指定页导出() {</span><br><span class="line">    try {</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; sourceDataList = new ArrayList&lt;&gt;();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map1 = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        map1.put("key0", "0");</span><br><span class="line">        map1.put("key1", "CC");</span><br><span class="line">        map1.put("key2", "123");</span><br><span class="line">        map1.put("key3", "456");</span><br><span class="line">        map1.put("key4", "789.88");</span><br><span class="line">        sourceDataList.add(map1);</span><br><span class="line">        // 获取指定页</span><br><span class="line">        ExcelUtil2 excelUtil2 = new ExcelUtil2("Sheet2", new FileInputStream(new File("D:\\test\\334.xlsx")));</span><br><span class="line">        // 删除多余页</span><br><span class="line">        excelUtil2.removeSheet(new String[]{"Sheet1"});</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;();</span><br><span class="line">        // 开始行</span><br><span class="line">        int startNum = 1;</span><br><span class="line">        for (int i = 0; i <span class="tag">&lt; <span class="attr">sourceDataList.size</span>(); <span class="attr">i</span>++) {</span></span><br><span class="line">            List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;();</span><br><span class="line">            int cellRow = startNum + i;</span><br><span class="line">            Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = sourceDataList.get(i);</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(0, "编号1", objectMap.get("key0"), "1"));</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(1, "代码2", objectMap.get("key1"), "3"));</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(2, "名称3", objectMap.get("key2"), "1"));</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(3, "名称4", objectMap.get("key3"), "1"));</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(4, "名称5", objectMap.get("key4"), "1"));</span><br><span class="line">            columnList.add(excelUtil2.addColumnData(5, "公式列", "=C" + (cellRow + 1) + "/D" + (cellRow + 1), "4", "8"));</span><br><span class="line">            // 写入</span><br><span class="line">            dataList.add(excelUtil2.addRowData(cellRow, columnList));</span><br><span class="line">        }</span><br><span class="line">        excelUtil2.setSheetName(excelUtil2.getSheetIndex(), "自定义" + excelUtil2.getSheetName());</span><br><span class="line">        excelUtil2.createWorkbook(dataList, new File("D:\\test\\3344.xlsx"));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx一个server配置多个location</title>
    <url>/2020/10/1602671313615/1602671313615/</url>
    <content><![CDATA[<p>nginx作为代理服务器，可以配置多个location，通过访问不同路径来访问不同目录。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">server {</span><br><span class="line">    listen       80;  #端口号</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    </span><br><span class="line">    location /video { </span><br><span class="line">        #alias末尾必须要用/结束</span><br><span class="line">        alias  html/video/;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    }</span><br><span class="line">        </span><br><span class="line">    location /music { </span><br><span class="line">        #alias末尾必须要用/结束</span><br><span class="line">        alias  html/music/;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    location / {</span><br><span class="line">        #root末尾可以不用/结束</span><br><span class="line">        root   html;</span><br><span class="line">        index  	index.html index.htm;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html {</span><br><span class="line">        root   html;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><p><img src="/2020/10/1602671313615/1602671313615/20201014184210.png" alt="20201014184210"><br>在music内放置文件 111.mp3<br>在video内放置文件 222.mp4</p>
<h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><p><a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a><br><a href="http://localhost/music/111.mp3" target="_blank" rel="noopener">http://localhost/music/111.mp3</a><br><a href="http://localhost/video/222.mp4" target="_blank" rel="noopener">http://localhost/video/222.mp4</a></p>
<h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>alias与root的区别：alias与root指定的url意义不同</p>
<br>

<p>root和alias都可以定义在location模块中，都是用来指定请求资源的真实路径，比如：</p>
<pre><code>location /music/ {
    root /data/file;
}
请求 http://localhost/music/111.mp3 时，那么在服务器里面对应的真正的资源是：/opt/data/file/music/111.mp3，</code></pre><p>注意：root真实路径是root指定的值加上location指定的值。</p>
<br>

<p>而 alias 正如其名，alias指定的路径是location的别名，不管location的值怎么写，资源的真实路径都是 alias 指定的路径，比如：</p>
<pre><code>location /music/ {
    alias /data/file/;
}
请求 http://localhost/music/111.mp3 时，那么在服务器里面对应的真正的资源是：/opt/data/file/111.mp3，</code></pre><p>注意：alias真实路径是alias指定的值，不包含location指定的值了。</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>在一个location中，alias可以存在多个，但是root只能有一个，<br>alias只能存在与location中，但是root可以用在server、http和location中，<br>alias后面必须要“/”结束，否则会找不到文件，而root的“/”可有可无，</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之TreeView的事件</title>
    <url>/2021/03/1614672011404/1614672011404/</url>
    <content><![CDATA[<p>判断TreeView是否点击到节点上</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Node node = event.getPickResult().getIntersectedNode();</span><br><span class="line">boolean flag = node instanceof TreeCell &amp;&amp; ((TreeCell) node).getText() != null;</span><br><span class="line">if (node instanceof Text || flag) {</span><br><span class="line">    String name = (String) ((TreeItem)tree.getSelectionModel().getSelectedItem()).getValue();</span><br><span class="line">    System.out.println("Node click: " + name);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>给TreeView 添加 鼠标点击事件<br>MouseButton.NONE 无判断<br>左键：event.getButton().compareTo(MouseButton.PRIMARY)  == 1<br>滚轮：event.getButton().compareTo(MouseButton.MIDDLE)  == 1<br>右键：event.getButton().compareTo(MouseButton.SECONDARY)  == 1</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">tree.addEventFilter(MouseEvent.MOUSE_CLICKED, event -&gt; {</span><br><span class="line">   switch (event.getButton().compareTo(MouseButton.NONE)){</span><br><span class="line">       case 1:</span><br><span class="line">           System.out.println("【左键】Node click: " + name);</span><br><span class="line">           break;</span><br><span class="line">       case 2:</span><br><span class="line">           System.out.println("【滚轮】Node click: " + name);</span><br><span class="line">           break;</span><br><span class="line">       case 3:</span><br><span class="line">           System.out.println("【右键】Node click: " + name);</span><br><span class="line">           break;</span><br><span class="line">       default:</span><br><span class="line">           break;</span><br><span class="line">   }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div>


<p>完成代码如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package sample;</span><br><span class="line"></span><br><span class="line">import javafx.application.Application;</span><br><span class="line">import javafx.scene.Node;</span><br><span class="line">import javafx.scene.Scene;</span><br><span class="line">import javafx.scene.control.TreeCell;</span><br><span class="line">import javafx.scene.control.TreeItem;</span><br><span class="line">import javafx.scene.control.TreeView;</span><br><span class="line">import javafx.scene.input.MouseButton;</span><br><span class="line">import javafx.scene.input.MouseEvent;</span><br><span class="line">import javafx.scene.layout.StackPane;</span><br><span class="line">import javafx.scene.text.Text;</span><br><span class="line">import javafx.stage.Stage;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: TreeViewMouseEvent</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2021/3/1 11:16</span><br><span class="line"> */</span><br><span class="line">public class TreeViewMouseEvent extends Application {</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        launch(args);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void start(Stage primaryStage) {</span><br><span class="line">        TreeItem<span class="tag">&lt;<span class="name">String</span>&gt;</span> rootItem = new TreeItem<span class="tag">&lt;&gt;</span>("Root");</span><br><span class="line">        rootItem.setExpanded(true);</span><br><span class="line"></span><br><span class="line">        TreeItem<span class="tag">&lt;<span class="name">String</span>&gt;</span> itemA = new TreeItem<span class="tag">&lt;&gt;</span>("A");</span><br><span class="line">        TreeItem<span class="tag">&lt;<span class="name">String</span>&gt;</span> itemB = new TreeItem<span class="tag">&lt;&gt;</span>("B");</span><br><span class="line">        rootItem.getChildren().add(itemA);</span><br><span class="line">        rootItem.getChildren().add(itemB);</span><br><span class="line"></span><br><span class="line">        TreeView<span class="tag">&lt;<span class="name">String</span>&gt;</span> tree = new TreeView<span class="tag">&lt;&gt;</span>(rootItem);</span><br><span class="line">        // 给TreeView 添加 鼠标点击事件</span><br><span class="line">        tree.addEventFilter(MouseEvent.MOUSE_CLICKED, event -&gt; {</span><br><span class="line">            Node node = event.getPickResult().getIntersectedNode();</span><br><span class="line">            boolean flag = node instanceof TreeCell &amp;&amp; ((TreeCell) node).getText() != null;</span><br><span class="line">            if (node instanceof Text || flag) {</span><br><span class="line">                String name = (String) ((TreeItem)tree.getSelectionModel().getSelectedItem()).getValue();</span><br><span class="line">                switch (event.getButton().compareTo(MouseButton.NONE)){</span><br><span class="line">                    case 1:</span><br><span class="line">                        System.out.println("【左键】Node click: " + name);</span><br><span class="line">                        break;</span><br><span class="line">                    case 2:</span><br><span class="line">                        System.out.println("【滚轮】Node click: " + name);</span><br><span class="line">                        break;</span><br><span class="line">                    case 3:</span><br><span class="line">                        System.out.println("【右键】Node click: " + name);</span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        break;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        StackPane root = new StackPane();</span><br><span class="line">        root.getChildren().add(tree);</span><br><span class="line">        primaryStage.setScene(new Scene(root, 600, 400));</span><br><span class="line">        primaryStage.show();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>TreeView</tag>
      </tags>
  </entry>
  <entry>
    <title>Zip4j - 压缩/解压（可设置密码）</title>
    <url>/2020/11/1605683417659/1605683417659/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.lingala.zip4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zip4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import net.lingala.zip4j.ZipFile;</span><br><span class="line">import net.lingala.zip4j.exception.ZipException;</span><br><span class="line">import net.lingala.zip4j.model.FileHeader;</span><br><span class="line">import net.lingala.zip4j.model.ZipParameters;</span><br><span class="line">import net.lingala.zip4j.model.enums.CompressionLevel;</span><br><span class="line">import net.lingala.zip4j.model.enums.CompressionMethod;</span><br><span class="line">import net.lingala.zip4j.model.enums.EncryptionMethod;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: Zip4jUtil</span><br><span class="line"> * @Description: zip 工具</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">public class Zip4jUtil {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据给定密码压缩文件(s)到指定目录</span><br><span class="line">     *</span><br><span class="line">     * @param destFileName 压缩文件存放绝对路径 e.g.:D:/upload/zip/demo.zip</span><br><span class="line">     * @param password 密码(可为null)</span><br><span class="line">     * @param files 单个文件或文件数组</span><br><span class="line">     * @return 最终的压缩文件存放的绝对路径,如果为false则说明压缩失败.</span><br><span class="line">     */</span><br><span class="line">    public static boolean compress(String destFileName, String password, File... files) throws ZipException {</span><br><span class="line">        try {</span><br><span class="line">            ZipParameters parameters = new ZipParameters();</span><br><span class="line">            // 压缩方式 8</span><br><span class="line">            parameters.setCompressionMethod(CompressionMethod.DEFLATE);</span><br><span class="line">            // 压缩级别 5</span><br><span class="line">            parameters.setCompressionLevel(CompressionLevel.NORMAL);</span><br><span class="line">            if (!(password == null || "".equals(password))) {</span><br><span class="line">                parameters.setEncryptFiles(true);</span><br><span class="line">                // 加密方式 0</span><br><span class="line">                parameters.setEncryptionMethod(EncryptionMethod.ZIP_STANDARD);</span><br><span class="line">            }</span><br><span class="line">            ZipFile zipFile = new ZipFile(destFileName);</span><br><span class="line">            if (!(password == null || "".equals(password))) {</span><br><span class="line">                zipFile.setPassword(password.toCharArray());</span><br><span class="line">            }</span><br><span class="line">            for (File file : files) {</span><br><span class="line">                zipFile.addFile(file, parameters);</span><br><span class="line">            }</span><br><span class="line">            return true;</span><br><span class="line">        } catch (ZipException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new ZipException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据给定密码压缩文件(s)到指定位置</span><br><span class="line">     *</span><br><span class="line">     * @param destFileName 压缩文件存放绝对路径 e.g.:D:/upload/zip/demo.zip</span><br><span class="line">     * @param password 密码(可为null)</span><br><span class="line">     * @param filePaths 单个文件路径或文件路径数组</span><br><span class="line">     * @return 最终的压缩文件存放的绝对路径,如果为false则说明压缩失败.</span><br><span class="line">     */</span><br><span class="line">    public static boolean compress(String destFileName, String password, String... filePaths) throws ZipException {</span><br><span class="line">        int size = filePaths.length;</span><br><span class="line">        File[] files = new File[size];</span><br><span class="line">        for (int i = 0; i <span class="tag">&lt; <span class="attr">size</span>; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">            <span class="attr">files</span>[<span class="attr">i</span>] = <span class="string">new</span> <span class="attr">File</span>(<span class="attr">filePaths</span>[<span class="attr">i</span>]);</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">compress</span>(<span class="attr">destFileName</span>, <span class="attr">password</span>, <span class="attr">files</span>);</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 根据给定密码压缩文件(<span class="attr">s</span>)到指定位置</span></span><br><span class="line"><span class="tag">     *</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">destFileName</span> 压缩文件存放绝对路径 <span class="attr">e.g.:D:</span>/<span class="attr">upload</span>/<span class="attr">zip</span>/<span class="attr">demo.zip</span></span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">password</span> 密码(可为<span class="attr">null</span>)</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">folder</span> 文件夹路径</span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> 最终的压缩文件存放的绝对路径,如果为<span class="attr">false</span>则说明压缩失败<span class="attr">.</span></span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">static</span> <span class="attr">boolean</span> <span class="attr">compressFolder</span>(<span class="attr">String</span> <span class="attr">destFileName</span>, <span class="attr">String</span> <span class="attr">password</span>, <span class="attr">String</span> <span class="attr">folder</span>) <span class="attr">throws</span> <span class="attr">ZipException</span> {</span></span><br><span class="line"><span class="tag">        <span class="attr">File</span> <span class="attr">folderParam</span> = <span class="string">new</span> <span class="attr">File</span>(<span class="attr">folder</span>);</span></span><br><span class="line"><span class="tag">        <span class="attr">if</span> (<span class="attr">folderParam.isDirectory</span>()) {</span></span><br><span class="line"><span class="tag">            <span class="attr">File</span>[] <span class="attr">files</span> = <span class="string">folderParam.listFiles();</span></span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">compress</span>(<span class="attr">destFileName</span>, <span class="attr">password</span>, <span class="attr">files</span>);</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">false</span>;</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 根据所给密码解压<span class="attr">zip</span>压缩包到指定目录</span></span><br><span class="line">     * &lt;p&gt;</span><br><span class="line">     * 如果指定目录不存在,可以自动创建,不合法的路径将导致异常被抛出</span><br><span class="line">     *</span><br><span class="line">     * @param zipFile zip压缩包绝对路径</span><br><span class="line">     * @param dest 指定解压文件夹位置</span><br><span class="line">     * @param password 密码(可为null)</span><br><span class="line">     * @return 解压后的文件数组</span><br><span class="line">     * @throws ZipException 异常</span><br><span class="line">     */</span><br><span class="line">    public static File[] deCompress(File zipFile, String dest, String password) throws ZipException {</span><br><span class="line">        //1.判断指定目录是否存在</span><br><span class="line">        File destDir = new File(dest);</span><br><span class="line">        if (destDir.isDirectory() &amp;&amp; !destDir.exists()) {</span><br><span class="line">            boolean mkdir = destDir.mkdir();</span><br><span class="line">            System.out.println(mkdir);</span><br><span class="line">        }</span><br><span class="line">        //2.初始化zip工具</span><br><span class="line">        ZipFile zFile = new ZipFile(zipFile);</span><br><span class="line">        zFile.setCharset(Charset.forName("UTF-8"));</span><br><span class="line">        if (!zFile.isValidZipFile()) {</span><br><span class="line">            throw new ZipException("压缩文件不合法,可能被损坏.");</span><br><span class="line">        }</span><br><span class="line">        //3.判断是否已加密</span><br><span class="line">        if (zFile.isEncrypted()) {</span><br><span class="line">            zFile.setPassword(password.toCharArray());</span><br><span class="line">        }</span><br><span class="line">        //4.解压所有文件</span><br><span class="line">        zFile.extractAll(dest);</span><br><span class="line">        List headerList = zFile.getFileHeaders();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">File</span>&gt;</span> extractedFileList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        for(Object object : headerList) {</span><br><span class="line">            FileHeader fileHeader = (FileHeader)object;</span><br><span class="line">            if (!fileHeader.isDirectory()) {</span><br><span class="line">                extractedFileList.add(new File(destDir,fileHeader.getFileName()));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        File [] extractedFiles = new File[extractedFileList.size()];</span><br><span class="line">        extractedFileList.toArray(extractedFiles);</span><br><span class="line">        return extractedFiles;</span><br><span class="line">    }</span><br><span class="line">    /**</span><br><span class="line">     * 解压无密码的zip压缩包到指定目录</span><br><span class="line">     * @param zipFile zip压缩包</span><br><span class="line">     * @param dest 指定解压文件夹位置</span><br><span class="line">     * @return 解压后的文件数组</span><br><span class="line">     */</span><br><span class="line">    public static File[] deCompress(File zipFile, String dest) throws ZipException {</span><br><span class="line">        try {</span><br><span class="line">            return deCompress(zipFile, dest, null);</span><br><span class="line">        } catch (ZipException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new ZipException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    /**</span><br><span class="line">     * 根据所给密码解压zip压缩包到指定目录</span><br><span class="line">     * @param zipFilePath zip压缩包绝对路径</span><br><span class="line">     * @param dest 指定解压文件夹位置</span><br><span class="line">     * @param password 压缩包密码</span><br><span class="line">     * @return 解压后的所有文件数组</span><br><span class="line">     */</span><br><span class="line">    public static File[] deCompress(String zipFilePath, String dest, String password) throws ZipException {</span><br><span class="line">        try {</span><br><span class="line">            return deCompress(new File(zipFilePath), dest, password);</span><br><span class="line">        } catch (ZipException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new ZipException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    /**</span><br><span class="line">     * 无密码解压压缩包到指定目录</span><br><span class="line">     * @param zipFilePath zip压缩包绝对路径</span><br><span class="line">     * @param dest 指定解压文件夹位置</span><br><span class="line">     * @return 解压后的所有文件数组</span><br><span class="line">     */</span><br><span class="line">    public static File[] deCompress(String zipFilePath, String dest) throws ZipException {</span><br><span class="line">        try {</span><br><span class="line">            return deCompress(new File(zipFilePath), dest, null);</span><br><span class="line">        } catch (ZipException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new ZipException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>压缩无密码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 压缩无密码() {</span><br><span class="line">    String file1 = "D:\\test\\unzip\\333\\123.txt";</span><br><span class="line">    String file2 = "D:\\test\\unzip\\333\\456.txt";</span><br><span class="line">    String file3 = "D:\\test\\unzip\\333\\789.txt";</span><br><span class="line">    String file4 = "D:\\test\\unzip\\333\\789 - 副本.txt";</span><br><span class="line">    //压缩后的zip文件路径</span><br><span class="line">    String zipFilePath1 = "D:\\test\\unzip\\5555.zip";</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(Zip4jUtil.compress(zipFilePath1,null,file1,file2,file3,file4));</span><br><span class="line">    } catch (ZipException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>压缩有密码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 压缩有密码() {</span><br><span class="line">    String file1 = "D:\\test\\unzip\\333\\123.txt";</span><br><span class="line">    String file2 = "D:\\test\\unzip\\333\\456.txt";</span><br><span class="line">    String file3 = "D:\\test\\unzip\\333\\789.txt";</span><br><span class="line">    //压缩后的zip文件路径</span><br><span class="line">    String zipFilePath2 = "D:\\test\\unzip\\6666.zip";</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(Zip4jUtil.compress(zipFilePath2,"123",file1,file2,file3));</span><br><span class="line">    } catch (ZipException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>解压无密码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 解压无密码() {</span><br><span class="line">    String zipFilePath1 = "D:\\test\\unzip\\5555.zip";</span><br><span class="line">    File[] files = new File[0];</span><br><span class="line">    try {</span><br><span class="line">        files = Zip4jUtil.deCompress(zipFilePath1, "D:\\test\\unzip\\5555");</span><br><span class="line">    } catch (ZipException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">    if(files != null){</span><br><span class="line">        System.out.println(files.length);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>解压有密码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 解压有密码() {</span><br><span class="line">    String zipFilePath1 = "D:\\test\\unzip\\6666.zip";</span><br><span class="line">    File[] files = new File[0];</span><br><span class="line">    try {</span><br><span class="line">        files = Zip4jUtil.deCompress(zipFilePath1, "D:\\test\\unzip\\6666", "123");</span><br><span class="line">    } catch (ZipException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">    if(files != null){</span><br><span class="line">        System.out.println(files.length);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Zip</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之动态添加组件</title>
    <url>/2021/03/1614738290477/1614738290477/</url>
    <content><![CDATA[<p>本例主要是构建动态模板，采用VBox模式，<br>效果如下：<br><img src="/2021/03/1614738290477/1614738290477/20210303103350.png" alt="20210303103350"><br>按钮操作 - 添加栏位<br><img src="/2021/03/1614738290477/1614738290477/20210303103536.png" alt="20210303103536"><br>按钮操作 - 上移<br><img src="/2021/03/1614738290477/1614738290477/20210303103643.png" alt="20210303103643"><br>按钮操作 - 下移<br><img src="/2021/03/1614738290477/1614738290477/20210303103713.png" alt="20210303103713"></p>
<p>按钮添加鼠标事件setOnMouseClicked</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Button addBtn = new Button("添加栏位");</span><br><span class="line">addBtn.setOnMouseClicked(addBtnMouseClicked());</span><br><span class="line">Button upBtn = new Button("上移");</span><br><span class="line">upBtn.setOnMouseClicked(upBtnMouseClicked());</span><br><span class="line">Button downBtn = new Button("下移");</span><br><span class="line">downBtn.setOnMouseClicked(downBtnMouseClicked());</span><br></pre></td></tr></tbody></table></figure></div>

<p>将内容面板content添加到滚动面板</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ScrollPane scrollPane = new ScrollPane(content);</span><br><span class="line">scrollPane.setPannable(true);</span><br><span class="line">scrollPane.setStyle("-fx-background-color: #FFF;");</span><br><span class="line">BorderPane.setAlignment(scrollPane,Pos.CENTER);</span><br></pre></td></tr></tbody></table></figure></div>

<p>寻找面板上的组件，只有类型对应，强转也无报错</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> templateAttrChildren = content.getChildren();</span><br><span class="line">if (templateAttrChildren != null &amp;&amp; templateAttrChildren.size() &gt; 0) {</span><br><span class="line">    for (Node node : templateAttrChildren) {</span><br><span class="line">        CheckBox attrFieldCheckbox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">        System.out.println(attrFieldCheckbox.getUserData());</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>移动操作：先获取当前组件对象，通过原始位置index进行remove，在进行位置add</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">上移：当移到最上层时index=1</span><br><span class="line">HBox hBox = (HBox) content.lookup("#" + checkBox.getParent().getId());</span><br><span class="line">int index = content.getChildren().indexOf(hBox);</span><br><span class="line">if (index &gt; 0) {</span><br><span class="line">    content.getChildren().remove(index);</span><br><span class="line">    content.getChildren().add(index - 1, hBox);</span><br><span class="line">}</span><br><span class="line">下移：当移到最下层时index=最大值</span><br><span class="line">HBox hBox = (HBox) content.lookup("#" + checkBox.getParent().getId());</span><br><span class="line">int index = content.getChildren().indexOf(hBox);</span><br><span class="line">if (index <span class="tag">&lt; <span class="attr">content.getChildren</span>()<span class="attr">.size</span>() <span class="attr">-</span> <span class="attr">1</span>) {</span></span><br><span class="line"><span class="tag">    <span class="attr">content.getChildren</span>()<span class="attr">.remove</span>(<span class="attr">index</span>);</span></span><br><span class="line"><span class="tag">    <span class="attr">content.getChildren</span>()<span class="attr">.add</span>(<span class="attr">index</span> + <span class="attr">1</span>, <span class="attr">hBox</span>);</span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>事件EventHandler</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">private EventHandler<span class="tag">&lt;<span class="name">MouseEvent</span>&gt;</span> btnMouseClicked(){</span><br><span class="line">    return event -&gt; {</span><br><span class="line">        System.out.println("事件执行");</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>完整代码</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package sample;</span><br><span class="line"></span><br><span class="line">import javafx.application.Application;</span><br><span class="line">import javafx.collections.FXCollections;</span><br><span class="line">import javafx.collections.ObservableList;</span><br><span class="line">import javafx.event.EventHandler;</span><br><span class="line">import javafx.geometry.Insets;</span><br><span class="line">import javafx.geometry.Pos;</span><br><span class="line">import javafx.scene.Node;</span><br><span class="line">import javafx.scene.Scene;</span><br><span class="line">import javafx.scene.control.*;</span><br><span class="line">import javafx.scene.input.MouseEvent;</span><br><span class="line">import javafx.scene.layout.BorderPane;</span><br><span class="line">import javafx.scene.layout.HBox;</span><br><span class="line">import javafx.scene.layout.StackPane;</span><br><span class="line">import javafx.scene.layout.VBox;</span><br><span class="line">import javafx.stage.Stage;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: VBox动态添加组件</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> * @Date: 2021/3/2 16:16</span><br><span class="line"> */</span><br><span class="line">public class 动态添加组件 extends Application {</span><br><span class="line"></span><br><span class="line">    private static VBox content = new VBox();</span><br><span class="line">    private static String[] attrType = new String[]{"常量", "变量"};</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">        launch(args);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void start(Stage primaryStage) {</span><br><span class="line">        // Center - 动态内容</span><br><span class="line">        content.setAlignment(Pos.TOP_CENTER);</span><br><span class="line">        content.setSpacing(3);</span><br><span class="line">        // 加载初始数据</span><br><span class="line">        getContentHbox(new AttributeVo().setAttrId("123456").setAttrName("测试1").setAttrType(0).setAttrValue("123"));</span><br><span class="line">        getContentHbox(new AttributeVo().setAttrId("345678").setAttrName("测试2").setAttrType(1).setAttrValue("321"));</span><br><span class="line"></span><br><span class="line">        // 初始化</span><br><span class="line">        BorderPane borderPane = new BorderPane();</span><br><span class="line">        borderPane.setPadding(new Insets(15,8,15,8));</span><br><span class="line">        // Top</span><br><span class="line">        VBox topVbox = new VBox();</span><br><span class="line">        Label title = new Label("栏位列表");</span><br><span class="line">        topVbox.getChildren().add(title);</span><br><span class="line">        borderPane.setTop(topVbox);</span><br><span class="line">        // Center</span><br><span class="line">        borderPane.setCenter(getCenterPane());</span><br><span class="line">        // Bottom</span><br><span class="line">        HBox bottomHbox = new HBox();</span><br><span class="line">        bottomHbox.setAlignment(Pos.CENTER);</span><br><span class="line">        Button saveBtn = new Button("保存");</span><br><span class="line">        saveBtn.setOnMouseClicked(saveBtnMouseClicked());</span><br><span class="line">        bottomHbox.getChildren().add(saveBtn);</span><br><span class="line">        borderPane.setBottom(bottomHbox);</span><br><span class="line">        // 将内容添加到主面板</span><br><span class="line">        StackPane root = new StackPane();</span><br><span class="line">        root.getChildren().add(borderPane);</span><br><span class="line">        primaryStage.setScene(new Scene(root, 800, 600));</span><br><span class="line">        primaryStage.setResizable(false);</span><br><span class="line">        primaryStage.show();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private BorderPane getCenterPane(){</span><br><span class="line">        BorderPane borderPane = new BorderPane();</span><br><span class="line">        // Top - 按钮</span><br><span class="line">        HBox topBox = new HBox();</span><br><span class="line">        topBox.setAlignment(Pos.CENTER_RIGHT);</span><br><span class="line">        topBox.setPadding(new Insets(0,5,5,0));</span><br><span class="line">        topBox.setSpacing(10);</span><br><span class="line">        Button addBtn = new Button("添加栏位");</span><br><span class="line">        addBtn.setOnMouseClicked(addBtnMouseClicked());</span><br><span class="line">        Button upBtn = new Button("上移");</span><br><span class="line">        upBtn.setOnMouseClicked(upBtnMouseClicked());</span><br><span class="line">        Button downBtn = new Button("下移");</span><br><span class="line">        downBtn.setOnMouseClicked(downBtnMouseClicked());</span><br><span class="line">        topBox.getChildren().addAll(addBtn,upBtn,downBtn);</span><br><span class="line">        borderPane.setTop(topBox);</span><br><span class="line">        // Center - 表格内容</span><br><span class="line">        borderPane.setCenter(getContent());</span><br><span class="line">        return borderPane;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private BorderPane getContent(){</span><br><span class="line">        System.out.println("添加初始化内容");</span><br><span class="line">        BorderPane borderPane = new BorderPane();</span><br><span class="line">        // Top - 栏位列表</span><br><span class="line">        HBox hBox = new HBox();</span><br><span class="line">        hBox.setAlignment(Pos.CENTER_LEFT);</span><br><span class="line">        hBox.setPrefHeight(30.0);</span><br><span class="line">        hBox.setSpacing(5);</span><br><span class="line">        Label label1 = new Label("栏位名称");</span><br><span class="line">        label1.setPrefWidth(220);</span><br><span class="line">        label1.setAlignment(Pos.CENTER);</span><br><span class="line">        Label label2 = new Label("栏位类型");</span><br><span class="line">        label2.setPrefWidth(100);</span><br><span class="line">        label2.setAlignment(Pos.CENTER);</span><br><span class="line">        Label label3 = new Label("栏位数值");</span><br><span class="line">        label3.setPrefWidth(350);</span><br><span class="line">        label3.setAlignment(Pos.CENTER);</span><br><span class="line">        hBox.getChildren().addAll(label1,label2,label3);</span><br><span class="line">        borderPane.setTop(hBox);</span><br><span class="line">        // 将内容添加到滚动面板</span><br><span class="line">        ScrollPane scrollPane = new ScrollPane(content);</span><br><span class="line">        scrollPane.setPannable(true);</span><br><span class="line">        scrollPane.setStyle("-fx-background-color: #FFF;");</span><br><span class="line">        BorderPane.setAlignment(scrollPane,Pos.CENTER);</span><br><span class="line"></span><br><span class="line">        borderPane.setCenter(scrollPane);</span><br><span class="line">        return borderPane;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 按钮事件 - 添加栏位</span><br><span class="line">     */</span><br><span class="line">    private EventHandler<span class="tag">&lt;<span class="name">MouseEvent</span>&gt;</span> addBtnMouseClicked(){</span><br><span class="line">        return event -&gt; {</span><br><span class="line">            //添加栏位</span><br><span class="line">            getContentHbox(new AttributeVo().setAttrId(UUID.randomUUID().toString()).setAttrType(0));</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 动态区域操作</span><br><span class="line">     * @param attributeVo 参数</span><br><span class="line">     */</span><br><span class="line">    private void getContentHbox(AttributeVo attributeVo){</span><br><span class="line">        System.out.println("添加ID:"+attributeVo.getAttrId());</span><br><span class="line">        HBox hBox = new HBox(5);</span><br><span class="line">        hBox.setId(UUID.randomUUID().toString());</span><br><span class="line">        hBox.setAlignment(Pos.CENTER_LEFT);</span><br><span class="line">        //栏位选取</span><br><span class="line">        CheckBox attrFieldCheckbox = new CheckBox();</span><br><span class="line">        attrFieldCheckbox.setId("attrFieldCheckbox");</span><br><span class="line">        attrFieldCheckbox.setUserData(attributeVo.getAttrId());</span><br><span class="line">        attrFieldCheckbox.setMaxWidth(30);</span><br><span class="line">        attrFieldCheckbox.setOnAction(event -&gt; {</span><br><span class="line">            if (attrFieldCheckbox.isSelected()) {</span><br><span class="line">                ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> contentChildren = content.getChildren();</span><br><span class="line">                if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) {</span><br><span class="line">                    for (Node node : contentChildren) {</span><br><span class="line">                        CheckBox checkBox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">                        checkBox.setSelected(false);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                attrFieldCheckbox.setSelected(true);</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        //栏位名称</span><br><span class="line">        TextField attrName = new TextField(attributeVo.getAttrName());</span><br><span class="line">        attrName.setId("attrName");</span><br><span class="line">        attrName.setPrefWidth(200);</span><br><span class="line">        //栏位类型</span><br><span class="line">        ComboBox attrTypeComboBox = new ComboBox();</span><br><span class="line">        attrTypeComboBox.setId("attrTypeComboBox");</span><br><span class="line">        attrTypeComboBox.setPrefWidth(100);</span><br><span class="line">        attrTypeComboBox.setItems(FXCollections.observableArrayList(attrType));</span><br><span class="line">        attrTypeComboBox.getSelectionModel().select(attributeVo.getAttrType());</span><br><span class="line">        //栏位数组</span><br><span class="line">        TextField attrValue = new TextField(attributeVo.getAttrValue());</span><br><span class="line">        attrValue.setId("attrValue");</span><br><span class="line">        attrValue.setPrefWidth(350);</span><br><span class="line">        //操作按钮</span><br><span class="line">        Button delBtn = new Button("删除");</span><br><span class="line">        delBtn.setMaxWidth(50);</span><br><span class="line">        delBtn.setOnMouseClicked(event1 -&gt; content.getChildren().removeAll(hBox));</span><br><span class="line">        // 添加组件到hBox</span><br><span class="line">        hBox.getChildren().addAll(attrFieldCheckbox,attrName,attrTypeComboBox,attrValue,delBtn);</span><br><span class="line">        // 将hBox添加到内容面板</span><br><span class="line">        content.getChildren().add(content.getChildren().size(), hBox);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 按钮事件 - 上移栏位</span><br><span class="line">     */</span><br><span class="line">    private EventHandler<span class="tag">&lt;<span class="name">MouseEvent</span>&gt;</span> upBtnMouseClicked(){</span><br><span class="line">        return event -&gt; {</span><br><span class="line">            ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> contentChildren = content.getChildren();</span><br><span class="line">            if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) {</span><br><span class="line">                for (Node node : contentChildren) {</span><br><span class="line">                    CheckBox checkBox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">                    if (checkBox.isSelected()) {</span><br><span class="line">                        HBox hBox = (HBox) content.lookup("#" + checkBox.getParent().getId());</span><br><span class="line">                        int index = content.getChildren().indexOf(hBox);</span><br><span class="line">                        if (index &gt; 0) {</span><br><span class="line">                            content.getChildren().remove(index);</span><br><span class="line">                            content.getChildren().add(index - 1, hBox);</span><br><span class="line">                        }</span><br><span class="line">                        break;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 按钮事件 - 下移栏位</span><br><span class="line">     */</span><br><span class="line">    private EventHandler<span class="tag">&lt;<span class="name">MouseEvent</span>&gt;</span> downBtnMouseClicked(){</span><br><span class="line">        return event -&gt; {</span><br><span class="line">            ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> contentChildren = content.getChildren();</span><br><span class="line">            if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) {</span><br><span class="line">                for (Node node : contentChildren) {</span><br><span class="line">                    CheckBox checkBox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">                    if (checkBox.isSelected()) {</span><br><span class="line">                        HBox hBox = (HBox) content.lookup("#" + checkBox.getParent().getId());</span><br><span class="line">                        int index = content.getChildren().indexOf(hBox);</span><br><span class="line">                        if (index <span class="tag">&lt; <span class="attr">content.getChildren</span>()<span class="attr">.size</span>() <span class="attr">-</span> <span class="attr">1</span>) {</span></span><br><span class="line"><span class="tag">                            <span class="attr">content.getChildren</span>()<span class="attr">.remove</span>(<span class="attr">index</span>);</span></span><br><span class="line"><span class="tag">                            <span class="attr">content.getChildren</span>()<span class="attr">.add</span>(<span class="attr">index</span> + <span class="attr">1</span>, <span class="attr">hBox</span>);</span></span><br><span class="line"><span class="tag">                        }</span></span><br><span class="line"><span class="tag">                        <span class="attr">break</span>;</span></span><br><span class="line"><span class="tag">                    }</span></span><br><span class="line"><span class="tag">                }</span></span><br><span class="line"><span class="tag">            }</span></span><br><span class="line"><span class="tag">        };</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 按钮事件 <span class="attr">-</span> 保存栏位</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line">    private EventHandler&lt;MouseEvent&gt; saveBtnMouseClicked(){</span><br><span class="line">        return event -&gt; {</span><br><span class="line">            List<span class="tag">&lt;<span class="name">AttributeVo</span>&gt;</span> attributeVoList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            //模板栏位</span><br><span class="line">            ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> contentChildren = content.getChildren();</span><br><span class="line">            if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) {</span><br><span class="line">                for (Node node : contentChildren) {</span><br><span class="line">                    // 获取值</span><br><span class="line">                    CheckBox attrFieldCheckbox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">                    TextField attrName = (TextField) node.lookup("#attrName");</span><br><span class="line">                    ComboBox attrTypeComboBox = (ComboBox) node.lookup("#attrTypeComboBox");</span><br><span class="line">                    TextField attrValue = (TextField) node.lookup("#attrValue");</span><br><span class="line">                    // 赋值</span><br><span class="line">                    AttributeVo attributeVo = new AttributeVo();</span><br><span class="line">                    attributeVo.setAttrId(String.valueOf(attrFieldCheckbox.getUserData()));</span><br><span class="line">                    attributeVo.setAttrName(attrName.getText());</span><br><span class="line">                    attributeVo.setAttrType(attrTypeComboBox.getSelectionModel().getSelectedIndex());</span><br><span class="line">                    attributeVo.setAttrValue(attrValue.getText());</span><br><span class="line">                    attributeVoList.add(attributeVo);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            System.out.println(attributeVoList);</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 虚拟实体类</span><br><span class="line"> */</span><br><span class="line">class AttributeVo {</span><br><span class="line">    private String attrId;</span><br><span class="line">    private String attrName;</span><br><span class="line">    private int attrType;</span><br><span class="line">    private String attrValue;</span><br><span class="line"></span><br><span class="line">    public String getAttrId() {</span><br><span class="line">        return attrId;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public AttributeVo setAttrId(String attrId) {</span><br><span class="line">        this.attrId = attrId;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getAttrName() {</span><br><span class="line">        return attrName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public AttributeVo setAttrName(String attrName) {</span><br><span class="line">        this.attrName = attrName;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public int getAttrType() {</span><br><span class="line">        return attrType;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public AttributeVo setAttrType(int attrType) {</span><br><span class="line">        this.attrType = attrType;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getAttrValue() {</span><br><span class="line">        return attrValue;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public AttributeVo setAttrValue(String attrValue) {</span><br><span class="line">        this.attrValue = attrValue;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() {</span><br><span class="line">        return "AttributeVo{" +</span><br><span class="line">                "attrId='" + attrId + '\'' +</span><br><span class="line">                ", attrName='" + attrName + '\'' +</span><br><span class="line">                ", attrType=" + attrType +</span><br><span class="line">                ", attrValue='" + attrValue + '\'' +</span><br><span class="line">                '}';</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>VBox</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之CheckBox变成单选模式</title>
    <url>/2021/03/1614740320445/1614740320445/</url>
    <content><![CDATA[<p>CheckBox：复选框模式</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">CheckBox checkBox = new CheckBox();</span><br><span class="line">checkBox.setId("checkBox");</span><br><span class="line">checkBox.setUserData("1234");</span><br><span class="line">checkBox.setMaxWidth(30);</span><br><span class="line">checkBox.setOnAction(event -&gt; {</span><br><span class="line">    if (checkBox.isSelected()) {</span><br><span class="line">        checkBox.setSelected(true);</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div>
<p>CheckBox：单选框模式，将其他选中的情况变成false</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">CheckBox checkBox = new CheckBox();</span><br><span class="line">checkBox.setId("checkBox");</span><br><span class="line">checkBox.setUserData("1234");</span><br><span class="line">checkBox.setMaxWidth(30);</span><br><span class="line">checkBox.setOnAction(event -&gt; {</span><br><span class="line">    if (checkBox.isSelected()) {</span><br><span class="line">        ObservableList<span class="tag">&lt;<span class="name">Node</span>&gt;</span> contentChildren = content.getChildren();</span><br><span class="line">        if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) {</span><br><span class="line">            for (Node node : contentChildren) {</span><br><span class="line">                CheckBox checkBox = (CheckBox) node.lookup("#attrFieldCheckbox");</span><br><span class="line">                checkBox.setSelected(false);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        checkBox.setSelected(true);</span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="/2021/03/1614738290477/1614738290477/">示例应用</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>CheckBox</tag>
      </tags>
  </entry>
  <entry>
    <title>解决SpringBoot2.x的跨域请求问题,开启跨域</title>
    <url>/2021/03/1614825070134/1614825070134/</url>
    <content><![CDATA[<p>请求错误描述：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">When allowCredentials is true, allowedOrigins cannot contain the special value "*“since </span><br><span class="line">that cannot be set on the “Access-Control-Allow-Origin” response header. </span><br><span class="line">To allow credentials to a set of origins, list them explicitly or consider using"allowedOriginPatterns” instead.</span><br></pre></td></tr></tbody></table></figure></div>

<p>SpringBoot2.3.x</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) {</span><br><span class="line">        registry</span><br><span class="line">                // 设置允许跨域的路由</span><br><span class="line">                .addMapping("/**")</span><br><span class="line">                // 设置允许跨域请求的域名</span><br><span class="line">                .allowedOrigins("*")</span><br><span class="line">                // 是否允许证书（cookies）</span><br><span class="line">                .allowCredentials(true)</span><br><span class="line">                // 设置允许的方法</span><br><span class="line">                .allowedMethods("GET", "POST", "DELETE", "PUT")</span><br><span class="line">                // 跨域允许时间</span><br><span class="line">                .maxAge(3600);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>SpringBoot2.4.x</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class WebMvcConfig implements WebMvcConfigurer {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) {</span><br><span class="line">        registry</span><br><span class="line">                // 设置允许跨域的路由</span><br><span class="line">                .addMapping("/**")</span><br><span class="line">                // 设置允许跨域请求的域名</span><br><span class="line">                .allowedOriginPatterns("*")</span><br><span class="line">                // 是否允许证书（cookies）</span><br><span class="line">                .allowCredentials(true)</span><br><span class="line">                // 设置允许的方法</span><br><span class="line">                .allowedMethods("GET", "POST", "DELETE", "PUT")</span><br><span class="line">                // 跨域允许时间</span><br><span class="line">                .maxAge(3600);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 MultipartFile[] 做多文件上传的功能</title>
    <url>/2021/03/1614764345833/1614764345833/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>yml配置上传文件的限制</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  servlet:</span><br><span class="line">    # 上传文件设置</span><br><span class="line">    multipart:</span><br><span class="line">      enabled: true</span><br><span class="line">      # 默认为 1MB</span><br><span class="line">      max-file-size: 100MB</span><br><span class="line">      # 默认为 10MB</span><br><span class="line">      max-request-size: 500MB</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p>文件属性名： name = file<br>参数非必传：required = false</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@PostMapping(value = "/upload",consumes="multipart/form-data")</span><br><span class="line">public String fileUpload(@RequestParam(value = "file",required = false) MultipartFile[] multipartFiles,</span><br><span class="line">                         @RequestParam(value = "username",required = false)String username,</span><br><span class="line">                         @RequestParam(value = "password",required = false)String password) throws IOException{</span><br><span class="line">    List&lt;Map&lt;String,Object&gt;&gt; fileList = new ArrayList&lt;&gt;();</span><br><span class="line">    for (MultipartFile multipartFile : multipartFiles) {</span><br><span class="line">        String fileName = multipartFile.getOriginalFilename();</span><br><span class="line">        assert fileName != null;</span><br><span class="line">        byte[] bytes = multipartFile.getBytes();</span><br><span class="line">        String fileExt = FilenameUtils.getExtension(fileName);</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        map.put("fileName",fileName);</span><br><span class="line">        map.put("fileExt",fileExt);</span><br><span class="line">        map.put("fileSize",bytes.length);</span><br><span class="line">        map.put("username",username);</span><br><span class="line">        map.put("password",password);</span><br><span class="line">        //转存，不需要进行IO流关闭处理</span><br><span class="line">        multipartFile.transferTo(new File("D:/dest.txt"));</span><br><span class="line">        fileList.add(map);</span><br><span class="line">    }</span><br><span class="line">    return JSON.toJSONString(fileList);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="请求示例"><a href="#请求示例" class="headerlink" title="请求示例"></a>请求示例</h3><ul>
<li><p>Java模拟请求</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void 多文件上传() {</span><br><span class="line">    File file1 = new File("D:\\test\\1234.xlsx");</span><br><span class="line">    File file2 = new File("D:\\test\\5678.xlsx");</span><br><span class="line">    String url = "https://www.zhuqiaolun.com/weixinz/api/test/upload";</span><br><span class="line">    HttpHeaders headers = new HttpHeaders();</span><br><span class="line">    headers.set("Content-Type", "multipart/form-data");</span><br><span class="line">    MultiValueMap<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> params = new LinkedMultiValueMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    params.add("file", new FileSystemResource(file1));</span><br><span class="line">    params.add("file", new FileSystemResource(file2));</span><br><span class="line">    params.add("username","admin");</span><br><span class="line">    params.add("password","123456");</span><br><span class="line">    HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers);</span><br><span class="line">    ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> responseEntity = restTemplate.postForEntity(url, httpEntity, String.class);</span><br><span class="line">    System.out.println(responseEntity.getStatusCodeValue());</span><br><span class="line">    System.out.println(responseEntity.getBody());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>Form表单提交</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>多文件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"https://www.zhuqiaolun.com/weixinz/api/test/upload"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"moreFile"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"admin"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>Ajax表单提交</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>多文件上传<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"moreFileForm"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"用户名"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"admin"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">"密码"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">onclick</span>=<span class="string">"moreFileSub()"</span>&gt;</span>ajax上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"result"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://libs.baidu.com/jquery/2.1.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">moreFileSub</span><span class="params">()</span></span>{</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData($(<span class="string">"#moreFileForm"</span>)[<span class="number">0</span>]);</span></span><br><span class="line"><span class="javascript">    $.ajax({</span></span><br><span class="line"><span class="actionscript">        url : <span class="string">"https://www.zhuqiaolun.com/weixinz/api/test/upload"</span>,</span></span><br><span class="line"><span class="actionscript">        type : <span class="string">'POST'</span>,</span></span><br><span class="line">        data : formData,</span><br><span class="line"><span class="actionscript">        <span class="comment">// 告诉jQuery不要去处理发送的数据</span></span></span><br><span class="line"><span class="actionscript">        processData : <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 告诉jQuery不要去设置Content-Type请求头</span></span></span><br><span class="line"><span class="actionscript">        contentType : <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> : <span class="literal">false</span>,</span></span><br><span class="line"><span class="actionscript">        dataType : <span class="string">"json"</span>,</span></span><br><span class="line"><span class="actionscript">        success : <span class="function"><span class="keyword">function</span><span class="params">(result)</span> </span>{</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(result);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#result"</span>).text(<span class="built_in">JSON</span>.stringify(result))</span></span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>查看Jar包的JDK版本</title>
    <url>/2021/03/1615358998628/1615358998628/</url>
    <content><![CDATA[<h3 id="通过版本"><a href="#通过版本" class="headerlink" title="通过版本"></a>通过版本</h3><p>通常在使用Java程序时，需要对JDK版本进行核对，JDK构建版本不等于执行的运行版本，需要通过执行类来辨别</p>
<ul>
<li><p>通过反编译工具jd-gui查看清单文件(此处版本为maven打包的版本)<br><img src="/2021/03/1615358998628/1615358998628/20210310150822.png" alt="20210310150822"></p>
</li>
<li><p>通过编译的class文件来查看文件信息(此处版本为class文件的版本)<br><img src="/2021/03/1615358998628/1615358998628/20210310151415.png" alt="20210310151415"></p>
</li>
</ul>
<h3 id="通过十六进制"><a href="#通过十六进制" class="headerlink" title="通过十六进制"></a>通过十六进制</h3><ul>
<li>Notepad++<br>在 Notepad++ 中添加插件：HEX-Editor，点击安装后自动重启<br>需要以十六进制显示时，点击菜单的：【插件】－【Hex-Editor】－【View in Hex】即可<br><img src="/2021/03/1615358998628/1615358998628/20210310154106.png" alt="20210310154106"><br>只看第一行数据，前面8个字节 CA FE BA BE 是固定的，<br>后4个字节 00 00 是次版本号，次版本号后面的4个字节 00 33 是jdk的版本号，如这里 00 34 则表示jdk的版本是1.8</li>
</ul>
<h3 id="版本查看"><a href="#版本查看" class="headerlink" title="版本查看"></a>版本查看</h3><p>以下为各个JDK版本对应的数值</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">J2SE 8.0 = 52(0x34 hex)</span><br><span class="line">J2SE 7.0 = 51(0x33 hex)</span><br><span class="line">J2SE 6.0 = 50 (0x32 hex)</span><br><span class="line">J2SE 5.0 = 49 (0x31 hex)</span><br><span class="line">JDK 1.4 = 48 (0x30 hex)</span><br><span class="line">JDK 1.3 = 47 (0x2F hex)</span><br><span class="line">JDK 1.2 = 46 (0x2E hex)</span><br><span class="line">JDK 1.1 = 45 (0x2D hex)</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot的RestTemplate的使用</title>
    <url>/2021/03/1614741214844/1614741214844/</url>
    <content><![CDATA[<p><a href="/2020/06/1592881660483/1592881660483/">RestTemplate配置</a></p>
<h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><ul>
<li>设置<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">HttpHeaders headers = new HttpHeaders();</span><br><span class="line">// Text</span><br><span class="line">headers.set("Content-Type", "application/json;charset=UTF-8");</span><br><span class="line">// File</span><br><span class="line">headers.set("Content-Type", "multipart/form-data");</span><br><span class="line">// Form</span><br><span class="line">headers.set("Content-Type", "application/x-www-form-urlencoded");</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h3 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h3><ul>
<li>query<br>eg：<br><a href="https://www.zhuqiaolun.com/weixinz/api/test/get?username=demon&amp;password=123456">https://www.zhuqiaolun.com/weixinz/api/test/get?username=demon&amp;password=123456</a><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">//将请求头部和参数合成一个请求</span><br><span class="line">UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url);</span><br><span class="line">builder.queryParam("username",username);</span><br><span class="line">builder.queryParam("password",password);</span><br><span class="line">//将请求头部和参数合成一个请求</span><br><span class="line">HttpEntity<span class="php"><span class="meta">&lt;?</span>&gt; httpEntity = <span class="keyword">new</span> HttpEntity&lt;&gt;(headers);</span></span><br><span class="line"><span class="php">restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String<span class="class">.<span class="keyword">class</span>);</span></span></span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h3 id="Post"><a href="#Post" class="headerlink" title="Post"></a>Post</h3><p>eg：<br><a href="https://www.zhuqiaolun.com/weixinz/api/test/post?username=demon&amp;password=123456">https://www.zhuqiaolun.com/weixinz/api/test/post?username=demon&amp;password=123456</a><br>body：{“username”:”demon”}</p>
<ul>
<li><p>application/json</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">JsonNodeFactory jsonNodeFactory = JsonNodeFactory.instance;</span><br><span class="line">ObjectNode params = jsonNodeFactory.objectNode();</span><br><span class="line">{</span><br><span class="line">    params.put("username", username);</span><br><span class="line">    params.put("password", password);</span><br><span class="line">}</span><br><span class="line">//将请求头部和参数合成一个请求</span><br><span class="line">System.out.println(params.toString());</span><br><span class="line">HttpEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> httpEntity = new HttpEntity<span class="tag">&lt;&gt;</span>(params.toString(), headers);</span><br><span class="line">restTemplate.postForEntity(url, httpEntity, String.class);</span><br></pre></td></tr></tbody></table></figure></div></li>
<li><p>application/x-www-form-urlencoded</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">MultiValueMap<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> params = new LinkedMultiValueMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">params.add("username", username);</span><br><span class="line">params.add("password", password);</span><br><span class="line">HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers);</span><br><span class="line">return restTemplate.postForEntity(url, httpEntity, String.class);</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>multipart/form-data</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">MultiValueMap<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> params = new LinkedMultiValueMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">params.add("file", new org.springframework.core.io.FileSystemResource(new java.io.File("AAA")));</span><br><span class="line">HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers);</span><br><span class="line">restTemplate.postForEntity(url, httpEntity, String.class);</span><br></pre></td></tr></tbody></table></figure></div>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>RestTemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome谷歌浏览器：下载，插件安装</title>
    <url>/2021/03/1615363585427/1615363585427/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://www.google.cn/intl/zh-CN/chrome/" target="_blank" rel="noopener">谷歌浏览器</a>在线安装<br><a href="https://www.google.cn/intl/zh-CN/chrome?standalone=1" target="_blank" rel="noopener">谷歌离线浏览器</a>离线安装<br><img src="/2021/03/1615363585427/1615363585427/20210310161717.png" alt="20210310161717"></p>
<h3 id="离线版"><a href="#离线版" class="headerlink" title="离线版"></a>离线版</h3><h3 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h3><p><a href="https://chrome.zzzmh.cn/#ext" target="_blank" rel="noopener">极简插件</a><br><img src="/2021/03/1615363585427/1615363585427/20210310161745.png" alt="20210310161745"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>删除没用的本地Jar - maven的错误引入</title>
    <url>/2021/03/1615374410736/1615374410736/</url>
    <content><![CDATA[<p>有时候maven下载的jar不完整或者是错误，则此时需要删除多余的jar</p>
<p>引入依赖</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>完整代码</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Collection;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.io.FileUtils;</span><br><span class="line">import org.apache.commons.io.filefilter.DirectoryFileFilter;</span><br><span class="line">import org.apache.commons.io.filefilter.RegexFileFilter;</span><br><span class="line">import org.apache.commons.io.filefilter.TrueFileFilter;</span><br><span class="line"></span><br><span class="line">public class 删除没用的Jar {</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) {</span><br><span class="line"></span><br><span class="line">		System.out.println("执行开始···");</span><br><span class="line">		String filePath = "D:\\apache\\Repositories\\Maven";</span><br><span class="line">		deleteFile(filePath,true);</span><br><span class="line">		System.out.println();</span><br><span class="line">		deleteDir(filePath,true);</span><br><span class="line">		System.out.println("执行完成！！！");</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	private static void deleteFile(String filePath,boolean flag){</span><br><span class="line">		RegexFileFilter regexFileFilter = new RegexFileFilter(".*(lastUpdated).*");</span><br><span class="line">		Collection<span class="tag">&lt;<span class="name">File</span>&gt;</span> listFiles1 = FileUtils.listFiles(new File(filePath),regexFileFilter, DirectoryFileFilter.INSTANCE);</span><br><span class="line">		for (File file : listFiles1) {</span><br><span class="line">			try {</span><br><span class="line">				System.out.println(file.getCanonicalPath());</span><br><span class="line">				if(flag){</span><br><span class="line">					FileUtils.forceDelete(file);</span><br><span class="line">				}</span><br><span class="line">			} catch (IOException e) {</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	private static void deleteDir(String filePath,boolean flag){</span><br><span class="line">		Collection<span class="tag">&lt;<span class="name">File</span>&gt;</span> listFiles1 = FileUtils.listFilesAndDirs(new File(filePath), TrueFileFilter.INSTANCE,DirectoryFileFilter.DIRECTORY);</span><br><span class="line">		for (File file : listFiles1) {</span><br><span class="line">			try {</span><br><span class="line">				if(file.isDirectory()){</span><br><span class="line">					if(file.getName().startsWith("$") || file.getName().startsWith("unknown") || file.getName().startsWith("error")){</span><br><span class="line">						System.out.println(file.getCanonicalPath());</span><br><span class="line">						if(flag){</span><br><span class="line">							FileUtils.forceDelete(file);</span><br><span class="line">						}</span><br><span class="line">					}</span><br><span class="line">				}</span><br><span class="line">			} catch (IOException e) {</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Maven</tag>
      </tags>
  </entry>
  <entry>
    <title>对MyBatis-Plus3.x的分页插件配置使用</title>
    <url>/2021/03/1615799438937/1615799438937/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>使用前的 <a href="/2021/04/1617878968965/1617878968965/">配置</a></p>
<p>MyBatis-Plus 是自带分页插件的Page，可用查询SQL并列使用<br><img src="/2021/03/1615799438937/1615799438937/20210315171503.png" alt="20210315171503"></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>xxMapper.xml：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getList"</span> <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultType</span>=<span class="string">"map"</span> &gt;</span></span><br><span class="line">    SELECT * FROM system_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>xxMapper.java：</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询列表信息(分页)</span><br><span class="line"> * @param page   分页标志</span><br><span class="line"> * @param params 参数</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">Page&lt;Map&lt;String, Object&gt;&gt; getList(IPage&lt;Map&lt;String, Object&gt;&gt; page, @Param("params") Map&lt;String, Object&gt; params);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询列表信息</span><br><span class="line"> * @param params 参数</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; getList(@Param("params") Map&lt;String,Object&gt; params);</span><br></pre></td></tr></tbody></table></figure>

<p>xxService.java:</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询列表信息(分页)</span><br><span class="line"> * @param current 每页数</span><br><span class="line"> * @param size 当前页</span><br><span class="line"> * @param map 参数</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">Page&lt;Map&lt;String, Object&gt;&gt; getListPage(long current, long size, Map&lt;String, Object&gt; map);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 查询列表信息</span><br><span class="line"> * @param map 参数</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; getList(Map&lt;String, Object&gt; map);</span><br></pre></td></tr></tbody></table></figure>

<p>xxServiceImpl.java:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public Page&lt;Map&lt;String, Object&gt;&gt; getListPage(long current, long size, Map&lt;String, Object&gt; map) {</span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; page = new Page&lt;&gt;(current, size);</span><br><span class="line">    return this.baseMapper.getList(page, map);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public List&lt;Map&lt;String,Object&gt;&gt; getList(Map&lt;String,Object&gt; map) {</span><br><span class="line">    return this.baseMapper.getList(map);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>xxController.java:</p>
<ul>
<li>已分页查询<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">long current = Long.parseLong(jsonParam.getString("current"));</span><br><span class="line">long size = Long.parseLong(jsonParam.getString("size"));</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">Page&lt;Map&lt;String, Object&gt;&gt; serviceListPage = systemService.getListPage(current,size,map);</span><br><span class="line">JSONObject jsonObject = ListUtil.getData(serviceListPage);</span><br><span class="line">System.out.println(jsonObject);</span><br></pre></td></tr></tbody></table></figure></div></li>
<li>不分页查询<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; serviceList = systemService.getJobList(map);</span><br><span class="line">System.out.println(serviceList);</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<p>ListUtil：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line">import java.util.Map;</span><br><span class="line">/**</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @description: 分页列表数据</span><br><span class="line"> */</span><br><span class="line">public class ListUtil {</span><br><span class="line"></span><br><span class="line">    public static JSONObject getData(Page&lt;Map&lt;String, Object&gt;&gt; listPage) {</span><br><span class="line">        JSONObject responseBean = new JSONObject(true);</span><br><span class="line">        //当前页码</span><br><span class="line">        responseBean.put("current", listPage.getCurrent());</span><br><span class="line">        //当前页条数</span><br><span class="line">        responseBean.put("size", listPage.getSize());</span><br><span class="line">        //总共条数</span><br><span class="line">        responseBean.put("total", listPage.getTotal());</span><br><span class="line">        //总共页数</span><br><span class="line">        responseBean.put("page", listPage.getPages());</span><br><span class="line">        //当前页数据</span><br><span class="line">        responseBean.put("data", listPage.getRecords());</span><br><span class="line">        //是否有上一页</span><br><span class="line">        responseBean.put("hasPrevious", listPage.hasPrevious());</span><br><span class="line">        //是否有下一页</span><br><span class="line">        responseBean.put("hasNext", listPage.hasNext());</span><br><span class="line">        return responseBean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>Java自定义异常 - EmptyException</title>
    <url>/2021/03/1615440974493/1615440974493/</url>
    <content><![CDATA[<p>作用：定义异常来生声明异常，保证程序可以准确捕获异常。</p>
<p>自定义异常继承类有3中：RuntimeException、Exception、Throwable<br>一般会选择继承Exception和RuntimeException，如果调用者一定要处理抛出的异常且没有要求，就继承RuntimeException。</p>
<p>定义异常</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2021/3/5 14:44</span><br><span class="line"> * @description: 空异常</span><br><span class="line"> */</span><br><span class="line">public class EmptyException extends RuntimeException {</span><br><span class="line"></span><br><span class="line">    private String code;</span><br><span class="line">    </span><br><span class="line">    public EmptyException(String code, String message) {</span><br><span class="line">        super(message);</span><br><span class="line">        this.code = code;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    public String getCode() {</span><br><span class="line">        return code;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    public void setCode(String code) {</span><br><span class="line">        this.code = code;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>使用异常</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">throw new EmptyException("40004", "参数不能为空");</span><br></pre></td></tr></tbody></table></figure></div>

<p>捕获异常</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">try {</span><br><span class="line">    System.out.println("业务处理···");</span><br><span class="line">}catch (EmptyException e){</span><br><span class="line">    System.out.println("捕获自定义异常···");</span><br><span class="line">    e.getCode();</span><br><span class="line">    e.getMessage();</span><br><span class="line">}catch (Exception e){</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    System.out.println("捕获抛出的异常···");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis返回多个结果集</title>
    <url>/2021/03/1615802317183/1615802317183/</url>
    <content><![CDATA[<p>MyBatis在查询时可以将单一的结果集并列查询组成多结果集；<br>如：多重List&lt;Map&lt;String,Object&gt;&gt;格式，Object可再次为 List&lt;Map&lt;String,Object&gt;&gt;结构</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        <span class="attr">"userName"</span>: <span class="string">"张三"</span>,</span><br><span class="line">        <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span>,</span><br><span class="line">        <span class="attr">"userRole"</span>: [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test1"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test2"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span></span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>xxMapper.xml：<br>xml中以userCode为连接，collection的property属性值为二级key</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"testResultMap"</span> <span class="attr">type</span>=<span class="string">"java.util.Map"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"userCode"</span> <span class="attr">column</span>=<span class="string">"user_Code"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userName"</span> <span class="attr">column</span>=<span class="string">"user_Name"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userRemark"</span> <span class="attr">column</span>=<span class="string">"user_Remark"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"userRole"</span> <span class="attr">javaType</span>=<span class="string">"list"</span> <span class="attr">ofType</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"roleCode"</span> <span class="attr">column</span>=<span class="string">"role_Code"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"userCode"</span> <span class="attr">column</span>=<span class="string">"user_Code"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleName"</span> <span class="attr">column</span>=<span class="string">"role_Name"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roleRemark"</span> <span class="attr">column</span>=<span class="string">"role_Remark"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectTestListResultMap"</span>  <span class="attr">parameterType</span>=<span class="string">"map"</span> <span class="attr">resultMap</span>=<span class="string">"testResultMap"</span>&gt;</span></span><br><span class="line">    SELECT</span><br><span class="line">    	test_user.user_Code,</span><br><span class="line">    	test_user.user_Name,</span><br><span class="line">    	test_user.user_Remark,</span><br><span class="line">    	test_role.role_Code,</span><br><span class="line">    	test_role.role_Name,</span><br><span class="line">    	test_role.role_Remark,</span><br><span class="line">    	test_role.user_Code</span><br><span class="line">    FROM</span><br><span class="line">    	test_user</span><br><span class="line">    LEFT JOIN test_role ON test_role.user_Code = test_user.user_Code</span><br><span class="line">    WHERE</span><br><span class="line">    	test_user.user_Code IN (</span><br><span class="line">    		SELECT</span><br><span class="line">    			test_role.user_Code</span><br><span class="line">    		FROM</span><br><span class="line">    			test_role</span><br><span class="line">    		WHERE</span><br><span class="line">    			test_role.user_Code = test_user.user_Code</span><br><span class="line">    		GROUP BY</span><br><span class="line">    			test_role.user_Code</span><br><span class="line">    	)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>xxMapper.java：</p>
<figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查询列表信息</span><br><span class="line"> * @param params 参数</span><br><span class="line"> * @return 返回</span><br><span class="line"> */</span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; selectTestListResultMap(@Param("params") Map&lt;String, Object&gt; params);</span><br></pre></td></tr></tbody></table></figure>

<p>结果集：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tbody><tr><td class="code"><pre><span class="line">[</span><br><span class="line">    {</span><br><span class="line">        <span class="attr">"userRemark"</span>: <span class="string">"备注用户"</span>,</span><br><span class="line">        <span class="attr">"userName"</span>: <span class="string">"张三"</span>,</span><br><span class="line">        <span class="attr">"userRole"</span>: [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test1"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"a"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test2"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"b"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span></span><br><span class="line">            }</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"userCode"</span>: <span class="string">"RBXLWCzGcqDncROd90Jd"</span></span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="attr">"userRemark"</span>: <span class="string">"备注用户"</span>,</span><br><span class="line">        <span class="attr">"userName"</span>: <span class="string">"李四"</span>,</span><br><span class="line">        <span class="attr">"userRole"</span>: [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test3"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"c"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"TALKA0I56vYUp2cVaczZ"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test4"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"d"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"TALKA0I56vYUp2cVaczZ"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test5"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"e"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"TALKA0I56vYUp2cVaczZ"</span></span><br><span class="line">            }</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"userCode"</span>: <span class="string">"TALKA0I56vYUp2cVaczZ"</span></span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">        <span class="attr">"userRemark"</span>: <span class="string">"备注用户"</span>,</span><br><span class="line">        <span class="attr">"userName"</span>: <span class="string">"王五"</span>,</span><br><span class="line">        <span class="attr">"userRole"</span>: [</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test6"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"f"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"EMbvTsuedRjItaD0aZzq"</span></span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                <span class="attr">"roleRemark"</span>: <span class="string">"备注权限"</span>,</span><br><span class="line">                <span class="attr">"roleCode"</span>: <span class="string">"test7"</span>,</span><br><span class="line">                <span class="attr">"roleName"</span>: <span class="string">"g"</span>,</span><br><span class="line">                <span class="attr">"userCode"</span>: <span class="string">"EMbvTsuedRjItaD0aZzq"</span></span><br><span class="line">            }</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"userCode"</span>: <span class="string">"EMbvTsuedRjItaD0aZzq"</span></span><br><span class="line">    }</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure></div>

<p>表：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for test_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `test_role`;</span><br><span class="line">CREATE TABLE `test_role` (</span><br><span class="line">  `tr_PKeyId` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键ID',</span><br><span class="line">  `role_Code` varchar(32) DEFAULT NULL COMMENT '角色代码',</span><br><span class="line">  `role_Name` varchar(32) DEFAULT NULL COMMENT '角色名称',</span><br><span class="line">  `user_Code` varchar(32) DEFAULT NULL COMMENT '用户代码',</span><br><span class="line">  `role_Remark` varchar(100) DEFAULT NULL COMMENT '备注',</span><br><span class="line">  PRIMARY KEY (`tr_PKeyId`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8 COMMENT='角色表';</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of test_role</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO `test_role` VALUES ('16', 'test1', 'a', 'RBXLWCzGcqDncROd90Jd', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('19', 'test2', 'b', 'RBXLWCzGcqDncROd90Jd', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('20', 'test3', 'c', 'TALKA0I56vYUp2cVaczZ', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('21', 'test4', 'd', 'TALKA0I56vYUp2cVaczZ', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('22', 'test5', 'e', 'TALKA0I56vYUp2cVaczZ', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('23', 'test6', 'f', 'EMbvTsuedRjItaD0aZzq', '备注权限');</span><br><span class="line">INSERT INTO `test_role` VALUES ('24', 'test7', 'g', 'EMbvTsuedRjItaD0aZzq', '备注权限');</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Table structure for test_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS `test_user`;</span><br><span class="line">CREATE TABLE `test_user` (</span><br><span class="line">  `tu_PKeyId` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键ID',</span><br><span class="line">  `user_Name` varchar(32) DEFAULT NULL COMMENT '用户名称',</span><br><span class="line">  `user_Code` varchar(32) DEFAULT NULL COMMENT '用户代码',</span><br><span class="line">  `user_Remark` varchar(100) DEFAULT NULL COMMENT '备注',</span><br><span class="line">  PRIMARY KEY (`tu_PKeyId`)</span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8 COMMENT='用户表';</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of test_user</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO `test_user` VALUES ('10', '张三', 'RBXLWCzGcqDncROd90Jd', '备注用户');</span><br><span class="line">INSERT INTO `test_user` VALUES ('11', '李四', 'TALKA0I56vYUp2cVaczZ', '备注用户');</span><br><span class="line">INSERT INTO `test_user` VALUES ('12', '王五', 'EMbvTsuedRjItaD0aZzq', '备注用户');</span><br><span class="line">INSERT INTO `test_user` VALUES ('13', '赵六', 'GosZVJuSCA70TmeRnBJO', '备注用户');</span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>MyBatis</tag>
      </tags>
  </entry>
  <entry>
    <title>WebService客户端请求</title>
    <url>/2021/03/1617084469964/1617084469964/</url>
    <content><![CDATA[<p>本文采用 axis的调用方式 <a href="http://axis.apache.org/axis2/java/core/docs/spring.html" target="_blank" rel="noopener">官网</a></p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- axis webService client start --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.axis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>axis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.axis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>axis-jaxrpc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.axis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>axis-saaj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wsdl4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-discovery<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- axis webService client end --&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.apache.axis.client.Call;</span><br><span class="line">import org.apache.axis.client.Service;</span><br><span class="line">import org.apache.axis.encoding.XMLType;</span><br><span class="line"></span><br><span class="line">import javax.xml.namespace.QName;</span><br><span class="line">import javax.xml.rpc.ParameterMode;</span><br><span class="line">import javax.xml.rpc.ServiceException;</span><br><span class="line">import java.net.MalformedURLException;</span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.rmi.RemoteException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: WebServiceClient</span><br><span class="line"> * @Description: 客户端封装</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">public class WebServiceClient {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 无参数请求</span><br><span class="line">     * @param wsdlUrl wsdl</span><br><span class="line">     * @param targetNamespace 命名空间</span><br><span class="line">     * @param methodName 方法名</span><br><span class="line">     * @return 返回值</span><br><span class="line">     * @throws ServiceException 异常</span><br><span class="line">     * @throws MalformedURLException 异常</span><br><span class="line">     * @throws RemoteException 异常</span><br><span class="line">     */</span><br><span class="line">    public static String execute(String wsdlUrl, String targetNamespace, String methodName) throws ServiceException, MalformedURLException, RemoteException {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params = new LinkedHashMap<span class="tag">&lt;&gt;</span>(0);</span><br><span class="line">        return execute(wsdlUrl, targetNamespace, methodName, params);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 有参数请求</span><br><span class="line">     * @param wsdlUrl wsdl</span><br><span class="line">     * @param targetNamespace 命名空间</span><br><span class="line">     * @param methodName 方法名</span><br><span class="line">     * @param params 参数 key-参数名，value-参数值</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ServiceException 异常</span><br><span class="line">     * @throws MalformedURLException 异常</span><br><span class="line">     * @throws RemoteException 异常</span><br><span class="line">     */</span><br><span class="line">    public static String execute(String wsdlUrl, String targetNamespace, String methodName, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params) throws ServiceException, MalformedURLException, RemoteException {</span><br><span class="line">        Service service = new Service();</span><br><span class="line">        Call call = (Call) service.createCall();</span><br><span class="line">        call.setUseSOAPAction(true);</span><br><span class="line">        //设置返回值</span><br><span class="line">        call.setReturnType(XMLType.SOAP_STRING);</span><br><span class="line">        // wsdl路径</span><br><span class="line">        call.setTargetEndpointAddress(new URL(wsdlUrl));</span><br><span class="line">        //第一个参数： targetNamespace，第二个参数 方法名</span><br><span class="line">        call.setOperationName(new QName(targetNamespace, methodName));</span><br><span class="line">        //参数，多个则多次add</span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> values = new ArrayList<span class="tag">&lt;&gt;</span>(params.size());</span><br><span class="line">        for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : params.entrySet()) {</span><br><span class="line">            call.addParameter(entry.getKey(), XMLType.SOAP_STRING, ParameterMode.IN);</span><br><span class="line">            values.add(entry.getValue());</span><br><span class="line">        }</span><br><span class="line">        //传入参数并执行</span><br><span class="line">        return String.valueOf(call.invoke(values.toArray()));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">class WebServiceClientTests {</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void getTime() {</span><br><span class="line">        try {</span><br><span class="line">            String wsdlUrl = "http://localhost:8090/spring-boot-webservice-service/cxf/exampleService?wsdl";</span><br><span class="line">            String targetNamespace = "http://example.webservice.springbootwebservice.demon.com/";</span><br><span class="line">            String methodName = "getTime";</span><br><span class="line">            String result = WebServiceClient.execute(wsdlUrl, targetNamespace, methodName);</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    void sayHello() {</span><br><span class="line">        try {</span><br><span class="line">            String wsdlUrl = "http://localhost:8090/spring-boot-webservice-service/cxf/exampleService?wsdl";</span><br><span class="line">            String targetNamespace = "http://example.webservice.sms.demon.com/";</span><br><span class="line">            String methodName = "sayHello";</span><br><span class="line">            Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> paramNames = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            paramNames.put("userName", "demon");</span><br><span class="line">            String result = WebServiceClient.execute(wsdlUrl, targetNamespace, methodName, paramNames);</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="服务端开发"><a href="#服务端开发" class="headerlink" title="服务端开发"></a>服务端开发</h3><p><a href="/2021/03/1617086122645/1617086122645/">服务端开发 - SpringBoot</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>WebService</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo博客的一些内置写法</title>
    <url>/2021/03/1615800535123/1615800535123/</url>
    <content><![CDATA[<p><a href="#描点-一">跳转到本文锚点一</a><br><a href="#描点-二">跳转到本文锚点二</a></p>
<p>在hexo中发表文章时需要相互引用，以下为一些内置写法，有些需要先安装modiles</p>
<p>1.引用内部图片</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">在根目录下执行如下命令</span><br><span class="line">  npm install hexo-asset-image</span><br><span class="line">  </span><br><span class="line">此时再执行命令 </span><br><span class="line">  hexo new article_name 创建新的文章，在 source/_posts 中会生成文章 post_name.md 和同名文件夹 post_name,</span><br><span class="line"></span><br><span class="line">我们将文章中所使用到的将图片资源均放在 post_name 中，这时就可以在文章中使用相对路径引用图片资源了</span><br><span class="line">![img_name](img_name.jpg) #文章中的图片资源路径格式</span><br><span class="line">如：![20210315171503](1615799438937/20210315171503.png)</span><br></pre></td></tr></tbody></table></figure></div>

<p>2.引用内部链接</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[标题]({% post_path %}/访问路径)</span><br><span class="line">如：[标题]({% post_path %}/2021/03/1615800535123/1615800535123/)</span><br></pre></td></tr></tbody></table></figure></div>

<p>3.描点</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">hexo markdown 文章里面如果使用 ## 文章二级标题 生成标题，标题会自动生成 id="文章二级标题"。</span><br><span class="line">如果标题中间有 半角空格 或者 全角空格 ，空格都会变成连字符。</span><br><span class="line">如：一个半角空格 ## hello world 或 多个半角 ## hello world 或 多个全角空格 ## hello　　　world 。</span><br><span class="line">其生成的 id 会变成 id="hello-world"，多个空格会合并成一个连字符。</span><br><span class="line"></span><br><span class="line">当前文章锚点跳转:</span><br><span class="line"></span><br><span class="line">使用 markdown 内置的链接方式即可，其中如果有空格，需要把空格换成连字符 - ，如下：</span><br><span class="line">[跳转到本文锚点](#hexo-标题与-id-关系)</span><br><span class="line"></span><br><span class="line">例如：</span><br><span class="line"></span><br><span class="line">[跳转到本文锚点一](#描点-一)</span><br><span class="line">[跳转到本文锚点二](#描点-二)</span><br><span class="line"></span><br><span class="line">## 描点 一</span><br><span class="line">### 描点 二</span><br></pre></td></tr></tbody></table></figure></div>

<p>4.折叠与收起</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">details：折叠语法标签</span><br><span class="line">summary：折叠语法展示的摘要</span><br><span class="line">pre：以原有格式显示元素内的文字是已经格式化的文本</span><br><span class="line">code：指定代码范例</span><br><span class="line">blockcode：表示程序的代码块</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">summary</span>&gt;</span>点击时的区域标题1<span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pre</span>&gt;</span><span class="tag">&lt;<span class="name">code</span>&gt;</span> System.out.println( "Hello, World!" );<span class="tag">&lt;/<span class="name">code</span>&gt;</span><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">summary</span>&gt;</span>点击时的区域标题2<span class="tag">&lt;/<span class="name">summary</span>&gt;</span></span><br><span class="line">  写```html也可</span><br><span class="line"><span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<details>
  <summary>点击时的区域标题1</summary>
  <pre><code> System.out.println( "Hello, World!" );</code></pre>
</details>
<details>
  <summary>点击时的区域标题2</summary>
  <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">System.out.println( "Hello, World!" );</span><br></pre></td></tr></tbody></table></figure></div>
</details>



<h2 id="描点-一"><a href="#描点-一" class="headerlink" title="描点 一"></a>描点 一</h2><h3 id="描点-二"><a href="#描点-二" class="headerlink" title="描点 二"></a>描点 二</h3><h2 id="博客迁移"><a href="#博客迁移" class="headerlink" title="博客迁移"></a>博客迁移</h2><p>当在git base 内输入hexo 出现 bash: hexo: command not found，<br>需要在环境变量PATH内配置：xxx\node_modules.bin；比如：D:\workspace-demon\myblog\node_modules.bin</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Blog</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>集合操作 - List，Set，Map</title>
    <url>/2021/03/1617003286483/1617003286483/</url>
    <content><![CDATA[<h3 id="集合概述"><a href="#集合概述" class="headerlink" title="集合概述"></a>集合概述</h3><p>Java中的集合类：是一种工具类，就像是容器，储存任意数量的具有共同属性的对象。</p>
<p>集合框架被设计成要满足以下几个目标：</p>
<blockquote>
<p>该框架必须是高性能的。基本集合（动态数组，链表，树，哈希表）的实现也必须是高效的。<br>    该框架允许不同类型的集合，以类似的方式工作，具有高度的互操作性。<br>    对一个集合的扩展和适应必须是简单的。</p>
</blockquote>
<p>为此，整个集合框架就围绕一组标准接口而设计。<br>可以直接使用这些接口的标准实现，诸如： LinkedList, HashSet, 和 TreeSet 等,<br>除此之外你也可以通过这些接口实现自己的集合。</p>
<h3 id="集合结构图"><a href="#集合结构图" class="headerlink" title="集合结构图"></a>集合结构图</h3><p><img src="/2021/03/1617003286483/1617003286483/20210329154610.png" alt="20210329154610"></p>
<h3 id="集合使用"><a href="#集合使用" class="headerlink" title="集合使用"></a>集合使用</h3><ul>
<li><p>List &amp; Set<br>List接口继承了Collection接口，并对父接口进行了简单的扩充。常用的实现类有：ArrayList、LinkedList和Vector。<br>Set接口一个不包括重复元素（包括可变对象）的Collection，是一种无序的集合。常用的实现类有：HashSet、TreeSet等。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">List<span class="tag">&lt;<span class="name">String</span>&gt;</span> list=new ArrayList<span class="tag">&lt;<span class="name">String</span>&gt;</span>();  </span><br><span class="line">list.add("Hello");  </span><br><span class="line">list.add("World");  </span><br><span class="line"></span><br><span class="line">//推荐的通用方法</span><br><span class="line">for (String str : list) {              </span><br><span class="line">    System.out.println(str);  </span><br><span class="line">}  </span><br><span class="line"></span><br><span class="line">//多线程并行执行</span><br><span class="line">list.parallelStream().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">Set 同理</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>Map<br>Map是一个键值对的集合。一个映射不能包含重复的键，每个键最多映射到一个值。常用的实现类有：HashMap、TreeMap、Properties。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">map.put("hello","Hello");</span><br><span class="line">map.put("world","World");</span><br><span class="line">System.out.println(map.size());</span><br><span class="line"></span><br><span class="line">// 第一种：map.keySet()返回的是所有key的值</span><br><span class="line">System.out.println("第一种：通过Map.keySet遍历key和value：");</span><br><span class="line">for (String in : map.keySet()) {</span><br><span class="line">    String str = map.get(in);//得到每个key多对用value的值</span><br><span class="line">    System.out.println(in + "     " + str);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 第二种：</span><br><span class="line">System.out.println("第二种：通过Map.entrySet使用iterator遍历key和value：");</span><br><span class="line">for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : map.entrySet()) {</span><br><span class="line">    System.out.println("key= " + entry.getKey() + " and value= " + entry.getValue());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 第三种：推荐，尤其是容量大时</span><br><span class="line">System.out.println("第三种：通过Map.entrySet遍历key和value");</span><br><span class="line">for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : map.entrySet()) {</span><br><span class="line">    System.out.println("key= " + entry.getKey() + " and value= "+ entry.getValue());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 第四种：</span><br><span class="line">System.out.println("第四种：通过Map.values()遍历所有的value，但不能遍历key");</span><br><span class="line">for (String v : map.values()) {</span><br><span class="line">    System.out.println("value= " + v);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h2 id="集合转化"><a href="#集合转化" class="headerlink" title="集合转化"></a>集合转化</h2><ul>
<li><p>数组转List<br>需要注意的是， Arrays.asList() 返回一个受指定数组决定的固定大小的列表。所以不能做 add 、 remove 等操作，否则会报错。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">String[] strArr = new String[]{"Hello", "World", "Java"};</span><br><span class="line">List strList = Arrays.asList(strArr);</span><br><span class="line">System.out.println(strList); //[Hello, World, Java]</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>数组转Set</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Set<span class="tag">&lt;<span class="name">String</span>&gt;</span> strSet = new HashSet<span class="tag">&lt;&gt;</span>(Arrays.asList(strArr));</span><br><span class="line">System.out.println(strSet); //[Hello, World, Java]</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>List转数组</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Object[] strArr = strList.toArray();</span><br><span class="line">System.out.println(Arrays.toString(strArr)); //[Hello, World, Java]</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>List转Set</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Set<span class="tag">&lt;<span class="name">String</span>&gt;</span> strSet = new HashSet<span class="tag">&lt;<span class="name">String</span>&gt;</span>(strList);</span><br><span class="line">System.out.println(strSet);</span><br><span class="line">结果：</span><br><span class="line">[Java, Hello, World]</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>java8的stream（流）：排序，统计，过滤，映射，分组，拼接，分区，总和，平均值，最小值</p>
<blockquote>
<p>使用Arrays 中的 stream() 方法，将数组转成流</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Integer[] nums = new Integer[10];</span><br><span class="line">Stream<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> stream = Arrays.stream(nums);</span><br></pre></td></tr></tbody></table></figure></div>

<blockquote>
<p>使用 BufferedReader.lines() 方法，将每行内容转成流</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">BufferedReader reader = new BufferedReader(new FileReader("d:\\test.txt"));</span><br><span class="line">Stream<span class="tag">&lt;<span class="name">String</span>&gt;</span> lineStream = reader.lines();</span><br><span class="line">lineStream.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure></div>

<blockquote>
<p> 使用 Pattern.splitAsStream() 方法，将字符串分隔成流</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Pattern pattern = Pattern.compile(",");</span><br><span class="line">Stream<span class="tag">&lt;<span class="name">String</span>&gt;</span> stringStream = pattern.splitAsStream("a,b,c,d,e");</span><br><span class="line">stringStream.forEach(System.out::println);</span><br></pre></td></tr></tbody></table></figure></div>

<blockquote>
<p>以下为第三方工具使用</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>30.0-jre<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatis-Plus的集成配置</title>
    <url>/2021/04/1617878968965/1617878968965/</url>
    <content><![CDATA[<p><a href="/2022/03/1648110385163/1648110385163/">自定义代码配置</a></p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>添加依赖</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 连接数据库 start --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库 连接 、事务--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库 mybatis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库 mysql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接数据库 end --&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>配置bean使用插件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @className: MybatisPlusConfig.java</span><br><span class="line"> * @description:  MyBatis-Plus的插件配置</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2020/8/25 11:24</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">public class MybatisPlusConfig {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 分页插件</span><br><span class="line">     * paginationInterceptor.setLimit(你的最大单页限制数量，默认 500 条，小于 0 如 -1 不受限制);</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public PaginationInterceptor paginationInterceptor() {</span><br><span class="line">        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();</span><br><span class="line">        </span><br><span class="line">        // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span><br><span class="line">        paginationInterceptor.setOverflow(false);</span><br><span class="line">        </span><br><span class="line">        // 设置最大单页限制数量，默认 500 条，-1 不受限制</span><br><span class="line">        paginationInterceptor.setLimit(-1);</span><br><span class="line">        </span><br><span class="line">        // 设置数据库需要根据mp版本使用set方法,以下为3.3.2</span><br><span class="line">        paginationInterceptor.setDbType(DbType.MYSQL);</span><br><span class="line">        </span><br><span class="line">        // 设置数据库需要根据mp版本使用set方法,以下为3.2.0</span><br><span class="line">        paginationInterceptor.setDialectType(DbType.MYSQL.getDb());</span><br><span class="line">        </span><br><span class="line">        return paginationInterceptor;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="添加事务"><a href="#添加事务" class="headerlink" title="添加事务"></a>添加事务</h3><p>在实现类的 增删改方法内添加</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Transactional(propagation = Propagation.NESTED, rollbackFor = Exception.class)</span><br></pre></td></tr></tbody></table></figure></div>
<p>PROPAGATION_NESTED：</p>
<blockquote>
<p>如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则进行与PROPAGATION_REQUIRED类似的操作。</p>
</blockquote>
<p>PROPAGATION_REQUIRED：</p>
<blockquote>
<p>支持当前事务，如果当前没有事务，就新建一个事务。</p>
</blockquote>
<h3 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">spring:</span><br><span class="line">  # 数据库连接</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql://127.0.0.1:3306/demo?useUnicode=true&amp;characterEncoding=utf8&amp;characterSetResults=utf8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC&amp;zeroDateTimeBehavior=convertToNull</span><br><span class="line">    username: root</span><br><span class="line">    password: root</span><br><span class="line">    # Spring Boot 2.0及以上版本 默认选择，不需要配置</span><br><span class="line">    type: com.zaxxer.hikari.HikariDataSource</span><br><span class="line">    hikari:</span><br><span class="line">      # 客户端等待连接池连接的最大毫秒数</span><br><span class="line">      connection-timeout: 20000</span><br><span class="line">      # 连接池中维护的最小空闲连接数</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      # 配置最大池大小</span><br><span class="line">      maximum-pool-size: 12</span><br><span class="line">      # 允许连接在连接池中空闲的最长时间（以毫秒为单位）</span><br><span class="line">      idle-timeout: 300000</span><br><span class="line">      # 池中连接关闭后的最长生命周期（以毫秒为单位）</span><br><span class="line">      max-lifetime: 1200000</span><br><span class="line">      # 从池返回的连接的默认自动提交行为。默认值为true。</span><br><span class="line">      auto-commit: true</span><br><span class="line"></span><br><span class="line"># mybatis-plus配置</span><br><span class="line">mybatis-plus:</span><br><span class="line">  # MyBatis 配置文件</span><br><span class="line">  configuration:</span><br><span class="line">    # 映射器启用缓存</span><br><span class="line">    cache-enabled: false</span><br><span class="line">    # 查询时，关闭关联对象即时加载以提高性能</span><br><span class="line">    lazy-loading-enabled: false</span><br><span class="line">    # 不允许使用自定义的主键值(比如由程序生成的UUID 32位编码作为键值), 数据表的PK生成策略将被覆盖</span><br><span class="line">    use-generated-keys: false</span><br><span class="line">    # 对于批量更新操作缓存SQL以提高性能 SIMPLE, REUSE, BATCH</span><br><span class="line">    default-executor-type: reuse</span><br><span class="line">    # 对于未知的SQL查询，允许返回不同的结果集以达到通用的效果</span><br><span class="line">    multiple-result-sets-enabled: true</span><br><span class="line">    # 允许使用列标签代替列名</span><br><span class="line">    use-column-label: true</span><br><span class="line">    # 解决mybatis空字段null字段不返回</span><br><span class="line">    call-setters-on-nulls: true</span><br><span class="line">    # 给予被嵌套的resultMap以字段-属性的映射支持 NONE, FULL,PARTIAL</span><br><span class="line">    auto-mapping-behavior: partial</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br><span class="line">  # 启动时是否检查 MyBatis XML 文件的存在，默认不检查。</span><br><span class="line">  check-config-location: false</span><br><span class="line">  # mapper.xml所在位置</span><br><span class="line">  mapper-locations: classpath*:/mapper/*Mapper.xml</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>WebService服务端开发 - SpringBoot</title>
    <url>/2021/03/1617086122645/1617086122645/</url>
    <content><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.cxf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cxf-spring-boot-starter-jaxws<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8069</span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /spring-boot-webservice-service</span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-boot-webservice-service</span><br><span class="line"></span><br><span class="line"># 发布服务名称：http://localhost:8069/spring-boot-webservice-service/ws</span><br><span class="line">cxf:</span><br><span class="line">  path: /ws</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="创建接口"><a href="#创建接口" class="headerlink" title="创建接口"></a>创建接口</h3><p>在创建接口时请将实现类与之放在同一级目录下，这样在endpointInterface时容易找到<br><img src="/2021/03/1617086122645/1617086122645/20210330144330.png" alt="20210330144330"></p>
<p>ExampleService：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import javax.jws.WebMethod;</span><br><span class="line">import javax.jws.WebParam;</span><br><span class="line">import javax.jws.WebResult;</span><br><span class="line">import javax.jws.WebService;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: exampleService</span><br><span class="line"> * @Description: ExampleService接口</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">@WebService(name = "ExampleService")</span><br><span class="line">public interface ExampleService {</span><br><span class="line"></span><br><span class="line">    @WebMethod</span><br><span class="line">    @WebResult</span><br><span class="line">    String getTime();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * sayHello</span><br><span class="line">     * @param userName 用户名</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @WebMethod</span><br><span class="line">    @WebResult</span><br><span class="line">    String sayHello(@WebParam(name = "userName") String userName);</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>ExampleServiceImpl：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.dom4j.Document;</span><br><span class="line">import org.dom4j.DocumentHelper;</span><br><span class="line">import org.dom4j.Element;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import javax.jws.WebService;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: ExampleController</span><br><span class="line"> * @Description:</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> </span><br><span class="line"> * serviceName:【对外发布的服务名 】：需要见名知意</span><br><span class="line"> * targetNamespace:【名称空间】：【实现类包名的反缀】</span><br><span class="line"> * endpointInterface :【服务接口全路径】 【接口的包名】</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@WebService(</span><br><span class="line">        serviceName = "ExampleService",</span><br><span class="line">        targetNamespace="http://example.webservice.springbootwebservice.demon.com/",</span><br><span class="line">        endpointInterface = "com.demon.springbootwebservice.webservice.example.ExampleService"</span><br><span class="line">)</span><br><span class="line">public class ExampleServiceImpl implements ExampleService {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getTime() {</span><br><span class="line">        return String.valueOf(System.currentTimeMillis());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String sayHello(String userName) {</span><br><span class="line">        System.out.println("=======================&gt;"+userName);</span><br><span class="line">        return userName;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="WebServiceConfig配置类"><a href="#WebServiceConfig配置类" class="headerlink" title="WebServiceConfig配置类"></a>WebServiceConfig配置类</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import org.apache.cxf.Bus;</span><br><span class="line">import org.apache.cxf.bus.spring.SpringBus;</span><br><span class="line">import org.apache.cxf.jaxws.EndpointImpl;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import javax.xml.ws.Endpoint;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @ClassName: WebServiceConfig</span><br><span class="line"> * @Description: 配置类</span><br><span class="line"> * @Author: Demon</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class WebServiceConfig {</span><br><span class="line">    </span><br><span class="line">    @Bean(name = Bus.DEFAULT_BUS_ID)</span><br><span class="line">    public SpringBus springBus() {</span><br><span class="line">        return new SpringBus();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * ExampleService --- sayHello</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Endpoint exampleServiceBean() {</span><br><span class="line">        // 绑定要发布的服务实现类</span><br><span class="line">        EndpointImpl endpoint = new EndpointImpl(springBus(), new ExampleServiceImpl());</span><br><span class="line">        // 接口访问地址</span><br><span class="line">        endpoint.publish("/exampleService");</span><br><span class="line">        return endpoint;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TestService --- getTest</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Endpoint testServiceBean() {</span><br><span class="line">        // 绑定要发布的服务实现类</span><br><span class="line">        EndpointImpl endpoint = new EndpointImpl(springBus(), new TestServiceImpl());</span><br><span class="line">        // 接口访问地址</span><br><span class="line">        endpoint.publish("/testService");</span><br><span class="line">        return endpoint;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="访问结果"><a href="#访问结果" class="headerlink" title="访问结果"></a>访问结果</h3><p>访问路径：<a href="http://localhost:8069/spring-boot-webservice-service/ws" target="_blank" rel="noopener">http://localhost:8069/spring-boot-webservice-service/ws</a><br><img src="/2021/03/1617086122645/1617086122645/20210330153035.png" alt="20210330153035"><br><img src="/2021/03/1617086122645/1617086122645/20210330153710.png" alt="20210330153710"><br><img src="/2021/03/1617086122645/1617086122645/20210330153725.png" alt="20210330153725"></p>
<h3 id="客户端请求"><a href="#客户端请求" class="headerlink" title="客户端请求"></a>客户端请求</h3><p><a href="/2021/03/1617084469964/1617084469964/"> axis客户端请求</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>WebService</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>使用NSSM把exe可执行文件注册为Windows服务,开机启动&amp;后台运行</title>
    <url>/2021/05/1620813081711/1620813081711/</url>
    <content><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><a href="http://www.nssm.cc/" target="_blank" rel="noopener">NSSM</a>是一款可将exe注册为Windows系统服务的工具。当你的exe程序需要部署在Windows Server上时，NSSM是一个不错的选择。<br>注册为服务后，启动、停止、重启皆由windows来管理，所以不必担心exe因意外的停止，而Windows的服务管理即可处理这些问题。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>官网<a href="http://www.nssm.cc/download" target="_blank" rel="noopener">下载</a>页面; 版本：<a href="http://www.nssm.cc/release/nssm-2.24.zip" target="_blank" rel="noopener">2.24</a></p>
<p>根据自己的平台，将32/64位nssm.exe文件解压至任意文件夹</p>
<p>以管理员身份运行CMD定位至nssm.exe所在目录</p>
<p>输入 nssm install {服务名称}，即注册服务的名称。注册服务弹出如下NSSM界面<br><img src="/2021/05/1620813081711/1620813081711/20210512181351.png" alt="20210512181351"></p>
<p>以安装Redis为例<br><img src="/2021/05/1620813081711/1620813081711/20210512182309.png" alt="20210512182309"></p>
<p>查询服务状态</p>
<pre><code>E:\nssm-2.24-101\win64&gt;nssm.exe status Redis
SERVICE_STOPPED</code></pre><p>nssm常用命令：</p>
<blockquote>
<p>创建服务：nssm install servername </p>
</blockquote>
<blockquote>
<p>启动服务：nssm start servername </p>
</blockquote>
<blockquote>
<p>暂停服务：nssm stop servername </p>
</blockquote>
<blockquote>
<p>重启服务：nssm restart servername </p>
</blockquote>
<blockquote>
<p>删除服务：nssm remove servername </p>
</blockquote>
<p>更多命令<a href="http://www.nssm.cc/usage" target="_blank" rel="noopener">查看</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>nssm</tag>
      </tags>
  </entry>
  <entry>
    <title>Go-FastDfs 安装配置</title>
    <url>/2021/05/1620815885110/1620815885110/</url>
    <content><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>项目地址：<a href="https://github.com/sjqzhang/go-fastdfs" target="_blank" rel="noopener">https://github.com/sjqzhang/go-fastdfs</a></p>
<p>编译版本下载地址：<a href="https://github.com/sjqzhang/go-fastdfs/releases" target="_blank" rel="noopener">https://github.com/sjqzhang/go-fastdfs/releases</a></p>
<p>中文Wiki地址：<a href="https://github.com/sjqzhang/go-fastdfs/blob/master/README.md" target="_blank" rel="noopener">https://github.com/sjqzhang/go-fastdfs/blob/master/README.md</a></p>
<p>gitee：<a href="https://gitee.com/sjqzhang/go-fastdfs" target="_blank" rel="noopener">https://gitee.com/sjqzhang/go-fastdfs</a></p>
<p>文档：<a href="https://sjqzhang.github.io/go-fastdfs/install.html" target="_blank" rel="noopener">https://sjqzhang.github.io/go-fastdfs/install.html</a></p>
<h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><pre><code>mkdir fastdfs &amp;&amp; cd fastdfs
wget --no-check-certificate  https://github.com/sjqzhang/go-fastdfs/releases/download/v1.4.1/fileserver
chmod +x fileserver
./fileserver</code></pre><h4 id="window"><a href="#window" class="headerlink" title="window"></a>window</h4><pre><code>下载时要注意链接的版本号，windows下直接运行 fileserver.exe</code></pre><p>运行完成后生成以下目录文件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">conf -- 配置</span><br><span class="line">data -- 数据</span><br><span class="line">files -- 文件</span><br><span class="line">log -- 日志</span><br><span class="line">static -- 静态页面</span><br></pre></td></tr></tbody></table></figure></div>

<blockquote>
<p>访问：localhost:8080 出现以下界面则运行成功</p>
</blockquote>
<p><img src="/2021/05/1620815885110/1620815885110/20210513133226.png" alt="20210513133226"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>配置文件在运行时自动生成，IP自动获取，端口默认8080；后面可根据需要自行修改端口配置；<br>配置文件去重算法为sha1，防止上传同一个文件导致为覆盖操作；<br>配置默认下载为false时，则可在返回的参数path后添加?download=0时在浏览器预览，path?download=1时在浏览器下载；</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><figcaption><span>json</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    "绑定端号": "端口",</span><br><span class="line">    "addr": ":18080",</span><br><span class="line">    "是否开启https": "默认不开启，如需启开启，请在conf目录中增加证书文件 server.crt 私钥 文件 server.key",</span><br><span class="line">    "enable_https": false,</span><br><span class="line">    "PeerID": "集群内唯一,请使用0-9的单字符，默认自动生成",</span><br><span class="line">    "peer_id": "5",</span><br><span class="line">    "本主机地址": "本机http地址,默认自动生成(注意端口必须与addr中的端口一致），必段为内网，自动生成不为内网请自行修改，下同",</span><br><span class="line">    "host": "http://127.0.0.1:18080",</span><br><span class="line">    "集群": "集群列表,注意为了高可用，IP必须不能是同一个,同一不会自动备份，且不能为127.0.0.1,且必须为内网IP，默认自动生成",</span><br><span class="line">    "peers": ["http://127.0.0.1:18080"],</span><br><span class="line">    "组号": "用于区别不同的集群(上传或下载)与support_group_manage配合使用,带在下载路径中",</span><br><span class="line">    "group": "group1",</span><br><span class="line">    "是否支持按组（集群）管理,主要用途是Nginx支持多集群": "默认支持,不支持时路径为http://10.1.5.4:8080/action,支持时为http://10.1.5.4:8080/group(配置中的group参数)/action,action为动作名，如status,delete,sync等",</span><br><span class="line">    "support_group_manage": true,</span><br><span class="line">    "是否合并小文件": "默认不合并,合并可以解决inode不够用的情况（当前对于小于1M文件）进行合并",</span><br><span class="line">    "enable_merge_small_file": false,</span><br><span class="line">    "允许后缀名": "允许可以上传的文件后缀名，如jpg,jpeg,png等。留空允许所有。",</span><br><span class="line">    "extensions": [],</span><br><span class="line">    "重试同步失败文件的时间": "单位秒",</span><br><span class="line">    "refresh_interval": 1800,</span><br><span class="line">    "是否自动重命名": "默认不自动重命名,使用原文件名",</span><br><span class="line">    "rename_file": false,</span><br><span class="line">    "是否支持web上传,方便调试": "默认支持web上传",</span><br><span class="line">    "enable_web_upload": true,</span><br><span class="line">    "是否支持非日期路径": "默认支持非日期路径,也即支持自定义路径,需要上传文件时指定path",</span><br><span class="line">    "enable_custom_path": true,</span><br><span class="line">    "下载域名": "用于外网下载文件的域名,不包含http://",</span><br><span class="line">    "download_domain": "",</span><br><span class="line">    "场景列表": "当设定后，用户指的场景必项在列表中，默认不做限制(注意：如果想开启场景认功能，格式如下：'场景名:googleauth_secret' 如 default:N7IET373HB2C5M6D ",</span><br><span class="line">    "scenes": [],</span><br><span class="line">    "默认场景": "默认default",</span><br><span class="line">    "default_scene": "default",</span><br><span class="line">    "是否显示目录": "默认显示,方便调试用,上线时请关闭",</span><br><span class="line">    "show_dir": true,</span><br><span class="line">    "邮件配置": "",</span><br><span class="line">    "mail": {</span><br><span class="line">        "user": "abc@163.com",</span><br><span class="line">        "password": "abc",</span><br><span class="line">        "host": "smtp.163.com:25"</span><br><span class="line">    },</span><br><span class="line">    "告警接收邮件列表": "接收人数组",</span><br><span class="line">    "alarm_receivers": [],</span><br><span class="line">    "告警接收URL": "方法post,参数:subject,message",</span><br><span class="line">    "alarm_url": "",</span><br><span class="line">    "下载是否需带token": "真假",</span><br><span class="line">    "download_use_token": false,</span><br><span class="line">    "下载token过期时间": "单位秒",</span><br><span class="line">    "download_token_expire": 600,</span><br><span class="line">    "是否自动修复": "在超过1亿文件时出现性能问题，取消此选项，请手动按天同步，请查看FAQ",</span><br><span class="line">    "auto_repair": true,</span><br><span class="line">    "文件去重算法md5可能存在冲突，默认md5": "sha1|md5",</span><br><span class="line">    "file_sum_arithmetic": "sha1",</span><br><span class="line">    "管理ip列表": "用于管理集的ip白名单,",</span><br><span class="line">    "admin_ips": ["127.0.0.1"],</span><br><span class="line">    "是否启用迁移": "默认不启用",</span><br><span class="line">    "enable_migrate": false,</span><br><span class="line">    "文件是否去重": "默认去重",</span><br><span class="line">    "enable_distinct_file": true,</span><br><span class="line">    "是否开启跨站访问": "默认开启",</span><br><span class="line">    "enable_cross_origin": true,</span><br><span class="line">    "是否开启Google认证，实现安全的上传、下载": "默认不开启",</span><br><span class="line">    "enable_google_auth": false,</span><br><span class="line">    "认证url": "当url不为空时生效,注意:普通上传中使用http参数 auth_token 作为认证参数, 在断点续传中通过HTTP头Upload-Metadata中的auth_token作为认证参数,认证流程参考认证架构图",</span><br><span class="line">    "auth_url": "",</span><br><span class="line">    "下载是否认证": "默认不认证(注意此选项是在auth_url不为空的情况下生效)",</span><br><span class="line">    "enable_download_auth": false,</span><br><span class="line">    "默认是否下载": "默认下载",</span><br><span class="line">    "default_download": false,</span><br><span class="line">    "本机是否只读": "默认可读可写",</span><br><span class="line">    "read_only": false,</span><br><span class="line">    "是否开启断点续传": "默认开启",</span><br><span class="line">    "enable_tus": true,</span><br><span class="line">    "同步单一文件超时时间（单位秒）": "默认为0,程序自动计算，在特殊情况下，自已设定",</span><br><span class="line">    "sync_timeout": 0</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p><a href="/2021/11/1636190973137/1636190973137/">传送门</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Go-FastDfs</category>
      </categories>
      <tags>
        <tag>Go-FastDfs</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器指令</title>
    <url>/2021/06/1624439801367/1624439801367/</url>
    <content><![CDATA[<h3 id="查看当前Linux系统版本"><a href="#查看当前Linux系统版本" class="headerlink" title="查看当前Linux系统版本"></a>查看当前Linux系统版本</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">lsb_release -a</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="更新yum源"><a href="#更新yum源" class="headerlink" title="更新yum源"></a>更新yum源</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="更新所有软件"><a href="#更新所有软件" class="headerlink" title="更新所有软件"></a>更新所有软件</h3><blockquote>
<p>列出所有可更新的软件清单命令<br>yum check-update</p>
</blockquote>
<blockquote>
<p>更新所有软件命令<br>yum update</p>
</blockquote>
<h3 id="清除缓存命令"><a href="#清除缓存命令" class="headerlink" title="清除缓存命令"></a>清除缓存命令</h3><blockquote>
<p>清除缓存目录下的软件包<br>yum clean packages</p>
</blockquote>
<blockquote>
<p>清除缓存目录下的 headers<br>yum clean headers</p>
</blockquote>
<blockquote>
<p>清除缓存目录下旧的 headers<br>yum clean oldheaders</p>
</blockquote>
<blockquote>
<p>清除缓存目录下的软件包及旧的headers<br>yum clean<br>yum clean all</p>
</blockquote>
<h3 id="下载文件：wget"><a href="#下载文件：wget" class="headerlink" title="下载文件：wget"></a>下载文件：wget</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install wget</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">下载Tomcat：wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/apache-tomcat-9.0.27.tar.gz</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="文件传输：lrzsz"><a href="#文件传输：lrzsz" class="headerlink" title="文件传输：lrzsz"></a>文件传输：lrzsz</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install lrzsz</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">从服务端发送文件到客户端：sz filename</span><br><span class="line">从客户端上传文件到服务端：rz</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="解压文件：xz"><a href="#解压文件：xz" class="headerlink" title="解压文件：xz"></a>解压文件：xz</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install xz </span><br><span class="line"></span><br><span class="line">eg：</span><br><span class="line">将xz文件解压为tar文件：xz -d example.tar.xz</span><br><span class="line">将tar文件解压：tar xf example.tar</span><br><span class="line"></span><br><span class="line">如果无法安装xz命令，先安装epel源：yum -y install epel-release</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="编辑器：vim"><a href="#编辑器：vim" class="headerlink" title="编辑器：vim"></a>编辑器：vim</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install vim*</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="查看网络信息：netstat"><a href="#查看网络信息：netstat" class="headerlink" title="查看网络信息：netstat"></a>查看网络信息：netstat</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install net-tools</span><br></pre></td></tr></tbody></table></figure></div>



<p><a href="/2021/06/1624517875141/1624517875141/">防火墙</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>command</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx部署Vue项目，添加前缀访问</title>
    <url>/2021/05/1620908327003/1620908327003/</url>
    <content><![CDATA[<p>首先准备1个vue项目</p>
<blockquote>
<p>hello/dist/<br>    - index.html</p>
</blockquote>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h3 id="根据路径访问"><a href="#根据路径访问" class="headerlink" title="根据路径访问"></a>根据路径访问</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">location / {</span><br><span class="line">    root html;</span><br><span class="line">    try_files $uri $uri/ /index.html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">location /hello { </span><br><span class="line">    # vue项目的打包后的dist</span><br><span class="line">    alias D:/demon/hello/dist/;</span><br><span class="line">    try_files $uri $uri/ /hello/index.html;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>访问</p>
<blockquote>
<p><a href="http://127.0.0.1/hello" target="_blank" rel="noopener">http://127.0.0.1/hello</a></p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7服务器安装MySQL 8.0.25</title>
    <url>/2021/06/1624440649011/1624440649011/</url>
    <content><![CDATA[<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">yum -y install wget lrzsz xz vim* libaio-devel.x86_64 numactl</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="MySQL地址"><a href="#MySQL地址" class="headerlink" title="MySQL地址"></a>MySQL地址</h3><p><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">https://dev.mysql.com/downloads/mysql/</a><br><img src="/2021/06/1624440649011/1624440649011/20210623172848.png" alt="20210623172848"></p>
<p>鼠标右键复制链接地址<br><img src="/2021/06/1624440649011/1624440649011/20210623174431.png" alt="20210623174431"></p>
<h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><p>通过wget方式获取安装包</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mkdir /usr/local/mysql</span><br><span class="line">cd /usr/local/mysql</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="解压安装包"><a href="#解压安装包" class="headerlink" title="解压安装包"></a>解压安装包</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">xz -d mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz</span><br><span class="line">tar -xf mysql-8.0.25-linux-glibc2.12-x86_64.tar</span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="重命名"><a href="#重命名" class="headerlink" title="重命名"></a>重命名</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mv mysql-8.0.25-linux-glibc2.12-x86_64 mysql-8.0.25</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="创建data目录"><a href="#创建data目录" class="headerlink" title="创建data目录"></a>创建data目录</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mkdir /usr/local/mysql/mysql-8.0.25/data</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="创建用户组以及用户和密码以及授权"><a href="#创建用户组以及用户和密码以及授权" class="headerlink" title="创建用户组以及用户和密码以及授权"></a>创建用户组以及用户和密码以及授权</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br><span class="line">chown -R mysql.mysql /usr/local/mysql</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="初始化基础信息"><a href="#初始化基础信息" class="headerlink" title="初始化基础信息"></a>初始化基础信息</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/mysql/mysql-8.0.25/bin/</span><br><span class="line">./mysqld --user=mysql --basedir=/usr/local/mysql/mysql-8.0.25 --datadir=/usr/local/mysql/mysql-8.0.25/data/ --initialize</span><br></pre></td></tr></tbody></table></figure></div>
<p>得到临时密码<br><img src="/2021/06/1624440649011/1624440649011/20210624141937.png" alt="20210624141937"></p>
<h3 id="编辑my-cnf文件"><a href="#编辑my-cnf文件" class="headerlink" title="编辑my.cnf文件"></a>编辑my.cnf文件</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></tbody></table></figure></div>
<p>内容：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">basedir=/usr/local/mysql/mysql-8.0.25</span><br><span class="line">datadir=/usr/local/mysql/mysql-8.0.25/data</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">character-set-server=utf8</span><br><span class="line">symbolic-links=0</span><br><span class="line">#bind-address = 127.0.0.1</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">#log-error=/var/log/mariadb/mariadb.log</span><br><span class="line">#pid-file=/var/run/mariadb/mariadb.pid</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># include all files from the config directory</span><br><span class="line">#</span><br><span class="line">!includedir /etc/my.cnf.d</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="添加mysql服务到系统"><a href="#添加mysql服务到系统" class="headerlink" title="添加mysql服务到系统"></a>添加mysql服务到系统</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cp -a /usr/local/mysql/mysql-8.0.25/support-files/mysql.server /etc/init.d/mysql</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="授权以及添加服务"><a href="#授权以及添加服务" class="headerlink" title="授权以及添加服务"></a>授权以及添加服务</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">chmod +x /etc/init.d/mysql</span><br><span class="line">chkconfig --add mysql</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="查看启动状态"><a href="#查看启动状态" class="headerlink" title="查看启动状态"></a>查看启动状态</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">service mysql status</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>显示：</p>
<blockquote>
<p>SUCCESS! MySQL running (16356)</p>
</blockquote>
</blockquote>
<h3 id="启动mysql"><a href="#启动mysql" class="headerlink" title="启动mysql"></a>启动mysql</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">service mysql start</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>显示：</p>
<blockquote>
<p>Starting MySQL…. SUCCESS! </p>
</blockquote>
</blockquote>
<h3 id="停止mysql"><a href="#停止mysql" class="headerlink" title="停止mysql"></a>停止mysql</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">service mysql stop</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="将mysql命令添加到服务"><a href="#将mysql命令添加到服务" class="headerlink" title="将mysql命令添加到服务"></a>将mysql命令添加到服务</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ln -s /usr/local/mysql/mysql-8.0.25/bin/mysql /usr/bin</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="重启mysql"><a href="#重启mysql" class="headerlink" title="重启mysql"></a>重启mysql</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="登录mysql"><a href="#登录mysql" class="headerlink" title="登录mysql"></a>登录mysql</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2021/06/1624440649011/1624440649011/20210624143714.png" alt="20210624143714"></p>
<h3 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h3><p>123456是新的密码</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">flush privileges;</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="修改远程连接并生效"><a href="#修改远程连接并生效" class="headerlink" title="修改远程连接并生效"></a>修改远程连接并生效</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set host='%' where user='root';</span><br><span class="line">flush privileges;</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="开通3306端口"><a href="#开通3306端口" class="headerlink" title="开通3306端口"></a>开通3306端口</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h3><p><img src="/2021/06/1624440649011/1624440649011/20210624154900.png" alt="20210624154900"></p>
<p><a href="/2021/06/1624517875141/1624517875141/">防火墙</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>日志之 logback 配置（SpringBoot）</title>
    <url>/2022/02/1644829623396/1644829623396/</url>
    <content><![CDATA[<p>根据不同的环境选择不同的日志配置：<a href="#Jar使用">Jar部署</a> 、<a href="#War使用">War部署</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="Jar使用"><a href="#Jar使用" class="headerlink" title="Jar使用"></a>Jar使用</h2><h3 id="自定义日志根路径：LogHomeConfig"><a href="#自定义日志根路径：LogHomeConfig" class="headerlink" title="自定义日志根路径：LogHomeConfig"></a>自定义日志根路径：LogHomeConfig</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import ch.qos.logback.core.PropertyDefinerBase;</span><br><span class="line">/**</span><br><span class="line"> * logback日志路径配置</span><br><span class="line"> * 在logback-spring.xml使用：例如：</span><br><span class="line"> * <span class="tag">&lt;<span class="name">define</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span> <span class="attr">class</span>=<span class="string">"com.xxx.config.LogHomeConfig"</span> /&gt;</span></span><br><span class="line"> */</span><br><span class="line">public class LogHomeConfig extends PropertyDefinerBase {</span><br><span class="line">    @Override</span><br><span class="line">    public String getPropertyValue() {</span><br><span class="line">        String logHome = System.getProperty("user.home") + File.separator + "project-name";</span><br><span class="line">        System.out.println("自定义日志路径:" + logHome);</span><br><span class="line">        return logHome;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="引入文件-logback-spring-xml"><a href="#引入文件-logback-spring-xml" class="headerlink" title="引入文件 logback-spring.xml"></a>引入文件 logback-spring.xml</h3><p>内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">status              log4j2自身日志输出等级</span></span><br><span class="line"><span class="comment">monitorInterval     自动检测间隔 30s</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"30 seconds"</span> <span class="attr">debug</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志格式和颜色渲染 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 彩色日志依赖的渲染类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"clr"</span> <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.ColorConverter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"wex"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"wEx"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 取配置类的值 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">define</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span> <span class="attr">class</span>=<span class="string">"com.xxx.config.LogHomeConfig"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 设置上下文名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span> <span class="attr">value</span>=<span class="string">"ProjectName"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.dirPath"</span> <span class="attr">value</span>=<span class="string">"${LOG_HOME}"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.contextName"</span> <span class="attr">value</span>=<span class="string">"logs"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.lever"</span> <span class="attr">value</span>=<span class="string">"DEBUG"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.pattern"</span> <span class="attr">value</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.MaxFileSize"</span> <span class="attr">value</span>=<span class="string">"1MB"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.maxHistory"</span> <span class="attr">value</span>=<span class="string">"7"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志格式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"CONSOLE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--子节点一: 输出到控制台 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 输出到文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 按照每天生成日志文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TRACE --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"TRACE_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/trace.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件输出的文件名--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/trace.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件最大的大小--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>TRACE<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- DEBUG --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"DEBUG_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/debug.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/debug.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- INFO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"INFO_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/info.logs-%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- WARN --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"WARN_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/warn.logs-%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ERROR --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"ERROR_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/error.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--第三方日志配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.yetech.platform.assistant"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.elasticsearch.client.RestClient"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.apache.axis"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.apache.http"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.baomidou.mybatisplus.core.MybatisConfiguration"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.zaxxer.hikari"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework.web.servlet.DispatcherServlet"</span> <span class="attr">level</span>=<span class="string">"${logback.lever}"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志输出级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"${logback.lever}"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"TRACE_APPENDER"</span>  /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"DEBUG_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_APPENDER"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="War使用"><a href="#War使用" class="headerlink" title="War使用"></a>War使用</h2><h3 id="引入文件-logback-spring-xml-1"><a href="#引入文件-logback-spring-xml-1" class="headerlink" title="引入文件 logback-spring.xml"></a>引入文件 logback-spring.xml</h3><p>内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">status              log4j2自身日志输出等级</span></span><br><span class="line"><span class="comment">monitorInterval     自动检测间隔 30s</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">"true"</span> <span class="attr">scanPeriod</span>=<span class="string">"30 seconds"</span> <span class="attr">debug</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志格式和颜色渲染 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 彩色日志依赖的渲染类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"clr"</span> <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.ColorConverter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"wex"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">conversionRule</span> <span class="attr">conversionWord</span>=<span class="string">"wEx"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">converterClass</span>=<span class="string">"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 设置上下文名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span> <span class="attr">value</span>=<span class="string">"ProjectName"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.dirPath"</span> <span class="attr">value</span>=<span class="string">"${catalina.base}/logs"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.contextName"</span> <span class="attr">value</span>=<span class="string">"ProjectName"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.lever"</span> <span class="attr">value</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.pattern"</span> <span class="attr">value</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.MaxFileSize"</span> <span class="attr">value</span>=<span class="string">"5MB"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logback.maxHistory"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志格式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"CONSOLE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--子节点一: 输出到控制台 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>${CONSOLE_LOG_PATTERN}<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 输出到文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 按照每天生成日志文件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- TRACE --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"TRACE_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/trace.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件输出的文件名--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/trace.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件最大的大小--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>TRACE<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- DEBUG --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"DEBUG_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/debug.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/debug.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- INFO --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"INFO_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/info.logs-%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- WARN --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"WARN_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/warn.logs-%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ERROR --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"ERROR_APPENDER"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>${logback.dirPath}/${logback.contextName}/error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>true<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/error.logs-%i.log</span><br><span class="line">            <span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>${logback.MaxFileSize}<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>${logback.maxHistory}<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>${logback.pattern}<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--第三方日志配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.demo"</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.apache.axis"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.apache.http"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.baomidou.mybatisplus.core.MybatisConfiguration"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.zaxxer.hikari"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework"</span> <span class="attr">level</span>=<span class="string">"info"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework.web"</span> <span class="attr">level</span>=<span class="string">"${logback.lever}"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日志输出级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"${logback.lever}"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"TRACE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"DEBUG_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_APPENDER"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>logback</tag>
      </tags>
  </entry>
  <entry>
    <title>CentOS7防火墙操作命令</title>
    <url>/2021/06/1624517875141/1624517875141/</url>
    <content><![CDATA[<blockquote>
<p>查看服务是否开机启动<br>systemctl is-enabled firewalld.service</p>
</blockquote>
<blockquote>
<p>查看已启动的服务列表<br>systemctl list-unit-files|grep enabled</p>
</blockquote>
<blockquote>
<p>查看启动失败的服务列表<br>systemctl –failed</p>
</blockquote>
<h3 id="firewalld的基本使用"><a href="#firewalld的基本使用" class="headerlink" title="firewalld的基本使用"></a>firewalld的基本使用</h3><blockquote>
<p>查看状态：<br>systemctl status firewalld </p>
</blockquote>
<blockquote>
<p>启动：<br>systemctl start firewalld</p>
</blockquote>
<blockquote>
<p>停止：<br>systemctl stop firewalld</p>
</blockquote>
<blockquote>
<p>禁止开机启动：<br>systemctl disable firewalld</p>
</blockquote>
<blockquote>
<p>启用开机启动：<br>systemctl enable firewalld</p>
</blockquote>
<h3 id="配置firewall-cmd"><a href="#配置firewall-cmd" class="headerlink" title="配置firewall-cmd"></a>配置firewall-cmd</h3><blockquote>
<p>查看版本：<br>firewall-cmd –version</p>
</blockquote>
<blockquote>
<p>查看帮助：<br>firewall-cmd –help</p>
</blockquote>
<blockquote>
<p>显示状态：<br>firewall-cmd –state</p>
</blockquote>
<blockquote>
<p>查看所有打开的端口：<br>firewall-cmd –zone=public –list-ports</p>
</blockquote>
<blockquote>
<p>更新防火墙规则：<br>firewall-cmd –reload</p>
</blockquote>
<blockquote>
<p>更新防火墙规则，重启服务：<br>firewall-cmd –completely-reload</p>
</blockquote>
<blockquote>
<p>查看已激活的Zone信息:<br>firewall-cmd –get-active-zones</p>
</blockquote>
<blockquote>
<p>查看指定接口所属区域：<br>firewall-cmd –get-zone-of-interface=eth0</p>
</blockquote>
<blockquote>
<p>拒绝所有包：<br>firewall-cmd –panic-on</p>
</blockquote>
<blockquote>
<p>取消拒绝状态：<br>firewall-cmd –panic-off</p>
</blockquote>
<blockquote>
<p>查看是否拒绝：<br>firewall-cmd –query-panic</p>
</blockquote>
<h3 id="firewall开启和关闭端口"><a href="#firewall开启和关闭端口" class="headerlink" title="firewall开启和关闭端口"></a>firewall开启和关闭端口</h3><p>-permanent永久生效，没有此参数重启后失效</p>
<blockquote>
<p>添加：<br>firewall-cmd –zone=public –add-port=80/tcp –permanent    </p>
</blockquote>
<blockquote>
<p>重新载入：<br>firewall-cmd –reload</p>
</blockquote>
<blockquote>
<p>查看：<br>firewall-cmd –zone=public –query-port=80/tcp</p>
</blockquote>
<blockquote>
<p>删除：<br>firewall-cmd –zone=public –remove-port=80/tcp –permanent</p>
</blockquote>
<p>示例：开通3306端口<br>firewall-cmd –zone=public –add-port=3306/tcp –permanent<br>firewall-cmd –reload</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>firewall</tag>
      </tags>
  </entry>
  <entry>
    <title>分布式自增ID算法---雪花算法</title>
    <url>/2022/02/1644472320483/1644472320483/</url>
    <content><![CDATA[<h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>SnowFlake的结构如下(每部分用-分开):<br>0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000<br>1位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是0<br>41位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)得到的值），<br>这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。<br>41位的时间截，可以使用69年，年T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69<br>10位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId<br>12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号加起来刚好64位，为一个Long型。</p>
<p>SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">public class SnowflakeIdWorker {</span><br><span class="line"></span><br><span class="line">    /** 开始时间截 (2015-01-01) */</span><br><span class="line">    private final long twepoch = 1489111610226L;</span><br><span class="line"></span><br><span class="line">    /** 机器id所占的位数 */</span><br><span class="line">    private final long workerIdBits = 5L;</span><br><span class="line"></span><br><span class="line">    /** 数据标识id所占的位数 */</span><br><span class="line">    private final long dataCenterIdBits = 5L;</span><br><span class="line"></span><br><span class="line">    /** 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数) */</span><br><span class="line">    private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits);</span><br><span class="line"></span><br><span class="line">    /** 支持的最大数据标识id，结果是31 */</span><br><span class="line">    private final long maxDataCenterId = -1L ^ (-1L &lt;&lt; dataCenterIdBits);</span><br><span class="line"></span><br><span class="line">    /** 序列在id中占的位数 */</span><br><span class="line">    private final long sequenceBits = 12L;</span><br><span class="line"></span><br><span class="line">    /** 机器ID向左移12位 */</span><br><span class="line">    private final long workerIdShift = sequenceBits;</span><br><span class="line"></span><br><span class="line">    /** 数据标识id向左移17位(12+5) */</span><br><span class="line">    private final long dataCenterIdShift = sequenceBits + workerIdBits;</span><br><span class="line"></span><br><span class="line">    /** 时间截向左移22位(5+5+12) */</span><br><span class="line">    private final long timestampLeftShift = sequenceBits + workerIdBits + dataCenterIdBits;</span><br><span class="line"></span><br><span class="line">    /** 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095) */</span><br><span class="line">    private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits);</span><br><span class="line"></span><br><span class="line">    /** 工作机器ID(0~31) */</span><br><span class="line">    private long workerId;</span><br><span class="line"></span><br><span class="line">    /** 数据中心ID(0~31) */</span><br><span class="line">    private long dataCenterId;</span><br><span class="line"></span><br><span class="line">    /** 毫秒内序列(0~4095) */</span><br><span class="line">    private long sequence = 0L;</span><br><span class="line"></span><br><span class="line">    /** 上次生成ID的时间截 */</span><br><span class="line">    private long lastTimestamp = -1L;</span><br><span class="line"></span><br><span class="line">    //==============================Constructors=====================================</span><br><span class="line">    /**</span><br><span class="line">     * 构造函数</span><br><span class="line">     * @param workerId 工作ID (0~31)</span><br><span class="line">     * @param dataCenterId 数据中心ID (0~31)</span><br><span class="line">     */</span><br><span class="line">    public SnowflakeIdWorker(long workerId, long dataCenterId) {</span><br><span class="line">        if (workerId &gt; maxWorkerId || workerId <span class="tag">&lt; <span class="attr">0</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">throw</span> <span class="attr">new</span> <span class="attr">IllegalArgumentException</span>(<span class="attr">String.format</span>("<span class="attr">workerId</span> <span class="attr">can</span>'<span class="attr">t</span> <span class="attr">be</span> <span class="attr">greater</span> <span class="attr">than</span> %<span class="attr">d</span> <span class="attr">or</span> <span class="attr">less</span> <span class="attr">than</span> <span class="attr">0</span>", <span class="attr">maxWorkerId</span>));</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">if</span> (<span class="attr">dataCenterId</span> &gt;</span> maxDataCenterId || dataCenterId <span class="tag">&lt; <span class="attr">0</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">throw</span> <span class="attr">new</span> <span class="attr">IllegalArgumentException</span>(<span class="attr">String.format</span>("<span class="attr">dataCenterId</span> <span class="attr">can</span>'<span class="attr">t</span> <span class="attr">be</span> <span class="attr">greater</span> <span class="attr">than</span> %<span class="attr">d</span> <span class="attr">or</span> <span class="attr">less</span> <span class="attr">than</span> <span class="attr">0</span>", <span class="attr">maxDataCenterId</span>));</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">this.workerId</span> = <span class="string">workerId;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">this.dataCenterId</span> = <span class="string">dataCenterId;</span></span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    // ==============================<span class="string">Methods</span>==========================================</span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 获得下一个<span class="attr">ID</span> (该方法是线程安全的)</span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> <span class="attr">SnowflakeId</span></span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">synchronized</span> <span class="attr">long</span> <span class="attr">nextId</span>() {</span></span><br><span class="line"><span class="tag">        <span class="attr">long</span> <span class="attr">timestamp</span> = <span class="string">timeGen();</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        //如果当前时间小于上一次<span class="attr">ID</span>生成的时间戳，说明系统时钟回退过这个时候应当抛出异常</span></span><br><span class="line">        if (timestamp &lt; lastTimestamp) {</span><br><span class="line">            throw new RuntimeException(</span><br><span class="line">                    String.format("Clock moved backwards.  Refusing to generate id for %d milliseconds", lastTimestamp - timestamp));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        //如果是同一时间生成的，则进行毫秒内序列</span><br><span class="line">        if (lastTimestamp == timestamp) {</span><br><span class="line">            sequence = (sequence + 1) &amp; sequenceMask;</span><br><span class="line">            //毫秒内序列溢出</span><br><span class="line">            if (sequence == 0) {</span><br><span class="line">                //阻塞到下一个毫秒,获得新的时间戳</span><br><span class="line">                timestamp = tilNextMillis(lastTimestamp);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        //时间戳改变，毫秒内序列重置</span><br><span class="line">        else {</span><br><span class="line">            sequence = 0L;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        //上次生成ID的时间截</span><br><span class="line">        lastTimestamp = timestamp;</span><br><span class="line"></span><br><span class="line">        //移位并通过或运算拼到一起组成64位的ID</span><br><span class="line">        return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) //</span><br><span class="line">                | (dataCenterId &lt;&lt; dataCenterIdShift) //</span><br><span class="line">                | (workerId &lt;&lt; workerIdShift) //</span><br><span class="line">                | sequence;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 阻塞到下一个毫秒，直到获得新的时间戳</span><br><span class="line">     * @param lastTimestamp 上次生成ID的时间截</span><br><span class="line">     * @return 当前时间戳</span><br><span class="line">     */</span><br><span class="line">    protected long tilNextMillis(long lastTimestamp) {</span><br><span class="line">        long timestamp = timeGen();</span><br><span class="line">        while (timestamp <span class="tag">&lt;<span class="name">=</span> <span class="attr">lastTimestamp</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">timestamp</span> = <span class="string">timeGen();</span></span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">timestamp</span>;</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 返回以毫秒为单位的当前时间</span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> 当前时间(毫秒)</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">protected</span> <span class="attr">long</span> <span class="attr">timeGen</span>() {</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">System.currentTimeMillis</span>();</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">public static void main(String[] args) {</span><br><span class="line">    System.out.println(System.currentTimeMillis());</span><br><span class="line">    SnowflakeIdWorker idWorker = new SnowflakeIdWorker(1, 1);</span><br><span class="line">    long startTime = System.nanoTime();</span><br><span class="line">    for (int i = 0; i <span class="tag">&lt; <span class="attr">50000</span>; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">        <span class="attr">long</span> <span class="attr">id</span> = <span class="string">idWorker.nextId();</span></span></span><br><span class="line"><span class="tag">        <span class="attr">System.out.println</span>(<span class="attr">id</span>);</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag">    <span class="attr">System.out.println</span>((<span class="attr">System.nanoTime</span>()<span class="attr">-startTime</span>)/<span class="attr">1000000</span>+"<span class="attr">ms</span>");</span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Snowflake</tag>
      </tags>
  </entry>
  <entry>
    <title>Yaml的配置文件读取</title>
    <url>/2022/02/1644832599629/1644832599629/</url>
    <content><![CDATA[<h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.yaml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>snakeyaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.29<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在项目resources下存在文件：config.yaml<br>内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">code:</span> <span class="number">000</span></span><br><span class="line"><span class="attr">message:</span> <span class="string">"成功"</span></span><br><span class="line"><span class="attr">stringList:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">"hello"</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">"world"</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>只要定义同等名称及类型即可赋值获取</p>
<h3 id="类YamlUtils"><a href="#类YamlUtils" class="headerlink" title="类YamlUtils"></a>类YamlUtils</h3><p>采用 @Data 注解 省略set/get 方法</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.yaml.snakeyaml.Yaml;</span><br><span class="line"></span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/8/15 14:51</span><br><span class="line"> * desc ：读取yaml文件，并获取值</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">public class YamlUtils {</span><br><span class="line"></span><br><span class="line">    private static YamlUtils yamlUtils;</span><br><span class="line"></span><br><span class="line">    public static YamlUtils getInstance() {</span><br><span class="line">        if (yamlUtils == null) {</span><br><span class="line">            yamlUtils = new YamlUtils();</span><br><span class="line">        }</span><br><span class="line">        return yamlUtils;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    static {</span><br><span class="line">        try {</span><br><span class="line">            Yaml yaml = new Yaml();</span><br><span class="line">            InputStream inputStream = YamlUtils.class.getResourceAsStream("/config.yaml");</span><br><span class="line">            // 可以将值转换为Map，通过map我们取值就可以了.</span><br><span class="line">            Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> ymlMap = yaml.load(inputStream);</span><br><span class="line">            // 动态赋值</span><br><span class="line">            yamlUtils = YamlUtils.class.newInstance();</span><br><span class="line">            for (Field field : yamlUtils.getClass().getDeclaredFields()) {</span><br><span class="line">                if (ymlMap.containsKey(field.getName())) {</span><br><span class="line">                    boolean flag = field.isAccessible();</span><br><span class="line">                    field.setAccessible(true);</span><br><span class="line">                    Object object = ymlMap.get(field.getName());</span><br><span class="line">                    if (object != null &amp;&amp; field.getType().isAssignableFrom(object.getClass())) {</span><br><span class="line">                        field.set(yamlUtils, object);</span><br><span class="line">                    }</span><br><span class="line">                    field.setAccessible(flag);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private Integer code;</span><br><span class="line">    private String message;</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">String</span>&gt;</span> stringList;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void Test1(){</span><br><span class="line">  System.out.println(YamlUtils.getInstance().getCode());</span><br><span class="line">  System.out.println(YamlUtils.getInstance().getMessage());</span><br><span class="line">  System.out.println(YamlUtils.getInstance().getStringList());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Yaml</tag>
      </tags>
  </entry>
  <entry>
    <title>RestTemplate 封装工具类</title>
    <url>/2021/07/1625194440104/1625194440104/</url>
    <content><![CDATA[<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p><a href="/2020/11/1605079105126/1605079105126/">ApplicationContextHelper</a></p>
<p><a href="/2020/06/1592881660483/1592881660483/">RestTemplate配置</a></p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>简单的 Get、Post 请求</p>
</blockquote>
<blockquote>
<p>自定义请求头的 Get、Post 请求</p>
</blockquote>
<blockquote>
<p>带参数的 Get(Query) 请求</p>
</blockquote>
<blockquote>
<p>带参数的 Post(Query/Body) 请求</p>
</blockquote>
<blockquote>
<p>可上传单个、多个文件的 Post 请求</p>
</blockquote>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.springframework.http.HttpEntity;</span><br><span class="line">import org.springframework.http.HttpHeaders;</span><br><span class="line">import org.springframework.http.HttpMethod;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.util.LinkedMultiValueMap;</span><br><span class="line">import org.springframework.util.MultiValueMap;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line">import org.springframework.web.util.UriComponentsBuilder;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/6/29 18:20</span><br><span class="line"> * desc ：RestTemplate 工具</span><br><span class="line"> */</span><br><span class="line">public class RestTemplateUtil {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义请求头</span><br><span class="line">     * 简单的 Get请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> simpleGet(HttpHeaders headers, String url) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url);</span><br><span class="line">        //将请求头部和参数合成一个请求</span><br><span class="line">        HttpEntity<span class="php"><span class="meta">&lt;?</span>&gt; httpEntity = <span class="keyword">new</span> HttpEntity&lt;&gt;(headers);</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String<span class="class">.<span class="keyword">class</span>);</span></span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 带参数 Get请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param params  参数</span><br><span class="line">     * @return 返回</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; executeGetParam(HttpHeaders headers, String url, Map&lt;String, String&gt; params) {</span></span><br><span class="line"><span class="php">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate<span class="class">.<span class="keyword">class</span>);</span></span></span><br><span class="line"><span class="php">        headers.set(<span class="string">"Content-Type"</span>, <span class="string">"application/x-www-form-urlencoded"</span>);</span></span><br><span class="line"><span class="php">        UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url);</span></span><br><span class="line"><span class="php">        <span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; params.size() &gt; <span class="number">0</span>) {</span></span><br><span class="line"><span class="php">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : params.entrySet()) {</span></span><br><span class="line"><span class="php">                builder.queryParam(entry.getKey(), entry.getValue());</span></span><br><span class="line"><span class="php">            }</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">        <span class="comment">//将请求头部和参数合成一个请求</span></span></span><br><span class="line"><span class="php">        HttpEntity<span class="meta">&lt;?</span>&gt;</span> httpEntity = new HttpEntity<span class="tag">&lt;&gt;</span>(headers);</span><br><span class="line">        return restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义请求头</span><br><span class="line">     *  - Query</span><br><span class="line">     *  - Body</span><br><span class="line">     * 简单的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> simplePost(HttpHeaders headers, String url) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        //将请求头部和参数合成一个请求</span><br><span class="line">        HttpEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> httpEntity = new HttpEntity<span class="tag">&lt;&gt;</span>(null, headers);</span><br><span class="line">        return restTemplate.postForEntity(url, httpEntity, String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 带参数的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param params  参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostFromParam(HttpHeaders headers, String url, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        return restTemplate.postForEntity(url, getMultiValueMap(headers, null, params), String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 上传单个文件的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param file    参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostFromFile(HttpHeaders headers, String url, File file) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        List<span class="tag">&lt;<span class="name">File</span>&gt;</span> files = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        files.add(file);</span><br><span class="line">        return restTemplate.postForEntity(url, getMultiValueMap(headers, files, null), String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 上传多个文件的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param files   参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostFromFile(HttpHeaders headers, String url, List<span class="tag">&lt;<span class="name">File</span>&gt;</span> files) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        return restTemplate.postForEntity(url, getMultiValueMap(headers, files, null), String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 上传单个文件且带参数的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param file    参数</span><br><span class="line">     * @param params  参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostFromFileParam(HttpHeaders headers, String url, File file, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        List<span class="tag">&lt;<span class="name">File</span>&gt;</span> files = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        files.add(file);</span><br><span class="line">        return restTemplate.postForEntity(url, getMultiValueMap(headers, files, params), String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表单 - Query</span><br><span class="line">     * 上传多个文件且带参数的 Post 请求</span><br><span class="line">     *</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url     参数</span><br><span class="line">     * @param files   参数</span><br><span class="line">     * @param params  参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostFromFileParam(HttpHeaders headers, String url, List<span class="tag">&lt;<span class="name">File</span>&gt;</span> files, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        return restTemplate.postForEntity(url, getMultiValueMap(headers, files, params), String.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; getMultiValueMap(HttpHeaders headers, List&lt;File&gt; files, Map&lt;String, String&gt; params) {</span><br><span class="line">        MultiValueMap<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> multiValueMap = new LinkedMultiValueMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        if (files != null &amp;&amp; files.size() &gt; 0) {</span><br><span class="line">            headers.set("Content-Type", "multipart/form-data");</span><br><span class="line">            for (File file : files) {</span><br><span class="line">                multiValueMap.add("file", new org.springframework.core.io.FileSystemResource(file));</span><br><span class="line">            }</span><br><span class="line">        } else {</span><br><span class="line">            headers.set("Content-Type", "application/x-www-form-urlencoded");</span><br><span class="line">        }</span><br><span class="line">        if (params != null &amp;&amp; params.size() &gt; 0) {</span><br><span class="line">            for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : params.entrySet()) {</span><br><span class="line">                multiValueMap.add(entry.getKey(), entry.getValue());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return new HttpEntity<span class="tag">&lt;&gt;</span>(multiValueMap, headers);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Body请求 - Body</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostBody(HttpHeaders headers, String url) {</span><br><span class="line">        return executePostBodyParam(headers,url,null);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Body请求 - Body</span><br><span class="line">     * @param headers 参数</span><br><span class="line">     * @param url 参数</span><br><span class="line">     * @param str 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static ResponseEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> executePostBodyParam(HttpHeaders headers, String url,String str) {</span><br><span class="line">        RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class);</span><br><span class="line">        headers.set("Content-Type", "application/json;charset=UTF-8");</span><br><span class="line">        HttpEntity<span class="tag">&lt;<span class="name">String</span>&gt;</span> httpEntity = new HttpEntity<span class="tag">&lt;&gt;</span>(str, headers);</span><br><span class="line">        return restTemplate.postForEntity(url, httpEntity, String.class);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>RestTemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>RedisTemplate 封装工具类</title>
    <url>/2021/07/1625194461536/1625194461536/</url>
    <content><![CDATA[<p><a href="/2020/11/1605606341401/1605606341401/">配置</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author: Demon</span><br><span class="line"> * @date 2019/8/19 14:34</span><br><span class="line"> * @description:  封装redisUtil类</span><br><span class="line"> */</span><br><span class="line">@SuppressWarnings("ConstantConditions")</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class RedisTemplateUtil {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RedisTemplate<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> redisTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 指定缓存失效时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     */</span><br><span class="line">    public boolean expire(String key, long time) {</span><br><span class="line">        try {</span><br><span class="line">            if (time &gt; 0) {</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            }</span><br><span class="line">            log.info("指定缓存失效时间成功，key:{}, time:{}", key, time);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            log.info("指定缓存失效时间错误，key:{}, time:{}", key, time);</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据key 获取过期时间</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @return 时间(秒) 返回0代表为永久有效</span><br><span class="line">     */</span><br><span class="line">    @SuppressWarnings("ConstantConditions")</span><br><span class="line">    public long getExpire(String key) {</span><br><span class="line">        log.info("获取过期时间，key:{}", key);</span><br><span class="line">        return redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断key是否存在</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean hasKey(String key) {</span><br><span class="line">        try {</span><br><span class="line">            log.info("判断key是否存在，key:{}", key);</span><br><span class="line">            return redisTemplate.hasKey(key);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            log.info("判断key是否存在error，key:{}", key);</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除缓存</span><br><span class="line">     * @param key 可以传一个值 或多个</span><br><span class="line">     */</span><br><span class="line">    public void del(String... key) {</span><br><span class="line">        if (key != null &amp;&amp; key.length &gt; 0) {</span><br><span class="line">            if (key.length == 1) {</span><br><span class="line">                redisTemplate.delete(key[0]);</span><br><span class="line">            } else {</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存获取</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return 值</span><br><span class="line">     */</span><br><span class="line">    public Object get(String key) {</span><br><span class="line">        redisTemplate.getConnectionFactory().getConnection();</span><br><span class="line">        log.info("获取缓存, key:{}", key);</span><br><span class="line">        return key == null ? null : redisTemplate.opsForValue().get(key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存放入</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key, Object value) {</span><br><span class="line">        try {</span><br><span class="line">            System.out.println(redisTemplate.getConnectionFactory().getConnection());</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            log.info("保存缓存, key:{}, value:{}", key, value);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存放入并设置时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期</span><br><span class="line">     * @return true成功 false 失败</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key, Object value, long time) {</span><br><span class="line">        try {</span><br><span class="line">            if (time &gt; 0) {</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            } else {</span><br><span class="line">                set(key, value);</span><br><span class="line">            }</span><br><span class="line">            log.info("保存缓存并设置时间, key:{}, value:{}, time:{}", key, value, time);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 递增</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param delta 要增加几(大于0)</span><br><span class="line">     */</span><br><span class="line">    public long incr(String key, long delta) {</span><br><span class="line">        if (delta <span class="tag">&lt; <span class="attr">0</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">throw</span> <span class="attr">new</span> <span class="attr">RuntimeException</span>("递增因子必须大于<span class="attr">0</span>");</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">redisTemplate.opsForValue</span>()<span class="attr">.increment</span>(<span class="attr">key</span>, <span class="attr">delta</span>);</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 递减</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">key</span> 键</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">delta</span> 要减少几(小于<span class="attr">0</span>)</span></span><br><span class="line"><span class="tag">     * @<span class="attr">return</span> 值</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">long</span> <span class="attr">decr</span>(<span class="attr">String</span> <span class="attr">key</span>, <span class="attr">long</span> <span class="attr">delta</span>) {</span></span><br><span class="line">        if (delta &lt; 0) {</span><br><span class="line">            throw new RuntimeException("递减因子必须大于0");</span><br><span class="line">        }</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * HashGet</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 不能为null</span><br><span class="line">     * @return 值</span><br><span class="line">     */</span><br><span class="line">    public Object hget(String key, String item) {</span><br><span class="line">        return redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取hashKey对应的所有键值</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return 对应的多个键值</span><br><span class="line">     */</span><br><span class="line">    public Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> hmget(String key) {</span><br><span class="line">        return redisTemplate.opsForHash().entries(key);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * HashSet</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param map 对应多个键值</span><br><span class="line">     * @return true 成功 false 失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hmset(String key, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * HashSet 并设置时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param map 对应多个键值</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @return true成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hmset(String key, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> map, long time) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            if (time &gt; 0) {</span><br><span class="line">                expire(key, time);</span><br><span class="line">            }</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true 成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hset(String key, String item, Object value) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span><br><span class="line">     * @return true 成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hset(String key, String item, Object value, long time) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            if (time &gt; 0) {</span><br><span class="line">                expire(key, time);</span><br><span class="line">            }</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除hash表中的值</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 可以使多个 不能为null</span><br><span class="line">     */</span><br><span class="line">    public void hdel(String key, Object... item) {</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断hash表中是否有该项的值</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 不能为null</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean hHasKey(String key, String item) {</span><br><span class="line">        return redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param by 要增加几(大于0)</span><br><span class="line">     */</span><br><span class="line">    public double hincr(String key, String item, double by) {</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hash递减</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param by 要减少记(小于0)</span><br><span class="line">     */</span><br><span class="line">    public double hdecr(String key, String item, double by) {</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据key获取Set中的所有值</span><br><span class="line">     * @param key 键</span><br><span class="line">     */</span><br><span class="line">    public Set<span class="tag">&lt;<span class="name">Object</span>&gt;</span> sGet(String key) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForSet().members(key);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据value从一个set中查询,是否存在</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean sHasKey(String key, Object value) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将数据放入set缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     */</span><br><span class="line">    public long sSet(String key, Object... values) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将set数据放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     */</span><br><span class="line">    public long sSetAndTime(String key, long time, Object... values) {</span><br><span class="line">        try {</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            if (time &gt; 0){</span><br><span class="line">                expire(key, time);</span><br><span class="line">            }</span><br><span class="line">            return count;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取set缓存的长度</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return 值</span><br><span class="line">     */</span><br><span class="line">    @SuppressWarnings("ConstantConditions")</span><br><span class="line">    public long sGetSetSize(String key) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForSet().size(key);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除值为value的</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     * @return 移除的个数</span><br><span class="line">     */</span><br><span class="line">    public long setRemove(String key, Object... values) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取list缓存的内容</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param start 开始</span><br><span class="line">     * @param end 结束 0 到 -1代表所有值</span><br><span class="line">     */</span><br><span class="line">    public List<span class="tag">&lt;<span class="name">Object</span>&gt;</span> lGet(String key, long start, long end) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取list缓存的长度</span><br><span class="line">     * @param key 键</span><br><span class="line">     */</span><br><span class="line">    public long lGetListSize(String key) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForList().size(key);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过索引 获取list中的值</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index<span class="tag">&lt;<span class="name">0时，-1，表尾，-2倒数第二个元素，依次类推</span></span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">Object</span> <span class="attr">lGetIndex</span>(<span class="attr">String</span> <span class="attr">key</span>, <span class="attr">long</span> <span class="attr">index</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">try</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">redisTemplate.opsForList</span>()<span class="attr">.index</span>(<span class="attr">key</span>, <span class="attr">index</span>);</span></span><br><span class="line"><span class="tag">        } <span class="attr">catch</span> (<span class="attr">Exception</span> <span class="attr">e</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">e.printStackTrace</span>();</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">null</span>;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 将<span class="attr">list</span>放入缓存</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">key</span> 键</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">value</span> 值</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">boolean</span> <span class="attr">lSet</span>(<span class="attr">String</span> <span class="attr">key</span>, <span class="attr">Object</span> <span class="attr">value</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">try</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">redisTemplate.opsForList</span>()<span class="attr">.rightPush</span>(<span class="attr">key</span>, <span class="attr">value</span>);</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">true</span>;</span></span><br><span class="line"><span class="tag">        } <span class="attr">catch</span> (<span class="attr">Exception</span> <span class="attr">e</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">e.printStackTrace</span>();</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">false</span>;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 将<span class="attr">list</span>放入缓存</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">key</span> 键</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">value</span> 值</span></span><br><span class="line"><span class="tag">     * @<span class="attr">param</span> <span class="attr">time</span> 时间(秒)</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">public</span> <span class="attr">boolean</span> <span class="attr">lSet</span>(<span class="attr">String</span> <span class="attr">key</span>, <span class="attr">Object</span> <span class="attr">value</span>, <span class="attr">long</span> <span class="attr">time</span>) {</span></span><br><span class="line"><span class="tag">        <span class="attr">try</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">redisTemplate.opsForList</span>()<span class="attr">.rightPush</span>(<span class="attr">key</span>, <span class="attr">value</span>);</span></span><br><span class="line"><span class="tag">            <span class="attr">if</span> (<span class="attr">time</span> &gt;</span> 0){</span><br><span class="line">                expire(key, time);</span><br><span class="line">            }</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, List<span class="tag">&lt;<span class="name">Object</span>&gt;</span> value) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     *</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, List<span class="tag">&lt;<span class="name">Object</span>&gt;</span> value, long time) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            if (time &gt; 0){</span><br><span class="line">                expire(key, time);</span><br><span class="line">            }</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据索引修改list中的某条数据</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param index 索引</span><br><span class="line">     * @param value 值</span><br><span class="line">     */</span><br><span class="line">    public boolean lUpdateIndex(String key, long index, Object value) {</span><br><span class="line">        try {</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除N个值为value</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param count 移除多少个</span><br><span class="line">     * @param value 值</span><br><span class="line">     */</span><br><span class="line">    public long lRemove(String key, long count, Object value) {</span><br><span class="line">        try {</span><br><span class="line">            return redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>RedisTemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven多模块指定模块工程打包</title>
    <url>/2022/02/1644831407066/1644831407066/</url>
    <content><![CDATA[<h3 id="打包说明"><a href="#打包说明" class="headerlink" title="打包说明"></a>打包说明</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Maven多模块工程打包指定模块工程执行如下命令：</span><br><span class="line">mvn clean package -pl  指定模块工程名 -am</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line">-am --also-make 同时构建所列模块的依赖模块；</span><br><span class="line">-amd -also-make-dependents 同时构建依赖于所列模块的模块；</span><br><span class="line">-pl --projects <span class="tag">&lt;<span class="name">arg</span>&gt;</span> 构建制定的模块，模块间用逗号分隔；</span><br><span class="line">-rf -resume-from <span class="tag">&lt;<span class="name">arg</span>&gt;</span> 从指定的模块恢复反应堆。</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Parent</span><br><span class="line">  - common          公共模块</span><br><span class="line">  - deploy          部署模块</span><br><span class="line">    - service1      部署服务1 -&gt; 引入 服务1</span><br><span class="line">    - service2      部署服务2 -&gt; 引入 服务2</span><br><span class="line">    - service3      部署服务3 -&gt; 引入 服务3</span><br><span class="line">  - forward         第三方模块 -&gt; 引入 公共模块</span><br><span class="line">  - framework       Spring模块 -&gt; 引入 公共模块</span><br><span class="line">  - service         服务模块</span><br><span class="line">    - service1      服务1 -&gt; 引入 Spring模块</span><br><span class="line">    - service2      服务2 -&gt; 引入 Spring模块</span><br><span class="line">    - service3      服务3 -&gt; 引入 Spring模块</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h3><p>在根目录Parent下进行打包</p>
<blockquote>
<p>打包部署service1模块 :<br>  mvn clean package -pl deploy/service1 -am</p>
</blockquote>
<blockquote>
<p>打包部署service2模块 :<br>  mvn clean package -pl deploy/service2 -am</p>
</blockquote>
<blockquote>
<p>打包部署service3模块 :<br>  mvn clean package -pl deploy/service3 -am</p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>pom</tag>
      </tags>
  </entry>
  <entry>
    <title>Freemarker 封装工具类</title>
    <url>/2021/07/1625196322877/1625196322877/</url>
    <content><![CDATA[<p><a href="/2020/08/1597309130215/1597309130215/">配置</a></p>
<p>FreemarkerService：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    FreemarkerService</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/5/20 17:40</span><br><span class="line"> * description  生成静态页面service</span><br><span class="line"> */</span><br><span class="line">public interface FreemarkerService {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生成静态页面</span><br><span class="line">     *</span><br><span class="line">     * @param ftlName 模板名称</span><br><span class="line">     * @param params  数据模型</span><br><span class="line">     * @param outFile 输出文件</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    boolean createStaticHtml(String ftlName, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params, File outFile);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 生成静态数据</span><br><span class="line">     *</span><br><span class="line">     * @param ftlName 模板名称</span><br><span class="line">     * @param params  数据模型</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws Exception 异常</span><br><span class="line">     */</span><br><span class="line">    String createStaticData(String ftlName, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 渲染静态数据</span><br><span class="line">     *</span><br><span class="line">     * @param ftlName 模板名称 - 自定义(随便一个值都行)</span><br><span class="line">     * @param ftlStr 模板字符串 - 内容</span><br><span class="line">     * @param params  数据模型</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws Exception 异常</span><br><span class="line">     */</span><br><span class="line">    String createStaticData(String ftlName,String ftlStr, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 渲染静态数据</span><br><span class="line">     *</span><br><span class="line">     * @param ftlName 模板名称 - 自定义(随便一个值都行)</span><br><span class="line">     * @param inputStream 模板字符串 - 内容 （文件流）</span><br><span class="line">     *                    resources目录下的文件 如：</span><br><span class="line">     *                    InputStream inputStream = xxx.class.getResourceAsStream("/ftl/example.ftl");</span><br><span class="line">     * @param params  数据模型</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws Exception 异常</span><br><span class="line">     */</span><br><span class="line">    String createStaticData(String ftlName, InputStream inputStream, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import freemarker.template.Configuration;</span><br><span class="line">import freemarker.template.Template;</span><br><span class="line">import freemarker.template.TemplateException;</span><br><span class="line">import org.apache.commons.io.FileUtils;</span><br><span class="line">import org.apache.commons.io.IOUtils;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.ui.freemarker.FreeMarkerTemplateUtils;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    FreemarkerServiceImpl</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/5/20 17:40</span><br><span class="line"> */</span><br><span class="line">@Service</span><br><span class="line">public class FreemarkerServiceImpl implements FreemarkerService {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private Configuration configuration;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean createStaticHtml(String ftlName, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params, File outFile) {</span><br><span class="line">        InputStream inputStream = null;</span><br><span class="line">        FileOutputStream fileOutputStream = null;</span><br><span class="line">        try {</span><br><span class="line">            //获取模板</span><br><span class="line">            Template template = configuration.getTemplate(ftlName);</span><br><span class="line">            // 静态化页面内容</span><br><span class="line">            String content = FreeMarkerTemplateUtils.processTemplateIntoString(template, params);</span><br><span class="line">            inputStream = IOUtils.toInputStream(content, "UTF-8");</span><br><span class="line">            // 输出文件</span><br><span class="line">            FileUtils.forceMkdirParent(outFile);</span><br><span class="line">            fileOutputStream = new FileOutputStream(outFile);</span><br><span class="line">            IOUtils.copy(inputStream, fileOutputStream);</span><br><span class="line">            return true;</span><br><span class="line">        } catch (IOException | TemplateException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        } finally {</span><br><span class="line">            // 关闭流</span><br><span class="line">            if (inputStream != null) {</span><br><span class="line">                try {</span><br><span class="line">                    inputStream.close();</span><br><span class="line">                } catch (IOException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                } finally {</span><br><span class="line">                    if (fileOutputStream != null) {</span><br><span class="line">                        try {</span><br><span class="line">                            fileOutputStream.close();</span><br><span class="line">                        } catch (IOException e) {</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String createStaticData(String ftlName, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception {</span><br><span class="line">        try {</span><br><span class="line">            //获取模板</span><br><span class="line">            Template template = configuration.getTemplate(ftlName);</span><br><span class="line">            // 静态化数据内容</span><br><span class="line">            return FreeMarkerTemplateUtils.processTemplateIntoString(template, params);</span><br><span class="line">        } catch (IOException | TemplateException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String createStaticData(String ftlName, String templateStr, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception {</span><br><span class="line">        try {</span><br><span class="line">            //创建模板</span><br><span class="line">            Template template = new Template(ftlName, templateStr, configuration);</span><br><span class="line">            // 渲染静态数据内容</span><br><span class="line">            return FreeMarkerTemplateUtils.processTemplateIntoString(template, params);</span><br><span class="line">        } catch (IOException | TemplateException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public String createStaticData(String ftlName, InputStream inputStream, Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params) throws Exception {</span><br><span class="line">        try {</span><br><span class="line">            String ftlStr = IOUtils.toString(inputStream, "utf-8");</span><br><span class="line">            //创建模板</span><br><span class="line">            Template template = new Template(ftlName, ftlStr, configuration);</span><br><span class="line">            // 渲染静态数据内容</span><br><span class="line">            return FreeMarkerTemplateUtils.processTemplateIntoString(template, params);</span><br><span class="line">        } catch (IOException | TemplateException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            throw new Exception(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>模板：<br>example.ftl：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">  "username": "${username}"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>示例1：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void 测试模板_静态页面() {</span><br><span class="line">    String ftlName = "example.ftl";</span><br><span class="line">    Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    params.put("username", "测试888");</span><br><span class="line">    System.out.println(JSONObject.toJSONString(params));</span><br><span class="line">    File outFile = new File("d:/test/page/test.html");</span><br><span class="line">    System.out.println(freemarkerService.createStaticHtml(ftlName, params, outFile));</span><br><span class="line">}</span><br><span class="line">    </span><br><span class="line">@Test</span><br><span class="line">void 测试模板_渲染数据1() {</span><br><span class="line">    String ftlName = "example.ftl";</span><br><span class="line">    String templateValue = "hello,${username}";</span><br><span class="line">    Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    params.put("username","测试888");</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(freemarkerService.createStaticData(ftlName,params));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void 测试模板_渲染数据2() {</span><br><span class="line">    String ftlName = "example.ftl";</span><br><span class="line">    String templateStr = "hello,${username}";</span><br><span class="line">    Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    params.put("username","测试888");</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(freemarkerService.createStaticData(ftlName,templateStr,params));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">void 测试模板_渲染数据3() {</span><br><span class="line">    String ftlName = "example.ftl";</span><br><span class="line">    String templateValue = "hello,${username}";</span><br><span class="line">    Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">    params.put("username", "测试888");</span><br><span class="line">    System.out.println(JSONObject.toJSONString(params));</span><br><span class="line">    try {</span><br><span class="line">        InputStream inputStream = xxx.class.getResourceAsStream("/ftl/example.ftl");</span><br><span class="line">        System.out.println(freemarkerService.createStaticData(ftlName, inputStream, params));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>运行结果：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">hello,测试888</span><br><span class="line">{</span><br><span class="line">  "username": "测试888"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>freemarker</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch-v6.8.1的安装</title>
    <url>/2021/07/1626758495025/1626758495025/</url>
    <content><![CDATA[<h3 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h3><p>ElasticSearch是基于lucence开发的，也就是运行需要java jdk支持，所以要先安装JAVA环境。<br>由于ElasticSearch 5.x 往后依赖于JDK 1.8的，所以现在我们下载JDK 1.8或者更高版本。<br>下载JDK1.8,下载完成后<a href="/2020/05/1590236390000/1590236390000/">安装</a></p>
<p>如若不安装JDK，可使用ElasticSearch的自带的JDK <a href="#使用自带的JDK">使用自带的JDK</a></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener">官网</a><br><a href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-6-8-1" target="_blank" rel="noopener">elasticsearch-6-8-1</a><br><img src="/2021/07/1626758495025/1626758495025/20210720132838.png" alt="20210720132838"></p>
<p>解压<br><img src="/2021/07/1626758495025/1626758495025/20210720133515.png" alt="20210720133515"></p>
<h3 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h3><p>进入bin目录下,双击执行elasticsearch.bat<br><img src="/2021/07/1626758495025/1626758495025/20210720133655.png" alt="20210720133655"><br><img src="/2021/07/1626758495025/1626758495025/20210720134124.png" alt="20210720134124"></p>
<p>浏览器访问：<a href="http://localhost:9200" target="_blank" rel="noopener">http://localhost:9200</a><br><img src="/2021/07/1626758495025/1626758495025/20210720134200.png" alt="20210720134200"></p>
<h2 id="配置远程访问"><a href="#配置远程访问" class="headerlink" title="配置远程访问"></a>配置远程访问</h2><p>修改es使用的参数.编辑目录下的config\elasticsearch.yml文件,</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">network.host: 0.0.0.0  </span><br><span class="line">http.port: 9200</span><br><span class="line"></span><br><span class="line">cluster.initial_master_nodes: ["node-1"]</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2021/07/1626758495025/1626758495025/20210720150202.png" alt="20210720150202"></p>
<h2 id="使用自带的JDK"><a href="#使用自带的JDK" class="headerlink" title="使用自带的JDK"></a>使用自带的JDK</h2><p>在bin目录下找到elasticsearch-env.bat并打开，加入你es7本身自带的jdk路径：<br>rem 配置es自己的jdk<br>set ES_JAVA_HOME=D:\services\elasticsearch-7.13.3\jdk<br><img src="/2021/07/1626758495025/1626758495025/20210720151122.png" alt="20210720151122"></p>
<h3 id="ElasticSearch安装为Windows服务"><a href="#ElasticSearch安装为Windows服务" class="headerlink" title="ElasticSearch安装为Windows服务"></a>ElasticSearch安装为Windows服务</h3><p>bin目录下有一个文件 elasticsearch-service.bat</p>
<p>执行: elasticsearch-service.bat install 即可安装为服务</p>
<p>安装ElasticSearch服务：</p>
<blockquote>
<p>elasticsearch-service.bat install</p>
</blockquote>
<p>删除已安装的ElasticSearch服务（如果启动则停止服务）</p>
<blockquote>
<p>elasticsearch-service.bat remove</p>
</blockquote>
<p>启动ElasticSearch服务（如果已安装）</p>
<blockquote>
<p>elasticsearch-service.bat start</p>
</blockquote>
<p>停止ElasticSearch服务（如果已安装）</p>
<blockquote>
<p>elasticsearch-service.bat stop</p>
</blockquote>
<p>启动GUI来管理已安装的服务</p>
<blockquote>
<p>elasticsearch-service.bat manager</p>
</blockquote>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch的浏览插件 - elasticsearch-head</title>
    <url>/2021/07/1626760500688/1626760500688/</url>
    <content><![CDATA[<h3 id="ElasticSearch-head页面介绍"><a href="#ElasticSearch-head页面介绍" class="headerlink" title="ElasticSearch-head页面介绍"></a>ElasticSearch-head页面介绍</h3><p>在登陆和访问head插件地址和ElasticSearch前需要事先在服务器上安装和配置好ElasticSearch以及head插件。<br>安装完后，默认head插件的web端口为9100，ElasticSearch服务的端口为9200，使用浏览器访问head地址，如 <a href="http://localhost:9100/，" target="_blank" rel="noopener">http://localhost:9100/，</a><br>推荐使用Chrome浏览器，head插件对Chrome浏览器兼容更佳。<br>进入head页面后将ElasticSearch连接输入框中填写正确的ElasticSearch服务地址，如 <a href="http://localhost:9200/。" target="_blank" rel="noopener">http://localhost:9200/。</a></p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p><a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">网址</a> <a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head</a><br><a href="https://github.com/mobz/elasticsearch-head/archive/refs/heads/master.zip" target="_blank" rel="noopener">下载</a> <a href="https://github.com/mobz/elasticsearch-head/archive/refs/heads/master.zip" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head/archive/refs/heads/master.zip</a></p>
<p>解压<br><img src="/2021/07/1626760500688/1626760500688/20210720140821.png" alt="20210720140821"></p>
<p>进入head文件夹下，执行命令：npm install (此处是为安装进行安装pathomjs)<br><img src="/2021/07/1626760500688/1626760500688/20210720141653.png" alt="20210720141653"><br><img src="/2021/07/1626760500688/1626760500688/20210720142330.png" alt="20210720142330"></p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>安装完成之后 npm run start 启动head插件<br><img src="/2021/07/1626760500688/1626760500688/20210720142519.png" alt="20210720142519"></p>
<p>访问：<a href="http://localhost:9100/" target="_blank" rel="noopener">http://localhost:9100/</a><br><img src="/2021/07/1626760500688/1626760500688/20210720142559.png" alt="20210720142559"></p>
<h3 id="修改es配置"><a href="#修改es配置" class="headerlink" title="修改es配置"></a>修改es配置</h3><p>修改es使用的参数.编辑目录下的config\elasticsearch.yml文件,</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 增加新的参数，这样head插件可以访问es</span><br><span class="line">http.cors.enabled: true </span><br><span class="line">http.cors.allow-origin: "*"</span><br></pre></td></tr></tbody></table></figure></div>
<p>修改完配置将es重启,浏览器访问 <a href="http://localhost:9100" target="_blank" rel="noopener">http://localhost:9100</a><br><img src="/2021/07/1626760500688/1626760500688/20210720143422.png" alt="20210720143422"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>Go-FastDfs 使用</title>
    <url>/2021/11/1636190973137/1636190973137/</url>
    <content><![CDATA[<p><a href="/2021/05/1620815885110/1620815885110/">安装</a></p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONObject;</span><br><span class="line">import okhttp3.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/5/26 11:36</span><br><span class="line"> * desc ：GoFast工具类</span><br><span class="line"> */</span><br><span class="line">public class GoFastFileService {</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public GoFastFileResult upload(String url, String scene, String fileName, byte[] bytes) throws Exception {</span><br><span class="line">        MultipartBody multipartBody = new MultipartBody.Builder().</span><br><span class="line">                setType(MultipartBody.FORM)</span><br><span class="line">                .addFormDataPart("file", fileName, RequestBody.create(MediaType.parse("multipart/form-data;charset=utf-8"), bytes))</span><br><span class="line">                .addFormDataPart("output", "json")</span><br><span class="line">                .addFormDataPart("scene", scene)</span><br><span class="line">                .build();</span><br><span class="line">        try {</span><br><span class="line">            GoFastFileResult goFastFileResult = new GoFastFileResult();</span><br><span class="line">            Request request = new Request.Builder().url(url).post(multipartBody).build();</span><br><span class="line">            Response response = new OkHttpClient().newCall(request).execute();</span><br><span class="line">            if (response.isSuccessful()) {</span><br><span class="line">                ResponseBody body = response.body();</span><br><span class="line">                if (body != null) {</span><br><span class="line">                    String result = body.string();</span><br><span class="line">                    System.out.println(result);</span><br><span class="line">                    JSONObject jsonObject = JSON.parseObject(result);</span><br><span class="line">                    if(String.valueOf(jsonObject.get("status")).equals("fail")){</span><br><span class="line">                        throw new Exception("上传文件异常:"+ jsonObject.get("message"));</span><br><span class="line">                    } else {</span><br><span class="line">                        goFastFileResult.setUrl(String.valueOf(jsonObject.get("url")));</span><br><span class="line">                        goFastFileResult.setMd5(String.valueOf(jsonObject.get("md5")));</span><br><span class="line">                        goFastFileResult.setPath(String.valueOf(jsonObject.get("path")));</span><br><span class="line">                        goFastFileResult.setDomain(String.valueOf(jsonObject.get("domain")));</span><br><span class="line">                        goFastFileResult.setScene(String.valueOf(jsonObject.get("scene")));</span><br><span class="line">                        goFastFileResult.setSize(Long.parseLong(String.valueOf(jsonObject.get("size"))));</span><br><span class="line">                        goFastFileResult.setMtime(Long.parseLong(String.valueOf(jsonObject.get("mtime"))));</span><br><span class="line">                        goFastFileResult.setScenes(String.valueOf(jsonObject.get("scenes")));</span><br><span class="line">                        goFastFileResult.setRetmsg(String.valueOf(jsonObject.get("retmsg")));</span><br><span class="line">                        goFastFileResult.setRetcode(String.valueOf(jsonObject.get("retcode")).equals("0"));</span><br><span class="line">                        goFastFileResult.setSrc(String.valueOf(jsonObject.get("src")));</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return goFastFileResult;</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            log.error("上传文件到影像服务器异常", e);</span><br><span class="line">            throw new Exception("上传文件异常",e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<p>返回值的实体类</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/5/26 13:23</span><br><span class="line"> * desc ：GoFastFile 结果返回映射</span><br><span class="line"> */</span><br><span class="line">public class GoFastFileResult implements Serializable {</span><br><span class="line"></span><br><span class="line">    private String url;</span><br><span class="line">    private String md5;</span><br><span class="line">    private String path;</span><br><span class="line">    private String domain;</span><br><span class="line">    private String scene;</span><br><span class="line">    private long size;</span><br><span class="line">    private long mtime;</span><br><span class="line">    private String scenes;</span><br><span class="line">    private String retmsg;</span><br><span class="line">    private Boolean retcode;</span><br><span class="line">    private String src;</span><br><span class="line"></span><br><span class="line">    public String getUrl() {</span><br><span class="line">        return url;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setUrl(String url) {</span><br><span class="line">        this.url = url;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getMd5() {</span><br><span class="line">        return md5;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setMd5(String md5) {</span><br><span class="line">        this.md5 = md5;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getPath() {</span><br><span class="line">        return path;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setPath(String path) {</span><br><span class="line">        this.path = path;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getDomain() {</span><br><span class="line">        return domain;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setDomain(String domain) {</span><br><span class="line">        this.domain = domain;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getScene() {</span><br><span class="line">        return scene;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setScene(String scene) {</span><br><span class="line">        this.scene = scene;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public long getSize() {</span><br><span class="line">        return size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setSize(long size) {</span><br><span class="line">        this.size = size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public long getMtime() {</span><br><span class="line">        return mtime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setMtime(long mtime) {</span><br><span class="line">        this.mtime = mtime;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getScenes() {</span><br><span class="line">        return scenes;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setScenes(String scenes) {</span><br><span class="line">        this.scenes = scenes;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getRetmsg() {</span><br><span class="line">        return retmsg;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setRetmsg(String retmsg) {</span><br><span class="line">        this.retmsg = retmsg;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public Boolean getRetcode() {</span><br><span class="line">        return retcode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setRetcode(Boolean retcode) {</span><br><span class="line">        this.retcode = retcode;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getSrc() {</span><br><span class="line">        return src;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setSrc(String src) {</span><br><span class="line">        this.src = src;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Go-FastDfs</category>
      </categories>
      <tags>
        <tag>Go-FastDfs</tag>
      </tags>
  </entry>
  <entry>
    <title>Kibana的安装</title>
    <url>/2022/03/1646201017125/1646201017125/</url>
    <content><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Kibana是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据；<br>使用Kibana，可以通过各种图表进行高级数据分析及展示，让海量数据更容易理解；<br>Kibana操作简单，基于浏览器的用户界面可以快速创建仪表板（dashboard）实时显示Elasticsearch查询动态；<br>设置Kibana非常简单。无需编码或者额外的基础架构，几分钟内就可以完成Kibana安装并启动Elasticsearch索引监测；</p>
<h3 id="安装Kibana"><a href="#安装Kibana" class="headerlink" title="安装Kibana"></a>安装Kibana</h3><p>下载解压安装包，一定要装与ES相同的版本；由于本地ElasticSearch安装的版本为6.8.1；所以下载相同版本：<a href="https://artifacts.elastic.co/downloads/kibana/kibana-6.8.1-windows-x86_64.zip" target="_blank" rel="noopener">kibana-6.8.1</a><br>下载地址：<a href="https://www.elastic.co/cn/downloads/past-releases#kibana" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/past-releases#kibana</a><br><img src="/2022/03/1646201017125/1646201017125/20220302145050.png" alt="20220302145050"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>解压文件并进入 \kibana-6.8.1-windows-x86_64\config目录下，打开 kibana.yml 进行配置；修改内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 服务端口号</span><br><span class="line">server.port: 5601</span><br><span class="line"># 允许访问的IP,如果允许任何IP访问此处输入0.0.0.0</span><br><span class="line">server.host: "0.0.0.0"</span><br><span class="line"># 服务名称</span><br><span class="line">server.name: "kibana"</span><br><span class="line"># ES服务地址</span><br><span class="line">elasticsearch.hosts: ["http://localhost:9200"]</span><br><span class="line"># 设置kibana为中文</span><br><span class="line">i18n.locale: "zh-CN"</span><br></pre></td></tr></tbody></table></figure></div>
<p><a href="#修改后的完整配置">修改后的完整配置</a></p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>1.启动ES<br>2.启用kibana  </p>
<p>cmd 进入目录：\kibana-6.8.1-windows-x86_64\bin 下双击运行：kibana.bat 即可<br><img src="/2022/03/1646201017125/1646201017125/20220302151256.png" alt="20220302151256"></p>
<h3 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h3><p>主界面：<a href="http://localhost:5601/" target="_blank" rel="noopener">http://localhost:5601/</a><br><img src="/2022/03/1646201017125/1646201017125/20220302151428.png" alt="20220302151428"></p>
<p>状态界面：<a href="http://localhost:5601/status" target="_blank" rel="noopener">http://localhost:5601/status</a><br>开发工具：<a href="http://localhost:5601/app/kibana#/dev_tools/console?_g=()" target="_blank" rel="noopener">http://localhost:5601/app/kibana#/dev_tools/console?_g=()</a><br>索引管理：<a href="http://localhost:5601/app/kibana#/management/elasticsearch/index_management/indices?_g=()" target="_blank" rel="noopener">http://localhost:5601/app/kibana#/management/elasticsearch/index_management/indices?_g=()</a></p>
<h3 id="修改后的完整配置"><a href="#修改后的完整配置" class="headerlink" title="修改后的完整配置"></a>修改后的完整配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line"># Kibana is served by a back end server. This setting specifies the port to use.</span><br><span class="line">#server.port: 5601</span><br><span class="line"># 服务端口号</span><br><span class="line">server.port: 5601</span><br><span class="line"></span><br><span class="line"># Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.</span><br><span class="line"># The default is 'localhost', which usually means remote machines will not be able to connect.</span><br><span class="line"># To allow connections from remote users, set this parameter to a non-loopback address.</span><br><span class="line">#server.host: "localhost"</span><br><span class="line"># 允许访问的IP,如果允许任何IP访问此处输入0.0.0.0</span><br><span class="line">server.host: "0.0.0.0"</span><br><span class="line"></span><br><span class="line"># Enables you to specify a path to mount Kibana at if you are running behind a proxy.</span><br><span class="line"># Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath</span><br><span class="line"># from requests it receives, and to prevent a deprecation warning at startup.</span><br><span class="line"># This setting cannot end in a slash.</span><br><span class="line">#server.basePath: ""</span><br><span class="line"></span><br><span class="line"># Specifies whether Kibana should rewrite requests that are prefixed with</span><br><span class="line"># `server.basePath` or require that they are rewritten by your reverse proxy.</span><br><span class="line"># This setting was effectively always `false` before Kibana 6.3 and will</span><br><span class="line"># default to `true` starting in Kibana 7.0.</span><br><span class="line">#server.rewriteBasePath: false</span><br><span class="line"></span><br><span class="line"># The maximum payload size in bytes for incoming server requests.</span><br><span class="line">#server.maxPayloadBytes: 1048576</span><br><span class="line"></span><br><span class="line"># The Kibana server's name.  This is used for display purposes.</span><br><span class="line">#server.name: "your-hostname"</span><br><span class="line"># 服务名称</span><br><span class="line">server.name: "kibana"</span><br><span class="line"></span><br><span class="line"># The URLs of the Elasticsearch instances to use for all your queries.</span><br><span class="line">#elasticsearch.hosts: ["http://localhost:9200"]</span><br><span class="line"># ES服务地址</span><br><span class="line">elasticsearch.hosts: ["http://localhost:9200"]</span><br><span class="line"></span><br><span class="line"># When this setting's value is true Kibana uses the hostname specified in the server.host</span><br><span class="line"># setting. When the value of this setting is false, Kibana uses the hostname of the host</span><br><span class="line"># that connects to this Kibana instance.</span><br><span class="line">#elasticsearch.preserveHost: true</span><br><span class="line"></span><br><span class="line"># Kibana uses an index in Elasticsearch to store saved searches, visualizations and</span><br><span class="line"># dashboards. Kibana creates a new index if the index doesn't already exist.</span><br><span class="line"># 创建的索引</span><br><span class="line">#kibana.index: ".kibana"</span><br><span class="line"></span><br><span class="line"># The default application to load.</span><br><span class="line">#kibana.defaultAppId: "home"</span><br><span class="line"></span><br><span class="line"># If your Elasticsearch is protected with basic authentication, these settings provide</span><br><span class="line"># the username and password that the Kibana server uses to perform maintenance on the Kibana</span><br><span class="line"># index at startup. Your Kibana users still need to authenticate with Elasticsearch, which</span><br><span class="line"># is proxied through the Kibana server.</span><br><span class="line"># 登录ES使用的用户名和密码</span><br><span class="line">#elasticsearch.username: "user"</span><br><span class="line">#elasticsearch.password: "pass"</span><br><span class="line"></span><br><span class="line"># Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.</span><br><span class="line"># These settings enable SSL for outgoing requests from the Kibana server to the browser.</span><br><span class="line">#server.ssl.enabled: false</span><br><span class="line">#server.ssl.certificate: /path/to/your/server.crt</span><br><span class="line">#server.ssl.key: /path/to/your/server.key</span><br><span class="line"></span><br><span class="line"># Optional settings that provide the paths to the PEM-format SSL certificate and key files.</span><br><span class="line"># These files validate that your Elasticsearch backend uses the same key files.</span><br><span class="line">#elasticsearch.ssl.certificate: /path/to/your/client.crt</span><br><span class="line">#elasticsearch.ssl.key: /path/to/your/client.key</span><br><span class="line"></span><br><span class="line"># Optional setting that enables you to specify a path to the PEM file for the certificate</span><br><span class="line"># authority for your Elasticsearch instance.</span><br><span class="line">#elasticsearch.ssl.certificateAuthorities: [ "/path/to/your/CA.pem" ]</span><br><span class="line"></span><br><span class="line"># To disregard the validity of SSL certificates, change this setting's value to 'none'.</span><br><span class="line">#elasticsearch.ssl.verificationMode: full</span><br><span class="line"></span><br><span class="line"># Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of</span><br><span class="line"># the elasticsearch.requestTimeout setting.</span><br><span class="line">#elasticsearch.pingTimeout: 1500</span><br><span class="line"></span><br><span class="line"># Time in milliseconds to wait for responses from the back end or Elasticsearch. This value</span><br><span class="line"># must be a positive integer.</span><br><span class="line">#elasticsearch.requestTimeout: 30000</span><br><span class="line"></span><br><span class="line"># List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side</span><br><span class="line"># headers, set this value to [] (an empty list).</span><br><span class="line">#elasticsearch.requestHeadersWhitelist: [ authorization ]</span><br><span class="line"></span><br><span class="line"># Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten</span><br><span class="line"># by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.</span><br><span class="line">#elasticsearch.customHeaders: {}</span><br><span class="line"></span><br><span class="line"># Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.</span><br><span class="line">#elasticsearch.shardTimeout: 30000</span><br><span class="line"></span><br><span class="line"># Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying.</span><br><span class="line">#elasticsearch.startupTimeout: 5000</span><br><span class="line"></span><br><span class="line"># Logs queries sent to Elasticsearch. Requires logging.verbose set to true.</span><br><span class="line">#elasticsearch.logQueries: false</span><br><span class="line"></span><br><span class="line"># Specifies the path where Kibana creates the process ID file.</span><br><span class="line">#pid.file: /var/run/kibana.pid</span><br><span class="line"></span><br><span class="line"># Enables you specify a file where Kibana stores log output.</span><br><span class="line">#logging.dest: stdout</span><br><span class="line"></span><br><span class="line"># Set the value of this setting to true to suppress all logging output.</span><br><span class="line">#logging.silent: false</span><br><span class="line"></span><br><span class="line"># Set the value of this setting to true to suppress all logging output other than error messages.</span><br><span class="line">#logging.quiet: false</span><br><span class="line"></span><br><span class="line"># Set the value of this setting to true to log all events, including system usage information</span><br><span class="line"># and all requests.</span><br><span class="line">#logging.verbose: false</span><br><span class="line"></span><br><span class="line"># Set the interval in milliseconds to sample system and process performance</span><br><span class="line"># metrics. Minimum is 100ms. Defaults to 5000.</span><br><span class="line">#ops.interval: 5000</span><br><span class="line"></span><br><span class="line"># Specifies locale to be used for all localizable strings, dates and number formats.</span><br><span class="line">#i18n.locale: "en"</span><br><span class="line"># 设置kibana为中文</span><br><span class="line">i18n.locale: "zh-CN"</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>Kibana</tag>
      </tags>
  </entry>
  <entry>
    <title>Maven项目的插件使用</title>
    <url>/2022/03/1646127631469/1646127631469/</url>
    <content><![CDATA[<h3 id="编译插件"><a href="#编译插件" class="headerlink" title="编译插件"></a>编译插件</h3><p>JDK版本</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可能需要版本号 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="源码打包"><a href="#源码打包" class="headerlink" title="源码打包"></a>源码打包</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="依赖插件"><a href="#依赖插件" class="headerlink" title="依赖插件"></a>依赖插件</h3><p>将子模块的class文件以及配置文件复制到根级目录下</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 将依赖包统一放到某个目录 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>${project.build.directory}/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludeScope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">excludeScope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>unpack<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--指定的依赖包--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactItems</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactItem</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.demon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demon-service-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 排除 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span>code.properties,system-config-prod.yaml<span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 包含（需放在排序之后） --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span>&gt;</span>**/*<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 用来指定拷出后Libraries的存放地 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>${project.build.directory}/classes<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">overWrite</span>&gt;</span>false<span class="tag">&lt;/<span class="name">overWrite</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">artifactItem</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">artifactItems</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="依赖打包"><a href="#依赖打包" class="headerlink" title="依赖打包"></a>依赖打包</h3><p>打出无/有依赖的jar,jar-with-dependencies结尾的表示含有jar的文件<br>打包命令：clean assembly:assembly</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appendAssemblyId</span>&gt;</span>false<span class="tag">&lt;/<span class="name">appendAssemblyId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这部分可有可无,加上的话则直接生成可运行jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">archive</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 主函数 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.demon.App<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>make-assembly<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>assembly<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="安装第三方依赖包"><a href="#安装第三方依赖包" class="headerlink" title="安装第三方依赖包"></a>安装第三方依赖包</h3><p>在src的同级目录下新增lib包，将xxx-0.0.1.jar放置在lib包下</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-install-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>install-external<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>clean<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">file</span>&gt;</span>${basedir}/src/lib/demon-0.0.1.jar<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">repositoryLayout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">repositoryLayout</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 安装jar的属性 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.demon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">generatePom</span>&gt;</span>true<span class="tag">&lt;/<span class="name">generatePom</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>install-file<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="复制文件到指定目录"><a href="#复制文件到指定目录" class="headerlink" title="复制文件到指定目录"></a>复制文件到指定目录</h3><p>把打包生成jar包复制到指定的位置</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>run<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--todir指定要复制到哪个位置，这里我设置为空则表示复制到当前项目下   eg：D:/jar--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">copy</span> <span class="attr">todir</span>=<span class="string">"${basedir}/packaging"</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"${project.build.directory}"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"${project.build.finalName}.${project.packaging}"</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">fileset</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">copy</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="复制资源文件到指定目录"><a href="#复制资源文件到指定目录" class="headerlink" title="复制资源文件到指定目录"></a>复制资源文件到指定目录</h3><p>把打包需要生成的资源文件复制到指定的位置</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-resources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>${basedir}/packaging<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">include</span>&gt;</span>conf/**<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="打包资源文件"><a href="#打包资源文件" class="headerlink" title="打包资源文件"></a>打包资源文件</h3><p>排除打包不需要生成的资源文件</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 资源根目录排除各环境的配置，防止在生成目录中多余其它目录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>font/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>conf/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>images/bg.png<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Maven</category>
      </categories>
      <tags>
        <tag>pom</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch下的Kibana的使用 - 增删改查</title>
    <url>/2022/03/1646201026514/1646201026514/</url>
    <content><![CDATA[<p>由于安装的ES版本为6.8.1，故以下操作都是基于此版本下的格式写法</p>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>索引名称：my_index<br>索引设置：settings<br>索引映射：mappings；在ES版本6.8.1中需要添加“_doc”声明type类型；-7.x中的type已经过时，默认设置为_doc</p>
<p>属性：<br>number_of_shards：主分片<br>number_of_replicas：副分片<br>ignore_malformed：忽略传值 null 的情况；默认为:false<br>type：<a href="/2022/03/1646285204846/1646285204846/">字段类型</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">{</span><br><span class="line">    "settings": {</span><br><span class="line">        "number_of_shards": 1,</span><br><span class="line">        "number_of_replicas": 0</span><br><span class="line">    },</span><br><span class="line">    "mappings": {</span><br><span class="line">        "_doc": {</span><br><span class="line">            "properties": {</span><br><span class="line">                "keyId": {</span><br><span class="line">                    "type": "long"</span><br><span class="line">                },</span><br><span class="line">                "account": {</span><br><span class="line">                    "type": "keyword"</span><br><span class="line">                },</span><br><span class="line">                "username": {</span><br><span class="line">                    "type": "text"</span><br><span class="line">                },</span><br><span class="line">                "age": {</span><br><span class="line">                    "type": "short"</span><br><span class="line">                },</span><br><span class="line">                "birthday": {</span><br><span class="line">                    "type": "date",</span><br><span class="line">                    "format": "yyyy-MM-dd",</span><br><span class="line">                    "ignore_malformed": true</span><br><span class="line">                },</span><br><span class="line">                "address": {</span><br><span class="line">                    "properties": {</span><br><span class="line">                        "region": {</span><br><span class="line">                            "type": "keyword",</span><br><span class="line">                            "index": "true"</span><br><span class="line">                        },</span><br><span class="line">                        "location": {</span><br><span class="line">                            "properties": {</span><br><span class="line">                                "province": {</span><br><span class="line">                                    "type": "keyword",</span><br><span class="line">                                    "index": "true"</span><br><span class="line">                                },</span><br><span class="line">                                "city": {</span><br><span class="line">                                    "type": "keyword",</span><br><span class="line">                                    "index": "true"</span><br><span class="line">                                }</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                },</span><br><span class="line">                "role": {</span><br><span class="line">                    "properties": {</span><br><span class="line">                        "attribute": {</span><br><span class="line">                            "type": "nested"</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                },</span><br><span class="line">                "createdTime": {</span><br><span class="line">                    "type": "date",</span><br><span class="line">                    "format": "yyyy-MM-dd HH:mm:ss||epoch_millis",</span><br><span class="line">                    "ignore_malformed": false</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="添加索引数据"><a href="#添加索引数据" class="headerlink" title="添加索引数据"></a>添加索引数据</h3><p>POST方法：_doc后面没有指定_id，系统会默认分配_id；<br>如果_id存在，就更新；如果_id不存在，就插入；<br>“_doc”：为在6.8.1的版本需要添加；<br>“1”：为_id的设置；  </p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_doc/1</span><br><span class="line">{</span><br><span class="line">    "keyId": 1,</span><br><span class="line">    "account": "admin",</span><br><span class="line">    "username": "管理员",</span><br><span class="line">    "age": 33,</span><br><span class="line">    "birthday": "2222-12-22",</span><br><span class="line">    "address": {</span><br><span class="line">        "region": "中国",</span><br><span class="line">        "location": {</span><br><span class="line">            "province": "湖北省",</span><br><span class="line">            "city": "黄冈市"</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    "role": {</span><br><span class="line">        "attribute": [</span><br><span class="line">            {</span><br><span class="line">                "first": "张三",</span><br><span class="line">                "last": "李四"</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="删除索引数据"><a href="#删除索引数据" class="headerlink" title="删除索引数据"></a>删除索引数据</h3><p>1.根据_id删除索引数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">DELETE /my_index/_doc/1</span><br></pre></td></tr></tbody></table></figure></div>
<p>2.根据条件删除索引数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_delete_by_query?pretty</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "term": {</span><br><span class="line">      "keyId": 1</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>3.根据条件批量删除索引数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_delete_by_query?pretty</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "terms": {</span><br><span class="line">      "keyId": [1, 2]</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>4.删除索引是所有数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_delete_by_query?pretty</span><br><span class="line">{</span><br><span class="line">    "query": {</span><br><span class="line">        "match_all": {}</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="修改索引数据"><a href="#修改索引数据" class="headerlink" title="修改索引数据"></a>修改索引数据</h3><p>PUT方法：必须指定_id，否则就会报错；<br>PUT修改时，其他属性值丢失，不是建议使用这种方式；<br>1.根据_id更新索引当条数据的全部数据；不写则其他属性值会丢失</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">PUT /my_index/_doc/1</span><br><span class="line">{</span><br><span class="line">    "keyId": 1,</span><br><span class="line">    "account": "admin",</span><br><span class="line">    "username": "超级管理员",</span><br><span class="line">    "age": 33,</span><br><span class="line">    "birthday": "2222-12-22",</span><br><span class="line">    "address": {</span><br><span class="line">        "region": "中国",</span><br><span class="line">        "location": {</span><br><span class="line">            "province": "湖北省",</span><br><span class="line">            "city": "黄冈市"</span><br><span class="line">        }</span><br><span class="line">    },</span><br><span class="line">    "role": {</span><br><span class="line">        "attribute": [</span><br><span class="line">            {</span><br><span class="line">                "first": "赵",</span><br><span class="line">                "last": "钱"</span><br><span class="line">            },</span><br><span class="line">            {</span><br><span class="line">                "first": "孙",</span><br><span class="line">                "last": "李"</span><br><span class="line">            }</span><br><span class="line">        ]</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>2.根据_id更新索引当条数据的局部数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_doc/1/_update</span><br><span class="line">{</span><br><span class="line">    "doc": {</span><br><span class="line">        "username": "超级管理员",</span><br><span class="line">        "age": 33,</span><br><span class="line">        "birthday": "2022-12-22",</span><br><span class="line">        "address": {</span><br><span class="line">            "location": {</span><br><span class="line">                "province": "上海市",</span><br><span class="line">                "city": "浦东新区"</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>3.根据条件批量更新索引数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /my_index/_doc/_update_by_query</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">        "terms": {</span><br><span class="line">            "keyId": [1, 2]</span><br><span class="line">        }</span><br><span class="line">  },</span><br><span class="line">  "script": {</span><br><span class="line">    "source": "ctx._source['username'] = params['username'];ctx._source['age'] = params['age']",</span><br><span class="line">    "params": {</span><br><span class="line">      "username": "管理员",</span><br><span class="line">      "age": 22</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="查询索引数据"><a href="#查询索引数据" class="headerlink" title="查询索引数据"></a>查询索引数据</h3><p>1.查询索引映射： GET /my_index/_mapping<br>2.查询索引设置：GET /my_index/settings<br>3.查询全部</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "match_all": {}</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>4.条件查询<br>4.1.单个值的条件查询</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /my_index/_doc/_search</span><br><span class="line">{</span><br><span class="line">    "query": {</span><br><span class="line">        "term": {</span><br><span class="line">            "keyId": {</span><br><span class="line">                "value": 1</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>4.2.多个值的条件查询</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">{</span><br><span class="line">    "query": {</span><br><span class="line">        "terms" : { "keyId" : [1, 2]}</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>4.3.区域范围的条件查询</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /my_index/_doc/_search</span><br><span class="line">{</span><br><span class="line">    "query": {</span><br><span class="line">        "range": {</span><br><span class="line">            "birthday": {</span><br><span class="line">                "gte": "2222-12-21",</span><br><span class="line">                "lte": "2222-12-22",</span><br><span class="line">                "relation": "within" </span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>5.嵌套对象(nested)查询<br>path：根节点路径</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /my_index/_search</span><br><span class="line">{</span><br><span class="line">    "query": {</span><br><span class="line">        "nested": {</span><br><span class="line">            "path": "role.attribute",</span><br><span class="line">            "query": {</span><br><span class="line">                "bool": {</span><br><span class="line">                    "must": [</span><br><span class="line">                        {</span><br><span class="line">                            "match": {</span><br><span class="line">                                "role.attribute.first": "张三"</span><br><span class="line">                            }</span><br><span class="line">                        },</span><br><span class="line">                        {</span><br><span class="line">                            "match": {</span><br><span class="line">                                "role.attribute.last": "李四"</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line">                    ]</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="更多查询"><a href="#更多查询" class="headerlink" title="更多查询"></a>更多查询</h2><h3 id="查全部-match-all"><a href="#查全部-match-all" class="headerlink" title="查全部 match_all"></a>查全部 match_all</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /index名/_search?pretty</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "match_all": {}</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="单条件模糊查询-match"><a href="#单条件模糊查询-match" class="headerlink" title="单条件模糊查询 match"></a>单条件模糊查询 match</h3><p>类似Sql的分页查询<br>指定查询条数/字段<br>from：下标值（分页，第一条数据的下标）<br>size：条数（分页，每页显示的条数）<br>_source：返回指定的字段值；为[]则返回全部</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /index名/_search?pretty</span><br><span class="line">{</span><br><span class="line">  "from": 0, </span><br><span class="line">  "size": 2, </span><br><span class="line">  "_source": ["字段"],</span><br><span class="line">  "query": {</span><br><span class="line">    "match": {</span><br><span class="line">      "字段": "条件内容"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="单条件精确查询-term"><a href="#单条件精确查询-term" class="headerlink" title="单条件精确查询 term"></a>单条件精确查询 term</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /index名/_search?pretty</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "term": {</span><br><span class="line">      "字段": "条件内容"</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>





<h3 id="过滤-filter"><a href="#过滤-filter" class="headerlink" title="过滤 filter"></a>过滤 filter</h3><p>类似Sql的范围查询<br>range：lt小于value的值，小于等于是lte、大于是gt、大于等于是gte<br>bool：must 必须；should 或者；must_not 不等于；filter：排除</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /index名/_search?pretty</span><br><span class="line">{</span><br><span class="line">  "query": {</span><br><span class="line">    "bool": {</span><br><span class="line">      "filter": {</span><br><span class="line">        "range": {</span><br><span class="line">          "过滤的字段": {</span><br><span class="line">            "gte": 10, </span><br><span class="line">            "lte": 20</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="聚合查询-aggregations"><a href="#聚合查询-aggregations" class="headerlink" title="聚合查询 aggregations"></a>聚合查询 aggregations</h4><p>类似Sql的统计;<br>terms 对某一字段进行聚合，可进行递归定义aggregations</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">GET /index名/_search?pretty</span><br><span class="line">{</span><br><span class="line">    "size": 2,</span><br><span class="line">    "query": {</span><br><span class="line">        "match_all": {}</span><br><span class="line">    },</span><br><span class="line">    "aggregations": {</span><br><span class="line">        "聚合后返回的关键字1_count": {</span><br><span class="line">            "terms": {</span><br><span class="line">                "field": "聚合字段1"</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        "聚合后返回的关键字2_count": {</span><br><span class="line">            "terms": {</span><br><span class="line">                "field": "聚合字段2"</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>掌握Aggregations需要明白的两个主要概念：<br>桶（Buckets）：满足特定条件的文档的集合，类似于SQL中的group by。<br>指标（Metrics）：对桶内的文档进行统计计算，类似于SQL中的count()、sum()、max()等聚合函数。<br>每个聚合都是由一个或者多个桶和零个或者多个指标的组合而成。 </p>
<p>Metric Aggregations常用的有min、max、avg、sum、cardinality等，Bucket Aggregations常用的有terms、range、histogram等。<br>更多的聚合查询详见<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html" target="_blank" rel="noopener">官方文档</a>：</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>Kibana</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch的数据类型</title>
    <url>/2022/03/1646285204846/1646285204846/</url>
    <content><![CDATA[<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>ElasticSearch中每个field都要精确对应一个数据类型.<br>本文都是基于ElasticSearch 6.8.1进行的, 不同的版本可能存在不支持的情况, 还请注意.<br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/mapping.html" target="_blank" rel="noopener">mapping</a><br><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/mapping-types.html" target="_blank" rel="noopener">mapping-types</a></p>
<h3 id="核心基本类型"><a href="#核心基本类型" class="headerlink" title="核心基本类型"></a>核心基本类型</h3><p> 1.<a href="#文本类型（text）">text类型</a><br> 2.<a href="#关键字类型（keyword）">keyword类型</a><br> 3.<a href="#数字数据类型">数字类型</a><br> 4.<a href="#日期类型（date）">日期类型</a><br> 5.<a href="#布尔类型（boolean）">布尔类型</a><br> 6.<a href="#二进制类型（binary）">二进制类型</a><br> 7.<a href="#范围类型（range）">范围类型</a><br> 8.<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/array.html" target="_blank" rel="noopener">数组类型</a><br> 9.<a href="#对象类型（object）">对象类型</a><br>10.<a href="#嵌套类型（nested）">嵌套类型</a><br>11.<a href="#IP类型（IPv4、IPv6）">IP类型</a><br>12.<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/token-count.html" target="_blank" rel="noopener">Token count类型</a><br>13.<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/geo-point.html" target="_blank" rel="noopener">Geo类型</a></p>
<h4 id="字符串类型（text、keyword）"><a href="#字符串类型（text、keyword）" class="headerlink" title="字符串类型（text、keyword）"></a>字符串类型（text、keyword）</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>ElasticSearch 5.X之后的字段类型不再支持string，由 text 或 keyword 取代。 如果仍使用string，会报错。</p>
<h5 id="文本类型（text）"><a href="#文本类型（text）" class="headerlink" title="文本类型（text）"></a>文本类型（text）</h5><blockquote>
<p>说明：<br>text的内容会被分词, 可以设置是否需要存储: “index”: “true|false”.<br>text类型的字段不能用于排序, 也很少用于聚合.<br>注意：<br>当一个字段需要用于全文搜索(会被分词), 比如商品名称、商品描述等信息, 就应该使用text类型.</p>
</blockquote>
<h5 id="关键字类型（keyword）"><a href="#关键字类型（keyword）" class="headerlink" title="关键字类型（keyword）"></a>关键字类型（keyword）</h5><blockquote>
<p>说明：<br>keyword的内容不会被分词, 可以设置是否需要存储: “index”: “true|false”.<br>keyword类型的字段可用于过滤、排序、聚合等.<br>注意：<br>当一个字段需要按照精确值进行操作时, 就应该使用keyword类型.</p>
</blockquote>
<h4 id="数字数据类型"><a href="#数字数据类型" class="headerlink" title="数字数据类型"></a>数字数据类型</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>数字类型有如下分类:</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">byte：	        有符号的8位整数,  范围: [-128 ~ 127]</span><br><span class="line">short	        有符号的16位整数, 范围: [-32768 ~ 32767]</span><br><span class="line">integer	        有符号的32位整数, 范围: [-2^31 ~ 2^31-1]</span><br><span class="line">long	        有符号的64位整数, 范围: [-2^63 ~ 2^63-1]</span><br><span class="line">float	        32位单精度浮点数</span><br><span class="line">double	        64位双精度浮点数</span><br><span class="line">half_float      16位半精度IEEE 754浮点类型</span><br><span class="line">scaled_float	缩放类型的的浮点数, 比如price字段只需精确到分, 57.34缩放因子为100, 存储结果为5734</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>说明：<br>字段的长度越短, 索引和搜索的效率越高<br>尽可能选择范围小的数据类型, 优先考虑使用带缩放因子的浮点类型</p>
</blockquote>
<h4 id="日期类型（date）"><a href="#日期类型（date）" class="headerlink" title="日期类型（date）"></a>日期类型（date）</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>在ES中, 日期默认格式: strict_date_optional_time||epoch_millis<br>包含格式化日期的字符串, “2018-10-01”, 或”2022-03-03 15:47:47”，可代表时间毫秒数的长整型数字，也可代表时间秒数的整数</p>
<blockquote>
<p>说明：<br>如果时区未指定, 日期将被转换为UTC格式, 但存储的却是长整型的毫秒值.<br>多个格式使用双竖线||分隔, 每个格式都会被依次尝试, 直到找到匹配的.第一个格式用于将时间毫秒值转换为对应格式的字符串.<br>可自定义日期格式：yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis</p>
</blockquote>
<h4 id="布尔类型（boolean）"><a href="#布尔类型（boolean）" class="headerlink" title="布尔类型（boolean）"></a>布尔类型（boolean）</h4><blockquote>
<p>说明：可以接受表示真、假的字符串或数字<br>真值: true, “true”, “on”, “yes”, “1”…<br>假值: false, “false”, “off”, “no”, “0”, “”(空字符串), 0.0, 0</p>
</blockquote>
<h4 id="二进制类型（binary）"><a href="#二进制类型（binary）" class="headerlink" title="二进制类型（binary）"></a>二进制类型（binary）</h4><p>二进制类型是Base64编码字符串的二进制值, 不以默认的方式存储, 且不能被搜索</p>
<blockquote>
<p>说明：<br>有2个设置项：doc_values、store<br>① doc_values: 该字段是否需要存储到磁盘上, 方便以后用来排序、聚合或脚本查询. 接受true和false，默认为false;<br>① store: 该字段的值是否要和_source分开存储、检索, 意思是除了_source中, 是否要单独再存储一份. 接受true或false，默认为false;.<br>注意:<br>Base64编码的二进制值不能嵌入换行符\n, 逗号(0x2c)等符号.</p>
</blockquote>
<h4 id="范围类型（range）"><a href="#范围类型（range）" class="headerlink" title="范围类型（range）"></a>范围类型（range）</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>range类型支持以下几种：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">integer_range           -2^31 ~ 2^31-1</span><br><span class="line">long_range              -2^63 ~ 2^63-1</span><br><span class="line">float_range             32位单精度浮点型</span><br><span class="line">double_range            64位双精度浮点型</span><br><span class="line">date_range              64位整数, 毫秒计时</span><br><span class="line">ip_range                IP值的范围, 支持IPV4和IPV6, 或者这两种同时存在</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>说明：小于是lt，小于等于是lte、大于是gt、大于等于是gte</p>
</blockquote>
<h3 id="复杂数据类型"><a href="#复杂数据类型" class="headerlink" title="复杂数据类型"></a>复杂数据类型</h3><h4 id="对象类型（object）"><a href="#对象类型（object）" class="headerlink" title="对象类型（object）"></a>对象类型（object）</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>文档是分层的: 文档可以包含内部对象, 内部对象也可以包含内部对象；</p>
<h4 id="嵌套类型（nested）"><a href="#嵌套类型（nested）" class="headerlink" title="嵌套类型（nested）"></a>嵌套类型（nested）</h4><p><a href="/2022/03/1646201026514/1646201026514/#创建索引">示例</a><br>嵌套类型是对象数据类型的一个特例, 可以让array类型的对象被独立索引和搜索，用nested类型解决object类型的不足</p>
<blockquote>
<p>说明：<br>如果需要对以最对象进行索引, 且保留数组中每个对象的独立性, 就应该使用嵌套数据类型.<br>嵌套对象实质是将每个对象分离出来, 作为隐藏文档进行索引.</p>
</blockquote>
<h3 id="专门数据类型"><a href="#专门数据类型" class="headerlink" title="专门数据类型"></a>专门数据类型</h3><h4 id="IP类型（IPv4、IPv6）"><a href="#IP类型（IPv4、IPv6）" class="headerlink" title="IP类型（IPv4、IPv6）"></a>IP类型（IPv4、IPv6）</h4><p>IP类型的字段用于存储IPv4或IPv6的地址, 本质上是一个长整型字段.</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    "mappings": {</span><br><span class="line">        "customer": {</span><br><span class="line">            "properties": {</span><br><span class="line">                "ip_addr": {</span><br><span class="line">                    "type": "ip"</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="更多类型"><a href="#更多类型" class="headerlink" title="更多类型"></a>更多类型</h3><p>更多TYPE类型查询详见<a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/mapping-types.html" target="_blank" rel="noopener">官方文档</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</title>
    <url>/2022/03/1646386352631/1646386352631/</url>
    <content><![CDATA[<p>本文是基于SpringBoot2.4.2的版本对ElasticSearch6.8.1的版本进行封装使用</p>
<p><a href="/2022/03/1646640931232/1646640931232/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</a><br><a href="/2022/03/1646640937853/1646640937853/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</a><br><a href="/2022/03/1646642392484/1646642392484/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</a><br><a href="/2022/03/1646645017427/1646645017427/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</a><br><a href="/2022/03/1646645021846/1646645021846/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</a></p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch-client.version</span>&gt;</span>6.8.1<span class="tag">&lt;/<span class="name">elasticsearch-client.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${elasticsearch-client.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${elasticsearch-client.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${elasticsearch-client.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-client-sniffer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${elasticsearch-client.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>ElasticSearchDataConfig</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022 2022/3/18 15:44</span><br><span class="line"> * desc ：ES的bean</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Component(value = "elasticSearchDataConfig")</span><br><span class="line">@ConditionalOnMissingClass(value = "elasticSearchDataConfig")</span><br><span class="line">public class ElasticSearchDataConfig {</span><br><span class="line"></span><br><span class="line">    // 服务器地址</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">String</span>&gt;</span> httpHost = Collections.singletonList("http://127.0.0.1:9200");</span><br><span class="line">    // ES用户名</span><br><span class="line">    private String username;</span><br><span class="line">    // ES密码</span><br><span class="line">    private String password;</span><br><span class="line">    // 设置连接超时时间，单位毫秒。指的是连接一个url的连接等待时间,单位毫秒。</span><br><span class="line">    private Integer connectTimeout = 5000;</span><br><span class="line">    // 请求获取数据的超时时间，单位毫秒。 如果访问一个接口，多少时间内无法返回数据，就直接放弃此次调用,单位毫秒。</span><br><span class="line">    private Integer socketTimeout = 60000;</span><br><span class="line">    // 设置从connect Manager获取Connection 超时时间，单位毫秒。</span><br><span class="line">    private Integer connectionRequestTimeout = 60000;</span><br><span class="line">    // httpclient最大连接数</span><br><span class="line">    private Integer maxConnTotal = 30;</span><br><span class="line">    // httpclient最大路由连接数</span><br><span class="line">    private Integer maxConnPerRoute = 10;</span><br><span class="line">    // httpclient保活策略</span><br><span class="line">    private Integer keepAliveMinutes = 10;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>ElasticSearchConfig</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.http.HttpHost;</span><br><span class="line">import org.apache.http.auth.AuthScope;</span><br><span class="line">import org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class="line">import org.apache.http.client.CredentialsProvider;</span><br><span class="line">import org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class="line">import org.elasticsearch.client.RestClient;</span><br><span class="line">import org.elasticsearch.client.RestClientBuilder;</span><br><span class="line">import org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/7/20 18:33</span><br><span class="line"> * desc ：ES 配置项</span><br><span class="line"> * https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.8/java-rest-high-document-index.html#java-rest-high-document-index</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Configuration</span><br><span class="line">public class ElasticSearchConfig {</span><br><span class="line"></span><br><span class="line">    @Resource(name = "elasticSearchDataConfig")</span><br><span class="line">    private ElasticSearchDataConfig elasticSearchDataConfig;</span><br><span class="line"></span><br><span class="line">    @Bean(destroyMethod = "close", name = "restHighLevelClient")</span><br><span class="line">    public RestHighLevelClient restHighLevelClient() {</span><br><span class="line">        // 创建链接</span><br><span class="line">        RestClientBuilder builder;</span><br><span class="line">        List<span class="tag">&lt;<span class="name">String</span>&gt;</span> httpHostList = elasticSearchDataConfig.getHttpHost();</span><br><span class="line">        if (httpHostList.size() &gt; 1) {</span><br><span class="line">            HttpHost[] httpHosts = new HttpHost[httpHostList.size()];</span><br><span class="line">            for (int i = 0; i <span class="tag">&lt; <span class="attr">httpHostList.size</span>(); <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">                <span class="attr">httpHosts</span>[<span class="attr">i</span>] = <span class="string">HttpHost.create(httpHostList.get(i));</span></span></span><br><span class="line"><span class="tag">            }</span></span><br><span class="line"><span class="tag">            <span class="attr">log.info</span>("<span class="attr">ES</span>模式：集群（{}）", <span class="attr">Collections.singletonList</span>(<span class="attr">httpHostList</span>)<span class="attr">.toArray</span>());</span></span><br><span class="line"><span class="tag">            // 集群创建</span></span><br><span class="line"><span class="tag">            <span class="attr">builder</span> = <span class="string">RestClient.builder(httpHosts);</span></span></span><br><span class="line"><span class="tag">        } <span class="attr">else</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">String</span> <span class="attr">host</span> = <span class="string">httpHostList.get(0);</span></span></span><br><span class="line"><span class="tag">            <span class="attr">log.info</span>("<span class="attr">ES</span>模式：单机（{}）", <span class="attr">Collections.singletonList</span>(<span class="attr">host</span>)<span class="attr">.toArray</span>());</span></span><br><span class="line"><span class="tag">            // 单机创建</span></span><br><span class="line"><span class="tag">            <span class="attr">builder</span> = <span class="string">RestClient.builder(HttpHost.create(host));</span></span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        // 该方法接收一个<span class="attr">RequestConfig.Builder</span>对象，对该对象进行修改后然后返回。</span></span><br><span class="line"><span class="tag">        <span class="attr">builder.setRequestConfigCallback</span>(<span class="attr">requestConfigBuilder</span> <span class="attr">-</span>&gt;</span> requestConfigBuilder</span><br><span class="line">                // 设置连接超时时间，单位毫秒。指的是连接一个url的连接等待时间</span><br><span class="line">                .setConnectTimeout(elasticSearchDataConfig.getConnectTimeout())</span><br><span class="line">                // 请求获取数据的超时时间，单位毫秒。 如果访问一个接口，多少时间内无法返回数据，就直接放弃此次调用。</span><br><span class="line">                .setSocketTimeout(elasticSearchDataConfig.getSocketTimeout())</span><br><span class="line">                // 设置从connect Manager获取Connection 超时时间，单位毫秒。</span><br><span class="line">                .setConnectionRequestTimeout(elasticSearchDataConfig.getConnectionRequestTimeout())</span><br><span class="line">        )</span><br><span class="line">                // 使用异步httpclient时设置并发连接数</span><br><span class="line">                .setHttpClientConfigCallback(httpClientBuilder -&gt; {</span><br><span class="line">                    // httpclient连接数配置</span><br><span class="line">                    httpClientBuilder</span><br><span class="line">                            // 最大连接数</span><br><span class="line">                            .setMaxConnTotal(elasticSearchDataConfig.getMaxConnTotal())</span><br><span class="line">                            // 最大路由连接数</span><br><span class="line">                            .setMaxConnPerRoute(elasticSearchDataConfig.getMaxConnPerRoute())</span><br><span class="line">                            // httpclient保活策略</span><br><span class="line">                            .setKeepAliveStrategy(CustomConnectionKeepAliveStrategy.getInstance(elasticSearchDataConfig.getKeepAliveMinutes()))</span><br><span class="line">                            // 没有密码可以不用这一个set</span><br><span class="line">                            .disableAuthCaching().setDefaultCredentialsProvider(getCredentialsProvider())</span><br><span class="line">                    ;</span><br><span class="line">                    return httpClientBuilder;</span><br><span class="line">                });</span><br><span class="line">        return new RestHighLevelClient(builder);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private CredentialsProvider getCredentialsProvider() {</span><br><span class="line">        final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();</span><br><span class="line">        //如果没配置密码就可以不用下面这行</span><br><span class="line">        String username = elasticSearchDataConfig.getUsername();</span><br><span class="line">        String password = elasticSearchDataConfig.getPassword();</span><br><span class="line">        if (username != null &amp;&amp; password != null) {</span><br><span class="line">            System.out.println("★★★★★ restHighLevelClient 用户验证★★★★★");</span><br><span class="line">            credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(username, password));</span><br><span class="line">        }</span><br><span class="line">        return credentialsProvider;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h3 id="连接策略"><a href="#连接策略" class="headerlink" title="连接策略"></a>连接策略</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.http.HttpResponse;</span><br><span class="line">import org.apache.http.impl.client.DefaultConnectionKeepAliveStrategy;</span><br><span class="line">import org.apache.http.protocol.HttpContext;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/9/12 23:40</span><br><span class="line"> * desc ：连接策略</span><br><span class="line"> */</span><br><span class="line">public class CustomConnectionKeepAliveStrategy extends DefaultConnectionKeepAliveStrategy {</span><br><span class="line">    private static CustomConnectionKeepAliveStrategy INSTANCE;</span><br><span class="line">    private static long maxKeepAliveMinutes;</span><br><span class="line">    // 带参数构造器</span><br><span class="line">    private CustomConnectionKeepAliveStrategy(long maxKeepAliveMinutes) {</span><br><span class="line">        super();</span><br><span class="line">        CustomConnectionKeepAliveStrategy.maxKeepAliveMinutes = maxKeepAliveMinutes;</span><br><span class="line">    }</span><br><span class="line">    // 为了传参数进来写了个单例</span><br><span class="line">    public static CustomConnectionKeepAliveStrategy getInstance(long maxKeepAliveMinutes) {</span><br><span class="line">        if (INSTANCE == null) {</span><br><span class="line">            synchronized (CustomConnectionKeepAliveStrategy.class) {</span><br><span class="line">                if (INSTANCE == null) {</span><br><span class="line">                    INSTANCE = new CustomConnectionKeepAliveStrategy(maxKeepAliveMinutes);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return INSTANCE;</span><br><span class="line">    }</span><br><span class="line">    /**</span><br><span class="line">     * 最大keep alive的时间（分钟）</span><br><span class="line">     * 这里默认为10分钟，可以根据实际情况设置。</span><br><span class="line">     * 可以观察客户端机器状态为TIME_WAIT的TCP连接数，如果太多，可以增大此值。</span><br><span class="line">     * 小于0为无限期keepalive，将无限期替换成一个默认的时间</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public long getKeepAliveDuration(HttpResponse response, HttpContext context) {</span><br><span class="line">        long keepAliveDuration = super.getKeepAliveDuration(response, context);</span><br><span class="line">        if (keepAliveDuration <span class="tag">&lt; <span class="attr">0</span>) {</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">TimeUnit.MINUTES.toMillis</span>(<span class="attr">maxKeepAliveMinutes</span>);</span></span><br><span class="line"><span class="tag">        } <span class="attr">else</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">keepAliveDuration</span>;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag">}</span></span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch下的Kibana的使用 - 别名(视图)</title>
    <url>/2022/03/1646205817389/1646205817389/</url>
    <content><![CDATA[<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>能非常优雅的解决两个索引无缝切换的问题；</p>
<h3 id="创建-add-、删除-remove"><a href="#创建-add-、删除-remove" class="headerlink" title="创建(add)、删除(remove)"></a>创建(add)、删除(remove)</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">{</span><br><span class="line">    "actions": [</span><br><span class="line">        {</span><br><span class="line">            "add": {</span><br><span class="line">                "index": "my_index",</span><br><span class="line">                "alias": "my_index_v1"</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">            "remove": {</span><br><span class="line">                "index": "my_index",</span><br><span class="line">                "alias": "my_index_v1"</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="读写"><a href="#读写" class="headerlink" title="读写"></a>读写</h3><p>当索引别名指向多个索引时，进行写操作，其中的一个索引必须被指定为写索引，并且只能指定一个，否则则无法写入。<br>is_write_index：默认为false；需要有且仅设置一个为true；</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">{</span><br><span class="line">    "actions": [</span><br><span class="line">        {</span><br><span class="line">            "add": {</span><br><span class="line">                "index": "my_index_1",</span><br><span class="line">                "alias": "my_index_v2",</span><br><span class="line">                "is_write_index" : true</span><br><span class="line">            }</span><br><span class="line">        },</span><br><span class="line">        {</span><br><span class="line">            "add": {</span><br><span class="line">                "index": "my_index_2",</span><br><span class="line">                "alias": "my_index_v2",</span><br><span class="line">                "is_write_index" : false</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h3><p>将索引【my_index_1】的数据复制到【my_index_2】的索引上；会根据数据的大小，消耗的时间不等；<br>注意：假如【my_index_2】本身已有数据，“_index”，“_type”，“_id”等值的不同，都是会造成有重复数据存在的因素；</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">POST /_reindex</span><br><span class="line">{</span><br><span class="line">   "source": {</span><br><span class="line">     "index": "my_index_1"</span><br><span class="line">   },</span><br><span class="line">   "dest": {</span><br><span class="line">     "index": "my_index_2"</span><br><span class="line">   }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>创建结构一样索引： my_index_1，my_index_2；</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">PUT /my_index</span><br><span class="line">{</span><br><span class="line">    "mappings": {</span><br><span class="line">        "_doc": {</span><br><span class="line">            "properties": {</span><br><span class="line">                "user_id": {</span><br><span class="line">                    "type": "integer"</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>按照 <a href="#读写">is_write_index=true</a> 的设置，当POST数据的时候，会写到索引为 my_index_1 内容，根据索引查询结果：<br><img src="/2022/03/1646205817389/1646205817389/20220303140424.png" alt="20220303140424"></p>
<p>更改 is_write_index=true 的设置，当POST数据的时候，会写到索引为 my_index_2 内容，根据索引查询结果：<br><img src="/2022/03/1646205817389/1646205817389/20220303140952.png" alt="20220303140952"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>Kibana</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</title>
    <url>/2022/03/1646640931232/1646640931232/</url>
    <content><![CDATA[<p><a href="/2022/03/1646386352631/1646386352631/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</a><br><a href="/2022/03/1646640937853/1646640937853/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</a><br><a href="/2022/03/1646642392484/1646642392484/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</a><br><a href="/2022/03/1646645017427/1646645017427/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</a><br><a href="/2022/03/1646645021846/1646645021846/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</a></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.elasticsearch.common.settings.Settings;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/9/12 15:01</span><br><span class="line"> * desc ：</span><br><span class="line"> */</span><br><span class="line">public interface ElasticSearchService {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断ES索引是否存在</span><br><span class="line">     *</span><br><span class="line">     * @param index 索引名称</span><br><span class="line">     * @return 返回。true:不存在；false:已存在</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean checkIndexExists(String index) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建ES索引</span><br><span class="line">     *</span><br><span class="line">     * @param index 索引名称</span><br><span class="line">     * @return 返回。true:创建成功；false:创建失败</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean createIndex(String index, String source) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    boolean createIndex(String index, Settings settings, XContentBuilder mapping) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除索引 会删除数据</span><br><span class="line">     *</span><br><span class="line">     * @param index 索引</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean deleteIndex(String index) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入单笔数据</span><br><span class="line">     *</span><br><span class="line">     * @param elasticSearchDTO 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean insertIndexData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入多笔数据</span><br><span class="line">     *</span><br><span class="line">     * @param elasticSearchDTO 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean insertIndexBatchData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 根据_Id 删除单笔数据</span><br><span class="line">     *</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean deleteIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据_Id 更新单笔数据</span><br><span class="line">     *</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    boolean updateIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询索引数据（分页）</span><br><span class="line">     *</span><br><span class="line">     * @param elasticSearchDTO 参数</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    ElasticSearchPage searchDataListPage(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询索引数据（全部）</span><br><span class="line">     *</span><br><span class="line">     * @param elasticSearchDTO 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; searchDataList(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取多条件查询的总数</span><br><span class="line">     *</span><br><span class="line">     * @param elasticSearchDTO 参数</span><br><span class="line">     * @return 返回</span><br><span class="line">     * @throws ElasticSearchException 异常</span><br><span class="line">     */</span><br><span class="line">    long  getIndexCount(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="接口实现"><a href="#接口实现" class="headerlink" title="接口实现"></a>接口实现</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line">import org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line">import org.elasticsearch.action.index.IndexRequest;</span><br><span class="line">import org.elasticsearch.action.index.IndexResponse;</span><br><span class="line">import org.elasticsearch.action.search.ClearScrollRequest;</span><br><span class="line">import org.elasticsearch.action.search.SearchRequest;</span><br><span class="line">import org.elasticsearch.action.search.SearchResponse;</span><br><span class="line">import org.elasticsearch.action.search.SearchScrollRequest;</span><br><span class="line">import org.elasticsearch.action.support.IndicesOptions;</span><br><span class="line">import org.elasticsearch.action.support.master.AcknowledgedResponse;</span><br><span class="line">import org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line">import org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line">import org.elasticsearch.client.RequestOptions;</span><br><span class="line">import org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line">import org.elasticsearch.client.core.CountRequest;</span><br><span class="line">import org.elasticsearch.client.core.CountResponse;</span><br><span class="line">import org.elasticsearch.client.indices.CreateIndexRequest;</span><br><span class="line">import org.elasticsearch.client.indices.CreateIndexResponse;</span><br><span class="line">import org.elasticsearch.client.indices.GetIndexRequest;</span><br><span class="line">import org.elasticsearch.common.settings.Settings;</span><br><span class="line">import org.elasticsearch.common.unit.TimeValue;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line">import org.elasticsearch.rest.RestStatus;</span><br><span class="line">import org.elasticsearch.search.Scroll;</span><br><span class="line">import org.elasticsearch.search.SearchHit;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/9/12 15:02</span><br><span class="line"> * desc ：ES 实现类</span><br><span class="line"> * queryById:根据id查询</span><br><span class="line"> * termQuery:精确匹配字段查询</span><br><span class="line"> * likeQuery:多词模糊查询</span><br><span class="line"> * rangeQuery:当前字段值范围查询</span><br><span class="line"> * queryNot:匹配非当前值的查询</span><br><span class="line"> * others:其他类型查询</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Service</span><br><span class="line">public class ElasticSearchServiceImpl implements ElasticSearchService {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean checkIndexExists(String index) throws ElasticSearchException {</span><br><span class="line">        log.info("验证索引是否存在：");</span><br><span class="line">        try {</span><br><span class="line">            GetIndexRequest getIndexRequest = new GetIndexRequest(index).local(false).humanReadable(true);</span><br><span class="line">            if (restHighLevelClient.indices().exists(getIndexRequest, RequestOptions.DEFAULT)) {</span><br><span class="line">                log.info("ES索引[" + index + "]已存在");</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("ES索引[" + index + "]不存在");</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("判断ES索引[" + index + "]存在异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean createIndex(String index, Settings settings, XContentBuilder mapping) throws ElasticSearchException {</span><br><span class="line">        return getCreateIndexResponse(new CreateIndexRequest(index).settings(settings).mapping(mapping));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean createIndex(String index, String source) throws ElasticSearchException {</span><br><span class="line">        return getCreateIndexResponse(new CreateIndexRequest(index).source(source, XContentType.JSON));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private boolean getCreateIndexResponse(CreateIndexRequest createIndexRequest) throws ElasticSearchException {</span><br><span class="line">        String index = createIndexRequest.index();</span><br><span class="line">        log.info("创建索引：{}", index);</span><br><span class="line">        try {</span><br><span class="line">            // 超时时间设置为 1m</span><br><span class="line">            createIndexRequest.setTimeout(TimeValue.timeValueMinutes(1));</span><br><span class="line">            CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(createIndexRequest, RequestOptions.DEFAULT);</span><br><span class="line">            if (createIndexResponse.isAcknowledged()) {</span><br><span class="line">                log.info("创建ES索引[" + index + "]成功");</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("创建ES索引[" + index + "]失败");</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("创建ES索引[" + index + "]异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean deleteIndex(String index) throws ElasticSearchException {</span><br><span class="line">        log.info("删除索引：{}", index);</span><br><span class="line">        try {</span><br><span class="line">            DeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest(index);</span><br><span class="line">            deleteIndexRequest.indicesOptions(IndicesOptions.LENIENT_EXPAND_OPEN);</span><br><span class="line">            AcknowledgedResponse acknowledgedResponse = restHighLevelClient.indices().delete(deleteIndexRequest, RequestOptions.DEFAULT);</span><br><span class="line">            if (acknowledgedResponse.isAcknowledged()) {</span><br><span class="line">                log.info("删除ES索引[" + index + "]成功");</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("删除ES索引[" + index + "]失败");</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("删除ES索引[" + index + "]异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean insertIndexData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        log.info("新增索引{}数据", index);</span><br><span class="line">        try {</span><br><span class="line">            IndexRequest indexRequest = new IndexRequest(index, "_doc", elasticSearchDTO.getEsKeyId());</span><br><span class="line">            indexRequest.source(elasticSearchDTO.getData(), elasticSearchDTO.getXContentType());</span><br><span class="line">            IndexResponse indexResponse = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line">            int status = indexResponse.status().getStatus();</span><br><span class="line">            if (status == RestStatus.CREATED.getStatus() || status == RestStatus.OK.getStatus()) {</span><br><span class="line">                log.info("插入ES索引[" + indexResponse.getIndex() + "]数据成功:" + status + "；_id：" + indexResponse.getId());</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("插入ES索引[" + indexResponse.getIndex() + "]数据失败:" + status + "；_id：" + indexResponse.getId());</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("插入ES索引[" + index + "]数据异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean insertIndexBatchData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">ElasticSearchDTO</span>&gt;</span> elasticSearchDTOList = elasticSearchDTO.getBatchData();</span><br><span class="line">        log.info("批量新增索引{}数据:{}", index, elasticSearchDTOList.size());</span><br><span class="line">        try {</span><br><span class="line">            BulkRequest bulkRequest = new BulkRequest();</span><br><span class="line">            for (ElasticSearchDTO searchDTO : elasticSearchDTOList) {</span><br><span class="line">                bulkRequest.add(new IndexRequest(index, "_doc", searchDTO.getEsKeyId()).source(searchDTO.getData(), elasticSearchDTO.getXContentType()));</span><br><span class="line">            }</span><br><span class="line">            BulkResponse bulkResponse = restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line">            int status = bulkResponse.status().getStatus();</span><br><span class="line">            if (status == RestStatus.OK.getStatus()) {</span><br><span class="line">                log.info("批量插入ES索引[" + index + "]数据成功;" + status + ";");</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("批量插入ES索引[" + index + "]数据失败;" + status + ";");</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("批量插入ES索引[" + index + "]数据异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean deleteIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        log.info("删除索引{}数据", index);</span><br><span class="line">        try {</span><br><span class="line">            DeleteRequest deleteRequest = new DeleteRequest(index, "_doc", elasticSearchDTO.getEsKeyId());</span><br><span class="line">            DeleteResponse deleteResponse = restHighLevelClient.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">            int status = deleteResponse.status().getStatus();</span><br><span class="line">            if (status == RestStatus.OK.getStatus()) {</span><br><span class="line">                log.info("删除ES索引[" + deleteResponse.getIndex() + "]数据成功:" + status + "；_id：" + deleteResponse.getId());</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("删除ES索引[" + deleteResponse.getIndex() + "]数据失败:" + status + "；_id：" + deleteResponse.getId());</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("删除ES索引[" + index + "]数据异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public boolean updateIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        log.info("更新索引{}数据", index);</span><br><span class="line">        try {</span><br><span class="line">            UpdateRequest updateRequest = new UpdateRequest(index, "_doc", elasticSearchDTO.getEsKeyId());</span><br><span class="line">            updateRequest.doc(elasticSearchDTO.getData());</span><br><span class="line">            UpdateResponse updateResponse = restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT);</span><br><span class="line">            int status = updateResponse.status().getStatus();</span><br><span class="line">            if (status == RestStatus.OK.getStatus()) {</span><br><span class="line">                log.info("更新ES索引[" + updateResponse.getIndex() + "]数据成功:" + status + "；_id：" + updateResponse.getId());</span><br><span class="line">                return true;</span><br><span class="line">            } else {</span><br><span class="line">                log.error("更新ES索引[" + updateResponse.getIndex() + "]数据失败:" + status + "；_id：" + updateResponse.getId());</span><br><span class="line">                return false;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("更新ES索引[" + index + "]数据异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ElasticSearchPage searchDataListPage(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        ElasticSearchPage elasticSearchPage = new ElasticSearchPage();</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        try {</span><br><span class="line">            List&lt;Map&lt;String, Object&gt;&gt; resultSearchHit = new ArrayList&lt;&gt;();</span><br><span class="line">            SearchRequest searchRequest = elasticSearchDTO.getSearchRequest();</span><br><span class="line">            SearchSourceBuilder searchSourceBuilder = searchRequest.indices(index).source();</span><br><span class="line">            // from是数据从下标0开始</span><br><span class="line">            searchSourceBuilder.from(elasticSearchDTO.getForm()).size(elasticSearchDTO.getSize()).timeout(TimeValue.timeValueSeconds(60)).explain(true);</span><br><span class="line">            SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">            if (searchResponse.getHits().getHits().length != 0) {</span><br><span class="line">                for (SearchHit hit : searchResponse.getHits().getHits()) {</span><br><span class="line">                    resultSearchHit.add(hit.getSourceAsMap());</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            elasticSearchPage.setRecords(resultSearchHit);</span><br><span class="line">            elasticSearchPage.setTotal(searchResponse.getHits().getTotalHits());</span><br><span class="line">            elasticSearchPage.setCurrent(elasticSearchDTO.getCurrent());</span><br><span class="line">            elasticSearchPage.setSize(elasticSearchDTO.getSize());</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("查询ES索引[" + index + "]数据异常", e);</span><br><span class="line">        }</span><br><span class="line">        return elasticSearchPage;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; searchDataList(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; resultSearchHit = new ArrayList&lt;&gt;();</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        // 设定滚动时间间隔,60秒,不是处理查询结果的所有文档的所需时间</span><br><span class="line">        // 游标查询的过期时间会在每次做查询的时候刷新，所以这个时间只需要足够处理当前批的结果就可以了</span><br><span class="line">        final Scroll scroll = new Scroll(TimeValue.timeValueSeconds(60));</span><br><span class="line">        // 查询条件</span><br><span class="line">        SearchRequest searchRequest = elasticSearchDTO.getSearchRequest().scroll(scroll);</span><br><span class="line">        searchRequest.indices(index).source().size(10000).timeout(TimeValue.timeValueSeconds(60)).explain(true);</span><br><span class="line">        log.info(searchRequest.source().toString());</span><br><span class="line">        // ES滚屏快照</span><br><span class="line">        ClearScrollRequest clearScrollRequest = new ClearScrollRequest();</span><br><span class="line">        try {</span><br><span class="line">            SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">            //每次循环完后取得scrollId,用于记录下次将从这个游标开始取数</span><br><span class="line">            String scrollId = searchResponse.getScrollId();</span><br><span class="line">            do {</span><br><span class="line">                for (SearchHit hit : searchResponse.getHits().getHits()) {</span><br><span class="line">                    resultSearchHit.add(hit.getSourceAsMap());</span><br><span class="line">                }</span><br><span class="line">                SearchScrollRequest scrollRequest = new SearchScrollRequest(scrollId).scroll(scroll);</span><br><span class="line">                //进行下次查询</span><br><span class="line">                searchResponse = restHighLevelClient.scroll(scrollRequest, RequestOptions.DEFAULT);</span><br><span class="line">            } while (searchResponse.getHits().getHits().length != 0);</span><br><span class="line">            // 也可以选择setScrollIds()将多个scrollId一起使用</span><br><span class="line">            clearScrollRequest.addScrollId(scrollId);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("查询ES索引[" + index + "]数据异常", e);</span><br><span class="line">        } finally {</span><br><span class="line">            if (clearScrollRequest.getScrollIds().size() &gt; 0) {</span><br><span class="line">                try {</span><br><span class="line">                    // 清除滚屏(及时清除es快照，释放资源)</span><br><span class="line">                    restHighLevelClient.clearScroll(clearScrollRequest, RequestOptions.DEFAULT);</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    log.error("清除es快照，释放资源出错：", e);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return resultSearchHit;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public long getIndexCount(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException {</span><br><span class="line">        String index = elasticSearchDTO.getEsIndex();</span><br><span class="line">        log.info("查询ES索引条数：{}", index);</span><br><span class="line">        try {</span><br><span class="line">            CountRequest countRequest = elasticSearchDTO.getCountRequest().indices(index);</span><br><span class="line">            CountResponse countResponse = restHighLevelClient.count(countRequest, RequestOptions.DEFAULT);</span><br><span class="line">            if (countResponse.status().getStatus() == RestStatus.OK.getStatus()) {</span><br><span class="line">                log.info("查询ES索引条数[" + index + "]成功");</span><br><span class="line">                return countResponse.getCount();</span><br><span class="line">            } else {</span><br><span class="line">                log.error("查询ES索引条数[" + index + "]失败");</span><br><span class="line">                return -1;</span><br><span class="line">            }</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new ElasticSearchException("查询ES索引条数[" + index + "]异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022 2022/3/7 14:21</span><br><span class="line"> * desc ：自定义异常</span><br><span class="line"> */</span><br><span class="line">public class ElasticSearchException extends RuntimeException {</span><br><span class="line"></span><br><span class="line">    //用指定的详细信息和原因构造一个新的异常</span><br><span class="line">    public ElasticSearchException(String message, Throwable cause){</span><br><span class="line">        super(message,cause);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</title>
    <url>/2022/03/1646642392484/1646642392484/</url>
    <content><![CDATA[<p><a href="/2022/03/1646386352631/1646386352631/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</a><br><a href="/2022/03/1646640931232/1646640931232/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</a><br><a href="/2022/03/1646640937853/1646640937853/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</a><br><a href="/2022/03/1646645017427/1646645017427/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</a><br><a href="/2022/03/1646645021846/1646645021846/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</a></p>
<details>
  <summary>使用Java创建索引不需要mappings下的_doc节点；以下面结构进行操作</summary>
    <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    "settings": {</span><br><span class="line">        "number_of_shards": 1,</span><br><span class="line">        "number_of_replicas": 0</span><br><span class="line">    },</span><br><span class="line">    "mappings": {</span><br><span class="line">        "properties": {</span><br><span class="line">            "keyId": {</span><br><span class="line">                "type": "long"</span><br><span class="line">            },</span><br><span class="line">            "account": {</span><br><span class="line">                "type": "keyword"</span><br><span class="line">            },</span><br><span class="line">            "username": {</span><br><span class="line">                "type": "text"</span><br><span class="line">            },</span><br><span class="line">            "age": {</span><br><span class="line">                "type": "short"</span><br><span class="line">            },</span><br><span class="line">            "birthday": {</span><br><span class="line">                "type": "date",</span><br><span class="line">                "format": "yyyy-MM-dd",</span><br><span class="line">                "ignore_malformed": true</span><br><span class="line">            },</span><br><span class="line">            "address": {</span><br><span class="line">                "properties": {</span><br><span class="line">                    "region": {</span><br><span class="line">                        "type": "text",</span><br><span class="line">                        "index": "true"</span><br><span class="line">                    },</span><br><span class="line">                    "location": {</span><br><span class="line">                        "properties": {</span><br><span class="line">                            "province": {</span><br><span class="line">                                "type": "text",</span><br><span class="line">                                "index": "true"</span><br><span class="line">                            },</span><br><span class="line">                            "city": {</span><br><span class="line">                                "type": "text",</span><br><span class="line">                                "index": "true"</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            },</span><br><span class="line">            "role": {</span><br><span class="line">                "properties": {</span><br><span class="line">                    "attribute": {</span><br><span class="line">                        "type": "nested"</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            },</span><br><span class="line">            "createdTime": {</span><br><span class="line">                "type": "date",</span><br><span class="line">                "format": "yyyy-MM-dd HH:mm:ss||epoch_millis",</span><br><span class="line">                "ignore_malformed": false</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
</details>

<h3 id="判断ES索引是否存在"><a href="#判断ES索引是否存在" class="headerlink" title="判断ES索引是否存在"></a>判断ES索引是否存在</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 判断ES索引是否存在() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(elasticSearchService.checkIndexExists(index));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><p>第一种方式创建索引：通过加载整体的mapping字符进行创建</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 创建ES索引1() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        String source = "索引mapping内容,即上述的json文本";</span><br><span class="line">        System.out.println(elasticSearchService.createIndex(index, source));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>第二种方式创建索引：通过标签代码进行组装mapping内容进行创建</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 创建ES索引2() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        // 设置settings映射</span><br><span class="line">        Settings settings = Settings.builder().put("number_of_shards", 1).put("number_of_replicas", 0).build();</span><br><span class="line">        // 复合参数</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> region = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        region.put("type", "text");</span><br><span class="line">        region.put("index", "true");</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> location = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> location_properties = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> province = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        province.put("type", "text");</span><br><span class="line">        province.put("index", "true");</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> city = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        city.put("type", "text");</span><br><span class="line">        city.put("index", "true");</span><br><span class="line">        location_properties.put("province", province);</span><br><span class="line">        location_properties.put("city", city);</span><br><span class="line">        location.put("properties", location_properties);</span><br><span class="line">        // 设置mapping映射</span><br><span class="line">        XContentBuilder mapping = XContentFactory.jsonBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .startObject("properties")</span><br><span class="line">                // keyId</span><br><span class="line">                .startObject("keyId").field("type", "long").endObject()</span><br><span class="line">                // account</span><br><span class="line">                .startObject("account").field("type", "keyword").endObject()</span><br><span class="line">                // username</span><br><span class="line">                .startObject("username").field("type", "text").endObject()</span><br><span class="line">                // age</span><br><span class="line">                .startObject("age").field("type", "short").endObject()</span><br><span class="line">                // birthday</span><br><span class="line">                .startObject("birthday")</span><br><span class="line">                    .field("type", "date")</span><br><span class="line">                    .field("format", "yyyy-MM-dd")</span><br><span class="line">                    .field("ignore_malformed", true).endObject()</span><br><span class="line">                // address</span><br><span class="line">                .startObject("address").startObject("properties")</span><br><span class="line">                    .field("region", region)</span><br><span class="line">                    .field("location", location)</span><br><span class="line">                    .endObject().endObject()</span><br><span class="line">                // role</span><br><span class="line">                .startObject("role").startObject("properties")</span><br><span class="line">                    .startObject("attribute").field("type", "nested").endObject()</span><br><span class="line">                    .endObject().endObject()</span><br><span class="line">                // createdTime</span><br><span class="line">                .startObject("createdTime")</span><br><span class="line">                    .field("type", "date")</span><br><span class="line">                    .field("format", "yyyy-MM-dd HH:mm:ss||epoch_millis")</span><br><span class="line">                    .field("ignore_malformed", true).endObject()</span><br><span class="line">                    .endObject().endObject();</span><br><span class="line">        System.out.println(elasticSearchService.createIndex(index, settings, mapping));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>删除索引的同时会删除索引内的全部数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 删除ES索引() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        System.out.println(elasticSearchService.deleteIndex(index));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</title>
    <url>/2022/03/1646640937853/1646640937853/</url>
    <content><![CDATA[<p>本文的内容都是对接口类的一些参数进行抽象的封装使用</p>
<p><a href="/2022/03/1646386352631/1646386352631/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</a><br><a href="/2022/03/1646640931232/1646640931232/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</a><br><a href="/2022/03/1646642392484/1646642392484/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</a><br><a href="/2022/03/1646645017427/1646645017427/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</a><br><a href="/2022/03/1646645021846/1646645021846/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</a></p>
<h3 id="实体类参数"><a href="#实体类参数" class="headerlink" title="实体类参数"></a>实体类参数</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span class="line">import org.elasticsearch.action.search.SearchRequest;</span><br><span class="line">import org.elasticsearch.client.core.CountRequest;</span><br><span class="line">import org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021/9/12 22:15</span><br><span class="line"> * desc ：ES 实体类</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Accessors(chain = true)</span><br><span class="line">public class ElasticSearchDTO implements Serializable {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 索引</span><br><span class="line">     */</span><br><span class="line">    private String esIndex;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 主键</span><br><span class="line">     */</span><br><span class="line">    private String esKeyId;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 单笔数据</span><br><span class="line">     */</span><br><span class="line">    private Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> data;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 数据类型</span><br><span class="line">     */</span><br><span class="line">    private XContentType xContentType = XContentType.JSON;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 多笔数据</span><br><span class="line">     */</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">ElasticSearchDTO</span>&gt;</span> batchData;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询构造器：全部数据，分页数据</span><br><span class="line">     */</span><br><span class="line">    private SearchRequest searchRequest = new SearchRequest();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 统计构造器</span><br><span class="line">     */</span><br><span class="line">    private CountRequest countRequest = new CountRequest();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 每页显示条数，默认 10</span><br><span class="line">     */</span><br><span class="line">    private int size = 10;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当前页码数，默认 1</span><br><span class="line">     */</span><br><span class="line">    private int current = 1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ElasticSearchDTO() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 分页构造函数(单页最多10000条数据)</span><br><span class="line">     *</span><br><span class="line">     * @param current 当前页</span><br><span class="line">     * @param size    每页显示条数</span><br><span class="line">     */</span><br><span class="line">    public ElasticSearchDTO(int current, int size) {</span><br><span class="line">        if (current &gt; 1) {</span><br><span class="line">            this.current = current;</span><br><span class="line">        }</span><br><span class="line">        if (size <span class="tag">&lt;<span class="name">=</span> <span class="attr">10000</span> &amp;&amp; <span class="attr">size</span> &gt;</span> 0) {</span><br><span class="line">            this.size = size;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public int getForm() {</span><br><span class="line">        if (this.getCurrent() == 1) {</span><br><span class="line">            return 0;</span><br><span class="line">        } else {</span><br><span class="line">            return ((this.getCurrent() - 1) * this.getSize());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="分页参数"><a href="#分页参数" class="headerlink" title="分页参数"></a>分页参数</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022/2/28 15:43</span><br><span class="line"> * desc ：ES 分页</span><br><span class="line"> */</span><br><span class="line">public class ElasticSearchPage implements Serializable {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询数据列表</span><br><span class="line">     */</span><br><span class="line">    private List&lt;Map&lt;String, Object&gt;&gt; records = Collections.emptyList();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 总数</span><br><span class="line">     */</span><br><span class="line">    private long total = 0;</span><br><span class="line">    /**</span><br><span class="line">     * 每页显示条数，默认 10</span><br><span class="line">     */</span><br><span class="line">    private long size = 10;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当前页</span><br><span class="line">     */</span><br><span class="line">    private long current = 1;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 是否存在上一页</span><br><span class="line">     *</span><br><span class="line">     * @return true / false</span><br><span class="line">     */</span><br><span class="line">    public boolean hasPrevious() {</span><br><span class="line">        return this.current &gt; 1;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 是否存在下一页</span><br><span class="line">     *</span><br><span class="line">     * @return true / false</span><br><span class="line">     */</span><br><span class="line">    public boolean hasNext() {</span><br><span class="line">        return this.current <span class="tag">&lt; <span class="attr">this.getPages</span>();</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    /**</span></span><br><span class="line"><span class="tag">     * 当前分页总页数</span></span><br><span class="line"><span class="tag">     */</span></span><br><span class="line"><span class="tag">    <span class="attr">long</span> <span class="attr">getPages</span>() {</span></span><br><span class="line"><span class="tag">        <span class="attr">if</span> (<span class="attr">this.getSize</span>() == <span class="string">0)</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">return</span> <span class="attr">0L</span>;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">long</span> <span class="attr">pages</span> = <span class="string">getTotal()</span> / <span class="attr">getSize</span>();</span></span><br><span class="line"><span class="tag">        <span class="attr">if</span> (<span class="attr">this.getTotal</span>() % <span class="attr">getSize</span>() != <span class="string">0)</span> {</span></span><br><span class="line"><span class="tag">            <span class="attr">pages</span>++;</span></span><br><span class="line"><span class="tag">        }</span></span><br><span class="line"><span class="tag">        <span class="attr">return</span> <span class="attr">pages</span>;</span></span><br><span class="line"><span class="tag">    }</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line">    public List&lt;Map&lt;String, Object&gt;&gt; getRecords() {</span><br><span class="line">        return this.records;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setRecords(List&lt;Map&lt;String, Object&gt;&gt; records) {</span><br><span class="line">        this.records = records;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    long getTotal() {</span><br><span class="line">        return this.total;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setTotal(long total) {</span><br><span class="line">        this.total = total;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    long getSize() {</span><br><span class="line">        return this.size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setSize(long size) {</span><br><span class="line">        this.size = size;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    long getCurrent() {</span><br><span class="line">        return this.current;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void setCurrent(long current) {</span><br><span class="line">        this.current = current;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="返回数据"><a href="#返回数据" class="headerlink" title="返回数据"></a>返回数据</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    ElasticSearchListUtil</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2022/3/1 13:25</span><br><span class="line"> * description  ES 列表数据</span><br><span class="line"> */</span><br><span class="line">public class ElasticSearchListUtil {</span><br><span class="line"></span><br><span class="line">    public static Map<span class="tag">&lt;<span class="name">String,Object</span>&gt;</span> getData(ElasticSearchPage listPage) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        objectMap.put("hasPrevious", listPage.hasPrevious());</span><br><span class="line">        objectMap.put("hasNext", listPage.hasNext());</span><br><span class="line">        objectMap.put("total", listPage.getTotal());</span><br><span class="line">        objectMap.put("page", listPage.getPages());</span><br><span class="line">        objectMap.put("current", listPage.getCurrent());</span><br><span class="line">        objectMap.put("size", listPage.getSize());</span><br><span class="line">        objectMap.put("records", listPage.getRecords());</span><br><span class="line">        return objectMap;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</title>
    <url>/2022/03/1646645017427/1646645017427/</url>
    <content><![CDATA[<p><a href="/2022/03/1646386352631/1646386352631/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</a><br><a href="/2022/03/1646640931232/1646640931232/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</a><br><a href="/2022/03/1646640937853/1646640937853/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</a><br><a href="/2022/03/1646642392484/1646642392484/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</a><br><a href="/2022/03/1646645021846/1646645021846/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</a></p>
<h3 id="添加ES索引数据"><a href="#添加ES索引数据" class="headerlink" title="添加ES索引数据"></a>添加ES索引数据</h3><h4 id="添加ES索引单个数据"><a href="#添加ES索引单个数据" class="headerlink" title="添加ES索引单个数据"></a>添加ES索引单个数据</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 添加ES索引单个数据() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        int keyId = 33;</span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON);</span><br><span class="line">        elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId));</span><br><span class="line">        // 数据</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        objectMap.put("keyId", keyId);</span><br><span class="line">        objectMap.put("account", "admin");</span><br><span class="line">        objectMap.put("username", "管理员");</span><br><span class="line">        objectMap.put("age", 33);</span><br><span class="line">        objectMap.put("birthday", "2222-12-22");</span><br><span class="line">        // address</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> address = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        address.put("region", "中国");</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> location = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        location.put("province", "湖北省");</span><br><span class="line">        location.put("city", "黄冈市");</span><br><span class="line">        address.put("location", location);</span><br><span class="line">        objectMap.put("address", address);</span><br><span class="line">        // role</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; roleList = new ArrayList&lt;&gt;();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> role_properties_attribute_1 = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        role_properties_attribute_1.put("roleName", "角色一");</span><br><span class="line">        role_properties_attribute_1.put("roleCode", "role1");</span><br><span class="line">        roleList.add(role_properties_attribute_1);</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> role_properties_attribute_2 = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        role_properties_attribute_2.put("roleName", "角色二");</span><br><span class="line">        role_properties_attribute_2.put("roleCode", "role2");</span><br><span class="line">        roleList.add(role_properties_attribute_2);</span><br><span class="line">        objectMap.put("role", roleList);</span><br><span class="line">        // createdTime</span><br><span class="line">        objectMap.put("createdTime", "2222-12-22 12:33:33");</span><br><span class="line">        System.out.println(JSON.toJSONString(objectMap));</span><br><span class="line">        elasticSearchDTO.setData(objectMap);</span><br><span class="line">        System.out.println(elasticSearchService.insertIndexData(elasticSearchDTO));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="添加ES索引多个数据"><a href="#添加ES索引多个数据" class="headerlink" title="添加ES索引多个数据"></a>添加ES索引多个数据</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 添加ES索引多个数据() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index).setXContentType(XContentType.JSON);</span><br><span class="line">        // 批量数据</span><br><span class="line">        List<span class="tag">&lt;<span class="name">ElasticSearchDTO</span>&gt;</span> elasticSearchDTOList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        int keyId = 22;</span><br><span class="line">        // 数据</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        objectMap.put("keyId", keyId);</span><br><span class="line">        objectMap.put("account", "user");</span><br><span class="line">        objectMap.put("username", "普通用户");</span><br><span class="line">        objectMap.put("age", 22);</span><br><span class="line">        objectMap.put("birthday", "2022-12-22");</span><br><span class="line">        // address</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> address = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        address.put("region", "中国");</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> location = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        location.put("province", "上海市");</span><br><span class="line">        location.put("city", "浦东新区");</span><br><span class="line">        address.put("location", location);</span><br><span class="line">        objectMap.put("address", address);</span><br><span class="line">        // role</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; roleList = new ArrayList&lt;&gt;();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> role_properties_attribute_1 = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        role_properties_attribute_1.put("roleName", "角色三");</span><br><span class="line">        role_properties_attribute_1.put("roleCode", "role3");</span><br><span class="line">        roleList.add(role_properties_attribute_1);</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> role_properties_attribute_2 = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        role_properties_attribute_2.put("roleName", "角色四");</span><br><span class="line">        role_properties_attribute_2.put("roleCode", "role4");</span><br><span class="line">        roleList.add(role_properties_attribute_2);</span><br><span class="line">        objectMap.put("role", roleList);</span><br><span class="line">        // createdTime</span><br><span class="line">        objectMap.put("createdTime", "2022-12-22 12:33:33");</span><br><span class="line">        // 添加单笔数据</span><br><span class="line">        elasticSearchDTOList.add(new ElasticSearchDTO().setEsKeyId(String.valueOf(keyId)).setData(objectMap));</span><br><span class="line">        // 设置批量数据</span><br><span class="line">        elasticSearchDTO.setBatchData(elasticSearchDTOList);</span><br><span class="line">        System.out.println(elasticSearchService.insertIndexBatchData(elasticSearchDTO));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="删除ES索引数据"><a href="#删除ES索引数据" class="headerlink" title="删除ES索引数据"></a>删除ES索引数据</h3><h4 id="根据-id删除ES索引单个数据"><a href="#根据-id删除ES索引单个数据" class="headerlink" title="根据_id删除ES索引单个数据"></a>根据_id删除ES索引单个数据</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 根据_id删除ES索引数据() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        int keyId = 33;</span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON);</span><br><span class="line">        elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId));</span><br><span class="line">        System.out.println(elasticSearchService.deleteIndexDataById(elasticSearchDTO));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="修改ES索引数据"><a href="#修改ES索引数据" class="headerlink" title="修改ES索引数据"></a>修改ES索引数据</h3><h4 id="根据-id修改ES索引单个数据"><a href="#根据-id修改ES索引单个数据" class="headerlink" title="根据_id修改ES索引单个数据"></a>根据_id修改ES索引单个数据</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 根据_id更新ES索引数据() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        int keyId = 33;</span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON);</span><br><span class="line">        elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId));</span><br><span class="line">        // 修改的内容(可修改指定部分字段内容)</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        objectMap.put("username", "超级管理员");</span><br><span class="line">        elasticSearchDTO.setData(objectMap);</span><br><span class="line">        System.out.println(elasticSearchService.updateIndexDataById(elasticSearchDTO));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)</title>
    <url>/2022/03/1646645021846/1646645021846/</url>
    <content><![CDATA[<p><a href="/2022/03/1646386352631/1646386352631/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类</a><br><a href="/2022/03/1646640931232/1646640931232/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类</a><br><a href="/2022/03/1646640937853/1646640937853/">SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类</a><br><a href="/2022/03/1646642392484/1646642392484/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除</a><br><a href="/2022/03/1646645017427/1646645017427/">SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)</a></p>
<p>在 ES 当中提供了 bool 查询，一个 bool 查询可以包含一个或多个查询字句，支持以下四种查询：</p>
<ul>
<li>must：必须匹配，贡献算分</li>
<li>should：选择性匹配，贡献算分</li>
<li>must_not：查询字句，必须不能匹配</li>
<li>filter：必须匹配，不贡献算分</li>
</ul>
<h3 id="查询ES索引数据-全部"><a href="#查询ES索引数据-全部" class="headerlink" title="查询ES索引数据_全部"></a>查询ES索引数据_全部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 查询ES索引数据_全部() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        // 根据_id查询 </span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.termQuery("_id", "33"));</span><br><span class="line">        </span><br><span class="line">        // 精确条件(单值查询)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.termQuery("account", "admin"));</span><br><span class="line">        // 精确条件(多值查询)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.termsQuery("keyId", Arrays.asList("22", "33")));</span><br><span class="line">        </span><br><span class="line">        // 模糊查询(查询全部)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchAllQuery());</span><br><span class="line">        // 模糊查询(会将搜索词分词，再与目标查询字段进行匹配，若分词中的任意一个词与目标字段匹配上，则可查询到)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchQuery("username", "临管"));</span><br><span class="line">        // 模糊查询(不会将搜索词分词，会精确匹配查询的短语，需要全部单词和顺序要完全一样)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchPhraseQuery("username", "时管理员"));</span><br><span class="line">        // 模糊查询(不会将搜索词分词，会精确匹配查询的短语，需要全部单词和顺序要完全一样同时需要前缀匹配，中英有出入)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchPhrasePrefixQuery("username", "临时管理"));</span><br><span class="line">        // 模糊查询(匹配搜索多个字段,minimumShouldMatch:设置匹配度，  field:提升字段的得分权限,每个结果搜索出来后都会有一个得分)</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.multiMatchQuery("用户", Arrays.asList("username", "address.region").toArray(new String[0])).minimumShouldMatch("50%"));</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.multiMatchQuery("浦东新区", Arrays.asList("username", "address.location.city").toArray(new String[0])).minimumShouldMatch("50%"));</span><br><span class="line"></span><br><span class="line">        // 范围值查询 lt小于value的值，小于等于是lte、大于是gt、大于等于是gte</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.rangeQuery("age").lt(30));</span><br><span class="line">        // 范围时间查询 lt小于value的值，小于等于是lte、大于是gt、大于等于是gte</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.rangeQuery("createdTime").lt("2122-12-22 12:33:33"));</span><br><span class="line"></span><br><span class="line">        // 过滤器查询(不分词查询,必须匹配，不贡献算分)</span><br><span class="line">        boolQueryBuilder.filter(QueryBuilders.termQuery("account", "admin"));</span><br><span class="line">                    </span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder().query(boolQueryBuilder);</span><br><span class="line">        </span><br><span class="line">        // 设置源字段过虑,第一个参数结果集包括哪些字段，第二个参数表示结果集不包括哪些字段</span><br><span class="line">        String[] includes = {"keyId", "username", "account", "createdTime", "role","birthday","address","age"};</span><br><span class="line">        String[] excludes = {"keyId"};</span><br><span class="line">        searchSourceBuilder.fetchSource(includes, excludes);</span><br><span class="line">        </span><br><span class="line">        // 排序(对查询后结果进行排序,DESC:倒序-从大到小,ASC:顺序-从小到大,含有优先序列)</span><br><span class="line">        searchSourceBuilder.sort("age", SortOrder.ASC).sort("birthday",SortOrder.DESC);</span><br><span class="line">        </span><br><span class="line">        // 设置高亮(requireFieldMatch:多次段高亮需要设置为false)</span><br><span class="line">        HighlightBuilder highlightBuilder = new HighlightBuilder();</span><br><span class="line">        highlightBuilder.preTags("<span class="tag">&lt;<span class="name">tag</span>&gt;</span>").postTags("<span class="tag">&lt;/<span class="name">tag</span>&gt;</span>");</span><br><span class="line">        highlightBuilder.field("account").field("username");</span><br><span class="line">        searchSourceBuilder.highlighter(highlightBuilder.requireFieldMatch(false));</span><br><span class="line">        </span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index).setSearchRequest(new SearchRequest().source(searchSourceBuilder));</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; mapList = elasticSearchService.searchDataList(elasticSearchDTO);</span><br><span class="line">        System.out.println(JSON.toJSONString(mapList));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="查询ES索引数据-分页"><a href="#查询ES索引数据-分页" class="headerlink" title="查询ES索引数据_分页"></a>查询ES索引数据_分页</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 查询ES索引数据_分页() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        // 模糊查询</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchPhraseQuery("username", "管理员"));</span><br><span class="line">        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder().query(boolQueryBuilder);</span><br><span class="line"></span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO(1, 10).setEsIndex(index).setSearchRequest(new SearchRequest().source(searchSourceBuilder));</span><br><span class="line">        ElasticSearchPage elasticSearchPage = elasticSearchService.searchDataListPage(elasticSearchDTO);</span><br><span class="line">        System.out.println(JSON.toJSONString(ElasticSearchListUtil.getData(elasticSearchPage)));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="查询ES索引数据-统计"><a href="#查询ES索引数据-统计" class="headerlink" title="查询ES索引数据_统计"></a>查询ES索引数据_统计</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">void 查询ES索引数据_统计() {</span><br><span class="line">    String index = "my_index";</span><br><span class="line">    try {</span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.matchPhraseQuery("username", "管理员"));</span><br><span class="line"></span><br><span class="line">        ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index);</span><br><span class="line">        elasticSearchDTO.getCountRequest().source(new SearchSourceBuilder().query(boolQueryBuilder));</span><br><span class="line">        System.out.println(elasticSearchService.getIndexCount(elasticSearchDTO));</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis集群配置 - Cluster（三主三从）</title>
    <url>/2022/03/1647423664207/1647423664207/</url>
    <content><![CDATA[<p><a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">Redis官方集群文档-中文版</a></p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>系统环境：Windows10</li>
<li>Ruby版本：<a href="https://github.com/oneclick/rubyinstaller2/releases/download/RubyInstaller-3.1.1-1/rubyinstaller-3.1.1-1-x64.7z" target="_blank" rel="noopener">Ruby31-x64</a></li>
<li>软件版本：<a href="http://localhost:4000/2020/09/1601194986992/1601194986992/" target="_blank" rel="noopener">Redis-x64-3.2.100</a></li>
</ul>
<p>示例-<a href="https://pan.baidu.com/s/1XaKoO6bXk23uLzQb6HXKmw?pwd=bs23" target="_blank" rel="noopener">传送门</a></p>
<p>软件均采取绿色版配置执行，由于Redis为3.x版本创建集群需要用Ruby环境，Redis5以后不需要了</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ul>
<li>Ruby<br> 1.下载完成后解压即可，本文采用全路径引用运行,无需配置环境变量<br> 2.安装Redis的驱动，考虑到兼容性，这里下载的是 <a href="https://rubygems.org/downloads/redis-3.2.2.gem" target="_blank" rel="noopener">3.2.2</a> 版本，复制文件到rubyinstaller-3.1.1-1-x64\bin目录下，在该目录下执行cmd命令：gem install –local redis-3.2.2.gem<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">D:\rubyinstaller-3.1.1-1-x64\bin&gt;gem install --local redis-3.2.2.gem</span><br><span class="line">Successfully installed redis-3.2.2</span><br><span class="line">Parsing documentation for redis-3.2.2</span><br><span class="line">Done installing documentation for redis after 1 seconds</span><br><span class="line">1 gem installed</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>Redis<br> 1.下载完成后解压即可，<br> 2.下载Redis集群管理工具 <a href="https://github.com/beebol/redis-trib.rb" target="_blank" rel="noopener">redis-trib.rb</a>，复制到 Redis-x64-3.2.100 同级目录下</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Redis集群需要至少3个以上节点，低于3个无法创建。<br>将下载到的 Redis-x64-3.2.100.zip 解压即可，为了方便使用，建议放在盘符根目录下，如：D:\Redis-Cluster\Redis-x64-3.2.100。<br>通过配置文件来启动6个不同的Redis实例，由于Redis默认端口为6379，所以这里使用了6380、6381、6382、6383、6384、6385来运行6个Redis实例。</p>
<p>1.在Redis安装根目录下创建目录 conf、logs<br><img src="/2022/03/1647423664207/1647423664207/20220317145427.png" alt="20220317145427"></p>
<p>2.在 conf 目录下创建编码格式为UTF-8的配置文件：redis.6380.conf、redis.6381.conf、redis.6382.conf、redis.6383.conf、redis.6384.conf、redis.6385.conf<br><img src="/2022/03/1647423664207/1647423664207/20220317145657.png" alt="20220317145657"></p>
<ul>
<li>  配置文件内容均为以下内容（根据端口修改对应内容）<a href="#参数说明">参数说明</a>：<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">port 6380</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">loglevel notice</span><br><span class="line">logfile "logs/redis6380.log"</span><br><span class="line">syslog-enabled yes</span><br><span class="line">syslog-ident redis6380</span><br><span class="line">appendfilename "appendonly.6380.aof"</span><br><span class="line">appendonly yes</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.6380.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">cluster-slave-validity-factor 10</span><br><span class="line">cluster-migration-barrier 1</span><br><span class="line">cluster-require-full-coverage yes</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>   最终目录：<br>   <img src="/2022/03/1647423664207/1647423664207/20220317151204.png" alt="20220317151204"></li>
</ul>
<h3 id="cmd运行"><a href="#cmd运行" class="headerlink" title="cmd运行"></a>cmd运行</h3><ul>
<li><p>运行Redis<br>建议在 D:/Redis-Cluster/Redis-x64-3.2.100 内执行，这样数据/日志就会写在logs目录下</p>
<p>  cd D:/Redis-Cluster/Redis-x64-3.2.100</p>
  <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">redis-server.exe ./conf/redis.6380.conf</span><br><span class="line">redis-server.exe ./conf/redis.6381.conf</span><br><span class="line">redis-server.exe ./conf/redis.6382.conf</span><br><span class="line">redis-server.exe ./conf/redis.6383.conf</span><br><span class="line">redis-server.exe ./conf/redis.6384.conf</span><br><span class="line">redis-server.exe ./conf/redis.6385.conf</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>创建集群<br>create –replicas 1指定从库数量1，创建顺序三主-三从。即主-主-主-从-从-从，如果redis设置了密码则创建集群时需要添加密码信息 -a 密码</p>
<p>  cd D:\Redis-Cluster</p>
  <div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">rubyinstaller-3.1.1-1-x64/bin/ruby.exe redis-trib.rb create  --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385</span><br></pre></td></tr></tbody></table></figure></div>


</li>
</ul>
<h3 id="bat运行"><a href="#bat运行" class="headerlink" title="bat运行"></a>bat运行</h3><ul>
<li>RedisServer - 0.集群安装Redis插件<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set root_home=%~dp0</span><br><span class="line">cd %root_home%rubyinstaller-3.1.1-1-x64\bin</span><br><span class="line">call gem install --local redis-3.2.2.gem</span><br><span class="line">@pause</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>RedisServer - 1.集群初始化<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">title redis-standalone-6379</span><br><span class="line">set root_home=%~dp0</span><br><span class="line">::指定起始文件夹</span><br><span class="line">echo %root_home%</span><br><span class="line">for /R %root_home%Redis-x64-3.2.100 %%f in (appendonly.*.aof redis.*.log nodes.*.conf) do ( </span><br><span class="line">    echo %%f</span><br><span class="line">    del %%f</span><br><span class="line">)</span><br><span class="line">@pause</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>RedisServer - 2.集群运行<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">title redis-cluster</span><br><span class="line">set root_home=%~dp0</span><br><span class="line">cd %root_home%Redis-x64-3.2.100</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6380</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6380" redis-server.exe conf/redis.6380.conf</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6381</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6381" redis-server.exe conf/redis.6381.conf</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6382</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6382" redis-server.exe conf/redis.6382.conf</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6383</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6383" redis-server.exe conf/redis.6383.conf</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6384</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6384" redis-server.exe conf/redis.6384.conf</span><br><span class="line"></span><br><span class="line">echo redis-cluster-6385</span><br><span class="line">choice /t 1 /c YN /d Y</span><br><span class="line">start "redis-cluster-6385" redis-server.exe conf/redis.6385.conf</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>RedisServer - 3.集群创建<br>  在第一次运行即可，后续的重启无需使用<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@echo off</span><br><span class="line">set root_home=%~dp0</span><br><span class="line">call %root_home%rubyinstaller-3.1.1-1-x64\bin\ruby.exe redis-trib.rb create  --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385</span><br><span class="line">@pause</span><br></pre></td></tr></tbody></table></figure></div></code></pre></li>
</ul>
<h3 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h3><p>可将运行程序进行服务化安装</p>
<ul>
<li>安装服务<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6380.conf --service-name redis6380</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6381.conf --service-name redis6381</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6382.conf --service-name redis6382</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6383.conf --service-name redis6383</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6384.conf --service-name redis6384</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6385.conf --service-name redis6385</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>卸载服务<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6380.conf --service-name redis6380</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6381.conf --service-name redis6381</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6382.conf --service-name redis6382</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6383.conf --service-name redis6383</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6384.conf --service-name redis6384</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6385.conf --service-name redis6385</span><br></pre></td></tr></tbody></table></figure></div></code></pre><br></li>
<li>启动服务<pre><code><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6380</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6381</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6382</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6383</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6384</span><br><span class="line">D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6385</span><br></pre></td></tr></tbody></table></figure></div></code></pre></li>
</ul>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">port 6380</span><br><span class="line">    端口号</span><br><span class="line">    </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">    IP地址</span><br><span class="line"></span><br><span class="line">loglevel notice</span><br><span class="line">    日志的记录级别，notice是适合生产环境的</span><br><span class="line"></span><br><span class="line">logfile "logs/redis6380.log"</span><br><span class="line">    指定log的保持路径,默认是创建在Redis安装目录下，如果有子目录需要手动创建,如此处的logs目录</span><br><span class="line"></span><br><span class="line">syslog-enabled yes</span><br><span class="line">    是否使用系统日志</span><br><span class="line"></span><br><span class="line">syslog-ident redis6380</span><br><span class="line">    在系统日志的标识名</span><br><span class="line"></span><br><span class="line">appendfilename "appendonly.6380.aof"</span><br><span class="line">    数据保存文件</span><br><span class="line"></span><br><span class="line">appendonly:</span><br><span class="line">    数据的保存为aof格式 yes表示：存储方式，aof，将写操作记录保存到日志中</span><br><span class="line">    指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。</span><br><span class="line">    yes表示：存储方式，aof，将写操作记录保存到日志中</span><br><span class="line">    </span><br><span class="line">cluster-enabled yes</span><br><span class="line">    是否开启集群</span><br><span class="line">    </span><br><span class="line">cluster-config-file nodes.6380.conf</span><br><span class="line">    保存节点配置,自动创建,自动更新(建议命名时加上端口号)</span><br><span class="line">    </span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">    集群超时时间，节点超过这个时间没反应就断定是宕机</span><br><span class="line">    </span><br><span class="line">cluster-slave-validity-factor 10</span><br><span class="line">    该参数就是用来判断slave节点与master断线的时间是否过长。</span><br><span class="line">    在进行故障转移的时候全部slave都会请求申请为master，但是有些slave可能与master断开连接一段时间了导致数据过于陈旧，不应该被提升为master,</span><br><span class="line">    判断方法是：比较slave断开连接的时间和(node-timeout * slave-validity-factor)+ repl-ping-slave-period如果节点超时时间为三十秒, </span><br><span class="line">    并且slave-validity-factor为10，假设默认的repl-ping-slave-period是10秒，即如果超过310秒slave将不会尝试进行故障转移。</span><br><span class="line">    </span><br><span class="line">cluster-migration-barrier 1</span><br><span class="line">    master的slave数量大于该值，slave才能迁移到其他孤立master上，如这个参数被设为2，那么只有当一个主节点拥有2个可工作的从节点时，它的一个从节点才会尝试迁移。</span><br><span class="line">    </span><br><span class="line">cluster-require-full-coverage yes</span><br><span class="line">    集群全部的slot有节点负责，集群状态才为ok并提供服务。设置为no可以在slot没有全部分配的时候提供服务。</span><br><span class="line">    不建议打开该配置，这样会造成分区的时候，小分区的master一直在接受写请求，而造成很长时间数据不一致。</span><br></pre></td></tr></tbody></table></figure></div>

<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot之自定义MyBatis-Plus配置</title>
    <url>/2022/03/1648110385163/1648110385163/</url>
    <content><![CDATA[<p>修改原生的<a href="/2021/04/1617878968965/1617878968965/">YML配置</a>，采取自定义模式，</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 连接 、事务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 mybatis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 sqlite --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xerial<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sqlite-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.27.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库 oracle --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>12.1.0.1-atlassian-hosted<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>创建Bean的注入方式，使用 @ConditionalOnMissingClass 注解 进行判断bean是否存在，<br>如不存在则加载当前默认bean，如存在则使用配置bean.</p>
<ul>
<li><p>MybatisDataConfig</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022 2022/3/18 15:41</span><br><span class="line"> * desc ：自定义bean</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Component(value = "mybatisDataConfig")</span><br><span class="line">@ConditionalOnMissingClass(value = "mybatisDataConfig")</span><br><span class="line">public class MybatisDataConfig {</span><br><span class="line"></span><br><span class="line">    private String driverClassName;</span><br><span class="line">    private String jdbcUrl;</span><br><span class="line">    private String username;</span><br><span class="line">    private String password;</span><br><span class="line">    </span><br><span class="line">    private String poolName = "DataSource_HikariCP";</span><br><span class="line">    private long connectionTimeoutMs = 30000;</span><br><span class="line">    private long idleTimeoutMs = 300000;</span><br><span class="line">    private long validationTimeoutMs = 5000;</span><br><span class="line">    private long maxLifetimeMs = 1800000;</span><br><span class="line">    private int maxPoolSize = 20;</span><br><span class="line">    private int minIdle = 5;</span><br><span class="line"></span><br><span class="line">    private String typeAliasesPackage = "**.database.entity";</span><br><span class="line">    private String locationPattern = "classpath*:/mapper/*Mapper.xml";</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>DataSourceConfig</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.zaxxer.hikari.HikariConfig;</span><br><span class="line">import com.zaxxer.hikari.HikariDataSource;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Primary;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2021 2021/8/27 13:54</span><br><span class="line"> * desc ：数据库</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class DataSourceConfig {</span><br><span class="line"></span><br><span class="line">    @Resource(name = "mybatisDataConfig")</span><br><span class="line">    private MybatisDataConfig mybatisDataConfig;</span><br><span class="line"></span><br><span class="line">    @Bean(name = "dataSource")</span><br><span class="line">    @Primary</span><br><span class="line">    public DataSource getDataSource() {</span><br><span class="line">        System.out.println("★★★★★配置 dataSource ★★★★★");</span><br><span class="line">        HikariConfig hikariConfig = new HikariConfig();</span><br><span class="line">        hikariConfig.setDriverClassName(mybatisDataConfig.getDriverClassName());</span><br><span class="line">        hikariConfig.setJdbcUrl(mybatisDataConfig.getJdbcUrl());</span><br><span class="line">        hikariConfig.setUsername(mybatisDataConfig.getUsername());</span><br><span class="line">        hikariConfig.setPassword(mybatisDataConfig.getPassword());</span><br><span class="line">        // 自定义连接池名称</span><br><span class="line">        hikariConfig.setPoolName(mybatisDataConfig.getPoolName());</span><br><span class="line">        hikariConfig.setReadOnly(false);</span><br><span class="line">        // 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQLException， 缺省:30秒</span><br><span class="line">        hikariConfig.setConnectionTimeout(mybatisDataConfig.getConnectionTimeoutMs());</span><br><span class="line">        // 一个连接idle状态的最大时长（毫秒），超时则被释放（retired），缺省:10分钟</span><br><span class="line">        hikariConfig.setIdleTimeout(mybatisDataConfig.getIdleTimeoutMs());</span><br><span class="line">        // 验证与数据库连接的有效时间</span><br><span class="line">        hikariConfig.setValidationTimeout(mybatisDataConfig.getValidationTimeoutMs());</span><br><span class="line">        // 建议设置比数据库超时时长少30秒，参考MySQL wait_timeout参数（show variables like '%timeout%';）</span><br><span class="line">        hikariConfig.setMaxLifetime(mybatisDataConfig.getMaxLifetimeMs());</span><br><span class="line">        // 连接池中允许的最大连接数。缺省值：10；推荐的公式：((core_count * 2) + effective_spindle_count)</span><br><span class="line">        hikariConfig.setMaximumPoolSize(mybatisDataConfig.getMaxPoolSize());</span><br><span class="line">        // 连接池中维护的最小空闲连接数</span><br><span class="line">        hikariConfig.setMinimumIdle(mybatisDataConfig.getMinIdle());</span><br><span class="line">        // 从池返回的连接的默认自动提交行为。默认值为true</span><br><span class="line">        hikariConfig.setAutoCommit(true);</span><br><span class="line">        // 如果您的驱动程序支持JDBC4，我们强烈建议您不要设置此属性</span><br><span class="line">        hikariConfig.setConnectionTestQuery("SELECT 1");</span><br><span class="line">        return new HikariDataSource(hikariConfig);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>MybatisPlusConfig</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line">import com.baomidou.mybatisplus.autoconfigure.SpringBootVFS;</span><br><span class="line">import com.baomidou.mybatisplus.core.MybatisConfiguration;</span><br><span class="line">import com.baomidou.mybatisplus.core.MybatisXMLLanguageDriver;</span><br><span class="line">import com.baomidou.mybatisplus.core.config.GlobalConfig;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;</span><br><span class="line">import com.baomidou.mybatisplus.extension.plugins.pagination.optimize.JsqlParserCountOptimize;</span><br><span class="line">import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.ibatis.session.AutoMappingBehavior;</span><br><span class="line">import org.apache.ibatis.session.ExecutorType;</span><br><span class="line">import org.apache.ibatis.type.JdbcType;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Primary;</span><br><span class="line">import org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * className    MybatisPlusConfig</span><br><span class="line"> * author       demon</span><br><span class="line"> * createTime   2021/5/21 18:15</span><br><span class="line"> * description  mybatis-plus 配置</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">public class MybatisPlusConfig {</span><br><span class="line"></span><br><span class="line">    @Resource(name = "mybatisDataConfig")</span><br><span class="line">    private MybatisDataConfig mybatisDataConfig;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 分页插件</span><br><span class="line">     * paginationInterceptor.setLimit(你的最大单页限制数量，默认 500 条，小于 0 如 -1 不受限制);</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public PaginationInterceptor paginationInterceptor() {</span><br><span class="line">        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();</span><br><span class="line">        // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span><br><span class="line">        paginationInterceptor.setOverflow(true);</span><br><span class="line">        // 设置最大单页限制数量，默认 500 条，-1 不受限制</span><br><span class="line">        paginationInterceptor.setLimit(-1);</span><br><span class="line">        // 开启 count 的 join 优化,只针对部分 left join</span><br><span class="line">        paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true));</span><br><span class="line">        return paginationInterceptor;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将yml配置代码化</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    @Primary</span><br><span class="line">    public MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean() throws Exception {</span><br><span class="line">        //一定要使用 MybatisSqlSessionFactoryBean否则Statement not bound错误</span><br><span class="line">        System.out.println("★★★★★配置 MybatisSqlSessionFactoryBean ★★★★★");</span><br><span class="line">        MybatisSqlSessionFactoryBean mybatisPlus = new MybatisSqlSessionFactoryBean();</span><br><span class="line">        //加载数据源  此处配置为关键配置，如果没有将 dataSource 作为数据源则不能实现切换</span><br><span class="line">        mybatisPlus.setDataSource(dataSource);</span><br><span class="line">        mybatisPlus.setVfs(SpringBootVFS.class);</span><br><span class="line">        // 配置 configuration</span><br><span class="line">        MybatisConfiguration configuration = new MybatisConfiguration();</span><br><span class="line">        configuration.setDefaultScriptingLanguage(MybatisXMLLanguageDriver.class);</span><br><span class="line">        configuration.setJdbcTypeForNull(JdbcType.NULL);</span><br><span class="line">        // 映射器缓存</span><br><span class="line">        configuration.setCacheEnabled(false);</span><br><span class="line">        // 查询时，关闭关联对象即时加载以提高性能</span><br><span class="line">        configuration.setLazyLoadingEnabled(false);</span><br><span class="line">        // 不允许使用自定义的主键值(比如由程序生成的UUID 32位编码作为键值), 数据表的PK生成策略将被覆盖</span><br><span class="line">        configuration.setUseGeneratedKeys(false);</span><br><span class="line">        // 对于批量更新操作缓存SQL以提高性能 SIMPLE, REUSE, BATCH</span><br><span class="line">        configuration.setDefaultExecutorType(ExecutorType.REUSE);</span><br><span class="line">        // 对于未知的SQL查询，允许返回不同的结果集以达到通用的效果</span><br><span class="line">        configuration.setMultipleResultSetsEnabled(true);</span><br><span class="line">        // 允许使用列标签代替列名</span><br><span class="line">        configuration.setUseColumnLabel(true);</span><br><span class="line">        // 解决mybatis空字段null字段不返回</span><br><span class="line">        configuration.setCallSettersOnNulls(true);</span><br><span class="line">        // 给予被嵌套的resultMap以字段-属性的映射支持 NONE, FULL,PARTIAL</span><br><span class="line">        configuration.setAutoMappingBehavior(AutoMappingBehavior.PARTIAL);</span><br><span class="line">        // 日志</span><br><span class="line">        configuration.setLogImpl(org.apache.ibatis.logging.stdout.StdOutImpl.class);</span><br><span class="line">        mybatisPlus.setConfiguration(configuration);</span><br><span class="line">        // 添加分页功能</span><br><span class="line">        mybatisPlus.setPlugins(paginationInterceptor());</span><br><span class="line">        //加载 mybatis-plus 全局配置</span><br><span class="line">        GlobalConfig globalConfig = new GlobalConfig();</span><br><span class="line">        GlobalConfig.DbConfig dbConfig = new GlobalConfig.DbConfig();</span><br><span class="line">        // 默认为自增</span><br><span class="line">        dbConfig.setIdType(IdType.AUTO);</span><br><span class="line">        // 全局的表前缀策略配置</span><br><span class="line">        globalConfig.setDbConfig(dbConfig);</span><br><span class="line">        mybatisPlus.setGlobalConfig(globalConfig);</span><br><span class="line">        //指定 pojo 目录 ，扫描Model</span><br><span class="line">        mybatisPlus.setTypeAliasesPackage(mybatisDataConfig.getTypeAliasesPackage());</span><br><span class="line">        // Mapper包路径， 扫描映射文件</span><br><span class="line">        mybatisPlus.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(mybatisDataConfig.getLocationPattern()));</span><br><span class="line">        return mybatisPlus;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MyBatis</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title>ElasticSearch-v6.8.1的集群配置</title>
    <url>/2022/03/1648106149513/1648106149513/</url>
    <content><![CDATA[<p><a href="/2021/07/1626758495025/1626758495025/">单机</a></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在配置文件 elasticsearch.yml 中修改以下节点<br>由于只有2个节点的ES集群，故 discovery.zen.minimum_master_nodes 无法配置（nodes / 2 + 1）</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 设置节点的名称，取当前主机名</span><br><span class="line">node.name: ${HOSTNAME}</span><br><span class="line"># 设置集群的名称</span><br><span class="line">cluster.name: my-elasticsearch-cluster</span><br><span class="line"># 设置集群节点</span><br><span class="line">discovery.zen.ping.unicast.hosts: ["127.0.0.2:9300", "127.0.0.3:9300"]</span><br></pre></td></tr></tbody></table></figure></div>

<ul>
<li>查询节点状态  <a href="http://127.0.0.1:9200/_cluster/state/?pretty" target="_blank" rel="noopener">http://127.0.0.1:9200/_cluster/state/?pretty</a><br><img src="/2022/03/1648106149513/1648106149513/20220324160440.png" alt="20220324160440"></li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>ElasticSearch</category>
      </categories>
      <tags>
        <tag>ElasticSearch</tag>
      </tags>
  </entry>
  <entry>
    <title>XML操作之dom4j</title>
    <url>/2023/07/1688699772517/1688699772517/</url>
    <content><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxen<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>dom4j:解析，生成<br>jaxen:查找节点</p>
<h2 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h2><h3 id="XML样例"><a href="#XML样例" class="headerlink" title="XML样例"></a>XML样例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">&lt;root&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;accessToken&gt;token&lt;/accessToken&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;request&gt;</span><br><span class="line">			&lt;param id='123' age='18'&gt;张三&lt;/param&gt;</span><br><span class="line">			&lt;param id='456' age='20'&gt;李四&lt;/param&gt;</span><br><span class="line">		&lt;/request&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="读取xml文件"><a href="#读取xml文件" class="headerlink" title="读取xml文件"></a>读取xml文件</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Document document = new SAXReader().read(filePath);</span><br><span class="line">Element rootElement = document.getRootElement();</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="读取xml字符串"><a href="#读取xml字符串" class="headerlink" title="读取xml字符串"></a>读取xml字符串</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Document document = DocumentHelper.parseText(xmlStr);</span><br><span class="line">Element rootElement = document.getRootElement();</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><h4 id="解析属性"><a href="#解析属性" class="headerlink" title="解析属性"></a>解析属性</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">String attributeKey = rootElement.attributeValue("attributeKey");</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="解析下级节点"><a href="#解析下级节点" class="headerlink" title="解析下级节点"></a>解析下级节点</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Element ele = rootElement.element("elementName")</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="迭代下级节点-多个"><a href="#迭代下级节点-多个" class="headerlink" title="迭代下级节点(多个)"></a>迭代下级节点(多个)</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Iterator<span class="tag">&lt;<span class="name">Element</span>&gt;</span> rootIter = root.elementIterator();	</span><br><span class="line">while (rootIter.hasNext()) {</span><br><span class="line">    Element ele = rootIter.next();</span><br><span class="line">    System.out.println(ele.getName());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">单节点：String accessToken = rootElement.selectSingleNode("/root/head/accessToken").getStringValue();   </span><br><span class="line">多节点：List param = root.selectNodes("/root/body/request/param");</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h2><h4 id="生成xml文档"><a href="#生成xml文档" class="headerlink" title="生成xml文档"></a>生成xml文档</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">// 创建一个Document实例</span><br><span class="line">Document document = DocumentHelper.createDocument();</span><br><span class="line">Element rootEle = document.addElement("root");</span><br><span class="line"></span><br><span class="line">Element headEle = rootEle.addElement("head");</span><br><span class="line">headEle.addElement("accessToken").addText("token");</span><br><span class="line"></span><br><span class="line">Element bodyEle = rootEle.addElement("body");</span><br><span class="line">Element requestEle =  bodyEle.addElement("request");</span><br><span class="line">requestEle.addElement("param").addAttribute("id","123").addAttribute("age","18").addText("张三");</span><br><span class="line">requestEle.addElement("param").addAttribute("id","124").addAttribute("age","20").addText("李四");</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="输出xml字符串"><a href="#输出xml字符串" class="headerlink" title="输出xml字符串"></a>输出xml字符串</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">String str = document.asXML();</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="输出xml文件"><a href="#输出xml文件" class="headerlink" title="输出xml文件"></a>输出xml文件</h4><p>展开格式：OutputFormat format = OutputFormat.createPrettyPrint();<br>压缩格式：OutputFormat format = OutputFormat.createCompactFormat();</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">// 自定义xml样式</span><br><span class="line">OutputFormat format = new OutputFormat();</span><br><span class="line">format.setEncoding("UTF-8");</span><br><span class="line">format.setNewLineAfterDeclaration(false); // 放置xml文件中第二行为空白行</span><br><span class="line">// 输出xml文件</span><br><span class="line">XMLWriter writer = new XMLWriter(new FileOutputStream(filePath), format);</span><br><span class="line">writer.write(document);</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Xml</tag>
      </tags>
  </entry>
  <entry>
    <title>Map的链式操作</title>
    <url>/2022/08/1661321528152/1661321528152/</url>
    <content><![CDATA[<p>创建Map数据：new HashMap&lt;&gt;()，new LinkedHashMap&lt;&gt;();</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params1 = new MapDataUtil<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span>().of().get();</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> params2 = new MapDataUtil<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span>().of(true).get();</span><br><span class="line"></span><br><span class="line">Map<span class="tag">&lt;<span class="name">Integer,</span> <span class="attr">Integer</span>&gt;</span> params3 = new MapDataUtil<span class="tag">&lt;<span class="name">Integer,</span> <span class="attr">Integer</span>&gt;</span>().of().get();</span><br><span class="line">Map<span class="tag">&lt;<span class="name">Integer,</span> <span class="attr">Integer</span>&gt;</span> params4 = new MapDataUtil<span class="tag">&lt;<span class="name">Integer,</span> <span class="attr">Integer</span>&gt;</span>().of(true).get();</span><br><span class="line"></span><br><span class="line">Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params5 = new MapDataUtil<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span>().of().get();</span><br><span class="line">Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> params6 = new MapDataUtil<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span>().of(true).get();</span><br><span class="line"></span><br><span class="line">Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> objectMap2 = MapDataUtil.builder().get();</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="全部代码"><a href="#全部代码" class="headerlink" title="全部代码"></a>全部代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022 2022/4/5 15:45</span><br><span class="line"> * desc ：创建Map数据</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * 使用：order:创建是否排序</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * 1：Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap1 = new MapDataUtil<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span>().of().put("a", "1").put("b", 1).get();</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * 2：Map<span class="tag">&lt;<span class="name">Object,</span> <span class="attr">Object</span>&gt;</span> objectMap2 = MapDataUtil.builder().put("a", "1").put("b", 1).get();</span><br><span class="line"> */</span><br><span class="line">public class MapDataUtil<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定类型的Map结构</span><br><span class="line">     * 无序</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> builder() {</span><br><span class="line">        return new Builder<span class="tag">&lt;&gt;</span>(false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定类型的Map结构</span><br><span class="line">     * 有序</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> builder(boolean order) {</span><br><span class="line">        return new Builder<span class="tag">&lt;&gt;</span>(order);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定类型的Map结构</span><br><span class="line">     * 无序</span><br><span class="line">     */</span><br><span class="line">    public Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> of() {</span><br><span class="line">        return new Builder<span class="tag">&lt;&gt;</span>(false);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定类型的Map结构</span><br><span class="line">     * 有序</span><br><span class="line">     */</span><br><span class="line">    public Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> of(boolean order) {</span><br><span class="line">        return new Builder<span class="tag">&lt;&gt;</span>(order);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 构建Map结构数据</span><br><span class="line">     */</span><br><span class="line">    public static final class Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">        private Map<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> map;</span><br><span class="line">        private boolean underConstruction;</span><br><span class="line"></span><br><span class="line">        private Builder(boolean order) {</span><br><span class="line">            if (order) {</span><br><span class="line">                map = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            } else {</span><br><span class="line">                map = new HashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            }</span><br><span class="line">            underConstruction = true;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> put(K k, V v) {</span><br><span class="line">            if (!underConstruction) {</span><br><span class="line">                throw new IllegalStateException("Map已经初始化，不可重复创建！！");</span><br><span class="line">            }</span><br><span class="line">            map.put(k, v);</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Map<span class="tag">&lt;<span class="name">K,</span> <span class="attr">V</span>&gt;</span> get() {</span><br><span class="line">            if (!underConstruction) {</span><br><span class="line">                throw new IllegalStateException("Map已经初始化，不可重复创建！！");</span><br><span class="line">            }</span><br><span class="line">            underConstruction = false;</span><br><span class="line">            return map;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Map</tag>
      </tags>
  </entry>
  <entry>
    <title>json数据的转换（Jackson）</title>
    <url>/2022/08/1661331439912/1661331439912/</url>
    <content><![CDATA[<p><a href="/2020/09/1601024145664/1601024145664/#封装">ObjectMapperUtil</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"></span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import com.fasterxml.jackson.databind.type.ArrayType;</span><br><span class="line">import com.fasterxml.jackson.databind.type.CollectionType;</span><br><span class="line">import com.fasterxml.jackson.databind.type.MapType;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2022 2022/4/5 14:42</span><br><span class="line"> * desc ：Json格式的数据转换</span><br><span class="line"> */</span><br><span class="line">public class JsonDataConvertUtil {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 对象转json字符串</span><br><span class="line">     * eg：实体对象、Map对象、数组、集合</span><br><span class="line">     */</span><br><span class="line">    public static String convertJsonStr(Object object) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            return ObjectMapperUtil.getInstance().getObjectMapper().writeValueAsString(object);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * json字符串转对象</span><br><span class="line">     * eg：实体类</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T convertObj(String jsonStr, Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> cls) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line">            return objectMapper.readValue(jsonStr, cls);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * json字符串转Map</span><br><span class="line">     * eg：key:字符串，value:对象</span><br><span class="line">     */</span><br><span class="line">    public static Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> convertMap(String jsonStr) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line">            MapType mapType = objectMapper.getTypeFactory().constructMapType(Map.class, String.class, Object.class);</span><br><span class="line">            return objectMapper.readValue(jsonStr, mapType);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * json字符串转集合对象</span><br><span class="line">     */</span><br><span class="line">    public static List<span class="tag">&lt;<span class="name">String</span>&gt;</span> convertList(String jsonStr) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line">            ArrayType arrayType = objectMapper.getTypeFactory().constructArrayType(String.class);</span><br><span class="line">            return objectMapper.readValue(jsonStr, arrayType);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * json字符串转对象数组</span><br><span class="line">     * eg：List<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> List<span class="tag">&lt;<span class="name">T</span>&gt;</span> convertListObj(String jsonStr, Class<span class="tag">&lt;<span class="name">T</span>&gt;</span> cls) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line">            CollectionType listType = objectMapper.getTypeFactory().constructCollectionType(ArrayList.class, cls);</span><br><span class="line">            return objectMapper.readValue(jsonStr, listType);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * json字符串转Map数组</span><br><span class="line">     * eg：List&lt;Map&lt;String,Object&gt;&gt;</span><br><span class="line">     */</span><br><span class="line">    public static List&lt;Map&lt;String, Object&gt;&gt; convertListMap(String jsonStr) throws RuntimeException {</span><br><span class="line">        try {</span><br><span class="line">            ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();</span><br><span class="line">            CollectionType listType = objectMapper.getTypeFactory().constructCollectionType(ArrayList.class, Map.class);</span><br><span class="line">            return objectMapper.readValue(jsonStr, listType);</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            throw new RuntimeException("格式化JSON字符串异常", e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>Json</tag>
      </tags>
  </entry>
  <entry>
    <title>绿色版Tomcat注册Windows服务并开机自启</title>
    <url>/2023/07/1690268890686/1690268890686/</url>
    <content><![CDATA[<h3 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h3><p>列表目录：<a href="https://archive.apache.org/dist/tomcat/" target="_blank" rel="noopener">https://archive.apache.org/dist/tomcat/</a><br>下载路径：<a href="https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/apache-tomcat-9.0.8-windows-x64.zip" target="_blank" rel="noopener">https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/apache-tomcat-9.0.8-windows-x64.zip</a></p>
<p>下载时需下载Windows版的，下载zip版没有tomcat9w.exe文件</p>
<h3 id="修改TITLE"><a href="#修改TITLE" class="headerlink" title="修改TITLE"></a>修改TITLE</h3><p>通过 startup.bat 运行可看见TITLE<br><img src="/2023/07/1690268890686/1690268890686/20230725161105.png" alt="20230725161105"><br><img src="/2023/07/1690268890686/1690268890686/20230725161251.png" alt="20230725161251"></p>
<h3 id="注册服务"><a href="#注册服务" class="headerlink" title="注册服务"></a>注册服务</h3><p>假设服务名为：Tomcat_8080</p>
<ol>
<li><p>配置环境变量 CATALINA_HOME，并在Path中添加 %CATALINA_HOME%\bin<br><img src="/2023/07/1690268890686/1690268890686/20230725155513.png" alt="20230725155513"></p>
</li>
<li><p>修改文件名：<br> tomcat9.exe -&gt; Tomcat_8080.exe<br> tomcat9w.exe -&gt; Tomcat_8080w.exe<br><img src="/2023/07/1690268890686/1690268890686/20230725155711.png" alt="20230725155711"></p>
</li>
<li><p>修改service.bat文件内容：<br> 将《tomcat9.exe》 统一变成：《Tomcat_8080.exe》<br><img src="/2023/07/1690268890686/1690268890686/20230725155828.png" alt="20230725155828"></p>
</li>
<li><p>进入tomcat根目录下的bin目录下cmd，输入安装命令<br>service.bat install Tomcat_8080</p>
</li>
</ol>
<p><img src="/2023/07/1690268890686/1690268890686/20230725152059.png" alt="20230725152059"></p>
<ol start="4">
<li><p>设置服务启动类型，调整为自动<br><img src="/2023/07/1690268890686/1690268890686/20230725155302.png" alt="20230725155302"></p>
</li>
<li><p>双击打开 Tomcat_8080w.exe 即可通过界面启动<br>Tomcat_8080.exe是可执行程序，用来启动tomcat服务。<br>Tomcat_8080w.exe是tomcat可视化管理客户端界面，可以设置启动，关闭，开机自启tomcat等。<br>Tomcat_8080w.Tomcat_8080w.exe都需要tomcat的环境变量CATALINA_HOME和向Windows注册tomcat服务的支持<br>Tomcat_8080w.exe界面如下：<br><img src="/2023/07/1690268890686/1690268890686/20230725154945.png" alt="20230725154945"></p>
</li>
</ol>
<h3 id="删除服务"><a href="#删除服务" class="headerlink" title="删除服务"></a>删除服务</h3><p>模式：service.bat uninstall tomcat服务名<br>示例：service.bat uninstall Tomcat_8080</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Tomcat</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>zxing开发之二维码</title>
    <url>/2023/09/1694141476592/1694141476592/</url>
    <content><![CDATA[<p>ZXing是Google开发的用于Java，Android的条形码扫描库。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.zxing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javase<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.zxing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.yetech.hello.util;</span><br><span class="line"></span><br><span class="line">import com.google.zxing.BarcodeFormat;</span><br><span class="line">import com.google.zxing.EncodeHintType;</span><br><span class="line">import com.google.zxing.MultiFormatWriter;</span><br><span class="line">import com.google.zxing.WriterException;</span><br><span class="line">import com.google.zxing.client.j2se.MatrixToImageConfig;</span><br><span class="line">import com.google.zxing.common.BitMatrix;</span><br><span class="line">import com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;</span><br><span class="line"></span><br><span class="line">import javax.imageio.ImageIO;</span><br><span class="line">import java.awt.*;</span><br><span class="line">import java.awt.geom.RoundRectangle2D;</span><br><span class="line">import java.awt.image.BufferedImage;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 参考 https://www.wetools.com/qrcode</span><br><span class="line"> */</span><br><span class="line">public class QrCodeUtil {</span><br><span class="line"></span><br><span class="line">    // 二维码内容</span><br><span class="line">    private String content;</span><br><span class="line">    // 二维码大小-宽</span><br><span class="line">    private int qrWidth;</span><br><span class="line">    // 二维码大小-高</span><br><span class="line">    private int qrHeight;</span><br><span class="line">    // 二维码边框-内边距</span><br><span class="line">    private int qrMargin = 0;</span><br><span class="line">    // 二维码前景色</span><br><span class="line">    private Color onColor = new Color(0, 0, 0);</span><br><span class="line">    // 二维码背景色</span><br><span class="line">    private Color offColor = new Color(255, 255, 255);</span><br><span class="line">    // Logo</span><br><span class="line">    private InputStream logoPath;</span><br><span class="line">    // Logo 边框宽度</span><br><span class="line">    private int logoBorder = 0;</span><br><span class="line">    // Logo 边框背景色</span><br><span class="line">    private Color logoBorderColor = Color.WHITE;</span><br><span class="line">    // Logo 圆角大小</span><br><span class="line">    private int logoRoundCorner = 0;</span><br><span class="line"></span><br><span class="line">    // 属性</span><br><span class="line">    private Map<span class="tag">&lt;<span class="name">EncodeHintType,</span> <span class="attr">Object</span>&gt;</span> hints;</span><br><span class="line"></span><br><span class="line">    public static QrCodeUtil Builder() {</span><br><span class="line">        return new QrCodeUtil();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setHints(Map<span class="tag">&lt;<span class="name">EncodeHintType,</span> <span class="attr">Object</span>&gt;</span> hints) {</span><br><span class="line">        this.hints = hints;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setContent(String content) {</span><br><span class="line">        this.content = content;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setSize(int width, int height) {</span><br><span class="line">        this.qrWidth = width;</span><br><span class="line">        this.qrHeight = height;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setColor(Color onColor, Color offColor) {</span><br><span class="line">        this.onColor = onColor;</span><br><span class="line">        this.offColor = offColor;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setMargin(int margin) {</span><br><span class="line">        this.qrMargin = margin;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setLogo(FileInputStream logoPath) {</span><br><span class="line">        this.logoPath = logoPath;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setLogoBorder(int logoBorder, Color logoBorderColor) {</span><br><span class="line">        this.logoBorder = logoBorder;</span><br><span class="line">        this.logoBorderColor = logoBorderColor;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public QrCodeUtil setLogoRoundCorner(int logoRoundCorner) {</span><br><span class="line">        this.logoRoundCorner = logoRoundCorner;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // 创建二维码  ImageIO.write(bufferedImage, "png", outFile);</span><br><span class="line">    public BufferedImage create() throws WriterException {</span><br><span class="line">        try {</span><br><span class="line">            if (this.hints == null) {</span><br><span class="line">                this.hints = new LinkedHashMap<span class="tag">&lt;&gt;</span>(3);</span><br><span class="line">                //设置容错等级</span><br><span class="line">                this.hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);</span><br><span class="line">                //定义字符集，我们设置为utf-8</span><br><span class="line">                this.hints.put(EncodeHintType.CHARACTER_SET, "UTF-8");</span><br><span class="line">                //设置边距，二维码边距空白宽度为0</span><br><span class="line">                this.hints.put(EncodeHintType.MARGIN, 0);</span><br><span class="line">            }</span><br><span class="line">            // 添加 hintType</span><br><span class="line">            BufferedImage bufferedImage = this.getBufferedImage(this.hints);</span><br><span class="line">            // 添加 logo</span><br><span class="line">            this.drawLogo(bufferedImage);</span><br><span class="line">            // 生成二维码图片</span><br><span class="line">            return bufferedImage;</span><br><span class="line">        } catch (WriterException e) {</span><br><span class="line">            System.out.println("生成二维码异常:" + e.getMessage());</span><br><span class="line">            throw new WriterException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void drawLogo(BufferedImage image) {</span><br><span class="line">        if (this.logoPath != null) {</span><br><span class="line">            // 读取二维码图片，并构建绘图对象</span><br><span class="line">            Graphics2D graphics2D = image.createGraphics();</span><br><span class="line">            int imageWidth = image.getWidth(), imageHeight = image.getHeight();</span><br><span class="line">            // 设置消除锯齿</span><br><span class="line">            graphics2D.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</span><br><span class="line">            graphics2D.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP));</span><br><span class="line">            try {</span><br><span class="line">                // 读取logo图片</span><br><span class="line">                BufferedImage logo = ImageIO.read(this.logoPath);</span><br><span class="line">                // 设置logo的大小,设置为二维码图片的20%,因为过大会盖掉二维码</span><br><span class="line">                int logoWidth = logo.getWidth(null) &gt; imageWidth * 3 / 10 ? (imageWidth * 3 / 10) : logo.getWidth(null);</span><br><span class="line">                int logoHeight = logo.getHeight(null) &gt; imageHeight * 3 / 10 ? (imageHeight * 3 / 10) : logo.getWidth(null);</span><br><span class="line">                // 定义logo位置x,y 放在中心,</span><br><span class="line">                int x = (imageWidth - logoWidth) / 2, y = (imageHeight - logoHeight) / 2;</span><br><span class="line">                // 设置logo 有一道边框 宽度（其实就是画一块贴面）</span><br><span class="line">                graphics2D.setStroke(new BasicStroke(this.logoBorder, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND));</span><br><span class="line">                // logo边框颜色</span><br><span class="line">                graphics2D.setColor(this.logoBorderColor);</span><br><span class="line">                // logo边框弧形</span><br><span class="line">                graphics2D.draw(new RoundRectangle2D.Float(x, y, logoWidth, logoHeight, this.logoRoundCorner, this.logoRoundCorner));</span><br><span class="line">                // 绘制LOGO圆弧矩形</span><br><span class="line">                graphics2D.setClip(new RoundRectangle2D.Float(x, y, logoWidth, logoHeight, this.logoRoundCorner, this.logoRoundCorner));</span><br><span class="line">                // 开始绘制LOGO到二维码上</span><br><span class="line">                graphics2D.drawImage(logo, x, y, logoWidth, logoHeight, null);</span><br><span class="line">            } catch (IOException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            } finally {</span><br><span class="line">                //释放资源</span><br><span class="line">                graphics2D.dispose();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // 绘制二维码图片流</span><br><span class="line">    private BufferedImage getBufferedImage(Map<span class="tag">&lt;<span class="name">EncodeHintType,</span> <span class="attr">Object</span>&gt;</span> hints) throws WriterException {</span><br><span class="line">        // 生成矩阵</span><br><span class="line">        BitMatrix bitMatrix = new MultiFormatWriter().encode(this.content, BarcodeFormat.QR_CODE, this.qrWidth, this.qrHeight, hints);</span><br><span class="line">        // 更新白边边框 让生成的二维码在图片属性上跟我们设置的图片大小size一致</span><br><span class="line">        BitMatrix bitMatrixUpdate = this.updateBitMatrix(bitMatrix, this.qrMargin);</span><br><span class="line">        // 是否设置二维码背景色/前景色</span><br><span class="line">        MatrixToImageConfig matrixToImageConfig = new MatrixToImageConfig(this.onColor.getRGB(), this.offColor.getRGB());</span><br><span class="line">        // 生成二维码对象</span><br><span class="line">        int matrixUpdateWidth = bitMatrixUpdate.getWidth(), matrixUpdateHeight = bitMatrixUpdate.getHeight();</span><br><span class="line">        BufferedImage bufferedImage = new BufferedImage(matrixUpdateWidth, matrixUpdateHeight, BufferedImage.TYPE_INT_ARGB);</span><br><span class="line">        for (int x = 0; x <span class="tag">&lt; <span class="attr">matrixUpdateWidth</span>; <span class="attr">x</span>++) {</span></span><br><span class="line">            for (int y = 0; y &lt; matrixUpdateHeight; y++) {</span><br><span class="line">                bufferedImage.setRGB(x, y, bitMatrixUpdate.get(x, y) ? matrixToImageConfig.getPixelOnColor() : matrixToImageConfig.getPixelOffColor());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        // 根据size放大、缩小生成的二维码</span><br><span class="line">        BufferedImage newImage = new BufferedImage(this.qrWidth, this.qrHeight, bufferedImage.getType());</span><br><span class="line">        Graphics g = newImage.getGraphics();</span><br><span class="line">        g.drawImage(bufferedImage, 0, 0, this.qrWidth, this.qrHeight, null);</span><br><span class="line">        g.dispose();</span><br><span class="line">        return newImage;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // 因为二维码边框设置那里不起作用，不管设置多少，都会生成白边，所以需要自定义控制白边宽度，</span><br><span class="line">    // 该方法生成自定义白边框后的bitMatrix</span><br><span class="line">    private BitMatrix updateBitMatrix(BitMatrix matrix, int margin) {</span><br><span class="line">        int tempM = margin * 2;</span><br><span class="line">        int[] rec = matrix.getEnclosingRectangle(); // 获取二维码图案的属性</span><br><span class="line">        int resWidth = rec[2] + tempM;</span><br><span class="line">        int resHeight = rec[3] + tempM;</span><br><span class="line">        BitMatrix resMatrix = new BitMatrix(resWidth, resHeight); // 按照自定义边框生成新的BitMatrix</span><br><span class="line">        resMatrix.clear();</span><br><span class="line">        for (int i = margin; i <span class="tag">&lt; <span class="attr">resWidth</span> <span class="attr">-</span> <span class="attr">margin</span>; <span class="attr">i</span>++) { // 循环，将二维码图案绘制到新的<span class="attr">bitMatrix</span>中</span></span><br><span class="line">            for (int j = margin; j &lt; resHeight - margin; j++) {</span><br><span class="line">                if (matrix.get(i - margin + rec[0], j - margin + rec[1])) {</span><br><span class="line">                    resMatrix.set(i, j);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return resMatrix;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h3><h4 id="普通二维码"><a href="#普通二维码" class="headerlink" title="普通二维码"></a>普通二维码</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Map<span class="tag">&lt;<span class="name">EncodeHintType,</span> <span class="attr">Object</span>&gt;</span> hints = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);</span><br><span class="line">//定义字符集，我们设置为utf-8</span><br><span class="line">hints.put(EncodeHintType.CHARACTER_SET, "UTF-8");</span><br><span class="line">ImageIO.write(QrCodeUtil.Builder().setContent("普通二维码")</span><br><span class="line">        .setSize(300, 300)</span><br><span class="line">        .setHints(hints)</span><br><span class="line">        .create(), "png", new File("E:\\qrcode\\zxingNormal.png"));</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="彩色二维码"><a href="#彩色二维码" class="headerlink" title="彩色二维码"></a>彩色二维码</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">// 设置颜色1</span><br><span class="line">ImageIO.write(QrCodeUtil.Builder().setContent("黑白二维码")</span><br><span class="line">        .setSize(300, 300)</span><br><span class="line">        .setColor(new Color(0, 0, 0), new Color(255, 255, 255))</span><br><span class="line">        .create(), "png", new File("E:\\qrcode\\zxingNorma2.png"));</span><br><span class="line">// 设置颜色2</span><br><span class="line">ImageIO.write(QrCodeUtil.Builder().setContent("彩色二维码")</span><br><span class="line">        .setSize(300, 300)</span><br><span class="line">        .setColor(new Color(255, 0, 0), new Color(0, 0, 255))</span><br><span class="line">        .create(), "png", new File("E:\\qrcode\\zxingNorma3.png"));</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="LOGO二维码"><a href="#LOGO二维码" class="headerlink" title="LOGO二维码"></a>LOGO二维码</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">ImageIO.write(QrCodeUtil.Builder().setContent("LOGO二维码")</span><br><span class="line">        .setSize(300, 300).setMargin(0)</span><br><span class="line">        .setLogo(new FileInputStream(new File("E:\\qrcode\\logo.png")))</span><br><span class="line">        .setLogoBorder(10, Color.RED).setLogoRoundCorner(10)</span><br><span class="line">        .create(), "png", new File("E:\\qrcode\\zxingNorma4.png"));</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>QR</tag>
      </tags>
  </entry>
  <entry>
    <title>OkHttp3 工具类</title>
    <url>/2024/06/1718257945709/1718257945709/</url>
    <content><![CDATA[<p>对请求的封装：可以进行https请求，重试次数，</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.util;</span><br><span class="line"></span><br><span class="line">import okhttp3.*;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.SSLContext;</span><br><span class="line">import javax.net.ssl.SSLSocketFactory;</span><br><span class="line">import javax.net.ssl.TrustManager;</span><br><span class="line">import javax.net.ssl.X509TrustManager;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line">import java.security.KeyManagementException;</span><br><span class="line">import java.security.NoSuchAlgorithmException;</span><br><span class="line">import java.security.SecureRandom;</span><br><span class="line">import java.security.cert.X509Certificate;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author ：demon</span><br><span class="line"> * date ：2023 2023/3/5 13:28</span><br><span class="line"> * desc ：</span><br><span class="line"> */</span><br><span class="line">public class OkHttpClientUtil {</span><br><span class="line"></span><br><span class="line">    public static String post(Headers.Builder headerBuilder, String url, String content) throws Exception {</span><br><span class="line">        // 执行POST(body)请求  - &gt; 请问完成后 自动关闭连接</span><br><span class="line">        try (Response response = getOkHttpClient()</span><br><span class="line">                .newCall(new Request.Builder()</span><br><span class="line">                        .url(url)</span><br><span class="line">                        .headers(headerBuilder.build())</span><br><span class="line">                        .post(RequestBody.create(MediaType.parse("application/json;charset=utf-8"), content))</span><br><span class="line">                        .build()).execute()) {</span><br><span class="line">            if (response.isSuccessful()) {</span><br><span class="line">                ResponseBody body = response.body();</span><br><span class="line">                System.out.println("响应的Code：" + response.code());</span><br><span class="line">                if (body != null) {</span><br><span class="line">                    String bodyString = body.string();</span><br><span class="line">                    System.out.println("响应的内容：" + bodyString);</span><br><span class="line">                    return bodyString;</span><br><span class="line">                }</span><br><span class="line">                throw new Exception("返回内容为空");</span><br><span class="line">            } else {</span><br><span class="line">                throw new Exception("请求错误，response code:" + response.code());</span><br><span class="line">            }</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            throw new IOException(e);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static InputStream downloadFile(String url) throws IOException, NoSuchAlgorithmException, KeyManagementException {</span><br><span class="line">        // 发起请求得到请求结果</span><br><span class="line">        Response response = getOkHttpClient().newCall(new Request.Builder().url(url).get().build()).execute();</span><br><span class="line">        // 获取请求结果</span><br><span class="line">        ResponseBody responseBody = response.body();</span><br><span class="line">        if (null != responseBody) {</span><br><span class="line">            // 获取文件后缀类型 可以使用 responseBody.contentType() 获取 ContentType，我这边知道这个url文件的类型</span><br><span class="line">            // 获取请求结果输入流</span><br><span class="line">            return responseBody.byteStream();</span><br><span class="line">        }</span><br><span class="line">        response.close();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static OkHttpClient getOkHttpClient() throws KeyManagementException, NoSuchAlgorithmException {</span><br><span class="line">        return new OkHttpClient.Builder()</span><br><span class="line">                // 设置连接时间10分钟 - &gt;三次握手 + SSL建立耗时</span><br><span class="line">                .connectTimeout(60 * 10, TimeUnit.SECONDS)</span><br><span class="line">                // 设置写入时间60秒</span><br><span class="line">                .writeTimeout(60, TimeUnit.SECONDS)</span><br><span class="line">                // 设置读取时间60秒</span><br><span class="line">                .readTimeout(60, TimeUnit.SECONDS)</span><br><span class="line">                // 添加信任HTTPS请求</span><br><span class="line">                .sslSocketFactory(sslSocketFactory(), x509TrustManager())</span><br><span class="line">                // 过滤器，设置最大重试次数</span><br><span class="line">                .addInterceptor(new OkHttpInterceptor(3))</span><br><span class="line">                // 不自动重连</span><br><span class="line">                .retryOnConnectionFailure(false).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static SSLSocketFactory sslSocketFactory() throws NoSuchAlgorithmException, KeyManagementException {</span><br><span class="line">        // 信任任何链接</span><br><span class="line">        SSLContext sslContext = SSLContext.getInstance("TLS");</span><br><span class="line">        sslContext.init(null, new TrustManager[]{x509TrustManager()}, new SecureRandom());</span><br><span class="line">        return sslContext.getSocketFactory();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static X509TrustManager x509TrustManager() {</span><br><span class="line">        return new X509TrustManager() {</span><br><span class="line">            @Override</span><br><span class="line">            public void checkClientTrusted(X509Certificate[] x509Certificates, String s) {</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void checkServerTrusted(X509Certificate[] x509Certificates, String s) {</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public X509Certificate[] getAcceptedIssuers() {</span><br><span class="line">                return new X509Certificate[0];</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static class OkHttpInterceptor implements Interceptor {</span><br><span class="line"></span><br><span class="line">        // 最大重试次数</span><br><span class="line">        private int maxRetry;</span><br><span class="line"></span><br><span class="line">        OkHttpInterceptor(int maxRetry) {</span><br><span class="line">            this.maxRetry = maxRetry;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        @SuppressWarnings("NullableProblems")</span><br><span class="line">        @Override</span><br><span class="line">        public Response intercept(Chain chain) {</span><br><span class="line">            /* 递归 4次下发请求，如果仍然失败 则返回 null ,但是 intercept must not return null.</span><br><span class="line">             * 返回 null 会报 IllegalStateException 异常</span><br><span class="line">             */</span><br><span class="line">            return retry(chain, 0);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        private Response retry(Chain chain, int retryCount) {</span><br><span class="line">            Request request = chain.request();</span><br><span class="line">            Response response = null;</span><br><span class="line">            try {</span><br><span class="line">                System.out.println("第" + (retryCount + 1) + "次执行HTTP请求···");</span><br><span class="line">                response = chain.proceed(request);</span><br><span class="line">            } catch (Exception e) {</span><br><span class="line">                if (maxRetry &gt; retryCount) {</span><br><span class="line">                    return retry(chain, retryCount + 1);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            return response;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void toTest() {</span><br><span class="line">    JSONObject json = new JSONObject();</span><br><span class="line">    json.put("jobId", "999999999");</span><br><span class="line">    try {</span><br><span class="line">        String post = OkHttpClientUtil.post(</span><br><span class="line">                new Headers.Builder().set("Content-Type", "application-json").set("API-KEY", "1234567890"),</span><br><span class="line">                "https://www.baidu.com/",</span><br><span class="line">                json.toJSONString());</span><br><span class="line">        System.out.println(post);</span><br><span class="line">    } catch (Exception e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Tools</category>
      </categories>
      <tags>
        <tag>OkHttp3</tag>
      </tags>
  </entry>
  <entry>
    <title>JetBrains的IDE中EvalReset的使用(重置试用期)</title>
    <url>/2023/08/1693278562635/1693278562635/</url>
    <content><![CDATA[<p>激活分 <a href="#在线激活">在线激活</a>  和 <a href="#离线激活">离线激活</a> 2种方式</p>
<h3 id="在线激活"><a href="#在线激活" class="headerlink" title="在线激活"></a>在线激活</h3><p>IDE工具左上角 File -&gt; Setting -&gt; plugins -&gt; 点设置并且选择 Manage Plugin Repositories<br><img src="/2023/08/1693278562635/1693278562635/20230829111940.png" alt="20230829111940"></p>
<p>在出现的弹窗中点“+”并且将 <a href="https://plugins.zhile.io" target="_blank" rel="noopener">https://plugins.zhile.io</a> 添加，然后点击 OK<br><img src="/2023/08/1693278562635/1693278562635/20230829112454.png" alt="20230829112454"></p>
<p>在搜索框搜索 IDE Eval Reset，然后点击 Install， 弹出窗点击 Accept<br><img src="/2023/08/1693278562635/1693278562635/20230829112754.png" alt="20230829112754"></p>
<p>download…完成后，出现 Restart IDE，  点击重启<br><img src="/2023/08/1693278562635/1693278562635/20230829113105.png" alt="20230829113105"></p>
<p>重启后打开在help中就会出现 Eval Reset 选项<br><img src="/2023/08/1693278562635/1693278562635/20230829113820.png" alt="20230829113820"></p>
<p>操作顺序：<br>1.勾选【Auto reset before per restart】则自动重置，重置是静默无感知的<br>2.按钮【Reload】用来刷新界面上的显示信息<br>3.按钮【Reset】点击会询问是否重置试用信息并重启IDE，选择Yes则执行重置操作并重启IDE生效，此为手动重置方式<br><img src="/2023/08/1693278562635/1693278562635/20230829114056.png" alt="20230829114056"></p>
<h3 id="离线激活"><a href="#离线激活" class="headerlink" title="离线激活"></a>离线激活</h3><h4 id="下载激活插件"><a href="#下载激活插件" class="headerlink" title="下载激活插件"></a>下载激活插件</h4><p>下载地址：<a href="https://plugins.zhile.io/files/ide-eval-resetter-2.1.6.zip" target="_blank" rel="noopener">https://plugins.zhile.io/files/ide-eval-resetter-2.1.6.zip</a>,<br>下载完成后，建议放到IDE软件安装的同级目录下（不要解压）<br><img src="/2023/08/1693278562635/1693278562635/20230829135131.png" alt="20230829135131"></p>
<h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><p>IDE工具左上角 File -&gt; Setting -&gt; plugins -&gt; 点设置并且选择 Install Plugin From Disk…<br><img src="/2023/08/1693278562635/1693278562635/20230829134501.png" alt="20230829134501"></p>
<h4 id="加载插件"><a href="#加载插件" class="headerlink" title="加载插件"></a>加载插件</h4><p>在弹出来的窗口中选择之前的zip文件，点击应用OK后，重启<br><img src="/2023/08/1693278562635/1693278562635/20230829135322.png" alt="20230829135322"><br><img src="/2023/08/1693278562635/1693278562635/20230829135949.png" alt="20230829135949"></p>
<h4 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h4><p>操作顺序：<br>1.勾选【Auto reset before per restart】则自动重置，重置是静默无感知的<br>2.按钮【Reload】用来刷新界面上的显示信息<br>3.按钮【Reset】点击会询问是否重置试用信息并重启IDE，选择Yes则执行重置操作并重启IDE生效，此为手动重置方式<br><img src="/2023/08/1693278562635/1693278562635/20230829114056.png" alt="20230829114056"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之问题</title>
    <url>/2024/08/1722499285345/1722499285345/</url>
    <content><![CDATA[<h3 id="镜像认证"><a href="#镜像认证" class="headerlink" title="镜像认证"></a>镜像认证</h3><p>在k8s的master节点上查看镜像认证信息,集群的每个node节点都需要这个文件存在，文件目录均为一致。<br>cat /root/.docker/config.json</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"auths"</span>: {</span><br><span class="line">        <span class="attr">"10.200.40.39:8080"</span>: {</span><br><span class="line">            <span class="attr">"auth"</span>: <span class="string">"eWV0OnlldGVjaFNIMTIz"</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="私有镜像地址"><a href="#私有镜像地址" class="headerlink" title="私有镜像地址"></a>私有镜像地址</h3><p>添加镜像地址，集群的每个node节点都需要这个文件存在，文件目录均为一致：</p>
<pre><code>"insecure-registries": [ "http://10.200.40.39:8080" ]</code></pre><p>完整如下： cat /etc/docker/daemon.json</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tbody><tr><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"registry-mirrors"</span>: [</span><br><span class="line">        <span class="string">"https://rsbud4vc.mirror.aliyuncs.com"</span>,</span><br><span class="line">        <span class="string">"https://registry.docker-cn.com"</span>,</span><br><span class="line">        <span class="string">"https://docker.mirrors.ustc.edu.cn"</span>,</span><br><span class="line">        <span class="string">"https://dockerhub.azk8s.cn"</span>,</span><br><span class="line">        <span class="string">"http://hub-mirror.c.163.com"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"exec-opts"</span>: [</span><br><span class="line">        <span class="string">"native.cgroupdriver=systemd"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"insecure-registries"</span>: [</span><br><span class="line">        <span class="string">"http://10.200.40.39:8080"</span></span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<p>加载：systemctl daemon-reload<br>重启：systemctl restart docker </p>
<h3 id="kube-proxy-开启-ipvs"><a href="#kube-proxy-开启-ipvs" class="headerlink" title="kube-proxy 开启 ipvs"></a>kube-proxy 开启 ipvs</h3><p>修改ConfigMap的kube-system/kube-proxy中的config.conf，把 mode: “” 改为mode: “ipvs” 保存退出即可</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">~]# kubectl edit cm kube-proxy -n kube-system</span><br><span class="line">###操作如下图(20240802151240)</span><br><span class="line"></span><br><span class="line">###删除之前的proxy pod</span><br><span class="line">~]# kubectl get pod -n kube-system |grep kube-proxy |awk '{system("kubectl delete pod "$1" -n kube-system")}'</span><br><span class="line">pod "kube-proxy-4p8s9" deleted</span><br><span class="line">pod "kube-proxy-9jr4z" deleted</span><br><span class="line">pod "kube-proxy-vnfqx" deleted</span><br><span class="line"></span><br><span class="line">#查看proxy运行状态</span><br><span class="line">~]# kubectl get pod -n kube-system | grep kube-proxy</span><br><span class="line">kube-proxy-n6brs                          1/1     Running   0          96s</span><br><span class="line">kube-proxy-tlp8h                          1/1     Running   0          113s</span><br><span class="line">kube-proxy-xnmjd                          1/1     Running   0          117s</span><br><span class="line"></span><br><span class="line">#查看日志,如果有 `Using ipvs Proxier.` 说明kube-proxy的ipvs 开启成功!</span><br><span class="line">~]# kubectl logs kube-proxy-xnmjd -n kube-system</span><br><span class="line">I0802 07:17:10.085013       1 node.go:172] Successfully retrieved node IP: 10.200.40.41</span><br><span class="line">I0802 07:17:10.085172       1 server_others.go:142] kube-proxy node IP is an IPv4 address (10.200.40.41), assume IPv4 operation</span><br><span class="line">I0802 07:17:10.934829       1 server_others.go:258] Using ipvs Proxier.</span><br><span class="line">E0802 07:17:10.935004       1 proxier.go:389] can't set sysctl net/ipv4/vs/conn_reuse_mode, kernel version must be at least 4.1</span><br><span class="line">W0802 07:17:10.935072       1 proxier.go:445] IPVS scheduler not specified, use rr by default</span><br><span class="line">I0802 07:17:10.935231       1 server.go:650] Version: v1.20.0</span><br><span class="line">I0802 07:17:10.939871       1 conntrack.go:52] Setting nf_conntrack_max to 131072</span><br><span class="line">I0802 07:17:10.947660       1 config.go:224] Starting endpoint slice config controller</span><br><span class="line">I0802 07:17:10.947701       1 shared_informer.go:240] Waiting for caches to sync for endpoint slice config</span><br><span class="line">I0802 07:17:10.949338       1 config.go:315] Starting service config controller</span><br><span class="line">I0802 07:17:10.949349       1 shared_informer.go:240] Waiting for caches to sync for service config</span><br><span class="line">I0802 07:17:11.049226       1 shared_informer.go:247] Caches are synced for endpoint slice config</span><br><span class="line">I0802 07:17:11.050451       1 shared_informer.go:247] Caches are synced for service config</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1722499285345/1722499285345/20240802151240.png" alt="20240802151240"><br><img src="/2024/08/1722499285345/1722499285345/20240802152025.png" alt="20240802152025"></p>
<h3 id="default-http-backend"><a href="#default-http-backend" class="headerlink" title="default-http-backend"></a>default-http-backend</h3><p>解决</p>
<pre><code>kubectl describe ingresses 内的 Default backend:  default-http-backend:80 (&lt;error: endpoints "default-http-backend" not found&gt;)</code></pre><p>安装：kube-backend.yaml</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">default-http-backend</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">ingress-nginx-controller</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure></div>
<p>应用：kubectl apply -f kube-backend.yaml</p>
<h3 id="Pod状态解释"><a href="#Pod状态解释" class="headerlink" title="Pod状态解释"></a>Pod状态解释</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tbody><tr><td class="code"><pre><span class="line">CrashLoopBackOff                                    容器退出，kubelet正在将它重启</span><br><span class="line">InvalidImageName                                    无法解析镜像名称</span><br><span class="line">ImageInspectError                                   无法校验镜像</span><br><span class="line">ErrImageNeverPul                                    策略禁止拉取镜像</span><br><span class="line">ImagePullBackOff                                    正在重试拉取</span><br><span class="line">RegistryUnavailable                                 连接不到镜像中心</span><br><span class="line">ErrImagePull                                        通用的拉取镜像出错</span><br><span class="line">CreateContainerConfigError                          不能创建kubelet使用的容器配置</span><br><span class="line">CreateContainerError                                创建容器失败</span><br><span class="line">m.internalLifecycle.PreStartContainer               执行hook报错</span><br><span class="line">RunContainerError                                   启动容器失败</span><br><span class="line">PostStartHookError                                  执行hook报错</span><br><span class="line">ContainersNotInitialized                            容器没有初始化完毕</span><br><span class="line">ContainersNotReady                                  容器没有准备完毕</span><br><span class="line">ContainerCreating                                   容器创建中</span><br><span class="line">PodInitializing                                     pod 初始化中</span><br><span class="line">DockerDaemonNotReady                                docker还没有完全启动</span><br><span class="line">NetworkPluginNotReady                               网络插件还没有完全启动</span><br><span class="line">Evicted                                             即驱赶的意思，意思是当节点出现异常时，kubernetes将有相应的机制驱赶该节点上的Pod。 </span><br><span class="line">                                                    多见于资源不足时导致的驱赶。</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="命令解释"><a href="#命令解释" class="headerlink" title="命令解释"></a>命令解释</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">服务器版本：kubectl version --short</span><br><span class="line">查看名称空间：kubectl get ns</span><br><span class="line">查看指定名称空间资源：kubectl get all -n default</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">列出所有运行的Pod信息：kubectl get pods</span><br><span class="line"></span><br><span class="line">列出Pod以及运行Pod节点信息：kubectl get pods -o wide</span><br><span class="line"></span><br><span class="line">列出所有replication controllers和service信息：kubectl get rc,services</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://docs.kubernetes.org.cn/" target="_blank" rel="noopener">Kubernetes中文社区 | 中文文档</a></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</title>
    <url>/2024/08/1722586325029/1722586325029/</url>
    <content><![CDATA[<h2 id="制作-springboot（jar）-程序-镜像"><a href="#制作-springboot（jar）-程序-镜像" class="headerlink" title="制作 springboot（jar） 程序 镜像"></a>制作 springboot（jar） 程序 镜像</h2><p>打包可运行的jar文件，放到同层目录下，如：/usr/local/java，目录下存在jar文件和Dockerfile文件</p>
<h3 id="Dockerfile文件内容："><a href="#Dockerfile文件内容：" class="headerlink" title="Dockerfile文件内容："></a>Dockerfile文件内容：</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DOCKERFILE"><figure class="iseeu highlight /dockerfile"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#基于我们刚刚创建的jdk镜像</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="number">10.200</span>.<span class="number">40.39</span>:<span class="number">8080</span>/jdk/openjdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> kgf</span><br><span class="line"><span class="comment">#j镜像解压出来的目录</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk/jdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> k8s-demo.jar /opt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /opt/k8s-demo.jar</span></span><br><span class="line"><span class="comment">#运行jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"sh"</span>,<span class="string">"-c"</span>,<span class="string">"java -Xms256m -Xmx512m -jar /opt/k8s-demo.jar"</span>]</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="build镜像"><a href="#build镜像" class="headerlink" title="build镜像"></a>build镜像</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">在公网构建镜像(后面的 空格+点 不能漏掉)：</span><br><span class="line">    docker build -t k8s-demo:v1.0 .</span><br><span class="line">给镜像打标签：</span><br><span class="line">    docker build -t 10.200.40.39:8080/testproject/k8s-demo:v1.0 .</span><br><span class="line">把镜像 push 到本地仓库：</span><br><span class="line">    docker push 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">查看镜像</span><br><span class="line">    docker image</span><br><span class="line">	</span><br><span class="line">其他节点下载镜像</span><br><span class="line">    docker pull 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">    </span><br><span class="line">验证镜像（测试运行）</span><br><span class="line">    docker run -it -p 8235:8235 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a>部署应用</h3><h4 id="创建文件（k8s-demo-service-yaml），内容如下："><a href="#创建文件（k8s-demo-service-yaml），内容如下：" class="headerlink" title="创建文件（k8s-demo-service.yaml），内容如下："></a>创建文件（k8s-demo-service.yaml），内容如下：</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">k8s-demo</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/testproject/k8s-demo:v1.0</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">8235</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="comment"># 解决Java程序时区问题</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># 这里的名称将来会被用作请求的域名来被集群外部和内部对象使用</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># 默认类型</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.101</span><span class="number">.65</span><span class="number">.14</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.101</span><span class="number">.65</span><span class="number">.14</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="comment"># 选择器，Service 会通过满足选择器的Pod去建立和Pod的映射关系，一般是1对多</span></span><br><span class="line">    <span class="comment"># 会找对应 这个 xxx label 的 Pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8235</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8235</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30235</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">test.k8s.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/k8s-demo</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">k8s-demo-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">8235</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[root@k8smaster k8s-demo]# kubectl apply -f k8s-demo-service.yaml</span><br><span class="line">    deployment.apps/k8s-demo-deployment created</span><br><span class="line">    service/k8s-demo-service created</span><br><span class="line">    ingress.networking.k8s.io/k8s-demo-ingress created</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[root@k8smaster k8s-demo]# kubectl delete -f k8s-demo-service.yaml</span><br><span class="line">    deployment.apps "k8s-demo-deployment" deleted</span><br><span class="line">    service "k8s-demo-service" deleted</span><br><span class="line">    ingress.networking.k8s.io "k8s-demo-ingress" deleted</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用信息</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe deployment k8s-demo-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service k8s-demo-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress k8s-demo-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com</span><br></pre></td></tr></tbody></table></figure></div>


<p>查看应用在容器的部署信息</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Pod执行记录，通过执行流程，可以看出是否部署成功</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl describe pod k8s-demo-deployment</span><br><span class="line">Name:         k8s-demo-deployment-76f6dcccd4-zv5sc</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         k8snode-2/10.200.40.42</span><br><span class="line">Start Time:   Fri, 02 Aug 2024 04:32:28 -0400</span><br><span class="line">Labels:       app=k8s-demo</span><br><span class="line">              pod-template-hash=76f6dcccd4</span><br><span class="line">Annotations:  cni.projectcalico.org/podIP: 192.168.163.144/32</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           192.168.163.144</span><br><span class="line">IPs:</span><br><span class="line">  IP:           192.168.163.144</span><br><span class="line">Controlled By:  ReplicaSet/k8s-demo-deployment-76f6dcccd4</span><br><span class="line">Containers:</span><br><span class="line">  k8s-demo:</span><br><span class="line">    Container ID:   docker://11d995c49cb2d90e7c8b7fc48742e002d83d0e3f5bb0a84d577f76f1bd8f2a61</span><br><span class="line">    Image:          10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">    Image ID:       docker-pullable://10.200.40.39:8080/testproject/k8s-demo@sha256:c39c992f2cbfdcd79895749f1470cb0eec3bb10b90eca95be515ef9883d88c9b</span><br><span class="line">    Port:           8235/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 02 Aug 2024 04:32:32 -0400</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:</span><br><span class="line">      TZ:  Asia/Shanghai</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-w7684 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-w7684:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-w7684</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  <span class="tag">&lt;<span class="name">none</span>&gt;</span></span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  13m   default-scheduler  Successfully assigned default/k8s-demo-deployment-76f6dcccd4-zv5sc to k8snode-2</span><br><span class="line">  Normal  Pulled     11m   kubelet            Container image "10.200.40.39:8080/testproject/k8s-demo:v1.0" already present on machine</span><br><span class="line">  Normal  Created    11m   kubelet            Created container k8s-demo</span><br><span class="line">  Normal  Started    11m   kubelet            Started container k8s-demo</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用在容器的执行日志</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl logs k8s-demo-deployment-76f6dcccd4-zv5sc</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  '  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::                (v2.4.2)</span><br><span class="line"></span><br><span class="line">2024-08-02 16:32:33.703  INFO 1 --- [           main] com.example.demo.DemoApplication         : Starting DemoApplication v1.0.0 using Java 11 on k8s-demo-deployment-76f6dcccd4-zv5sc with PID 1 (/opt/k8s-demo.jar started by root in /)</span><br><span class="line">2024-08-02 16:32:33.706  INFO 1 --- [           main] com.example.demo.DemoApplication         : No active profile set, falling back to default profiles: default</span><br><span class="line">2024-08-02 16:32:34.621  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8235 (http)</span><br><span class="line">2024-08-02 16:32:34.630  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2024-08-02 16:32:34.630  INFO 1 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.41]</span><br><span class="line">2024-08-02 16:32:34.680  INFO 1 --- [           main] o.a.c.c.C.[.[localhost].[/k8s-demo]      : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2024-08-02 16:32:34.680  INFO 1 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 922 ms</span><br><span class="line">2024-08-02 16:32:35.433  INFO 1 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'</span><br><span class="line">2024-08-02 16:32:35.628  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8235 (http) with context path '/k8s-demo'</span><br><span class="line">2024-08-02 16:32:35.763  INFO 1 --- [           main] com.example.demo.DemoApplication         : Started DemoApplication in 2.615 seconds (JVM running for 3.272)</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl exec -it k8s-demo-deployment-76f6dcccd4-zv5sc -- /bin/bash</span><br><span class="line">[root@k8s-demo-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl scale deployment k8s-demo-deployment --replicas 3</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30235/k8s-demo/" target="_blank" rel="noopener">http://10.200.40.40:30235/k8s-demo/</a><br>    域名访问：<a href="http://test.k8s.com/k8s-demo/，" target="_blank" rel="noopener">http://test.k8s.com/k8s-demo/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</title>
    <url>/2024/08/1722583767468/1722583767468/</url>
    <content><![CDATA[<p>该Nginx是经过改造的，而不是传统的Nginx。由于K8S的版本为1.20.6，故我们下载的版本为：nginx-0.30.0。<br><a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">Ingress-Nginx官网地址</a>：<a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/</a><br><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">Ingress-Nginx GitHub地址</a>：<a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx</a><br><a href="https://github.com/kubernetes/ingress-nginx/releases?page=21" target="_blank" rel="noopener">nginx-0.30.0</a>：<a href="https://github.com/kubernetes/ingress-nginx/releases?page=21" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx/releases?page=21</a></p>
<h3 id="镜像下载"><a href="#镜像下载" class="headerlink" title="镜像下载"></a>镜像下载</h3><pre><code>公网拉取镜像
docker pull registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0
给镜像添加标签
docker tag registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0
把镜像 push 到本地仓库
docker push 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0

节点拉取本地仓库的镜像
docker pull 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0</code></pre><h3 id="Ingress-Nginx下载"><a href="#Ingress-Nginx下载" class="headerlink" title="Ingress-Nginx下载"></a>Ingress-Nginx下载</h3><pre><code>下载文件：wget https://github.com/kubernetes/ingress-nginx/archive/nginx-0.30.0.tar.gz
解压文件：tar xf nginx-0.30.0.tar.gz
编辑文件：ingress-nginx-nginx-0.30.0/deploy/static/mandatory.yaml</code></pre><h3 id="yaml文件修改后的配置-mandatory-yaml"><a href="#yaml文件修改后的配置-mandatory-yaml" class="headerlink" title="yaml文件修改后的配置(mandatory.yaml)"></a>yaml文件修改后的配置(mandatory.yaml)</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tcp-services</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">udp-services</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"extensions"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"extensions"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">resourceNames:</span></span><br><span class="line">      <span class="comment"># Defaults to "&lt;election-id&gt;-&lt;ingress-class&gt;"</span></span><br><span class="line">      <span class="comment"># Here: "&lt;ingress-controller-leader&gt;-&lt;nginx&gt;"</span></span><br><span class="line">      <span class="comment"># This has to be adapted if you change either parameter</span></span><br><span class="line">      <span class="comment"># when launching the nginx-ingress-controller.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ingress-controller-leader-nginx"</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role-nisa-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole-nisa-binding</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span>   <span class="comment"># 从Deployment改为DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment">#replicas: 1   # 注释掉</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">prometheus.io/port:</span> <span class="string">"10254"</span></span><br><span class="line">        <span class="attr">prometheus.io/scrape:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># wait up to five minutes for the drain of connections</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">300</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="comment"># 添加 hostNetwork: true,否则无法通过 K8s 节点 IP 地址绑定域名外部访问</span></span><br><span class="line">      <span class="comment"># ingress-controller 会直接使用 K8s 物理机的 DNS 来解析域名，而不再使用 K8s 内部的 DNS 来解析域名</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line">          <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/nginx-ingress-controller:0.30.0</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--configmap=$(POD_NAMESPACE)/nginx-configuration</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--udp-services-configmap=$(POD_NAMESPACE)/udp-services</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--publish-service=$(POD_NAMESPACE)/ingress-nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--annotations-prefix=nginx.ingress.kubernetes.io</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">              <span class="attr">drop:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">              <span class="attr">add:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">            <span class="comment"># www-data -&gt; 101</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">101</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">80</span>    <span class="comment"># 添加处【可在宿主机通过该端口访问Pod】</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">443</span>   <span class="comment"># 添加处【可在宿主机通过该端口访问Pod】</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">/wait-shutdown</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">min:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">90Mi</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="ingress-nginx部署"><a href="#ingress-nginx部署" class="headerlink" title="ingress-nginx部署"></a>ingress-nginx部署</h3><pre><code>应用：
    kubectl apply -f mandatory.yaml

查看：
    kubectl get ds -n ingress-nginx -o wide
    kubectl get pod -n ingress-nginx -o wide

验证：
    kubectl get pods -n ingress-nginx
        确保Ingress Controller的Pod状态为Running</code></pre><h3 id="ingress-nginx更新"><a href="#ingress-nginx更新" class="headerlink" title="ingress-nginx更新"></a>ingress-nginx更新</h3><pre><code>先执行 kubectl delete -f mandatory.yaml 清空已安装的pod和configmap，
然后根据实际报错修改 mandatory.yaml 再 kubectl apply -f mandatory.yaml</code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：openjdk-11</title>
    <url>/2024/08/1722585036230/1722585036230/</url>
    <content><![CDATA[<p>下载想要制作的镜像的对应jdk文件，放到同层目录下，如：/usr/local/project/jdk/，目录下存在tar.gz文件和Dockerfile文件<br><img src="/2024/08/1722585036230/1722585036230/20240802160151.png" alt="20240802160151"></p>
<h3 id="下载openjdk-11"><a href="#下载openjdk-11" class="headerlink" title="下载openjdk-11"></a>下载openjdk-11</h3><p><a href="https://openjdk.org/" target="_blank" rel="noopener">openjdk</a>：<a href="https://openjdk.org/" target="_blank" rel="noopener">https://openjdk.org/</a><br><a href="https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz" target="_blank" rel="noopener">下载地址</a>：<a href="https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz" target="_blank" rel="noopener">https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz</a></p>
<h3 id="Dockerfile文件内容："><a href="#Dockerfile文件内容：" class="headerlink" title="Dockerfile文件内容："></a>Dockerfile文件内容：</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DOCKERFILE"><figure class="iseeu highlight /dockerfile"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#建立一个新的镜像文件，配置模板：新建立的镜像是以centos为基础模板</span></span><br><span class="line"><span class="comment">#因为jdk必须运行在操作系统之上</span></span><br><span class="line"><span class="comment">#每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</span></span><br><span class="line"><span class="comment">#第一条FROM，指定使用哪个镜像源</span></span><br><span class="line"><span class="keyword">FROM</span> centos:centos7</span><br><span class="line"></span><br><span class="line"><span class="comment">#维护者 作者 邮箱</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> demon</span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN 指令告诉docker 在镜像内执行命令，安装了什么</span></span><br><span class="line"><span class="comment">#创建一个新目录来存储jdk文件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir <span class="string">"/usr/local/jdk"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将jdk压缩文件复制到镜像中，它将自动解压缩tar文件</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> openjdk-11_linux-x64_bin.tar.gz /usr/<span class="built_in">local</span>/jdk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量《jdk-11》是解压tat.gz出来的文件名</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk/jdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># VOLUME 指定了临时文件目录为/tmp</span></span><br><span class="line"><span class="comment"># 其效果是在主机 /var/lib/docker 目录下创建了一个临时文件，并链接到容器的/tmp</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="build镜像"><a href="#build镜像" class="headerlink" title="build镜像"></a>build镜像</h3><h4 id="1-在公网构建镜像-后面的-空格-点-不能漏掉-："><a href="#1-在公网构建镜像-后面的-空格-点-不能漏掉-：" class="headerlink" title="1.在公网构建镜像(后面的 空格+点 不能漏掉)："></a>1.在公网构建镜像(后面的 空格+点 不能漏掉)：</h4><pre><code>docker build -t openjdk-11 .</code></pre><h4 id="2-给镜像打标签："><a href="#2-给镜像打标签：" class="headerlink" title="2.给镜像打标签："></a>2.给镜像打标签：</h4><pre><code>docker tag openjdk-11 10.200.40.39:8080/jdk/openjdk-11</code></pre><h4 id="3-把镜像-push-到本地仓库："><a href="#3-把镜像-push-到本地仓库：" class="headerlink" title="3.把镜像 push 到本地仓库："></a>3.把镜像 push 到本地仓库：</h4><pre><code>docker push 10.200.40.39:8080/jdk/openjdk-11</code></pre><h4 id="4-查看镜像"><a href="#4-查看镜像" class="headerlink" title="4.查看镜像"></a>4.查看镜像</h4><pre><code>docker images</code></pre><h4 id="5-验证镜像"><a href="#5-验证镜像" class="headerlink" title="5.验证镜像"></a>5.验证镜像</h4><pre><code>docker run -id --name checkJdk11 10.200.40.39:8080/jdk/openjdk-11
docker ps
docker exec -it checkJdk11 bash
java -version
exit
docker stop checkJdk11
docker rm checkJdk11</code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：Nginx1.21.5</title>
    <url>/2024/08/1722586394326/1722586394326/</url>
    <content><![CDATA[<p>只运行一个Nginx的Pod程序，以后的前端项目均存放在一个html目录即可，本文采用 nfs 存储。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull nginx:1.21.5</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag nginx:1.21.5 10.200.40.39:8080/component/nginx:1.21.5</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/nginx:1.21.5</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/nginx:1.21.5</span><br></pre></td></tr></tbody></table></figure></div>


<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（nginx-configmap.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-conf</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">nginx.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">user</span>  <span class="string">nginx;</span></span><br><span class="line">    <span class="string">worker_processes</span>  <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">error_log</span>  <span class="string">/var/log/nginx/error.log</span> <span class="string">warn;</span></span><br><span class="line">    <span class="string">pid</span>        <span class="string">/var/run/nginx.pid;</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">events</span> <span class="string">{</span></span><br><span class="line">      <span class="string">worker_connections</span>  <span class="number">1024</span><span class="string">;</span></span><br><span class="line">    <span class="string">}</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">http</span> <span class="string">{</span></span><br><span class="line">      <span class="string">include</span>       <span class="string">/etc/nginx/mime.types;</span></span><br><span class="line">      <span class="string">default_type</span>  <span class="string">application/octet-stream;</span></span><br><span class="line">      <span class="comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">      <span class="comment">#                  '$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">      <span class="comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">sendfile</span>        <span class="string">on;</span></span><br><span class="line">      <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">      <span class="string">keepalive_timeout</span>  <span class="number">65</span><span class="string">;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">#gzip  on;</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        <span class="string">server</span> <span class="string">{</span></span><br><span class="line">            <span class="string">listen</span>       <span class="number">80</span><span class="string">;</span></span><br><span class="line">            <span class="string">server_name</span>  <span class="string">_;</span></span><br><span class="line">            </span><br><span class="line">            <span class="string">location</span> <span class="string">/</span> <span class="string">{</span></span><br><span class="line">                <span class="string">root</span>   <span class="string">/usr/share/nginx/html;</span></span><br><span class="line">                <span class="string">index</span>  <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">/sip-web</span> <span class="string">{</span></span><br><span class="line">                <span class="string">alias</span>  <span class="string">/usr/share/nginx/html/sip-web/dist/;</span></span><br><span class="line">                <span class="string">try_files</span> <span class="string">$uri</span> <span class="string">$uri/</span> <span class="string">/hello/index.html;</span></span><br><span class="line">                <span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">^~</span> <span class="string">/sip-api/</span> <span class="string">{</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$http_host;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">REMOTE-HOST</span> <span class="string">$remote_addr;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line">                <span class="string">proxy_pass</span>  <span class="string">http://10.200.40.40:30088/sip-admin/;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 避免actuator暴露</span></span><br><span class="line">            <span class="string">if</span> <span class="string">($request_uri</span> <span class="string">~</span> <span class="string">"/actuator"</span><span class="string">)</span> <span class="string">{</span></span><br><span class="line">                <span class="string">return</span> <span class="number">403</span><span class="string">;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  <span class="string">/50x.html;</span></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/50x.html</span> <span class="string">{</span></span><br><span class="line">                <span class="string">root</span>   <span class="string">html;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line">              </span><br><span class="line">        <span class="string">}</span></span><br><span class="line">    <span class="string">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>文件（nginx-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-nginx</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/nginx:1.21.5</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"64Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"250m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"128Mi"</span> <span class="comment"># 内存最新128M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-config</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/nginx/nginx.conf</span> <span class="comment">#  挂载配置了 nginx.conf 的 volume</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">nginx.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-log</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/log/nginx/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-html</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html/</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-config</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-log</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/nginx/logs/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-html</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/nginx/html/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.110</span><span class="number">.23</span><span class="number">.182</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.110</span><span class="number">.23</span><span class="number">.182</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30080</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">my.nginx.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">my-nginx-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f nginx-configmap.yaml</span><br><span class="line">kubectl apply -f nginx-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f nginx-configmap.yaml</span><br><span class="line">kubectl delete -f nginx-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用信息</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe configmap nginx-conf</span><br><span class="line">kubectl describe deployment my-nginx-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service my-nginx-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress my-nginx-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com my.nginx.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com my.nginx.com</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用在容器的部署信息<br>kubectl describe pod my-nginx-deployment<br>kubectl logs my-nginx-deployment-???????</p>
<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster nginx]# kubectl exec -it my-nginx-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-nginx-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30080/" target="_blank" rel="noopener">http://10.200.40.40:30080/</a><br>    域名访问：<a href="http://my.nginx.com/，" target="_blank" rel="noopener">http://my.nginx.com/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：Tomcat9.0.56</title>
    <url>/2024/08/1722586402699/1722586402699/</url>
    <content><![CDATA[<p>只运行一个Tomcat的Pod程序，以后的后端项目均存放在一个webapps目录即可，本文采用 nfs 存储。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull tomcat:9.0.56</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag tomcat:9.0.56 10.200.40.39:8080/component/tomcat:9.0.56</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/tomcat:9.0.56</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/tomcat:9.0.56</span><br></pre></td></tr></tbody></table></figure></div>


<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（tomcat-configmap.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-conf</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">server.xml:</span> <span class="string">|-</span></span><br><span class="line">   <span class="string">&lt;?xml</span> <span class="string">version="1.0"</span> <span class="string">encoding="UTF-8"?&gt;</span></span><br><span class="line">       <span class="string">&lt;Server</span> <span class="string">port="8005"</span> <span class="string">shutdown="SHUTDOWN"&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.startup.VersionLoggerListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.AprLifecycleListener"</span> <span class="string">SSLEngine="on"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;GlobalNamingResources&gt;</span></span><br><span class="line">           <span class="string">&lt;Resource</span> <span class="string">name="UserDatabase"</span> <span class="string">auth="Container"</span></span><br><span class="line">                     <span class="string">type="org.apache.catalina.UserDatabase"</span></span><br><span class="line">                     <span class="string">description="User</span> <span class="string">database</span> <span class="string">that</span> <span class="string">can</span> <span class="string">be</span> <span class="string">updated</span> <span class="string">and</span> <span class="string">saved"</span></span><br><span class="line">                     <span class="string">factory="org.apache.catalina.users.MemoryUserDatabaseFactory"</span></span><br><span class="line">                     <span class="string">pathname="conf/tomcat-users.xml"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;/GlobalNamingResources&gt;</span></span><br><span class="line">         <span class="string">&lt;Service</span> <span class="string">name="Catalina"&gt;</span></span><br><span class="line">           <span class="string">&lt;Connector</span> <span class="string">port="8080"</span> <span class="string">protocol="HTTP/1.1"</span></span><br><span class="line">                      <span class="string">connectionTimeout="20000"</span></span><br><span class="line">                      <span class="string">redirectPort="8443"</span> <span class="string">/&gt;</span></span><br><span class="line">           <span class="string">&lt;Engine</span> <span class="string">name="Catalina"</span> <span class="string">defaultHost="localhost"&gt;</span></span><br><span class="line">             <span class="string">&lt;Realm</span> <span class="string">className="org.apache.catalina.realm.LockOutRealm"&gt;</span></span><br><span class="line">               <span class="string">&lt;Realm</span> <span class="string">className="org.apache.catalina.realm.UserDatabaseRealm"</span></span><br><span class="line">                      <span class="string">resourceName="UserDatabase"/&gt;</span></span><br><span class="line">             <span class="string">&lt;/Realm&gt;</span></span><br><span class="line">             <span class="string">&lt;Host</span> <span class="string">name="localhost"</span>  <span class="string">appBase="webapps"</span></span><br><span class="line">                   <span class="string">unpackWARs="true"</span> <span class="string">autoDeploy="true"&gt;</span></span><br><span class="line">               <span class="string">&lt;Valve</span> <span class="string">className="org.apache.catalina.valves.AccessLogValve"</span> <span class="string">directory="logs"</span></span><br><span class="line">                      <span class="string">prefix="localhost_access_log"</span> <span class="string">suffix=".txt"</span></span><br><span class="line">                      <span class="string">pattern="%h</span> <span class="string">%l</span> <span class="string">%u</span> <span class="string">%t</span> <span class="string">&amp;quot;%r&amp;quot;</span> <span class="string">%s</span> <span class="string">%b"</span> <span class="string">/&gt;</span></span><br><span class="line">             <span class="string">&lt;/Host&gt;</span></span><br><span class="line">           <span class="string">&lt;/Engine&gt;</span></span><br><span class="line">         <span class="string">&lt;/Service&gt;</span></span><br><span class="line">       <span class="string">&lt;/Server&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>文件（tomcat-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-tomcat</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/tomcat:9.0.56</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"-Xmx512m -Xms256m"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新256M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新512M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用1核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/conf/server.xml</span> <span class="comment">#  挂载配置了 tomcat-conf 的 volume</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">server.xml</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-log</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/logs/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-webapps</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/webapps/</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">tomcat-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-log</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/tomcat/logs/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-webapps</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/tomcat/webapps/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.109</span><span class="number">.128</span><span class="number">.67</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.109</span><span class="number">.128</span><span class="number">.67</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30808</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">my.tomcat.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">my-tomcat-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f tomcat-configmap.yaml</span><br><span class="line">kubectl apply -f tomcat-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f tomcat-configmap.yaml</span><br><span class="line">kubectl delete -f tomcat-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用信息</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe configmap tomcat-conf</span><br><span class="line">kubectl describe deployment my-tomcat-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service my-tomcat-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress my-tomcat-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com my.nginx.com my.tomcat.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com my.nginx.com my.tomcat.com</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看应用在容器的部署信息<br>kubectl describe pod my-tomcat-deployment<br>kubectl logs my-tomcat-deployment-???????</p>
<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster tomcat]# kubectl exec -it my-tomcat-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-tomcat-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30808/" target="_blank" rel="noopener">http://10.200.40.40:30808/</a><br>    域名访问：<a href="http://my.tomcat.com/，" target="_blank" rel="noopener">http://my.tomcat.com/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：MySql5.6.51</title>
    <url>/2024/08/1722836276725/1722836276725/</url>
    <content><![CDATA[<p>只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull mysql:5.6.51</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag mysql:5.6.51 10.200.40.39:8080/component/mysql:5.6.51</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/mysql:5.6.51</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/mysql:5.6.51</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql5-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">my.cnf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">[mysql]</span></span><br><span class="line">    <span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line">    <span class="string">default-character-set=utf8</span></span><br><span class="line">    <span class="string">[mysqld]</span></span><br><span class="line">    <span class="comment">#默认编码</span></span><br><span class="line">    <span class="string">character_set_server=utf8</span> </span><br><span class="line">    <span class="string">bind-address</span> <span class="string">=</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="comment">#端口</span></span><br><span class="line">    <span class="string">port</span> <span class="string">=</span> <span class="number">3306</span> </span><br><span class="line">    <span class="comment">#引擎</span></span><br><span class="line">    <span class="string">default-storage-engine=INNODB</span></span><br><span class="line">    <span class="comment"># 最大连接数量</span></span><br><span class="line">    <span class="string">max_connections</span> <span class="string">=</span> <span class="number">100</span></span><br><span class="line">    <span class="comment">#单个内存表的最大值限定</span></span><br><span class="line">    <span class="string">max_heap_table_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="comment">#为每个线程分配的排序缓冲大小</span></span><br><span class="line">    <span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">    <span class="comment">#join 连表操作的缓冲大小,根据实际业务来设置，默认8M</span></span><br><span class="line">    <span class="string">join_buffer_size</span> <span class="string">=</span> <span class="string">32M</span></span><br><span class="line">    <span class="comment"># sql查询缓存，如果提交的查询与几次中的某查询相同，并且在query缓存中存在，则直接返回缓存中的结果</span></span><br><span class="line">    <span class="string">query_cache_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="comment"># sql模式</span></span><br><span class="line">    <span class="string">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span> </span><br><span class="line">    <span class="comment">#表示开启binlog并指定binglog文件名</span></span><br><span class="line">    <span class="string">log_bin</span> <span class="string">=</span> <span class="string">mysql-bin</span> </span><br><span class="line">    <span class="comment">#默认</span></span><br><span class="line">    <span class="string">binlog_format</span> <span class="string">=</span> <span class="string">ROW</span> </span><br><span class="line">    <span class="comment">#binlog保留天数</span></span><br><span class="line">    <span class="string">expire_logs_days=15</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>文件（mysql6-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql5-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限）</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-mysql5-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/mysql5/data/"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/mysql5/data/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-mysql5</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/mysql:5.6.51</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATEBASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"myblog"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新128M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>                            <span class="comment">#容器内挂载点名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>              <span class="comment">#容器内挂载点路径，可以是文件或目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/my.cnf</span>       <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">my.cnf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span>  </span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span>   <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>          <span class="comment">#数据卷名称，需要与容器内挂载点名称一致</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span>      <span class="comment">#挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mysql5-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/mysql5/data/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql5-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.102</span><span class="number">.102</span><span class="number">.249</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.102</span><span class="number">.102</span><span class="number">.249</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30306</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f mysql5-configmap.yaml</span><br><span class="line">kubectl apply -f mysql5-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f mysql5-configmap.yaml</span><br><span class="line">kubectl delete -f mysql5-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看容器日志</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod my-mysql5-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-mysql5-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster mysql5]# kubectl exec -it my-mysql5-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-mysql5-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如遇见未知错误可删除已经生成的data目录，重新生成data<br>如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：<br>1进入MySQL的Pod中：<br>    kubectl exec -it my-mysql5-deployment-88f575676-2h2nn – /bin/bash<br>2进入MySQL命令行：<br>    mysql -uroot -proot -P 3306<br>3执行以下SQL语句，允许root用户从任意主机访问MySQL：<br>    GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION;<br>    FLUSH PRIVILEGES;<br>4退出MySQL命令行和Pod：exit；</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：MySql8.0.27</title>
    <url>/2024/08/1722836311451/1722836311451/</url>
    <content><![CDATA[<p>只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull mysql:8.0.27</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag mysql:8.0.27 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/mysql:8.0.27</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">my.cnf:</span> <span class="string">|-</span></span><br><span class="line">       <span class="string">[client]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysql]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysqld]</span></span><br><span class="line">       <span class="string">port=3308</span></span><br><span class="line">       <span class="string">max_connections</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line">       <span class="comment">#secure_file_priv=/var/lib/mysql</span></span><br><span class="line">       <span class="string">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line">       <span class="string">skip-name-resolve</span></span><br><span class="line">       <span class="string">open_files_limit</span> <span class="string">=</span> <span class="number">65535</span></span><br><span class="line">       <span class="string">table_open_cache</span> <span class="string">=</span> <span class="number">128</span></span><br><span class="line">       <span class="string">log_error</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-errorlog</span> <span class="comment">#错误日志路径</span></span><br><span class="line">       <span class="string">slow_query_log</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">long_query_time</span> <span class="string">=</span> <span class="number">1</span> <span class="comment">#慢查询时间 超过1秒则为慢查询</span></span><br><span class="line">       <span class="string">slow_query_log_file</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-slowlog</span></span><br><span class="line">       <span class="string">default-storage-engine</span> <span class="string">=</span> <span class="string">InnoDB</span> <span class="comment">#默认存储引擎</span></span><br><span class="line">       <span class="string">innodb_file_per_table</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_open_files</span> <span class="string">=</span> <span class="number">500</span></span><br><span class="line">       <span class="string">innodb_buffer_pool_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">       <span class="string">innodb_write_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_read_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_thread_concurrency</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">       <span class="string">innodb_purge_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line">       <span class="string">innodb_log_buffer_size</span> <span class="string">=</span> <span class="string">2M</span></span><br><span class="line">       <span class="string">innodb_log_file_size</span> <span class="string">=</span> <span class="string">32M</span></span><br><span class="line">       <span class="string">innodb_log_files_in_group</span> <span class="string">=</span> <span class="number">3</span></span><br><span class="line">       <span class="string">innodb_max_dirty_pages_pct</span> <span class="string">=</span> <span class="number">90</span></span><br><span class="line">       <span class="string">innodb_lock_wait_timeout</span> <span class="string">=</span> <span class="number">120</span></span><br><span class="line">       <span class="string">bulk_insert_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_max_sort_file_size</span> <span class="string">=</span> <span class="string">10G</span></span><br><span class="line">       <span class="string">myisam_repair_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">interactive_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">wait_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">[mysqldump]</span></span><br><span class="line">       <span class="string">quick</span></span><br><span class="line">       <span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">16M</span> <span class="comment">#服务器发送和接受的最大包长度</span></span><br><span class="line">       <span class="string">[myisamchk]</span></span><br><span class="line">       <span class="string">key_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">read_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br><span class="line">       <span class="string">write_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>文件（mysql8-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限）</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-mysql8-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/mysql8/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-mysql8</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/mysql:8.0.27</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATEBASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"myblog"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">3308</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新128M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>                            <span class="comment">#容器内挂载点名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>              <span class="comment">#容器内挂载点路径，可以是文件或目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/my.cnf</span>       <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">my.cnf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span>  </span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span>   <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>          <span class="comment">#数据卷名称，需要与容器内挂载点名称一致</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span>      <span class="comment">#挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3308</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3308</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30308</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f mysql8-configmap.yaml</span><br><span class="line">kubectl apply -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f mysql8-configmap.yaml</span><br><span class="line">kubectl delete -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看容器日志</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod my-mysql8-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-mysql8-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster mysql8]# kubectl exec -it my-mysql8-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-mysql8-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如遇见未知错误可删除已经生成的data目录，重新生成data<br>如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：<br>1进入MySQL的Pod中：<br>    kubectl exec -it my-mysql8-deployment-88f575676-2h2nn – /bin/bash<br>2进入MySQL命令行：<br>    mysql -uroot -proot -P 3306<br>3执行以下SQL语句，允许root用户从任意主机访问MySQL：<br>    GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION;<br>    FLUSH PRIVILEGES;<br>4退出MySQL命令行和Pod：exit；</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：Redis3.2.10（单机）</title>
    <url>/2024/08/1722839201478/1722839201478/</url>
    <content><![CDATA[<p>只运行一个Redis的Pod程序，本文采用 nfs 作为持久化储存。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull redis:3.2.10</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag redis:3.2.10 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/redis:3.2.10</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（redis-configmap.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">redis.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">bind</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="string">protected-mode</span> <span class="literal">no</span></span><br><span class="line">    <span class="string">port</span> <span class="number">6379</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>文件（redis-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-redis-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/redis/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-redis</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/redis:3.2.10</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/usr/local/etc/redis/redis.conf</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">redis.conf</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/var/log/redis</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">redis.conf</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">redis.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span> </span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/logs</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-6379</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31379</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f redis-configmap.yaml</span><br><span class="line">kubectl apply -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f redis-configmap.yaml</span><br><span class="line">kubectl delete -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看容器日志</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod my-redis-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-redis-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster redis]# kubectl exec -it my-redis-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-redis-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</title>
    <url>/2024/08/1722839250449/1722839250449/</url>
    <content><![CDATA[<p>只运行一个RabbitMq的Pod程序，本文采用 nfs 作为持久化储存。</p>
<h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">docker pull rabbitmq:3.9.11-management</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag rabbitmq:3.9.11-management 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>文件（rabbitmq-service.yaml）如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-rabbitmq-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/rabbitmq/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">"10.200.40.39:8080/component/rabbitmq:3.9.11-management"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5672</span> <span class="comment"># amqp</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">4369</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5671</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">15672</span> <span class="comment"># http</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">25672</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="comment">#存储</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/home/rabbitmq/</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HOSTNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_CLEANUP</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_USE_LONGNAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_LOG_LEVEL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"debug"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_INTERVAL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"60"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_WARN_ONLY</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"false"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_TYPE</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"k8s"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LANG</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"en_US.UTF-8"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></tbody></table></figure></div>

<p>新建应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl apply -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>删除应用</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl delete -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看容器日志</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl describe pod my-rabbitmq-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-rabbitmq-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster rabbitmq]# kubectl exec -it my-rabbitmq-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-rabbitmq-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div>


<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>kubernetes</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux中安装subversion环境</title>
    <url>/2024/08/1723020746262/1723020746262/</url>
    <content><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote>
<p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p>
</blockquote>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol>
<li>apr-1.6.5.tar.gz</li>
<li>apr-util-1.6.1.tar.gz</li>
<li>sqlite-autoconf-3250100.tar.gz</li>
<li>zlib-1.2.11.tar.gz</li>
<li>subversion-1.10.6.tar.gz</li>
</ol>
<ul>
<li><p>apr-1.6.5.tar.gz、apr-util-1.6.1.tar.gz</p>
<blockquote>
<p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="http://archive.apache.org/dist/apr" target="_blank" rel="noopener">http://archive.apache.org/dist/apr</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</a></p>
</blockquote>
</li>
<li><p>zlib-1.2.11.tar.gz </p>
<blockquote>
<p>文件地址：<a href="http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml" target="_blank" rel="noopener">http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml</a><br>下载地址：<a href="https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1" target="_blank" rel="noopener">https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1</a></p>
</blockquote>
</li>
<li><p>sqlite-autoconf-3250100.tar.gz</p>
<blockquote>
<p>官网地址：<a href="http://www.sqlite.org" target="_blank" rel="noopener">http://www.sqlite.org</a><br>下载地址：<a href="https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz" target="_blank" rel="noopener">https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</a></p>
</blockquote>
</li>
<li><p>subversion-1.10.6.tar.gz</p>
<blockquote>
<p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="https://archive.apache.org/dist/subversion" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion</a><br>下载地址：<a href="https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</a></p>
</blockquote>
</li>
</ul>
<h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件目录</span><br><span class="line">mkdir /usr/local/subversion</span><br><span class="line"></span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/subversion/svn</span><br><span class="line"></span><br><span class="line">项目目录</span><br><span class="line">mkdir /usr/local/subversion/svn/project</span><br><span class="line"></span><br><span class="line">软件依赖安装目录</span><br><span class="line">mkdir /usr/local/subversion/software</span><br><span class="line"></span><br><span class="line">1.下载文件</span><br><span class="line">cd /usr/local/subversion/software</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz</span><br><span class="line">wget https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf apr-1.6.5.tar.gz</span><br><span class="line">tar -xzvf apr-util-1.6.1.tar.gz</span><br><span class="line">tar -xf zlib-1.2.11.tar.xz</span><br><span class="line">tar -xzvf sqlite-autoconf-3250100.tar.gz</span><br><span class="line">tar -zxvf subversion-1.10.6.tar.gz</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723020746262/1723020746262/20240807172108.png" alt="20240807172108"></p>
<h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul>
<li><p>apr-1.6.5.tar.gz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-1.6.5</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>apr-util-1.6.1.tar.gz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-util-1.6.1</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-util-1.6.1 --with-apr=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>zlib-1.2.11.tar.xz（可以不安装）</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/subversion/software/zlib-1.2.11</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/zlib-1.2.11</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>sqlite-autoconf-3250100.tar.gz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/subversion/software/sqlite-autoconf-3250100</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/sqlite</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>subversion-1.10.6.tar.gz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/subversion/software/subversion-1.10.6</span><br><span class="line"></span><br><span class="line">（--with-apr等参数后面的路径，取决于前面几个插件安装的路径，插件也应该放在/usr/local/下面，我这里插件都放在/home/svn/其实不推荐这么干，</span><br><span class="line">在使用 ./configure 脚本时，如果需要在命令行中换行拼接多个选项，可以使用 \ 符号在多行中分割长命令。这样做可以提高命令的可读性，使其不会过长。）</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/subversion-1.10.6  \</span><br><span class="line">            --with-apr=/usr/local/subversion/svn/apr-1.6.5  \</span><br><span class="line">            --with-apr-util=/usr/local/subversion/svn/apr-util-1.6.1  \</span><br><span class="line">            --with-sqlite=/usr/local/subversion/svn/sqlite  \</span><br><span class="line">            --with-lz4=internal  \</span><br><span class="line">            --with-utf8proc=internal</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><p>安装完成，添加环境变量path</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">添加</span><br><span class="line">echo "export PATH=/usr/local/subversion/svn/subversion-1.10.6/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">生效</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">cat /etc/profile</span><br><span class="line"></span><br><span class="line">验证：</span><br><span class="line">svnserve --version</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723020746262/1723020746262/20240808142507.png" alt="20240808142507"></p>
<h2 id="添加项目库"><a href="#添加项目库" class="headerlink" title="添加项目库"></a>添加项目库</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">创建两个库</span><br><span class="line">svnadmin create /usr/local/subversion/svn/javaproject/</span><br><span class="line">svnadmin create /usr/local/subversion/svn/webproject/</span><br><span class="line"></span><br><span class="line">进两个库里面设置权限，分别进入库的conf目录下，设置各自的权限……</span><br><span class="line"></span><br><span class="line">例如配置：</span><br><span class="line">cd /usr/local/subversion/svn/javaproject/conf</span><br><span class="line">    vim svnserve.conf</span><br><span class="line">        修改以下内容（大约在27行）：</span><br><span class="line">        password-db = passwd    	# 指明密码文件路径</span><br><span class="line"></span><br><span class="line">修改passwd文件</span><br><span class="line">	vim passwd</span><br><span class="line">		添加以下内容：</span><br><span class="line">		[users]</span><br><span class="line">		test1=test1</span><br><span class="line">		test2=test2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动（默认端口），指向库的父级目录</span><br><span class="line">svnserve -d -r  /usr/local/subversion/svn/</span><br><span class="line"></span><br><span class="line">关闭svn服务</span><br><span class="line">killall svnserve</span><br><span class="line"></span><br><span class="line">通过客户端访问</span><br><span class="line">svn://服务器ip:端口(默认端口3690可以不写)/javaproject/</span><br><span class="line">例如：svn://10.200.47.87/javaproject/</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/svnserver.service , 内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=SVN Server Service</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -d -r /usr/local/subversion/svn/</span><br><span class="line">ExecStop=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -q –pid-file /var/run/svnserve.pid</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div>
<p>wq!保存</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">查看服务： cat /etc/systemd/system/svnserver.service</span><br><span class="line"></span><br><span class="line">加载服务：systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">服务启动：systemctl start svnserver</span><br><span class="line">服务停止：systemctl stop svnserver</span><br><span class="line">服务状态：systemctl status svnserver</span><br><span class="line"></span><br><span class="line">开机启动：systemctl enable svnserver</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=3690/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=3690/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有3690端口</span><br><span class="line">ss -ntulp | grep 3690   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SVN</category>
      </categories>
      <tags>
        <tag>subversion</tag>
      </tags>
  </entry>
  <entry>
    <title>在Linux下安装RabbitMQ及配置</title>
    <url>/2024/08/1723102274931/1723102274931/</url>
    <content><![CDATA[<p>Rabbitmq依赖于Erlan 对应版本查看：<a href="https://www.rabbitmq.com/docs/which-erlang" target="_blank" rel="noopener">https://www.rabbitmq.com/docs/which-erlang</a></p>
<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote>
<p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p>
</blockquote>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol>
<li>otp_src_24.1.7.tar.gz</li>
<li>rabbitmq-server-generic-unix-3.9.11.tar.xz</li>
</ol>
<ul>
<li><p>otp_src_24.1.7.tar.gz</p>
<blockquote>
<p>官网地址：<a href="https://www.erlang.org/" target="_blank" rel="noopener">https://www.erlang.org/</a><br>文件地址：<a href="https://www.erlang.org/patches/otp-24.1.7" target="_blank" rel="noopener">https://www.erlang.org/patches/otp-24.1.7</a><br>下载地址：<a href="https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz" target="_blank" rel="noopener">https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</a></p>
</blockquote>
</li>
<li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p>
<blockquote>
<p>官网地址：<a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">https://www.rabbitmq.com/</a><br>文件地址：<a href="https://github.com/rabbitmq/rabbitmq-server" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server</a><br>下载地址：<a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</a></p>
</blockquote>
</li>
</ul>
<h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf otp_src_24.1.7.tar.gz</span><br><span class="line">tar -xf rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723102274931/1723102274931/20240808172416.png" alt="20240808172416"></p>
<h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul>
<li><p>otp_src_24.1.7.tar.gz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/software/otp_src_24.1.7</span><br><span class="line">./configure --prefix=/usr/local/erlang</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/erlang/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">测试安装是否成功</span><br><span class="line">erl --version</span><br><span class="line">输出：</span><br><span class="line">Erlang/OTP 24 [erts-12.1.5] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1]</span><br><span class="line">Eshell V12.1.5  (abort with ^G)</span><br><span class="line"></span><br><span class="line">退出</span><br><span class="line">halt(). 或者 q().</span><br></pre></td></tr></tbody></table></figure></div>
</li>
<li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/software/</span><br><span class="line">mv rabbitmq_server-3.9.11 /usr/local/</span><br><span class="line">mv /usr/local/rabbitmq_server-3.9.11 /usr/local/rabbitmq</span><br><span class="line">cd /usr/local/rabbitmq</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/rabbitmq/sbin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h4 id="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config"><a href="#rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config" class="headerlink" title="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config"></a>rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config</h4><p>mkdir /etc/rabbitmq/<br>创建文件 vim /etc/rabbitmq/rabbitmq-env.conf，内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 应用根目录</span><br><span class="line">RABBITMQ_HOME=/usr/local/rabbitmq</span><br><span class="line"># 插件的路径</span><br><span class="line">RABBITMQ_PLUGINS_DIR=/usr/local/rabbitmq/plugins</span><br><span class="line"># 需要使用的MNESIA数据库的路径（创建）</span><br><span class="line">RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/data</span><br><span class="line"># 日志文件的路径（创建）</span><br><span class="line">RABBITMQ_LOG_BASE=/usr/local/rabbitmq/logs</span><br><span class="line"># 配置文件的路径（创建）</span><br><span class="line">RABBITMQ_CONFIG_FILE=/usr/local/rabbitmq/conf/rabbitmq.config</span><br><span class="line">NODENAME=rabbit@localhost</span><br></pre></td></tr></tbody></table></figure></div>
<p>查看：cat /etc/rabbitmq/rabbitmq-env.conf</p>
<p>mkdir /usr/local/rabbitmq/conf<br>创建配置文件 vim /usr/local/rabbitmq/conf/rabbitmq.config，内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">## Clustering</span><br><span class="line">cluster_partition_handling = ignore</span><br><span class="line"></span><br><span class="line">## Defaults</span><br><span class="line"># During the first start, RabbitMQ will create a vhost and a user</span><br><span class="line"># These config items control what gets created</span><br><span class="line">default_permissions.configure = .*</span><br><span class="line">default_permissions.read = .*</span><br><span class="line">default_permissions.write = .*</span><br><span class="line">default_vhost = /</span><br><span class="line">default_user = admin</span><br><span class="line">default_pass = admin</span><br><span class="line"></span><br><span class="line">## Networking</span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line"></span><br><span class="line">## Management</span><br><span class="line">management.tcp.ip = 0.0.0.0</span><br><span class="line">management.tcp.port = 15672</span><br><span class="line"></span><br><span class="line">## Resource limits</span><br><span class="line"># Set a free disk space limit relative to total available RAM</span><br><span class="line">disk_free_limit.relative = 1.0</span><br></pre></td></tr></tbody></table></figure></div>
<p>查看：cat /usr/local/rabbitmq/conf/rabbitmq.config</p>
<h2 id="常用RabbitMQ命令"><a href="#常用RabbitMQ命令" class="headerlink" title="常用RabbitMQ命令"></a>常用RabbitMQ命令</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1.服务启动：rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line">2.服务停止：rabbitmqctl stop</span><br><span class="line"></span><br><span class="line">3.服务状态：rabbitmqctl status</span><br><span class="line"></span><br><span class="line">4.服务重启：rabbitmq-server restart</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="安装RabbitMQ-Web界面"><a href="#安装RabbitMQ-Web界面" class="headerlink" title="安装RabbitMQ Web界面"></a>安装RabbitMQ Web界面</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">开启插件：rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"></span><br><span class="line">浏览器访问：http://127.0.0.1:15672/</span><br><span class="line"></span><br><span class="line">RabbitMQ默认提供了一个guest/guest用户，但是从3.3.0 版本以后该账号只能localhost登陆（User can only log in via localhost）</span><br><span class="line"></span><br><span class="line">通过以下命令创建一个用户admin，密码为admin</span><br><span class="line">rabbitmqctl add_user admin admin</span><br><span class="line"></span><br><span class="line">创建完成之后通过以下命令设置用户标签为administrator</span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line"></span><br><span class="line">给用户user赋予权限，授予user用户可访问虚拟主机 /，并在所有的资源上具备可配置、可写及可读的权限</span><br><span class="line">rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"</span><br><span class="line"></span><br><span class="line">最后，通过以下命令可以看出当前的所有用户</span><br><span class="line">rabbitmqctl list_users</span><br></pre></td></tr></tbody></table></figure></div>

<p><img src="/2024/08/1723102274931/1723102274931/20240808180724.png" alt="20240808180724"></p>
<h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=15672/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=15672/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有15672端口</span><br><span class="line">ss -ntulp | grep 15672   //查看所有15672端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>RabbitMq</category>
      </categories>
      <tags>
        <tag>rabbitMq</tag>
      </tags>
  </entry>
  <entry>
    <title>部署OceanBase社区版(4.2.2.0)</title>
    <url>/2024/08/1723180766825/1723180766825/</url>
    <content><![CDATA[<p>本文仅学习体验 OceanBase 的功能，使用1台机器部署单节点集群即可。</p>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>OceanBase 支持部署在主流的Linux操作系统上，下面列出了常用的操作系统：</p>
<ul>
<li>Redhat / CentOS 7.x/8.x</li>
<li>SUSE / OpenSUSE 15.x</li>
<li>Anlios 7.x/8.x</li>
<li>Debian 9.x</li>
<li>Ubuntu 20.x</li>
</ul>
<h2 id="主机资源"><a href="#主机资源" class="headerlink" title="主机资源"></a>主机资源</h2><p>下表列出了部署OceanBase所需的单台主机的资源，如果需要集群部署，推荐使用相同规格的主机</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">CPU：2c，生产环境推荐4c以上</span><br><span class="line">内存：8G，生产环境推荐16G以上</span><br><span class="line">磁盘：内存的6倍以上，推荐使用 SSD, 生产环境要配置多块磁盘，将日志盘和数据盘分开</span><br><span class="line">文件系统：EXT4 戓 XFS，当数据超过 16T 时，使用 XFS</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="部署前置"><a href="#部署前置" class="headerlink" title="部署前置"></a>部署前置</h2><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>防火墙状态：systemctl status firewalld，如果输出结果非 inactive, 可以通过如下命令进行关闭：<br>防火墙停止：systemctl stop firewalld<br>防火墙禁用：systemctl disable firewalld</p>
<h3 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h3><p>修改配置文件，将SELINUX的配置修改为disabled，vi /etc/selinux/config</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"># SELINUXTYPE= can take one of three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></tbody></table></figure></div>
<p>配置文件修改后只会重启后生效，还需要使用下面命令立即生效：<br>setenforce 0</p>
<h3 id="修改配置-limits-conf"><a href="#修改配置-limits-conf" class="headerlink" title="修改配置 limits.conf"></a>修改配置 limits.conf</h3><p>执行以下命令解决安装时出现的资源性错误，打开 vi /etc/security/limits.conf 配置文件，添加以下内容：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">root soft nofile 655350</span><br><span class="line">root hard nofile 655350</span><br><span class="line">* soft nofile 655350</span><br><span class="line">* hard nofile 655350</span><br><span class="line">* soft stack unlimited</span><br><span class="line">* hard stack unlimited</span><br><span class="line">* soft nproc 655360</span><br><span class="line">* hard nproc 655360</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723180766825/1723180766825/20240809133727.png" alt="20240809133727"></p>
<h3 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h3><p>参考：<a href="https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561" target="_blank" rel="noopener">https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561</a></p>
<p>退出当前会话，重新登录。执行以下命令，查看配置是否生效。</p>
<blockquote>
<p>ulimit -a</p>
</blockquote>
<p>输出如下:<br><img src="/2024/08/1723180766825/1723180766825/20240809134315.png" alt="20240809134315"></p>
<h3 id="修改内核-etc-sysctl-conf"><a href="#修改内核-etc-sysctl-conf" class="headerlink" title="修改内核 /etc/sysctl.conf"></a>修改内核 /etc/sysctl.conf</h3><p>打开 vi /etc/sysctl.conf 配置文件，修改或添加以下内容：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">fs.aio-max-nr=1048576</span><br><span class="line">fs.file-max=6573688</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></tbody></table></figure></div>
<p>执行如下命令让配置生效<br>sysctl -p</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mkdir /usr/local/oceanbase</span><br><span class="line">cd /usr/local/oceanbase</span><br><span class="line"></span><br><span class="line"># 下载文件</span><br><span class="line">wget https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/download-center/opensource/oceanbase-all-in-one/7/x86_64/oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压文件</span><br><span class="line">tar -xzf oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">bin/install.sh</span><br><span class="line"></span><br><span class="line">    安装脚本会在主机上部署好OBD和OBClient, 并且将携带的rpm包都导入到OBD的环境中，安装后的输出结果如下。</span><br><span class="line">    Install Finished</span><br><span class="line">      =====================================================================</span><br><span class="line">      Setup Environment:     source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line">      Quick Start:           obd demo</span><br><span class="line">      More Details:          obd -h</span><br><span class="line">      =====================================================================</span><br><span class="line"></span><br><span class="line"># 在执行下一步操作之前，需要根据提示设置环境变量，命令如下：</span><br><span class="line"># set environment</span><br><span class="line">source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line"># check obd and obclient command</span><br><span class="line">which obd</span><br><span class="line">which obclient</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>采用快速部署模式：obd demo<br>demo 部署方式采用最小规格部署，部署的组件版本默认为最新版本默认部署的组件包含 oceanbase-ce、obproxy-ce、obagent、grafana、prometheus。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># use obd demo command to quickly launch a demo cluster</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">obd demo</span><br></pre></td></tr></tbody></table></figure></div>
<p>部署完成后，OBD会将各个组件的连接方式打印出来：<br><img src="/2024/08/1723180766825/1723180766825/20240809135908.png" alt="20240809135908"></p>
<p>说明：<br>Grafana访问：<a href="http://127.0.0.1:3000/d/oceanbase，" target="_blank" rel="noopener">http://127.0.0.1:3000/d/oceanbase，</a> 用户名和密码：admin/Kx7FPKTDh7</p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>安装后，可以使用 OBClient 客户端连接进行验证：obclient -h127.0.0.1 -uroot -P2881<br>授予所有特权：grant all privileges on <em>.</em> to root@’%’;<br><img src="/2024/08/1723180766825/1723180766825/20240809135934.png" alt="20240809135934"></p>
<h2 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h2><p>安装完成后 root用户是默认没密码</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">初次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot</span><br><span class="line"></span><br><span class="line">设置密码(!root)</span><br><span class="line">ALTER USER root@'%' IDENTIFIED BY '!root';</span><br><span class="line"></span><br><span class="line">再次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot -p</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723180766825/1723180766825/20240809145241.png" alt="20240809145241"></p>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">启动：obd cluster start demo</span><br><span class="line">停止：obd cluster stop demo</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=2881/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=2881/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有2881端口</span><br><span class="line">ss -ntulp | grep 2881   //查看所有2881端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>OceanBase</category>
      </categories>
      <tags>
        <tag>OceanBase</tag>
      </tags>
  </entry>
  <entry>
    <title>Linux安装 Redis - 绿色版</title>
    <url>/2024/08/1723099472324/1723099472324/</url>
    <content><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote>
<p>yum install -y gcc gcc-c++ tcl cmake</p>
</blockquote>
<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ul>
<li>redis-3.2.10.tar.gz<blockquote>
<p>官网地址：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a><br>文件地址：<a href="https://download.redis.io/releases/" target="_blank" rel="noopener">https://download.redis.io/releases/</a><br>下载地址：<a href="https://download.redis.io/releases/redis-3.2.10.tar.gz" target="_blank" rel="noopener">https://download.redis.io/releases/redis-3.2.10.tar.gz</a></p>
</blockquote>
</li>
</ul>
<h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://download.redis.io/releases/redis-3.2.10.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf redis-3.2.10.tar.gz</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723099472324/1723099472324/20240808145352.png" alt="20240808145352"></p>
<h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul>
<li>redis-3.2.10.tar.gz<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/software/redis-3.2.10</span><br><span class="line"></span><br><span class="line"># 指定安装目录</span><br><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ul>
<h2 id="配置文件redis-conf"><a href="#配置文件redis-conf" class="headerlink" title="配置文件redis.conf"></a>配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">从redis的源码目录中复制redis.conf到redis的bin目录下：</span><br><span class="line">cp /usr/local/software/redis-3.2.10/redis.conf /usr/local/redis/bin/</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723099472324/1723099472324/20240808150953.png" alt="20240808150953"></p>
<h2 id="修改配置文件redis-conf"><a href="#修改配置文件redis-conf" class="headerlink" title="修改配置文件redis.conf"></a>修改配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line">//显示行号</span><br><span class="line">:set nu</span><br><span class="line"></span><br><span class="line">//61行左右</span><br><span class="line">注释掉# bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">//80行左右</span><br><span class="line">修改 protected-mode yes 改为 protected-mode no</span><br><span class="line"></span><br><span class="line">//128行左右</span><br><span class="line">daemonize no 改为 daemonize yes</span><br><span class="line"></span><br><span class="line">:wq! 保存退出</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2024/08/1723099472324/1723099472324/20240808151306.png" alt="20240808151306"></p>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>在bin目录下，启动redis服务：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-server redis.conf</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="停止服务："><a href="#停止服务：" class="headerlink" title="停止服务："></a>停止服务：</h2><p>利用redis-cli来执行 shutdown 命令，即可停止 Redis 服务，</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-cli shutdown</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/redis.service , 内容如下：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div>

<p>查看：<br>cat /etc/systemd/system/redis.service</p>
<p>然后重载系统服务：<br>systemctl daemon-reload</p>
<p>可以用下面这组命令来操作redis了：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start redis</span><br><span class="line"># 停止</span><br><span class="line">systemctl stop redis</span><br><span class="line"># 重启</span><br><span class="line">systemctl restart redis</span><br><span class="line"># 查看状态</span><br><span class="line">systemctl status redis</span><br></pre></td></tr></tbody></table></figure></div>

<p>执行下面的命令，可以让redis开机自启：<br>systemctl enable redis</p>
<h2 id="添加端口到防火墙里："><a href="#添加端口到防火墙里：" class="headerlink" title="添加端口到防火墙里："></a>添加端口到防火墙里：</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=6379/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=6379/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有6379端口</span><br><span class="line">ss -ntulp | grep 6379   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>innosetup进行exe打包成安装文件</title>
    <url>/2024/08/1723804410469/1723804410469/</url>
    <content><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>官网地址：<a href="https://jrsoftware.org/" target="_blank" rel="noopener">https://jrsoftware.org/</a><br>下载地址：<a href="https://files.jrsoftware.org/is/6/" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/</a><br>文件下载：<a href="https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe</a></p>
<p>按照默认选择 一路点击“Next” 即可安装完成。</p>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>待续···</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>innosetup</tag>
      </tags>
  </entry>
  <entry>
    <title>exe4j将Java程序打包（EXE执行或者Win服务）</title>
    <url>/2024/08/1723797971551/1723797971551/</url>
    <content><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网地址：<a href="https://www.ej-technologies.com/exe4j/download" target="_blank" rel="noopener">https://www.ej-technologies.com/exe4j/download</a><br>进入网址，选择需要的版本，点击下载就可以了，需要注意的是exe4j 6.0 需要的jdk版本为1.8及以上。</p>
<p>下载地址：<a href="https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe" target="_blank" rel="noopener">https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe</a><br><img src="/2024/08/1723797971551/1723797971551/20240816165442.png" alt="20240816165442"></p>
<p>一键式安装，下载完成和平时安装软件以下，基本上直接下一步就可安装完成。</p>
<h3 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h3><p>安装完成运行软件，点击Enter License, 填写用户名、注册码即可,然后，点OK即可注册成功。<br><img src="/2024/08/1723797971551/1723797971551/20240816171223.png" alt="20240816171223"><br>注意：用户名可随便填写，公司可不填，注册码下面的随便选择复制一个即可</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">A-XVK258563F-1p4lv7mg7sav</span><br><span class="line">A-XVK209982F-1y0i3h4ywx2h1</span><br><span class="line">A-XVK267351F-dpurrhnyarva</span><br><span class="line">A-XVK204432F-1kkoilo1jy2h3r</span><br><span class="line">A-XVK246130F-1l7msieqiwqnq</span><br><span class="line">A-XVK249554F-pllh351kcke50</span><br><span class="line">A-XVK238729F-25yn13iea25i</span><br><span class="line">A-XVK222711F-134h5ta8yxbm0</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在 VM Parameters中输入:-Dexe.path=${EXE4J_EXEDIR}；然后可以用它在程序中找到exe所在目录，这样无论生成的exe放到哪都可以找到当前目录，<br>代码中的用法（String exePath = System.getProperty(“exe.path”);）<br>exe执行路径的获取，在把exe文件打包成可安装文件的操作和查找配置文件等操作中至关重要</p>
<p>Exe4j的内置VM变量：<br>%EXE4J_EXEDIR%：exe执行路径<br>%EXE4J_JVM_HOME%：运行可执行文件的JRE目录</p>
<h4 id="打开exe4j，点击Next"><a href="#打开exe4j，点击Next" class="headerlink" title="打开exe4j，点击Next"></a>打开exe4j，点击Next</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173007.png" alt="20240816173007"></p>
<h4 id="选择项目类型，点击Next"><a href="#选择项目类型，点击Next" class="headerlink" title="选择项目类型，点击Next"></a>选择项目类型，点击Next</h4><h5 id="这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，"><a href="#这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，" class="headerlink" title="这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，"></a>这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816172746.png" alt="20240816172746"></p>
<h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173731.png" alt="20240816173731"></p>
<h4 id="生成配置"><a href="#生成配置" class="headerlink" title="生成配置"></a>生成配置</h4><p>如果需要cmd窗体调试，可以选择第二个Console</p>
<h5 id="客户端（含有界面操作，选择第一个"><a href="#客户端（含有界面操作，选择第一个" class="headerlink" title="客户端（含有界面操作，选择第一个"></a>客户端（含有界面操作，选择第一个</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174643.png" alt="20240816174643"></p>
<h5 id="服务端（可配置在系统服务内运行，开机自启"><a href="#服务端（可配置在系统服务内运行，开机自启" class="headerlink" title="服务端（可配置在系统服务内运行，开机自启"></a>服务端（可配置在系统服务内运行，开机自启</h5><p><img src="/2024/08/1723797971551/1723797971551/20240906174526.png" alt="20240906174526"><br><img src="/2024/08/1723797971551/1723797971551/20240906174608.png" alt="20240906174608"></p>
<blockquote>
<p>服务安装：hello.exe /install hello<br>服务卸载：hello.exe /uninstall hello<br>服务启动：hello.exe /start hello<br>服务停止：hello.exe /stop hello  </p>
</blockquote>
<h5 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174809.png" alt="20240816174809"><br><img src="/2024/08/1723797971551/1723797971551/20240816174852.png" alt="20240816174852"></p>
<h4 id="JAR配置"><a href="#JAR配置" class="headerlink" title="JAR配置"></a>JAR配置</h4><p>点击右边绿色的 “+”号，然后选择【Archive】，打开浏览目录，找到我们的jar包，然后选择【打开】，【ok】<br><img src="/2024/08/1723797971551/1723797971551/20240816180639.png" alt="20240816180639"><br>注：VM Parameters中可以设置虚拟机的一下参数，-Dfile.encoding=utf-8是设置了utf-8的编码，以防中文乱码</p>
<h4 id="JRE配置"><a href="#JRE配置" class="headerlink" title="JRE配置"></a>JRE配置</h4><p>设置JRE的最小最高版本，我们根据自己的情况设置就ok，小版本设置成1.8就行；<br><img src="/2024/08/1723797971551/1723797971551/20240816180930.png" alt="20240816180930"></p>
<p>然后点击【Advanced Options】，选择【Search sequence】，将软件默认的三个配置需要全部删除，添加我们自己的JRE到软件中，<br>这样我们的代码可以在别的没有安装Java环境的电脑上运行；点击右边的添加，选择【Directory】，然后选择【浏览】，找到我们的JRE，然后添加；<br><img src="/2024/08/1723797971551/1723797971551/20240816181453.png" alt="20240816181453"><br><img src="/2024/08/1723797971551/1723797971551/20240816181729.png" alt="20240816181729"><br><img src="/2024/08/1723797971551/1723797971551/20240816181848.png" alt="20240816181848"></p>
<p>然后【Next】,点击左侧的【Preferred VM】，选择【Client hotspot VM】，然后【next】<br><img src="/2024/08/1723797971551/1723797971551/20240816182009.png" alt="20240816182009"><br>剩下的步骤直接一直next，这样exe文件生成了<br><img src="/2024/08/1723797971551/1723797971551/20240816182215.png" alt="20240816182215"><br>最后在Finished中选择save，保存现在的配置。</p>
<h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>以下为完整内容，双击exe可以执行<br><img src="/2024/08/1723797971551/1723797971551/20240816182945.png" alt="20240816182945"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>J-Package</category>
      </categories>
      <tags>
        <tag>exe4j</tag>
      </tags>
  </entry>
  <entry>
    <title>【JDK1.8】【编程式配置】日志之 log4j2 配置（控制台输出）</title>
    <url>/2024/12/1734417756349/1734417756349/</url>
    <content><![CDATA[<p><a href="/2024/12/1734677869669/1734677869669">XML配置</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init() {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef[] appenderRefs = {AppenderRef.createAppenderRef(consoleAppenderName, null, null)};</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefs, null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, level, null);</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLoggerLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLoggerLevel(Level.INFO).build().init();</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>



<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>【JDK1.8】【编程式配置】日志之 log4j2 配置（多文件输出）</title>
    <url>/2024/12/1734663522947/1734663522947/</url>
    <content><![CDATA[<p>多文件输出：输出指定级别及以上的日志信息且写入对应的日志级别文件<br><a href="/2024/12/1734677869669/1734677869669/#多文件输出">XML配置#多文件输出</a></p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.LevelMatchFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private boolean traceFlag;</span><br><span class="line">    private boolean debugFlag;</span><br><span class="line">    private boolean infoFlag;</span><br><span class="line">    private boolean warnFlag;</span><br><span class="line">    private boolean errorFlag;</span><br><span class="line">    private boolean fatalFlag;</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(boolean traceFlag, boolean debugFlag, boolean infoFlag, boolean warnFlag, boolean errorFlag, boolean fatalFlag, List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList) {</span><br><span class="line">        this.traceFlag = traceFlag;</span><br><span class="line">        this.debugFlag = debugFlag;</span><br><span class="line">        this.infoFlag = infoFlag;</span><br><span class="line">        this.warnFlag = warnFlag;</span><br><span class="line">        this.errorFlag = errorFlag;</span><br><span class="line">        this.fatalFlag = fatalFlag;</span><br><span class="line">        this.packLoggerList = packLoggerList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static Appender getFileAppender(PatternLayout layout, String logRootPath, Level level, String appenderName) {</span><br><span class="line">        //  日志文件名，根据日志级别取名</span><br><span class="line">        String fileName = level.toString().toLowerCase();</span><br><span class="line">        return RollingFileAppender.newBuilder().setName(appenderName)</span><br><span class="line">                // 过滤日志文件内容</span><br><span class="line">                .setFilter(LevelMatchFilter.newBuilder().setLevel(level).setOnMatch(Filter.Result.ACCEPT).setOnMismatch(Filter.Result.DENY).build())</span><br><span class="line">                // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                // 设置日志输出格式</span><br><span class="line">                .setLayout(layout)</span><br><span class="line">                // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     *</span><br><span class="line">     * @param logRootPath ，传 null 则不输出文件日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">AppenderRef</span>&gt;</span> appenderRefMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">Appender</span>&gt;</span> appenderMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line"></span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            if (traceFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String traceAppenderName = "TRACE_APPENDER";</span><br><span class="line">                Appender traceAppender = getFileAppender(layout, logRootPath, Level.TRACE, traceAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.TRACE, AppenderRef.createAppenderRef(traceAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.TRACE, traceAppender);</span><br><span class="line">            }</span><br><span class="line">            if (debugFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String debugAppenderName = "DEBUG_APPENDER";</span><br><span class="line">                Appender debugAppender = getFileAppender(layout, logRootPath, Level.DEBUG, debugAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.DEBUG, AppenderRef.createAppenderRef(debugAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.DEBUG, debugAppender);</span><br><span class="line">            }</span><br><span class="line">            if (infoFlag) {</span><br><span class="line">                // INFO</span><br><span class="line">                String infoAppenderName = "INFO_APPENDER";</span><br><span class="line">                Appender infoAppender = getFileAppender(layout, logRootPath, Level.INFO, infoAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.INFO, AppenderRef.createAppenderRef(infoAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.INFO, infoAppender);</span><br><span class="line">            }</span><br><span class="line">            if (warnFlag) {</span><br><span class="line">                // WARN</span><br><span class="line">                String warnAppenderName = "WARN_APPENDER";</span><br><span class="line">                Appender warnAppender = getFileAppender(layout, logRootPath, Level.WARN, warnAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.WARN, AppenderRef.createAppenderRef(warnAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.WARN, warnAppender);</span><br><span class="line">            }</span><br><span class="line">            if (errorFlag) {</span><br><span class="line">                // ERROR</span><br><span class="line">                String errorAppenderName = "ERROR_APPENDER";</span><br><span class="line">                Appender errorAppender = getFileAppender(layout, logRootPath, Level.ERROR, errorAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.ERROR, AppenderRef.createAppenderRef(errorAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.ERROR, errorAppender);</span><br><span class="line">            }</span><br><span class="line">            if (fatalFlag) {</span><br><span class="line">                // FATAL</span><br><span class="line">                String fatalAppenderName = "FATAL_APPENDER";</span><br><span class="line">                Appender fatalAppender = getFileAppender(layout, logRootPath, Level.FATAL, fatalAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.FATAL, AppenderRef.createAppenderRef(fatalAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.FATAL, fatalAppender);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>(appenderRefMap.values());</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderMap.values()) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        // 选配</span><br><span class="line">        if (packLoggerList.size() &gt; 0) {</span><br><span class="line">            for (PackLoggerVo packLoggerVo : packLoggerList) {</span><br><span class="line">                List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                if (packLoggerVo.isConsoleFlag()) {</span><br><span class="line">                    appenderRefListTemp.add(consoleAppenderRef);</span><br><span class="line">                    appenderListTemp.add(consoleAppender);</span><br><span class="line">                }</span><br><span class="line">                if (packLoggerVo.isFileFlag()) {</span><br><span class="line">                    Level[] packLoggerVoLevels = packLoggerVo.getLevels();</span><br><span class="line">                    for (Level loggerVoLevel : packLoggerVoLevels) {</span><br><span class="line">                        if (appenderRefMap.containsKey(loggerVoLevel)) {</span><br><span class="line">                            appenderRefListTemp.add(appenderRefMap.get(loggerVoLevel));</span><br><span class="line">                            appenderListTemp.add(appenderMap.get(loggerVoLevel));</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (appenderRefListTemp.size() &gt; 0) {</span><br><span class="line">                    LoggerConfig loggerConfig2 = LoggerConfig.createLogger(false, Level.ALL, packLoggerVo.getPackageName(), "true", appenderRefListTemp.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">                    for (Appender appender : appenderListTemp) {</span><br><span class="line">                        loggerConfig2.addAppender(appender, null, null);</span><br><span class="line">                    }</span><br><span class="line">                    config.addLogger(packLoggerVo.getPackageName(), loggerConfig2);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private boolean traceFlag = false;</span><br><span class="line">        private boolean debugFlag = false;</span><br><span class="line">        private boolean infoFlag = false;</span><br><span class="line">        private boolean warnFlag = false;</span><br><span class="line">        private boolean errorFlag = false;</span><br><span class="line">        private boolean fatalFlag = false;</span><br><span class="line">        private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">        public Builder withTraceFlag(final boolean traceFlag) {</span><br><span class="line">            this.traceFlag = traceFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withDebugFlag(boolean debugFlag) {</span><br><span class="line">            this.debugFlag = debugFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withInfoFlag(boolean infoFlag) {</span><br><span class="line">            this.infoFlag = infoFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withWarnFlag(boolean warnFlag) {</span><br><span class="line">            this.warnFlag = warnFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withErrorFlag(boolean errorFlag) {</span><br><span class="line">            this.errorFlag = errorFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withFatalFlag(boolean fatalFlag) {</span><br><span class="line">            this.fatalFlag = fatalFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder addPackLogger(final String packageName, boolean consoleFlag, boolean fileFlag, final Level... levels) {</span><br><span class="line">            if (packageName != null &amp;&amp; packageName.length() &gt; 0) {</span><br><span class="line">                packLoggerList.add(new PackLoggerVo().setPackageName(packageName).setConsoleFlag(consoleFlag).setFileFlag(fileFlag).setLevels(levels));</span><br><span class="line">            }</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(traceFlag, debugFlag, infoFlag, warnFlag, errorFlag, fatalFlag, packLoggerList);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class PackLoggerVo {</span><br><span class="line">        private String packageName;</span><br><span class="line">        private boolean consoleFlag;</span><br><span class="line">        private boolean fileFlag;</span><br><span class="line">        private Level[] levels;</span><br><span class="line"></span><br><span class="line">        String getPackageName() {</span><br><span class="line">            return packageName;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setPackageName(String packageName) {</span><br><span class="line">            this.packageName = packageName;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isConsoleFlag() {</span><br><span class="line">            return consoleFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setConsoleFlag(boolean consoleFlag) {</span><br><span class="line">            this.consoleFlag = consoleFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isFileFlag() {</span><br><span class="line">            return fileFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setFileFlag(boolean fileFlag) {</span><br><span class="line">            this.fileFlag = fileFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Level[] getLevels() {</span><br><span class="line">            return levels;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setLevels(Level[] levels) {</span><br><span class="line">            this.levels = levels;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>定义日志配置1：控制台输出</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init();</span><br></pre></td></tr></tbody></table></figure></div>

<p>定义日志配置2：文件输出</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div>

<p>定义日志配置2：过滤包且指定日志级别输出</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .addPackLogger("cn.hutool.log", true, false, Level.TRACE, Level.DEBUG, Level.INFO)</span><br><span class="line">                    .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">                        </span><br><span class="line">        // 定义日志配置</span><br><span class="line">        Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                   .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true).withFatalFlag(false)</span><br><span class="line">                   .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                   .build().init("D:\\logs");</span><br><span class="line">                   </span><br><span class="line">        // 输出日志</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>【JDK1.8】【编程式配置】日志之 log4j2 配置（单文件输出）</title>
    <url>/2024/12/1734663400620/1734663400620/</url>
    <content><![CDATA[<p>单文件输出：输出指定级别及以上的日志信息且写入同一个文件<br><a href="/2024/12/1734677869669/1734677869669/#单文件输出">XML配置#单文件输出</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.ThresholdFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void init() {</span><br><span class="line">        this.init(null, null);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath, String logName) {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        appenderList.add(consoleAppender);</span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            String fileAppenderName = "FILE_APPENDER";</span><br><span class="line">            AppenderRef fileAppenderRef = AppenderRef.createAppenderRef(fileAppenderName, null, null);</span><br><span class="line">            //  日志文件名，根据日志级别取名</span><br><span class="line">            String fileName = "logs" + File.separator + ((logName != null &amp;&amp; logName.length() &gt; 0) ? logName : "app");</span><br><span class="line">            Appender fileAppender = RollingFileAppender.newBuilder().setName(fileAppenderName)</span><br><span class="line">                    // 过滤日志文件内容</span><br><span class="line">                    .setFilter(ThresholdFilter.createFilter(level, Filter.Result.ACCEPT, Filter.Result.DENY))</span><br><span class="line">                    // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                    .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                    // 设置日志输出格式</span><br><span class="line">                    .setLayout(layout)</span><br><span class="line">                    // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                    .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                    // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                    .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                    // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                    .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                    .build();</span><br><span class="line">            appenderRefList.add(fileAppenderRef);</span><br><span class="line">            appenderList.add(fileAppender);</span><br><span class="line">        }</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderList) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // Log4j2Util.newBuilder().build().init();</span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLevel(Level.INFO).build().init("D:\\logs","app");</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>【JDK1.8】【XML配置】日志之 log4j2 配置（控制台输出）</title>
    <url>/2024/12/1734677869669/1734677869669/</url>
    <content><![CDATA[<p><a href="/2024/12/1734417756349/1734417756349/">JDK1.8的编程式配置</a><br><a href="/2026/01/1768813044601/1768813044601">JDK1.7的版本</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h2><p>log4j2.xml</p>
<h3 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="单文件输出"><a href="#单文件输出" class="headerlink" title="单文件输出"></a>单文件输出</h3><p><a href="/2024/12/1734663400620/1734663400620/">编程式配置#单文件输出</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"FILE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/app.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/app.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"FILE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="多文件输出"><a href="#多文件输出" class="headerlink" title="多文件输出"></a>多文件输出</h3><p><a href="/2024/12/1734663522947/1734663522947/">编程式配置#多文件输出</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"TRACE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/trace.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/trace.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"TRACE"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"DEBUG_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/debug.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/debug.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"INFO_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/info.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/info.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"WARN_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/warn.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/warn.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"ERROR_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/error.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/error.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"TRACE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"DEBUG_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>



<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote>
<p>private static final Logger log = LogManager.getLogger(App.class);</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line"></span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>【JDK1.7】【properties配置】日志之 log4j 配置（控制台输出）</title>
    <url>/2026/01/1768813044601/1768813044601/</url>
    <content><![CDATA[<p><a href="/2024/12/1734677869669/1734677869669">JDK1.8的版本</a></p>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--log4j 适配包。即面向 slf4j 调用 API，然后它内部调用适配包，最后适配包调用 log4j--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="log4j-properties"><a href="#log4j-properties" class="headerlink" title="log4j.properties"></a>log4j.properties</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">#指定输出日志信息的级别与输出的位置</span><br><span class="line">#日志级别，包括 TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR .</span><br><span class="line">#console 表示下面的控制台，logFile 表示下面的日志文件.</span><br><span class="line">log4j.rootLogger=DEBUG,console</span><br><span class="line">#表示Logger不会在父Logger的appender里输出，默认为true</span><br><span class="line">log4j.additivity.org.apache=true</span><br><span class="line">#控制台</span><br><span class="line">log4j.appender.console=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.console.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.console.ImmediateFlush=true</span><br><span class="line">log4j.appender.console.Target=System.out</span><br><span class="line">#日志输出的格式</span><br><span class="line">log4j.appender.console.layout.ConversionPattern=%5p [%t] (%c:%L) %d{yyyy-MM-dd HH:mm:ss,SSS} ---- %m%n</span><br></pre></td></tr></tbody></table></figure></div>


<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote>
<p>private static final Logger log = LoggerFactory.getLogger(App.class);</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LoggerFactory.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line"></span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>Logger</category>
      </categories>
      <tags>
        <tag>log4j</tag>
      </tags>
  </entry>
  <entry>
    <title>定时任务的简单应用（spring-boot-starter-quartz）</title>
    <url>/2025/06/1749008291584/1749008291584/</url>
    <content><![CDATA[<p><a href="/2020/11/1605079105126/1605079105126/">配置</a></p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="任务定义"><a href="#任务定义" class="headerlink" title="任务定义"></a>任务定义</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.TaskManager;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.*;</span><br><span class="line"></span><br><span class="line">import javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-03 003 17:34</span><br><span class="line"> * description: 任务定义</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public abstract class ScheduledJob implements Job {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化任务</span><br><span class="line">     */</span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() {</span><br><span class="line">        boolean run = this.isRun();</span><br><span class="line">        log.info("初始化任务【{}】，是否添加任务:{}",this.getClass().getName(),run);</span><br><span class="line">        if(run){</span><br><span class="line">            TaskManager.JOB_LIST.add(this);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 任务是否需求</span><br><span class="line">     */</span><br><span class="line">    public abstract boolean isRun();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * cron表达式在线生成 http://cron.qqe2.com/</span><br><span class="line">     * cron表达式在线生成 https://cron.ciding.cc/</span><br><span class="line">     */</span><br><span class="line">    public abstract String getCron();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param scheduler 0/5 * * * * ?</span><br><span class="line">     * @throws SchedulerException 异常</span><br><span class="line">     */</span><br><span class="line">    public void startJob(Scheduler scheduler) throws SchedulerException {</span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(this.getClass()).withIdentity(this.getClass().getName() + "-job", "group1").build();</span><br><span class="line">        CronScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(this.getCron());</span><br><span class="line">        CronTrigger cronTrigger = this.getCronTrigger(scheduleBuilder);</span><br><span class="line">        scheduler.scheduleJob(jobDetail, cronTrigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 若要自定义触发器,请在子类重写此方法</span><br><span class="line">     */</span><br><span class="line">    private CronTrigger getCronTrigger(CronScheduleBuilder scheduleBuilder) {</span><br><span class="line">        return TriggerBuilder.newTrigger().withIdentity(this.getClass().getName() + "-trigger", "group1").withSchedule(scheduleBuilder).build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="任务管理器"><a href="#任务管理器" class="headerlink" title="任务管理器"></a>任务管理器</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import com.demon.springbootquartzsimple.support.ApplicationContextHelper;</span><br><span class="line">import org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  author: Demon</span><br><span class="line"> *  date: 2025-06-04 004 11:25</span><br><span class="line"> *  description: 任务管理器</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@EnableScheduling</span><br><span class="line">public class TaskManager {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 存放所有定时任务</span><br><span class="line">     */</span><br><span class="line">    public static final List<span class="tag">&lt;<span class="name">ScheduledJob</span>&gt;</span> JOB_LIST = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 执行所有定时任务</span><br><span class="line">     */</span><br><span class="line">    public void executeTasks() {</span><br><span class="line">        if (JOB_LIST.size() &gt; 0) {</span><br><span class="line">            SchedulerFactoryBean schedulerFactoryBean = ApplicationContextHelper.getBean(SchedulerFactoryBean.class);</span><br><span class="line">            for (ScheduledJob job : JOB_LIST) {</span><br><span class="line">                try {</span><br><span class="line">                    // 运行</span><br><span class="line">                    job.startJob(schedulerFactoryBean.getScheduler());</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="任务监听"><a href="#任务监听" class="headerlink" title="任务监听"></a>任务监听</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.listener;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.TaskManager;</span><br><span class="line">import org.springframework.context.ApplicationListener;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.event.ContextRefreshedEvent;</span><br><span class="line">import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</span><br><span class="line">import org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-03 003 16:42</span><br><span class="line"> * description: 任务监听</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class SchedulerListener implements ApplicationListener<span class="tag">&lt;<span class="name">ContextRefreshedEvent</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    public TaskManager taskManager;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onApplicationEvent(ContextRefreshedEvent event) {</span><br><span class="line">        try {</span><br><span class="line">            taskManager.executeTasks();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * scheduled调度器：调度什么时候去做什么事情</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public SchedulerFactoryBean schedulerFactoryBean() {</span><br><span class="line">       Properties properties = new Properties();</span><br><span class="line">       // 实例化ThreadPool时，使用的线程类为SimpleThreadPool（一般使用SimpleThreadPool即可满足几乎所有用户的需求）</span><br><span class="line">       properties.put("org.quartz.threadPool.class", "org.quartz.simpl.SimpleThreadPool");</span><br><span class="line">       // 并发个数,指定线程数，至少为1（无默认值）(一般设置为1-100之间的的整数合适)</span><br><span class="line">       properties.put("org.quartz.threadPool.threadCount", "5");</span><br><span class="line">       //设置线程的优先级（最大为java.lang.Thread.MAX_PRIORITY 10，最小为Thread.MIN_PRIORITY 1，默认为5）</span><br><span class="line">       properties.put("org.quartz.threadPool.threadPriority", "5");</span><br><span class="line"></span><br><span class="line">       SchedulerFactoryBean schedulerFactoryBean = new SchedulerFactoryBean();</span><br><span class="line">       schedulerFactoryBean.setSchedulerName("scheduled-task-");</span><br><span class="line">       schedulerFactoryBean.setQuartzProperties(properties);</span><br><span class="line">       return schedulerFactoryBean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="执行任务1"><a href="#执行任务1" class="headerlink" title="执行任务1"></a>执行任务1</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job.task;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-04 004 10:53</span><br><span class="line"> * description: 任务1</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class MyTaskJob1 extends ScheduledJob {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isRun() {</span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表示每5秒 执行任务</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String getCron() {</span><br><span class="line">        return "0/5 * * * * ?";</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void execute(JobExecutionContext jobExecutionContext) {</span><br><span class="line">        log.info("=======开始执行========MyTaskJob1================");</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="执行任务2"><a href="#执行任务2" class="headerlink" title="执行任务2"></a>执行任务2</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job.task;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.quartz.JobExecutionException;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-04 004 10:54</span><br><span class="line"> * description: 任务2</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class MyTaskJob2 extends ScheduledJob {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isRun() {</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表示每5秒 执行任务</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String getCron() {</span><br><span class="line">        return "0/5 * * * * ?";</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    @Override</span><br><span class="line">    public void execute(JobExecutionContext jobExecutionContext) {</span><br><span class="line">        log.info("=======开始执行========MyTaskJob2================");</span><br><span class="line">        throw new JobExecutionException("MyTaskJob2抛出任务异常");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<p>启动程序即会执行<br><img src="/2025/06/1749008291584/1749008291584/20250604134001.png" alt="20250604134001"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>Quartz</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoTemplate的封装应用：MongoTemplateUtil</title>
    <url>/2025/08/1755659266090/1755659266090/</url>
    <content><![CDATA[<p><a href="/2020/11/1605079105126/1605079105126/">SpringUtils类</a></p>
<p><a href="/2025/08/1755658946010/1755658946010/">MongoTemplate配置</a></p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.utils;</span><br><span class="line"></span><br><span class="line">import com.mongodb.bulk.BulkWriteResult;</span><br><span class="line">import com.mongodb.client.result.DeleteResult;</span><br><span class="line">import com.mongodb.client.result.UpdateResult;</span><br><span class="line">import com.demon.common.core.utils.SpringUtils;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.domain.PageRequest;</span><br><span class="line">import org.springframework.data.mongodb.core.BulkOperations;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Query;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Update;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongo 工具类</span><br><span class="line"> *</span><br><span class="line"> * @author demon</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * 参考：https://blog.csdn.net/mouday/article/details/128706828</span><br><span class="line"> * 参考：https://www.cnblogs.com/mihutao/p/17522327.html</span><br><span class="line"> * 参考：https://www.cnblogs.com/gongchengship/p/18306392</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class MongoTemplateUtil {</span><br><span class="line"></span><br><span class="line">    private static final MongoTemplate mongoTemplate = SpringUtils.getBean(MongoTemplate.class);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入一条记录（选择字段，策略插入）</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T save(T entity) {</span><br><span class="line">        return mongoTemplate.insert(entity);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入（批量）</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> Collection<span class="tag">&lt;<span class="name">T</span>&gt;</span> saveBatch(Collection<span class="php"><span class="meta">&lt;?</span> extends T&gt; entityList, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.insert(entityList, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 删除</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> DeleteResult removeById(String id, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.remove(new Query(Criteria.where("_id").is(id)), entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除（根据ID 批量删除）</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeByIds(Collection<span class="php"><span class="meta">&lt;?</span> extends Serializable&gt; idList, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.remove(new Query(Criteria.where("_id").in(idList)), entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 columnMap 条件，删除记录</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeByMap(Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> columnMap, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        Criteria criteria = <span class="keyword">new</span> Criteria();</span></span><br><span class="line"><span class="php">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : columnMap.entrySet()) {</span></span><br><span class="line"><span class="php">            criteria.<span class="keyword">and</span>(entry.getKey()).is(entry.getValue());</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.remove(<span class="keyword">new</span> Query(criteria), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 设置的条件，删除记录</span><br><span class="line">     * eg: Query query = new Query(Criteria.where("_id").is("123456912").and("age").gt(11));</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> DeleteResult removeByQuery(Query query, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        log.info("MongoTemplateUtil.removeByQuery执行语句：{}", query.toString());</span><br><span class="line">        return mongoTemplate.remove(query, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除文档全部数据</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeAll(Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.remove(<span class="keyword">new</span> Query(), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 Query条件 更新</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> UpdateResult update(Query query, Update update, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.updateMulti(query, update, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 更新</span><br><span class="line">     */</span><br><span class="line">    public static UpdateResult updateById(String id, Update update, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.updateMulti(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).is(id)), update, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据ID 批量更新</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> UpdateResult updateBatchById(Collection&lt;String&gt; ids, Update update, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.updateMulti(new Query(Criteria.where("_id").in(ids)), update, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 Query条件 批量更新</span><br><span class="line">     */</span><br><span class="line">    public static BulkWriteResult updateBatchByQuery(Map<span class="tag">&lt;<span class="name">Query,</span> <span class="attr">Update</span>&gt;</span> queryUpdateMap, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        BulkOperations bulkOperations = mongoTemplate.bulkOps(BulkOperations.BulkMode.ORDERED, entityClass);</span></span><br><span class="line"><span class="php">        <span class="keyword">for</span> (Map.Entry&lt;Query, Update&gt; entry : queryUpdateMap.entrySet()) {</span></span><br><span class="line"><span class="php">            bulkOperations.updateMulti(entry.getKey(), entry.getValue());</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> bulkOperations.execute();</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 查询</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T selectById(String id, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findById(id, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询（根据ID 批量查询）</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectBatchIds(Collection&lt;String&gt; ids, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).in(ids)), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询一条记录，结果集如果是多个会取第一条</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T selectOne(Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findOne(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询全部记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectList(Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询全部记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectList(<span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findAll(entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询分页记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectPage(int page, int size, Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        query.with(PageRequest.of(page, size));</span></span><br><span class="line"><span class="php">        log.info(<span class="string">"MongoTemplateUtil.selectPage执行语句：{}"</span>, query.toString());</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询总记录数</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> long selectCount(Query query, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.count(query, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>MongoDb</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows中同时安装MySQL5和MySQL8</title>
    <url>/2025/02/1739425332925/1739425332925/</url>
    <content><![CDATA[<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>官网地址：<a href="https://www.mysql.com/" target="_blank" rel="noopener">https://www.mysql.com/</a><br>下载地址：<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener">https://downloads.mysql.com/archives/community/</a></p>
<h4 id="1-下载MySql-5-7-24"><a href="#1-下载MySql-5-7-24" class="headerlink" title="1.下载MySql-5.7.24"></a>1.下载MySql-5.7.24</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213134906.png" alt="20250213134906"></p>
<h4 id="2-下载MySql-8-0-16"><a href="#2-下载MySql-8-0-16" class="headerlink" title="2.下载MySql-8.0.16"></a>2.下载MySql-8.0.16</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213135151.png" alt="20250213135151"></p>
<h2 id="解压文件并配置环境变量"><a href="#解压文件并配置环境变量" class="headerlink" title="解压文件并配置环境变量"></a>解压文件并配置环境变量</h2><p>下载下来的文件是压缩包，解压缩放在系统盘符目录下，并配置配置环境变量：MYSQL5_HOME,MYSQL8_HOME，同时在PATH内添加，<br><img src="/2025/02/1739425332925/1739425332925/20250213142910.png" alt="20250213142910"></p>
<h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><h3 id="安装MySQL5"><a href="#安装MySQL5" class="headerlink" title="安装MySQL5"></a>安装MySQL5</h3><p>1.创建必要文件 my.ini</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">innodb_flush_method=normal</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-5.7.24-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不要手动创建，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-5.7.24-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"># 连接时间</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br><span class="line"></span><br><span class="line"># 关闭5.7 密码验证</span><br><span class="line"># validate_password=off</span><br></pre></td></tr></tbody></table></figure></div>

<p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL5的 bin 路径下，输入命令：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div>

<p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213145411.png" alt="20250213145411"></p>
<p>3.安装MySQL5服务<br>输入命令</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mysqld --install MYSQL5</span><br></pre></td></tr></tbody></table></figure></div>
<p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL8冲突）<br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213145744.png" alt="20250213145744"></p>
<p>4.开启MySQL5服务<br>输入命令：net start MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213150037.png" alt="20250213150037"></p>
<p>5.登录MySQL5修改密码并开启远程访问</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3306 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问：GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2025/02/1739425332925/1739425332925/20250213153023.png" alt="20250213153023"></p>
<h3 id="安装MySQL8"><a href="#安装MySQL8" class="headerlink" title="安装MySQL8"></a>安装MySQL8</h3><ol>
<li>创建必要文件 my.ini<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3308端口</span><br><span class="line">port = 3308</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-8.0.16-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-8.0.16-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"># 绑定到所有IP地址</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line"># 连接时间一年</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br></pre></td></tr></tbody></table></figure></div>

</li>
</ol>
<p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL8的 bin 路径下，输入命令：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div>

<p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213153903.png" alt="20250213153903"></p>
<p>3.安装MySQL8服务<br>输入命令：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">mysqld --install MYSQL8</span><br></pre></td></tr></tbody></table></figure></div>
<p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL5冲突）<br><img src="/2025/02/1739425332925/1739425332925/20250213153321.png" alt="20250213153321"><br><span style="color:red">由于在安装服务的时候 会使用MYSQL5的目录下的mysqld文件，故需要将注册表的内容 变更为MYSQL8的目录下的mysqld文件</span><br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155551.png" alt="20250213155551"></p>
<p>4.开启MySQL8服务<br>输入命令：net start MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155713.png" alt="20250213155713"></p>
<p>5.登录MySQL8修改密码并开启远程访问</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3308 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问</span><br><span class="line"># 使用mysql数据库</span><br><span class="line">use mysql;</span><br><span class="line"># 查看用户及权限</span><br><span class="line">select user,host from mysql.user;</span><br><span class="line"># 更新root用户的host属性为%</span><br><span class="line">update user set host='%' where user='root';</span><br><span class="line"># 刷新下权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"># 再执行就可以了，就可以使用navicat连接了</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;</span><br><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div>
<p><img src="/2025/02/1739425332925/1739425332925/20250213160902.png" alt="20250213160902"></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>MySql</category>
      </categories>
      <tags>
        <tag>MySql</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之过渡动画</title>
    <url>/2025/12/1764912927964/1764912927964/</url>
    <content><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p>
<h2 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h2><p><img src="/2025/12/1764912927964/1764912927964/20251205133736.png" alt="20251205133736"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">// 虚拟数据，实际map放自己需要的内容</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">objectMap.put("result", new Random().nextInt(2));</span><br><span class="line">// 导出</span><br><span class="line">try {</span><br><span class="line">    Dialog dialog = SystemAlert.getDialog(window, "导出中···", FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource("fxml/Export.fxml"))));</span><br><span class="line">    dialog.initStyle(StageStyle.UNDECORATED);</span><br><span class="line">    ExportController exportController = ExportController.getInstance();</span><br><span class="line">    exportController.loadProgress(dialog.getTitle(), objectMap, dialog);</span><br><span class="line">    dialog.showAndWait();</span><br><span class="line">} catch (Exception e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="ExportController"><a href="#ExportController" class="headerlink" title="ExportController"></a>ExportController</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.controller;</span><br><span class="line"></span><br><span class="line">import cn.hutool.core.util.StrUtil;</span><br><span class="line">import com.demon.ui.SystemAlert;</span><br><span class="line">import javafx.concurrent.Service;</span><br><span class="line">import javafx.concurrent.Task;</span><br><span class="line">import javafx.fxml.FXML;</span><br><span class="line">import javafx.fxml.Initializable;</span><br><span class="line">import javafx.scene.control.Button;</span><br><span class="line">import javafx.scene.control.Dialog;</span><br><span class="line">import javafx.scene.control.Label;</span><br><span class="line">import javafx.scene.control.ProgressIndicator;</span><br><span class="line">import javafx.stage.Window;</span><br><span class="line"></span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.ResourceBundle;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class ExportController implements Initializable {</span><br><span class="line"></span><br><span class="line">    private static ExportController exportController;</span><br><span class="line"></span><br><span class="line">    @FXML</span><br><span class="line">    public ProgressIndicator downloadProgressIndicator;</span><br><span class="line">    @FXML</span><br><span class="line">    public Label exportStatus;</span><br><span class="line">    @FXML</span><br><span class="line">    public Button downloadYes;</span><br><span class="line"></span><br><span class="line">    private Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> dataMap;</span><br><span class="line">    /**</span><br><span class="line">     * 异步 Service</span><br><span class="line">     */</span><br><span class="line">    private Service<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> serviceExecute = new Service<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() {</span><br><span class="line">        @Override</span><br><span class="line">        protected Task<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> createTask() {</span><br><span class="line">            return new Task<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() {</span><br><span class="line">                @Override</span><br><span class="line">                protected Integer call() {</span><br><span class="line">                    //业务逻辑，每执行一次 updateProgress 则可以 调用监听事件</span><br><span class="line">                    try {</span><br><span class="line">                        // 导出操作</span><br><span class="line">                        int result = (int)dataMap.get("result");</span><br><span class="line">                        System.out.println(result);</span><br><span class="line">                        TimeUnit.SECONDS.sleep(5); // 休眠10s 模拟导出过程，真实场景不需要</span><br><span class="line">                        // 以上为自己业务的逻辑</span><br><span class="line">                        if (result == 0) {</span><br><span class="line">                            System.out.println("导出完成！！！");</span><br><span class="line">                            downloadYes.setUserData(true);</span><br><span class="line">                            this.updateProgress(1, 1);</span><br><span class="line">                        } else {</span><br><span class="line">                            System.out.println("导出失败！！！");</span><br><span class="line">                            exportStatus.setUserData("自定义是失败原因");</span><br><span class="line">                            downloadYes.setUserData(false);</span><br><span class="line">                            this.updateProgress(0, 0);</span><br><span class="line">                        }</span><br><span class="line">                    } catch (Exception e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        downloadYes.setUserData(false);</span><br><span class="line">                        exportStatus.setUserData(String.valueOf(e.toString()));</span><br><span class="line">                        System.out.println("导出异常");</span><br><span class="line">                        updateProgress(0, 0);</span><br><span class="line">                    } finally {</span><br><span class="line">                        downloadYes.setDisable(false);</span><br><span class="line">                    }</span><br><span class="line">                    return null;</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    static ExportController getInstance() {</span><br><span class="line">        return exportController;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initialize(URL location, ResourceBundle resources) {</span><br><span class="line">        exportController = this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    void loadProgress(String title, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> dataMap, Dialog dialog) {</span><br><span class="line">        this.dataMap = dataMap;</span><br><span class="line">        exportStatus.setText(title);</span><br><span class="line">        downloadYes.setOnMouseClicked(event -&gt; SystemAlert.getCloseDialogPane(downloadYes));</span><br><span class="line">        // 执行  调用 updateProgress 的 监听事件</span><br><span class="line">        serviceExecute.progressProperty().addListener((observable, oldValue, newValue) -&gt; {</span><br><span class="line">            Window window = downloadYes.getScene().getWindow();</span><br><span class="line">            System.out.println(newValue);</span><br><span class="line">            if ("NaN".equals(String.valueOf(newValue))) {</span><br><span class="line">                //导出异常-关闭loading</span><br><span class="line">                dialog.close();</span><br><span class="line">                exportStatus.setText("导出异常");</span><br><span class="line">                SystemAlert.getAlertToInfo(window, "提示", "导出异常", String.valueOf(exportStatus.getUserData()));</span><br><span class="line">                SystemAlert.getCloseDialogPane(downloadYes);</span><br><span class="line">            } else {</span><br><span class="line">                if (!StrUtil.isNullOrUndefined(String.valueOf(downloadYes.getUserData())) &amp;&amp; Boolean.parseBoolean(String.valueOf(downloadYes.getUserData()))) {</span><br><span class="line">                    //导出完成-关闭loading</span><br><span class="line">                    dialog.close();</span><br><span class="line">                    exportStatus.setText("导出成功");</span><br><span class="line">                    // 导出完成后的操作··</span><br><span class="line">                    //MainController.getInstance().loadData();</span><br><span class="line">                    // 以上为自己业务的逻辑</span><br><span class="line">                    SystemAlert.getCloseDialogPane(downloadYes);</span><br><span class="line">                } else {</span><br><span class="line">                    exportStatus.setText("导出中···");</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        serviceExecute.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="Fxml"><a href="#Fxml" class="headerlink" title="Fxml"></a>Fxml</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.geometry.Insets<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.Button<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.Label<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.ProgressIndicator<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.layout.*<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">AnchorPane</span> <span class="attr">xmlns</span>=<span class="string">"http://javafx.com/javafx"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:fx</span>=<span class="string">"http://javafx.com/fxml"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fx:controller</span>=<span class="string">"com.demon.controller.ExportController"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prefHeight</span>=<span class="string">"150.0"</span> <span class="attr">prefWidth</span>=<span class="string">"300.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">BorderPane</span> <span class="attr">layoutX</span>=<span class="string">"30.0"</span> <span class="attr">layoutY</span>=<span class="string">"30.0"</span> <span class="attr">style</span>=<span class="string">"-fx-background-color: #FFFFFF;"</span> <span class="attr">AnchorPane.bottomAnchor</span>=<span class="string">"-40.0"</span> <span class="attr">AnchorPane.leftAnchor</span>=<span class="string">"0.0"</span> <span class="attr">AnchorPane.rightAnchor</span>=<span class="string">"0.0"</span> <span class="attr">AnchorPane.topAnchor</span>=<span class="string">"0.0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ProgressIndicator</span> <span class="attr">fx:id</span>=<span class="string">"downloadProgressIndicator"</span> <span class="attr">prefHeight</span>=<span class="string">"123.0"</span> <span class="attr">prefWidth</span>=<span class="string">"300.0"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">top</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">HBox</span> <span class="attr">alignment</span>=<span class="string">"CENTER_LEFT"</span> <span class="attr">prefHeight</span>=<span class="string">"25.0"</span> <span class="attr">style</span>=<span class="string">"-fx-background-color: #F8F8F8;"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Label</span> <span class="attr">fx:id</span>=<span class="string">"exportStatus"</span> <span class="attr">text</span>=<span class="string">"加载提示中···"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">padding</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Insets</span> <span class="attr">left</span>=<span class="string">"10.0"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">padding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">HBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">top</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bottom</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">HBox</span> <span class="attr">alignment</span>=<span class="string">"CENTER"</span> <span class="attr">prefHeight</span>=<span class="string">"20.0"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">fx:id</span>=<span class="string">"downloadYes"</span> <span class="attr">disable</span>=<span class="string">"true"</span> <span class="attr">mnemonicParsing</span>=<span class="string">"false"</span> <span class="attr">text</span>=<span class="string">"确定"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">padding</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Insets</span> <span class="attr">bottom</span>=<span class="string">"2.0"</span> <span class="attr">left</span>=<span class="string">"2.0"</span> <span class="attr">right</span>=<span class="string">"2.0"</span> <span class="attr">top</span>=<span class="string">"15.0"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">padding</span>&gt;</span><span class="tag">&lt;/<span class="name">HBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bottom</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BorderPane</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AnchorPane</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>ProgressIndicator</tag>
      </tags>
  </entry>
  <entry>
    <title>MongoTemplate的简单应用（spring-boot-starter-data-mongodb）</title>
    <url>/2025/08/1755658946010/1755658946010/</url>
    <content><![CDATA[<p>MongoDB是一款开源的文档型数据库，它以动态的模式存储类似JSON的BSON文档，能够处理大量的非结构化数据。<br>其特点包括灵活的数据模型、高效的索引机制、支持数据复制和分片，以及易于使用的API。<br>MongoDB适用于需要快速迭代和存储多样化数据格式的应用场景。  </p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 可选：用于 JSON 序列化/反序列化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-driver-legacy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="yml-配置"><a href="#yml-配置" class="headerlink" title="yml 配置"></a>yml 配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line"># mongodb 配置</span><br><span class="line">mongodb:</span><br><span class="line">  uri: mongodb://127.0.0.1:27017/dataBaseName</span><br><span class="line">  database: dataBaseName</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="config-配置"><a href="#config-配置" class="headerlink" title="config 配置"></a>config 配置</h3><p>当前的uri为无密码写法</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.config.properties;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongodb 配置属性</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@ConfigurationProperties(prefix = "mongodb")</span><br><span class="line">public class MongodbProperties {</span><br><span class="line"></span><br><span class="line">    private String uri;</span><br><span class="line">    private String database;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="convert-转换器"><a href="#convert-转换器" class="headerlink" title="convert 转换器"></a>convert 转换器</h3><p>针对存储类型转换 Mongodb存储的基本数据字段类型有：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">1.1 String</span><br><span class="line">1.描述:字符串类型，用于存储文本数据，支持 UTF-8 编码。</span><br><span class="line">2.示例:“name”: “Alice”</span><br><span class="line"></span><br><span class="line">1.2 Number</span><br><span class="line">1.Int32/Int64: 整数类型（32 位或 64 位）。“age”: 30</span><br><span class="line">2.示例:Double: 双精度浮点数。“height”: 1.75</span><br><span class="line"></span><br><span class="line">1.3 Boolean</span><br><span class="line">1.布尔类型，用于存储 true 或 false。</span><br><span class="line">2.示例:“isStudent”: true</span><br><span class="line"></span><br><span class="line">1.4 Date</span><br><span class="line">1.描述:日期类型，用于存储日期和时间，存储为 UTC 时间。</span><br><span class="line">2.示例:“createdAt”: ISODate(“2023-10-01T00:00:00Z”)</span><br><span class="line"></span><br><span class="line">1.5 Null</span><br><span class="line">1.描述:空值类型，用于表示字段值为空或不存在。</span><br><span class="line">2.示例:“middleName”: null</span><br><span class="line"></span><br><span class="line">1.6 ObjectId</span><br><span class="line">1.描述:唯一标识符类型，MongoDB 默认的 _id 字段类型，用于唯一标识文档。</span><br><span class="line">2.示例:“_id”: ObjectId(“6523f1c7e8b8d4a5b3c1d2e3”)</span><br><span class="line"></span><br><span class="line">1.7 Array</span><br><span class="line">1.描述:数组类型，用于存储一组值，可以是任意数据类型的混合。</span><br><span class="line">2.示例:“tags”: [“mongodb”, “database”, “nosql”]</span><br><span class="line"></span><br><span class="line">1.8 Binary Data</span><br><span class="line">1.描述:二进制数据类型，用于存储二进制数据（如图片、文件等）。</span><br><span class="line">2.示例:“imageData”: BinData(0, “base64data==”)</span><br><span class="line"></span><br><span class="line">1.9 Object</span><br><span class="line">1.描述:嵌套文档类型，用于存储嵌套的键值对（类似于 JSON 对象）。</span><br><span class="line">2.示例:“address”: { “city”: “New York”, “zip”: “10001” }</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="BigDecimal-转-Decimal128"><a href="#BigDecimal-转-Decimal128" class="headerlink" title="BigDecimal 转 Decimal128"></a>BigDecimal 转 Decimal128</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.bson.types.Decimal128;</span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.WritingConverter;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-15 015 14:33</span><br><span class="line"> * description: 配置 BigDecimal 转 Decimal128 的转换器 BigDecimalToDecimal128Converter</span><br><span class="line"> */</span><br><span class="line">@WritingConverter</span><br><span class="line">public class BigDecimalToDecimal128Converter implements Converter<span class="tag">&lt;<span class="name">BigDecimal,</span> <span class="attr">Decimal128</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Decimal128 convert(@NotNull BigDecimal bigDecimal) {</span><br><span class="line">        return new Decimal128(bigDecimal);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="Decimal128-转-BigDecimal"><a href="#Decimal128-转-BigDecimal" class="headerlink" title="Decimal128 转 BigDecimal"></a>Decimal128 转 BigDecimal</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.bson.types.Decimal128;</span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.ReadingConverter;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-15 015 14:33</span><br><span class="line"> * description: 配置 Decimal128 转 BigDecimal 的转换器 Decimal128ToBigDecimalConverter</span><br><span class="line"> */</span><br><span class="line">@ReadingConverter</span><br><span class="line">public class Decimal128ToBigDecimalConverter implements Converter<span class="tag">&lt;<span class="name">Decimal128,</span> <span class="attr">BigDecimal</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public BigDecimal convert(@NotNull Decimal128 decimal128) {</span><br><span class="line">        return decimal128.bigDecimalValue();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h4 id="Date-转-ZonedDateTime"><a href="#Date-转-ZonedDateTime" class="headerlink" title="Date 转 ZonedDateTime"></a>Date 转 ZonedDateTime</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.ReadingConverter;</span><br><span class="line"></span><br><span class="line">import java.time.ZoneOffset;</span><br><span class="line">import java.time.ZonedDateTime;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-14 014 17:16</span><br><span class="line"> * description: Date 转 ZonedDateTime</span><br><span class="line"> */</span><br><span class="line">@ReadingConverter</span><br><span class="line">public class ZonedDateTimeReadConverter implements Converter<span class="tag">&lt;<span class="name">Date,</span> <span class="attr">ZonedDateTime</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ZonedDateTime convert(@NotNull Date date) {</span><br><span class="line">        System.out.println("Date 转 ZonedDateTime");</span><br><span class="line">        return date.toInstant().atZone(ZoneOffset.systemDefault());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<h4 id="ZonedDateTime-转-Date"><a href="#ZonedDateTime-转-Date" class="headerlink" title="ZonedDateTime 转 Date"></a>ZonedDateTime 转 Date</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.WritingConverter;</span><br><span class="line"></span><br><span class="line">import java.time.ZonedDateTime;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-14 014 17:17</span><br><span class="line"> * description: ZonedDateTime 转 Date</span><br><span class="line"> */</span><br><span class="line">@WritingConverter</span><br><span class="line">public class ZonedDateTimeWriteConverter implements Converter<span class="tag">&lt;<span class="name">ZonedDateTime,</span> <span class="attr">Date</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Date convert(@NotNull ZonedDateTime zonedDateTime) {</span><br><span class="line">        System.out.println("ZonedDateTime 转 Date");</span><br><span class="line">        return Date.from(zonedDateTime.toInstant());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Mongodb配置"><a href="#Mongodb配置" class="headerlink" title="Mongodb配置"></a>Mongodb配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.common.mongodb.config;</span><br><span class="line"></span><br><span class="line">import com.mongodb.ConnectionString;</span><br><span class="line">import com.mongodb.MongoClientSettings;</span><br><span class="line">import com.mongodb.client.MongoClient;</span><br><span class="line">import com.mongodb.client.MongoClients;</span><br><span class="line">import com.demon.common.mongodb.config.properties.MongodbProperties;</span><br><span class="line">import com.demon.common.mongodb.convert.BigDecimalToDecimal128Converter;</span><br><span class="line">import com.demon.common.mongodb.convert.Decimal128ToBigDecimalConverter;</span><br><span class="line">import com.demon.common.mongodb.convert.ZonedDateTimeReadConverter;</span><br><span class="line">import com.demon.common.mongodb.convert.ZonedDateTimeWriteConverter;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.autoconfigure.AutoConfiguration;</span><br><span class="line">import org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.data.mongodb.MongoDatabaseFactory;</span><br><span class="line">import org.springframework.data.mongodb.MongoTransactionManager;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.SimpleMongoClientDatabaseFactory;</span><br><span class="line">import org.springframework.data.mongodb.core.convert.*;</span><br><span class="line">import org.springframework.data.mongodb.core.mapping.MongoMappingContext;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongodb配置</span><br><span class="line"> * https://www.mongodb.com/zh-cn/docs/manual/administration/connection-pool-overview/</span><br><span class="line"> *</span><br><span class="line"> * @author demon</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@AutoConfiguration</span><br><span class="line">@EnableCaching</span><br><span class="line">@EnableConfigurationProperties(MongodbProperties.class)</span><br><span class="line">public class MongodbConfiguration {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MongodbProperties mongodbProperties;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MongoDatabaseFactory mongoDatabaseFactory() {</span><br><span class="line">        MongoClientSettings.Builder builder = MongoClientSettings.builder();</span><br><span class="line">        // 设置应用程序的逻辑名称</span><br><span class="line">        builder.applicationName("yet-platform-saas");</span><br><span class="line">        // 设置应用</span><br><span class="line">        builder.applyConnectionString(new ConnectionString(mongodbProperties.getUri()));</span><br><span class="line">        // 连接池</span><br><span class="line">        builder.applyToConnectionPoolSettings(b -&gt; {</span><br><span class="line">            // 允许的最大连接数。这些连接在空闲时将保留在池中。一旦池耗尽，任何需要连接的操作都将阻塞等待可用连接 默认: 100</span><br><span class="line">            b.maxSize(100);</span><br><span class="line">            // 最小连接数。这些连接在空闲时将保留在池中，并且池将确保它至少包含这个最小数量 默认: 0</span><br><span class="line">            b.minSize(18);</span><br><span class="line">            // 池连接可以存活的最长时间。零值表示寿命没有限制。超过其生命周期的池连接将被关闭并在必要时由新连接替换</span><br><span class="line">            b.maxConnectionLifeTime(0, TimeUnit.SECONDS);</span><br><span class="line">            // 池连接的最大空闲时间。零值表示对空闲时间没有限制。超过其空闲时间的池连接将被关闭并在必要时由新连接替换</span><br><span class="line">            b.maxConnectionIdleTime(5, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">            b.maxWaitTime(120, TimeUnit.SECONDS);</span><br><span class="line">        });</span><br><span class="line">        MongoClient mongoClient = MongoClients.create(builder.build());</span><br><span class="line">        return new SimpleMongoClientDatabaseFactory(mongoClient, mongodbProperties.getDatabase());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MongoMappingContext mongoMappingContext() {</span><br><span class="line">        return new MongoMappingContext();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义 MongoTemplate</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MongoTemplate mongoTemplate(MongoDatabaseFactory mongoDatabaseFactory, MappingMongoConverter converter) {</span><br><span class="line">        return new MongoTemplate(mongoDatabaseFactory, converter);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    //配置 mongodb 事务管理器，能够让 mongodb 支持事务操作</span><br><span class="line">    @Bean</span><br><span class="line">    MongoTransactionManager mongoTransactionManager(MongoDatabaseFactory mongoDatabaseFactory) {</span><br><span class="line">        return new MongoTransactionManager(mongoDatabaseFactory);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义 MappingMongoConverter</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MappingMongoConverter mappingMongoConverter(MongoDatabaseFactory mongoDatabaseFactory, MongoMappingContext mongoMappingContext, MongoCustomConversions mongoCustomConversions) {</span><br><span class="line"></span><br><span class="line">        DbRefResolver dbRefResolver = new DefaultDbRefResolver(mongoDatabaseFactory);</span><br><span class="line">        MappingMongoConverter mappingMongoConverter = new MappingMongoConverter(dbRefResolver, mongoMappingContext);</span><br><span class="line"></span><br><span class="line">        // 自定义配置</span><br><span class="line">        mappingMongoConverter.setTypeMapper(new DefaultMongoTypeMapper(null)); // 移除 _class 字段</span><br><span class="line">        mappingMongoConverter.setCustomConversions(mongoCustomConversions); // 注册自定义转换器</span><br><span class="line">        mappingMongoConverter.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        return mappingMongoConverter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注册自定义类型转换器</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MongoCustomConversions mongoCustomConversions() {</span><br><span class="line"></span><br><span class="line">        return new MongoCustomConversions(Arrays.asList(</span><br><span class="line">                // 添加自定义转换器 - BigDecimal 类型</span><br><span class="line">                new BigDecimalToDecimal128Converter(), new Decimal128ToBigDecimalConverter(),</span><br><span class="line">                // 添加自定义转换器 - ZonedDateTime 类型</span><br><span class="line">                new ZonedDateTimeReadConverter(), new ZonedDateTimeWriteConverter()</span><br><span class="line">        ));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="方法使用"><a href="#方法使用" class="headerlink" title="方法使用"></a>方法使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">    @Resource</span><br><span class="line">    private MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.新增</span><br><span class="line">    mongoTemplate.insert()</span><br><span class="line">    </span><br><span class="line">2.删除</span><br><span class="line">    mongoTemplate.remove()</span><br><span class="line">    </span><br><span class="line">2.修改</span><br><span class="line">    mongoTemplate.updateMulti()</span><br><span class="line">    </span><br><span class="line">2.查询</span><br><span class="line">    mongoTemplate.find()</span><br><span class="line">    </span><br><span class="line">2.统计</span><br><span class="line">    mongoTemplate.count()</span><br></pre></td></tr></tbody></table></figure></div>

<h3 id="Query使用"><a href="#Query使用" class="headerlink" title="Query使用"></a>Query使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">// 创建条件对象</span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line"></span><br><span class="line">// 等于</span><br><span class="line">criteria.and("_id").is(123457);</span><br><span class="line"></span><br><span class="line">// 模糊查询 忽略大小写，匹配正则</span><br><span class="line">criteria.and("userName").regex(Pattern.compile("^.*W.*$", Pattern.CASE_INSENSITIVE));</span><br><span class="line"></span><br><span class="line">// 查询多个字段  等于  或</span><br><span class="line">criteria.orOperator(Criteria.where("_id").is("123457"), Criteria.where("_id").is("123456"));</span><br><span class="line"></span><br><span class="line">// 查询日期范围  大于等于createTime  小于等于updateTime 并且，传入当前时间即可，mongodb 会自动转换UTC时间格式处理</span><br><span class="line">criteria.andOperator(Criteria.where("createTime").gte(DateUtils.parseDate("2025-08-11 09:41:23.449")), Criteria.where("updateTime").lte(DateUtils.parseDate("2025-08-18 11:41:23.449")));</span><br><span class="line"></span><br><span class="line">// 查询int数值范围  大于等于22  小于等于33 并且，</span><br><span class="line">criteria.and("age").gte(22).lte(33);</span><br><span class="line"></span><br><span class="line">// 查询BigDecimal数值范围  大于等于10.5  小于等于12.5 并且</span><br><span class="line">criteria.and("balance").gte(10.5).lte(12.5);</span><br><span class="line"></span><br><span class="line">// 匹配多个内容</span><br><span class="line">criteria.and("age").in(Arrays.asList(22, 33));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 组装SQL语句</span><br><span class="line">Query query = new Query(criteria);</span><br><span class="line">// 查询返回指定字段 (自定义列表)</span><br><span class="line">query.fields().include("_id", "userName", "nickName", "age", "createTime");</span><br><span class="line">// 排序，这里以age升序为例</span><br><span class="line">query.with(Sort.by(Sort.Direction.ASC, "age"));</span><br><span class="line"></span><br><span class="line">// 分页查询，page为当前页面，size为当前页的条数，初始page=0</span><br><span class="line">query.with(PageRequest.of(page, size));</span><br></pre></td></tr></tbody></table></figure></div>

<p><a href="/2025/08/1755659266090/1755659266090/">工具类</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>MongoDb</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之TableView工具</title>
    <url>/2025/12/1764903803268/1764903803268/</url>
    <content><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p>
<h2 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h2><p><img src="/2025/12/1764903803268/1764903803268/20251205112533.png" alt="20251205112533"></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight"><table><tbody><tr><td class="code"><pre><span class="line">// 初始化 表格样式</span><br><span class="line">TableViewUi<span class="tag">&lt;<span class="name">TableViewDemo</span>&gt;</span> tableViewUi = new TableViewUi<span class="tag">&lt;&gt;</span>(true);</span><br><span class="line">// 加载表格列表0</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn0 = tableViewUi.addTableColumn("序号");</span><br><span class="line">nameTableColumn0.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getIndex()));</span><br><span class="line">nameTableColumn0.setMinWidth(50);</span><br><span class="line">nameTableColumn0.setMaxWidth(50);</span><br><span class="line">// 加载表格列表1</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn1 = tableViewUi.addTableColumn("姓名");</span><br><span class="line">nameTableColumn1.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getName()));</span><br><span class="line">nameTableColumn1.setMinWidth(60);</span><br><span class="line">nameTableColumn1.setMaxWidth(80);</span><br><span class="line">// 加载表格列表2</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn2 = tableViewUi.addTableColumn("年龄");</span><br><span class="line">nameTableColumn2.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getAge()));</span><br><span class="line">nameTableColumn2.setMinWidth(60);</span><br><span class="line">nameTableColumn2.setMaxWidth(80);</span><br><span class="line">// 加载表格数据</span><br><span class="line">List<span class="tag">&lt;<span class="name">TableViewDemo</span>&gt;</span> tableViewDemoList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">for (int i = 0; i <span class="tag">&lt;<span class="name">20</span> ; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">    <span class="attr">tableViewDemoList.add</span>(<span class="attr">new</span> <span class="attr">TableViewDemo</span>()<span class="attr">.setIndex</span>(<span class="attr">String.valueOf</span>(<span class="attr">i</span>+<span class="attr">1</span>))<span class="attr">.setName</span>("张三"+<span class="attr">i</span>)<span class="attr">.setAge</span>(<span class="attr">String.valueOf</span>(<span class="attr">ThreadLocalRandom.current</span>()<span class="attr">.nextInt</span>(<span class="attr">10</span>, <span class="attr">100</span>))));</span></span><br><span class="line"><span class="tag">}</span></span><br><span class="line"><span class="tag"><span class="attr">tableViewUi.initData</span>(<span class="attr">tableViewDemoList</span>);</span></span><br><span class="line"><span class="tag">// 将表格添加到容器组件</span></span><br><span class="line">TableView&lt;TableViewDemo&gt; tableView = tableViewUi.getTableView();</span><br></pre></td></tr></tbody></table></figure>

<h2 id="TableViewUi"><a href="#TableViewUi" class="headerlink" title="TableViewUi"></a>TableViewUi</h2><p>创建一个表格UI，快速加载表格数据</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import javafx.beans.InvalidationListener;</span><br><span class="line">import javafx.beans.value.ChangeListener;</span><br><span class="line">import javafx.beans.value.ObservableValue;</span><br><span class="line">import javafx.collections.FXCollections;</span><br><span class="line">import javafx.collections.ObservableList;</span><br><span class="line">import javafx.scene.control.CheckBox;</span><br><span class="line">import javafx.scene.control.TableCell;</span><br><span class="line">import javafx.scene.control.TableColumn;</span><br><span class="line">import javafx.scene.control.TableView;</span><br><span class="line">import javafx.util.Callback;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  author: Demon</span><br><span class="line"> *  date: 2025-12-04 004 14:48</span><br><span class="line"> *  description: 表格UI</span><br><span class="line"> */ </span><br><span class="line">public class TableViewUi<span class="tag">&lt;<span class="name">T</span> <span class="attr">extends</span> <span class="attr">TableViewUi.TableViewData</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    private TableView<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableView = new TableView<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    private CheckBox checkBoxAll = new CheckBox("全选");</span><br><span class="line"></span><br><span class="line">    public TableViewUi(boolean isNeedCheckBoxAll) {</span><br><span class="line">        tableView.getStylesheets().add("css/table.css");</span><br><span class="line">        this.tableView.setEditable(false);</span><br><span class="line">        this.tableView.setColumnResizePolicy((param) -&gt; true);</span><br><span class="line">        this.tableView.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY);</span><br><span class="line">        this.tableView.setFocusTraversable(false);</span><br><span class="line">        if (isNeedCheckBoxAll) {</span><br><span class="line">            this.checkBoxAll.setText("");</span><br><span class="line">            this.checkBoxAll.setSelected(false);</span><br><span class="line">            this.checkBoxAll.setOnAction(event -&gt; this.getSelectAllEvent());</span><br><span class="line">            // 第一列</span><br><span class="line">            TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> checkBoxTableColumn = new TableColumn<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            checkBoxTableColumn.setCellValueFactory(cellData -&gt; cellData.getValue().getCb().getCheckBox());</span><br><span class="line">            checkBoxTableColumn.setCellFactory(this.getTableCellFactoryToCheckBox());</span><br><span class="line">            checkBoxTableColumn.setMinWidth(50);</span><br><span class="line">            checkBoxTableColumn.setMaxWidth(50);</span><br><span class="line">            //checkBoxTableColumn.setStyle("-fx-alignment:center");</span><br><span class="line">            checkBoxTableColumn.setGraphic(checkBoxAll);</span><br><span class="line">            checkBoxTableColumn.setSortable(false);</span><br><span class="line">            tableView.getColumns().add(checkBoxTableColumn);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableView<span class="tag">&lt;<span class="name">T</span>&gt;</span> getTableView() {</span><br><span class="line">        return tableView;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加列：</span><br><span class="line">     * tableColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue()));</span><br><span class="line">     * tableColumn.setMinWidth(60);</span><br><span class="line">     * tableColumn.setMaxWidth(80);</span><br><span class="line">     *</span><br><span class="line">     * @param tableColumnName 列名</span><br><span class="line">     */</span><br><span class="line">    public TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">String</span>&gt;</span> addTableColumn(String tableColumnName) {</span><br><span class="line">        TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">String</span>&gt;</span> tableColumn = new TableColumn<span class="tag">&lt;&gt;</span>(tableColumnName);</span><br><span class="line">        tableColumn.setVisible(true);</span><br><span class="line">        this.tableView.getColumns().add(tableColumn);</span><br><span class="line">        return tableColumn;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void initData(List<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableViewList) {</span><br><span class="line">        tableView.getItems().clear();</span><br><span class="line">        tableView.setItems(FXCollections.observableArrayList(tableViewList));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public List<span class="tag">&lt;<span class="name">T</span>&gt;</span> getTableViewToSelectData() {</span><br><span class="line">        List<span class="tag">&lt;<span class="name">T</span>&gt;</span> dataList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableViewItems = tableView.getItems();</span><br><span class="line">        if (tableViewItems.size() &gt; 0) {</span><br><span class="line">            for (T t : tableViewItems) {</span><br><span class="line">                if (t.getCb().isSelected()) {</span><br><span class="line">                    dataList.add(t);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return dataList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化复选框-监听-所有checkbox复选框都勾选则全选框勾选，</span><br><span class="line">     * 所有checkbox复选框不勾选则全选框不勾选</span><br><span class="line">     *</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    private Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt; getTableCellFactoryToCheckBox() {</span><br><span class="line">        return new Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt;() {</span><br><span class="line">            @Override</span><br><span class="line">            public TableCell<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> call(TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> param) {</span><br><span class="line">                return new TableCell<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span>() {</span><br><span class="line">                    @Override</span><br><span class="line">                    public void updateItem(CheckBox item, boolean empty) {</span><br><span class="line">                        super.updateItem(item, empty);</span><br><span class="line">                        setGraphic(item);</span><br><span class="line">                        if (item != null) {</span><br><span class="line">                            item.selectedProperty().addListener((observable, oldValue, newValue) -&gt; {</span><br><span class="line">                                boolean flagSelectAll = true;</span><br><span class="line">                                ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> items2 = tableView.getItems();</span><br><span class="line">                                for (T t : items2) {</span><br><span class="line">                                    if (!t.getCb().isSelected()) {</span><br><span class="line">                                        flagSelectAll = false;</span><br><span class="line">                                        break;</span><br><span class="line">                                    }</span><br><span class="line">                                }</span><br><span class="line">                                checkBoxAll.setSelected(flagSelectAll);</span><br><span class="line">                            });</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                };</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void getSelectAllEvent() {</span><br><span class="line">        ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> items = tableView.getItems();</span><br><span class="line">        if (checkBoxAll.isSelected()) {</span><br><span class="line">            for (T t : items) {</span><br><span class="line">                t.getCb().setCheckbox(true);</span><br><span class="line">            }</span><br><span class="line">            checkBoxAll.setSelected(true);</span><br><span class="line">        } else {</span><br><span class="line">            for (T t : items) {</span><br><span class="line">                t.getCb().setCheckbox(false);</span><br><span class="line">            }</span><br><span class="line">            checkBoxAll.setSelected(false);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class TableViewData {</span><br><span class="line"></span><br><span class="line">        private CheckboxUi cb = new CheckboxUi();</span><br><span class="line"></span><br><span class="line">        CheckboxUi getCb() {</span><br><span class="line">            return cb;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static class CheckboxUi {</span><br><span class="line"></span><br><span class="line">        private CheckBox checkbox = new CheckBox();</span><br><span class="line"></span><br><span class="line">        ObservableValue<span class="tag">&lt;<span class="name">CheckBox</span>&gt;</span> getCheckBox() {</span><br><span class="line">            return new ObservableValue<span class="tag">&lt;<span class="name">CheckBox</span>&gt;</span>() {</span><br><span class="line">                @Override</span><br><span class="line">                public CheckBox getValue() {</span><br><span class="line">                    return checkbox;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void addListener(ChangeListener<span class="php"><span class="meta">&lt;?</span> super CheckBox&gt; listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void removeListener(ChangeListener<span class="meta">&lt;?</span> super CheckBox&gt; listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void addListener(InvalidationListener listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void removeListener(InvalidationListener listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"><span class="php">            };</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"></span><br><span class="line"><span class="php">        Boolean isSelected() {</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> checkbox.isSelected();</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"></span><br><span class="line"><span class="php">        void setCheckbox(boolean value) {</span></span><br><span class="line"><span class="php">            checkbox.setSelected(value);</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"><span class="php">}</span></span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="TableViewDemo"><a href="#TableViewDemo" class="headerlink" title="TableViewDemo"></a>TableViewDemo</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">import com.demon.ui.TableViewUi;</span><br><span class="line"></span><br><span class="line">public class TableViewDemo extends TableViewUi.TableViewData {</span><br><span class="line">    private String index;</span><br><span class="line">    private String name;</span><br><span class="line">    private String age;</span><br><span class="line">    public String getIndex() {</span><br><span class="line">        return index;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setIndex(String index) {</span><br><span class="line">        this.index = index;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getName() {</span><br><span class="line">        return name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setName(String name) {</span><br><span class="line">        this.name = name;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getAge() {</span><br><span class="line">        return age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setAge(String age) {</span><br><span class="line">        this.age = age;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>TableView</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaFx之Alert提示框</title>
    <url>/2025/12/1764905210595/1764905210595/</url>
    <content><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getAlertToInfo(this.window, "提示", "没有选中的数据", null);</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getAlertToConfig(this.getWindow(), "信息", "选中的数据", jsonString);</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">File file = new File("C:\\Users\\Demon\\Desktop\\将近酒.txt");</span><br><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getOpenFile(this.window, file.getName(), file.getAbsolutePath());</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">    if (buttonType.getButtonData() == ButtonType.FINISH.getButtonData()) {</span><br><span class="line">        try {</span><br><span class="line">            Desktop.getDesktop().open(file);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">File file = new File("C:\\Users\\Demon\\Desktop");</span><br><span class="line">String fileName = "test";</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> filterMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">filterMap.put("Excel 工作簿", "*.xlsx");</span><br><span class="line">filterMap.put("Excel 97-2003 工作簿", "*.xls");</span><br><span class="line">try {</span><br><span class="line">    File openFileDir = SystemAlert.getOpenDir(this.window, file, fileName, filterMap);</span><br><span class="line">    System.out.println(openFileDir);</span><br><span class="line">} catch (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div>

<h2 id="SystemAlert"><a href="#SystemAlert" class="headerlink" title="SystemAlert"></a>SystemAlert</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="code"><pre><span class="line">package com.demon.ui;</span><br><span class="line"></span><br><span class="line">import javafx.scene.Node;</span><br><span class="line">import javafx.scene.control.*;</span><br><span class="line">import javafx.stage.FileChooser;</span><br><span class="line">import javafx.stage.Window;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-12-04 004 15:31</span><br><span class="line"> * description: 提示框   Alert.AlertType  自行扩展</span><br><span class="line"> */</span><br><span class="line">public class SystemAlert {</span><br><span class="line"></span><br><span class="line">    // 提示 INFORMATION</span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getAlertToInfo(Window window, String title, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span><br><span class="line">        alert.setTitle(title);</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        alert.getButtonTypes().set(0, ButtonType.CLOSE);</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // 提示 CONFIRMATION</span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getAlertToConfig(Window window, String title, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span><br><span class="line">        alert.setTitle(title);</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        alert.getButtonTypes().set(0, new ButtonType("确定", ButtonType.OK.getButtonData()));</span><br><span class="line">        alert.getButtonTypes().set(1, new ButtonType("取消", ButtonType.NO.getButtonData()));</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getOpenFile(Window window, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span><br><span class="line">        alert.setTitle("打开文件");</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        ButtonType finalButtonType = new ButtonType("打开", ButtonType.FINISH.getButtonData());</span><br><span class="line">        ButtonType closeButtonType = new ButtonType("关闭", ButtonType.CLOSE.getButtonData());</span><br><span class="line">        alert.getButtonTypes().clear();</span><br><span class="line">        alert.getButtonTypes().add(0, finalButtonType);</span><br><span class="line">        alert.getButtonTypes().add(1, closeButtonType);</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 弹窗选择目录框</span><br><span class="line">     *</span><br><span class="line">     * @param fileName  文件名（不含后缀）</span><br><span class="line">     * @param filterMap key=描述,value=过滤</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static File getOpenDir(Window window, File file, String fileName, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> filterMap) throws IOException {</span><br><span class="line">        FileChooser fileChooser = new FileChooser();</span><br><span class="line">        fileChooser.setTitle("选择目录");</span><br><span class="line">        //打开选择目录，设置默认文件名</span><br><span class="line">        fileChooser.setInitialFileName(fileName);</span><br><span class="line">        //打开选择目录，设置默认路径为桌面</span><br><span class="line">        //fileChooser.setInitialDirectory(FileSystemView.getFileSystemView().getHomeDirectory());</span><br><span class="line">        fileChooser.setInitialDirectory(file);</span><br><span class="line">        //打开选择目录，设置过滤目录文件</span><br><span class="line">        if (filterMap != null &amp;&amp; filterMap.size() &gt; 0) {</span><br><span class="line">            for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : filterMap.entrySet()) {</span><br><span class="line">                String description = entry.getKey(), extensions = entry.getValue();</span><br><span class="line">                fileChooser.getExtensionFilters().add(new FileChooser.ExtensionFilter(description, extensions));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return fileChooser.showSaveDialog(window);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Dialog getDialog(Window window, String title, Node content) {</span><br><span class="line">        Dialog dialog = new Dialog<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        dialog.setTitle(title);</span><br><span class="line">        dialog.setHeaderText(null);</span><br><span class="line">        ButtonType closeButtonType = new ButtonType("关闭", ButtonBar.ButtonData.CANCEL_CLOSE);</span><br><span class="line">        dialog.getDialogPane().getButtonTypes().addAll(closeButtonType);</span><br><span class="line">        //添加组件</span><br><span class="line">        dialog.getDialogPane().setContent(content);</span><br><span class="line">        dialog.initOwner(window);</span><br><span class="line">        //隐藏按钮</span><br><span class="line">        Node closeButton = dialog.getDialogPane().lookupButton(closeButtonType);</span><br><span class="line">        closeButton.setVisible(false);</span><br><span class="line">        return dialog;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 关闭当前弹窗面板</span><br><span class="line">     */</span><br><span class="line">    public static void getCloseDialogPane(Button closeBtn) {</span><br><span class="line">        DialogPane dialogPane = (DialogPane) closeBtn.getScene().getRoot();</span><br><span class="line">        for (ButtonType bt : dialogPane.getButtonTypes()) {</span><br><span class="line">            if (bt.getButtonData() == ButtonBar.ButtonData.CANCEL_CLOSE) {</span><br><span class="line">                closeBtn = (Button) dialogPane.lookupButton(bt);</span><br><span class="line">                closeBtn.fire();</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>]]></content>
      <categories>
        <category>JavaFx</category>
      </categories>
      <tags>
        <tag>Alert</tag>
      </tags>
  </entry>
</search>
