<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zhuqiaolun - 个人博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.zhuqiaolun.com/"/>
  <updated>2025-02-13T09:13:40.119Z</updated>
  <id>https://www.zhuqiaolun.com/</id>
  
  <author>
    <name>十二</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Windows中同时安装MySQL5和MySQL8</title>
    <link href="https://www.zhuqiaolun.com/2025/02/1739425332925/1739425332925/"/>
    <id>https://www.zhuqiaolun.com/2025/02/1739425332925/1739425332925/</id>
    <published>2025-02-13T05:42:12.000Z</published>
    <updated>2025-02-13T09:13:40.119Z</updated>
    
    <content type="html"><![CDATA[<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>官网地址：<a href="https://www.mysql.com/" target="_blank" rel="noopener">https://www.mysql.com/</a><br>下载地址：<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener">https://downloads.mysql.com/archives/community/</a></p><h4 id="1-下载MySql-5-7-24"><a href="#1-下载MySql-5-7-24" class="headerlink" title="1.下载MySql-5.7.24"></a>1.下载MySql-5.7.24</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213134906.png" alt="20250213134906"></p><h4 id="2-下载MySql-8-0-16"><a href="#2-下载MySql-8-0-16" class="headerlink" title="2.下载MySql-8.0.16"></a>2.下载MySql-8.0.16</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213135151.png" alt="20250213135151"></p><h2 id="解压文件并配置环境变量"><a href="#解压文件并配置环境变量" class="headerlink" title="解压文件并配置环境变量"></a>解压文件并配置环境变量</h2><p>下载下来的文件是压缩包，解压缩放在系统盘符目录下，并配置配置环境变量：MYSQL5_HOME,MYSQL8_HOME，同时在PATH内添加，<br><img src="/2025/02/1739425332925/1739425332925/20250213142910.png" alt="20250213142910"></p><h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><h3 id="安装MySQL5"><a href="#安装MySQL5" class="headerlink" title="安装MySQL5"></a>安装MySQL5</h3><p>1.创建必要文件 my.ini</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">innodb_flush_method=normal</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-5.7.24-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不要手动创建，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-5.7.24-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"># 连接时间</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br><span class="line"></span><br><span class="line"># 关闭5.7 密码验证</span><br><span class="line"># validate_password=off</span><br></pre></td></tr></tbody></table></figure></div><p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL5的 bin 路径下，输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div><p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213145411.png" alt="20250213145411"></p><p>3.安装MySQL5服务<br>输入命令</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --install MYSQL5</span><br></pre></td></tr></tbody></table></figure></div><p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL8冲突）<br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213145744.png" alt="20250213145744"></p><p>4.开启MySQL5服务<br>输入命令：net start MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213150037.png" alt="20250213150037"></p><p>5.登录MySQL5修改密码并开启远程访问</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3306 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问：GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2025/02/1739425332925/1739425332925/20250213153023.png" alt="20250213153023"></p><h3 id="安装MySQL8"><a href="#安装MySQL8" class="headerlink" title="安装MySQL8"></a>安装MySQL8</h3><ol><li>创建必要文件 my.ini<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3308端口</span><br><span class="line">port = 3308</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-8.0.16-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-8.0.16-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"># 绑定到所有IP地址</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line"># 连接时间一年</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br></pre></td></tr></tbody></table></figure></div></li></ol><p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL8的 bin 路径下，输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div><p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213153903.png" alt="20250213153903"></p><p>3.安装MySQL8服务<br>输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --install MYSQL8</span><br></pre></td></tr></tbody></table></figure></div><p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL5冲突）<br><img src="/2025/02/1739425332925/1739425332925/20250213153321.png" alt="20250213153321"><br><span style="color:red">由于在安装服务的时候 会使用MYSQL5的目录下的mysqld文件，故需要将注册表的内容 变更为MYSQL8的目录下的mysqld文件</span><br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155551.png" alt="20250213155551"></p><p>4.开启MySQL8服务<br>输入命令：net start MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155713.png" alt="20250213155713"></p><p>5.登录MySQL8修改密码并开启远程访问</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3308 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问</span><br><span class="line"># 使用mysql数据库</span><br><span class="line">use mysql;</span><br><span class="line"># 查看用户及权限</span><br><span class="line">select user,host from mysql.user;</span><br><span class="line"># 更新root用户的host属性为%</span><br><span class="line">update user set host='%' where user='root';</span><br><span class="line"># 刷新下权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"># 再执行就可以了，就可以使用navicat连接了</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;</span><br><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2025/02/1739425332925/1739425332925/20250213160902.png" alt="20250213160902"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Windows中同时安装MySQL5和MySQL8
    
    </summary>
    
    
      <category term="MySql" scheme="https://www.zhuqiaolun.com/categories/MySql/"/>
    
    
      <category term="MySql" scheme="https://www.zhuqiaolun.com/tags/MySql/"/>
    
  </entry>
  
  <entry>
    <title>【log4j.xml】日志之 log4j2 配置</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734677869669/1734677869669/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734677869669/1734677869669/</id>
    <published>2024-12-20T06:57:49.000Z</published>
    <updated>2024-12-20T08:05:08.347Z</updated>
    
    <content type="html"><![CDATA[<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote><p>private static final Logger log = LogManager.getLogger(App.class);</p></blockquote><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line"></span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h2><p><a href="/2024/12/1734417756349/1734417756349/">编程式配置</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="单文件输出"><a href="#单文件输出" class="headerlink" title="单文件输出"></a>单文件输出</h2><p><a href="/2024/12/1734663400620/1734663400620/">编程式配置</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"FILE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/app.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/app.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"FILE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="多文件输出"><a href="#多文件输出" class="headerlink" title="多文件输出"></a>多文件输出</h2><p><a href="/2024/12/1734663522947/1734663522947/">编程式配置</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"TRACE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/trace.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/trace.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"TRACE"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"DEBUG_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/debug.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/debug.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"INFO_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/info.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/info.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"WARN_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/warn.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/warn.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"ERROR_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/error.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/error.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"TRACE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"DEBUG_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（多文件输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734663522947/1734663522947/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734663522947/1734663522947/</id>
    <published>2024-12-20T02:58:42.000Z</published>
    <updated>2024-12-20T07:59:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>多文件输出：输出指定级别及以上的日志信息且写入对应的日志级别文件<br><a href="/2024/12/1734677869669/1734677869669/#多文件输出">XML配置#多文件输出</a></p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.LevelMatchFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private boolean traceFlag;</span><br><span class="line">    private boolean debugFlag;</span><br><span class="line">    private boolean infoFlag;</span><br><span class="line">    private boolean warnFlag;</span><br><span class="line">    private boolean errorFlag;</span><br><span class="line">    private boolean fatalFlag;</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(boolean traceFlag, boolean debugFlag, boolean infoFlag, boolean warnFlag, boolean errorFlag, boolean fatalFlag, List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList) {</span><br><span class="line">        this.traceFlag = traceFlag;</span><br><span class="line">        this.debugFlag = debugFlag;</span><br><span class="line">        this.infoFlag = infoFlag;</span><br><span class="line">        this.warnFlag = warnFlag;</span><br><span class="line">        this.errorFlag = errorFlag;</span><br><span class="line">        this.fatalFlag = fatalFlag;</span><br><span class="line">        this.packLoggerList = packLoggerList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static Appender getFileAppender(PatternLayout layout, String logRootPath, Level level, String appenderName) {</span><br><span class="line">        //  日志文件名，根据日志级别取名</span><br><span class="line">        String fileName = level.toString().toLowerCase();</span><br><span class="line">        return RollingFileAppender.newBuilder().setName(appenderName)</span><br><span class="line">                // 过滤日志文件内容</span><br><span class="line">                .setFilter(LevelMatchFilter.newBuilder().setLevel(level).setOnMatch(Filter.Result.ACCEPT).setOnMismatch(Filter.Result.DENY).build())</span><br><span class="line">                // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                // 设置日志输出格式</span><br><span class="line">                .setLayout(layout)</span><br><span class="line">                // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     *</span><br><span class="line">     * @param logRootPath ，传 null 则不输出文件日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">AppenderRef</span>&gt;</span> appenderRefMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">Appender</span>&gt;</span> appenderMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line"></span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            if (traceFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String traceAppenderName = "TRACE_APPENDER";</span><br><span class="line">                Appender traceAppender = getFileAppender(layout, logRootPath, Level.TRACE, traceAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.TRACE, AppenderRef.createAppenderRef(traceAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.TRACE, traceAppender);</span><br><span class="line">            }</span><br><span class="line">            if (debugFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String debugAppenderName = "DEBUG_APPENDER";</span><br><span class="line">                Appender debugAppender = getFileAppender(layout, logRootPath, Level.DEBUG, debugAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.DEBUG, AppenderRef.createAppenderRef(debugAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.DEBUG, debugAppender);</span><br><span class="line">            }</span><br><span class="line">            if (infoFlag) {</span><br><span class="line">                // INFO</span><br><span class="line">                String infoAppenderName = "INFO_APPENDER";</span><br><span class="line">                Appender infoAppender = getFileAppender(layout, logRootPath, Level.INFO, infoAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.INFO, AppenderRef.createAppenderRef(infoAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.INFO, infoAppender);</span><br><span class="line">            }</span><br><span class="line">            if (warnFlag) {</span><br><span class="line">                // WARN</span><br><span class="line">                String warnAppenderName = "WARN_APPENDER";</span><br><span class="line">                Appender warnAppender = getFileAppender(layout, logRootPath, Level.WARN, warnAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.WARN, AppenderRef.createAppenderRef(warnAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.WARN, warnAppender);</span><br><span class="line">            }</span><br><span class="line">            if (errorFlag) {</span><br><span class="line">                // ERROR</span><br><span class="line">                String errorAppenderName = "ERROR_APPENDER";</span><br><span class="line">                Appender errorAppender = getFileAppender(layout, logRootPath, Level.ERROR, errorAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.ERROR, AppenderRef.createAppenderRef(errorAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.ERROR, errorAppender);</span><br><span class="line">            }</span><br><span class="line">            if (fatalFlag) {</span><br><span class="line">                // FATAL</span><br><span class="line">                String fatalAppenderName = "FATAL_APPENDER";</span><br><span class="line">                Appender fatalAppender = getFileAppender(layout, logRootPath, Level.FATAL, fatalAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.FATAL, AppenderRef.createAppenderRef(fatalAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.FATAL, fatalAppender);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>(appenderRefMap.values());</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderMap.values()) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        // 选配</span><br><span class="line">        if (packLoggerList.size() &gt; 0) {</span><br><span class="line">            for (PackLoggerVo packLoggerVo : packLoggerList) {</span><br><span class="line">                List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                if (packLoggerVo.isConsoleFlag()) {</span><br><span class="line">                    appenderRefListTemp.add(consoleAppenderRef);</span><br><span class="line">                    appenderListTemp.add(consoleAppender);</span><br><span class="line">                }</span><br><span class="line">                if (packLoggerVo.isFileFlag()) {</span><br><span class="line">                    Level[] packLoggerVoLevels = packLoggerVo.getLevels();</span><br><span class="line">                    for (Level loggerVoLevel : packLoggerVoLevels) {</span><br><span class="line">                        if (appenderRefMap.containsKey(loggerVoLevel)) {</span><br><span class="line">                            appenderRefListTemp.add(appenderRefMap.get(loggerVoLevel));</span><br><span class="line">                            appenderListTemp.add(appenderMap.get(loggerVoLevel));</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (appenderRefListTemp.size() &gt; 0) {</span><br><span class="line">                    LoggerConfig loggerConfig2 = LoggerConfig.createLogger(false, Level.ALL, packLoggerVo.getPackageName(), "true", appenderRefListTemp.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">                    for (Appender appender : appenderListTemp) {</span><br><span class="line">                        loggerConfig2.addAppender(appender, null, null);</span><br><span class="line">                    }</span><br><span class="line">                    config.addLogger(packLoggerVo.getPackageName(), loggerConfig2);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private boolean traceFlag = false;</span><br><span class="line">        private boolean debugFlag = false;</span><br><span class="line">        private boolean infoFlag = false;</span><br><span class="line">        private boolean warnFlag = false;</span><br><span class="line">        private boolean errorFlag = false;</span><br><span class="line">        private boolean fatalFlag = false;</span><br><span class="line">        private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">        public Builder withTraceFlag(final boolean traceFlag) {</span><br><span class="line">            this.traceFlag = traceFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withDebugFlag(boolean debugFlag) {</span><br><span class="line">            this.debugFlag = debugFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withInfoFlag(boolean infoFlag) {</span><br><span class="line">            this.infoFlag = infoFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withWarnFlag(boolean warnFlag) {</span><br><span class="line">            this.warnFlag = warnFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withErrorFlag(boolean errorFlag) {</span><br><span class="line">            this.errorFlag = errorFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withFatalFlag(boolean fatalFlag) {</span><br><span class="line">            this.fatalFlag = fatalFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder addPackLogger(final String packageName, boolean consoleFlag, boolean fileFlag, final Level... levels) {</span><br><span class="line">            if (packageName != null &amp;&amp; packageName.length() &gt; 0) {</span><br><span class="line">                packLoggerList.add(new PackLoggerVo().setPackageName(packageName).setConsoleFlag(consoleFlag).setFileFlag(fileFlag).setLevels(levels));</span><br><span class="line">            }</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(traceFlag, debugFlag, infoFlag, warnFlag, errorFlag, fatalFlag, packLoggerList);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class PackLoggerVo {</span><br><span class="line">        private String packageName;</span><br><span class="line">        private boolean consoleFlag;</span><br><span class="line">        private boolean fileFlag;</span><br><span class="line">        private Level[] levels;</span><br><span class="line"></span><br><span class="line">        String getPackageName() {</span><br><span class="line">            return packageName;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setPackageName(String packageName) {</span><br><span class="line">            this.packageName = packageName;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isConsoleFlag() {</span><br><span class="line">            return consoleFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setConsoleFlag(boolean consoleFlag) {</span><br><span class="line">            this.consoleFlag = consoleFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isFileFlag() {</span><br><span class="line">            return fileFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setFileFlag(boolean fileFlag) {</span><br><span class="line">            this.fileFlag = fileFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Level[] getLevels() {</span><br><span class="line">            return levels;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setLevels(Level[] levels) {</span><br><span class="line">            this.levels = levels;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>定义日志配置1：控制台输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init();</span><br></pre></td></tr></tbody></table></figure></div><p>定义日志配置2：文件输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div><p>定义日志配置2：过滤包且指定日志级别输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .addPackLogger("cn.hutool.log", true, false, Level.TRACE, Level.DEBUG, Level.INFO)</span><br><span class="line">                    .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div><h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">                        </span><br><span class="line">        // 定义日志配置</span><br><span class="line">        Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                   .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true).withFatalFlag(false)</span><br><span class="line">                   .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                   .build().init("D:\\logs");</span><br><span class="line">                   </span><br><span class="line">        // 输出日志</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（单文件输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734663400620/1734663400620/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734663400620/1734663400620/</id>
    <published>2024-12-20T02:56:40.000Z</published>
    <updated>2024-12-20T07:59:47.303Z</updated>
    
    <content type="html"><![CDATA[<p>单文件输出：输出指定级别及以上的日志信息且写入同一个文件<br><a href="/2024/12/1734677869669/1734677869669/#单文件输出">XML配置#单文件输出</a></p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.ThresholdFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void init() {</span><br><span class="line">        this.init(null, null);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath, String logName) {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        appenderList.add(consoleAppender);</span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            String fileAppenderName = "FILE_APPENDER";</span><br><span class="line">            AppenderRef fileAppenderRef = AppenderRef.createAppenderRef(fileAppenderName, null, null);</span><br><span class="line">            //  日志文件名，根据日志级别取名</span><br><span class="line">            String fileName = "logs" + File.separator + ((logName != null &amp;&amp; logName.length() &gt; 0) ? logName : "app");</span><br><span class="line">            Appender fileAppender = RollingFileAppender.newBuilder().setName(fileAppenderName)</span><br><span class="line">                    // 过滤日志文件内容</span><br><span class="line">                    .setFilter(ThresholdFilter.createFilter(level, Filter.Result.ACCEPT, Filter.Result.DENY))</span><br><span class="line">                    // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                    .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                    // 设置日志输出格式</span><br><span class="line">                    .setLayout(layout)</span><br><span class="line">                    // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                    .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                    // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                    .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                    // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                    .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                    .build();</span><br><span class="line">            appenderRefList.add(fileAppenderRef);</span><br><span class="line">            appenderList.add(fileAppender);</span><br><span class="line">        }</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderList) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // Log4j2Util.newBuilder().build().init();</span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLevel(Level.INFO).build().init("D:\\logs","app");</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（控制台输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734417756349/1734417756349/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734417756349/1734417756349/</id>
    <published>2024-12-17T06:42:36.000Z</published>
    <updated>2024-12-20T07:59:39.842Z</updated>
    
    <content type="html"><![CDATA[<p>控制台输出<br><a href="/2024/12/1734677869669/1734677869669/#控制台输出">XML配置#控制台输出</a></p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init() {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef[] appenderRefs = {AppenderRef.createAppenderRef(consoleAppenderName, null, null)};</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefs, null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, level, null);</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLoggerLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLoggerLevel(Level.INFO).build().init();</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>innosetup进行exe打包成安装文件</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723804410469/1723804410469/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723804410469/1723804410469/</id>
    <published>2024-08-16T10:33:30.000Z</published>
    <updated>2025-02-07T10:07:54.893Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>官网地址：<a href="https://jrsoftware.org/" target="_blank" rel="noopener">https://jrsoftware.org/</a><br>下载地址：<a href="https://files.jrsoftware.org/is/6/" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/</a><br>文件下载：<a href="https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe</a></p><p>按照默认选择 一路点击“Next” 即可安装完成。</p><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>待续···</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      innosetup进行exe打包成安装文件
    
    </summary>
    
    
      <category term="J-Package" scheme="https://www.zhuqiaolun.com/categories/J-Package/"/>
    
    
      <category term="innosetup" scheme="https://www.zhuqiaolun.com/tags/innosetup/"/>
    
  </entry>
  
  <entry>
    <title>exe4j将Java程序打包（EXE执行或者Win服务）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723797971551/1723797971551/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723797971551/1723797971551/</id>
    <published>2024-08-16T08:46:11.000Z</published>
    <updated>2025-02-07T09:54:29.111Z</updated>
    
    <content type="html"><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网地址：<a href="https://www.ej-technologies.com/exe4j/download" target="_blank" rel="noopener">https://www.ej-technologies.com/exe4j/download</a><br>进入网址，选择需要的版本，点击下载就可以了，需要注意的是exe4j 6.0 需要的jdk版本为1.8及以上。</p><p>下载地址：<a href="https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe" target="_blank" rel="noopener">https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe</a><br><img src="/2024/08/1723797971551/1723797971551/20240816165442.png" alt="20240816165442"></p><p>一键式安装，下载完成和平时安装软件以下，基本上直接下一步就可安装完成。</p><h3 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h3><p>安装完成运行软件，点击Enter License, 填写用户名、注册码即可,然后，点OK即可注册成功。<br><img src="/2024/08/1723797971551/1723797971551/20240816171223.png" alt="20240816171223"><br>注意：用户名可随便填写，公司可不填，注册码下面的随便选择复制一个即可</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A-XVK258563F-1p4lv7mg7sav</span><br><span class="line">A-XVK209982F-1y0i3h4ywx2h1</span><br><span class="line">A-XVK267351F-dpurrhnyarva</span><br><span class="line">A-XVK204432F-1kkoilo1jy2h3r</span><br><span class="line">A-XVK246130F-1l7msieqiwqnq</span><br><span class="line">A-XVK249554F-pllh351kcke50</span><br><span class="line">A-XVK238729F-25yn13iea25i</span><br><span class="line">A-XVK222711F-134h5ta8yxbm0</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br></pre></td></tr></tbody></table></figure></div><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在 VM Parameters中输入:-Dexe.path=${EXE4J_EXEDIR}；然后可以用它在程序中找到exe所在目录，这样无论生成的exe放到哪都可以找到当前目录，<br>代码中的用法（String exePath = System.getProperty(“exe.path”);）<br>exe执行路径的获取，在把exe文件打包成可安装文件的操作和查找配置文件等操作中至关重要</p><p>Exe4j的内置VM变量：<br>%EXE4J_EXEDIR%：exe执行路径<br>%EXE4J_JVM_HOME%：运行可执行文件的JRE目录</p><h4 id="打开exe4j，点击Next"><a href="#打开exe4j，点击Next" class="headerlink" title="打开exe4j，点击Next"></a>打开exe4j，点击Next</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173007.png" alt="20240816173007"></p><h4 id="选择项目类型，点击Next"><a href="#选择项目类型，点击Next" class="headerlink" title="选择项目类型，点击Next"></a>选择项目类型，点击Next</h4><h5 id="这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，"><a href="#这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，" class="headerlink" title="这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，"></a>这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816172746.png" alt="20240816172746"></p><h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173731.png" alt="20240816173731"></p><h4 id="生成配置"><a href="#生成配置" class="headerlink" title="生成配置"></a>生成配置</h4><p>如果需要cmd窗体调试，可以选择第二个Console</p><h5 id="客户端（含有界面操作，选择第一个"><a href="#客户端（含有界面操作，选择第一个" class="headerlink" title="客户端（含有界面操作，选择第一个"></a>客户端（含有界面操作，选择第一个</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174643.png" alt="20240816174643"></p><h5 id="服务端（可配置在系统服务内运行，开机自启"><a href="#服务端（可配置在系统服务内运行，开机自启" class="headerlink" title="服务端（可配置在系统服务内运行，开机自启"></a>服务端（可配置在系统服务内运行，开机自启</h5><p><img src="/2024/08/1723797971551/1723797971551/20240906174526.png" alt="20240906174526"><br><img src="/2024/08/1723797971551/1723797971551/20240906174608.png" alt="20240906174608"><br>服务安装：hello.exe /uninstall hello<br>服务卸载：hello.exe /install hello</p><h5 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174809.png" alt="20240816174809"><br><img src="/2024/08/1723797971551/1723797971551/20240816174852.png" alt="20240816174852"></p><h4 id="JAR配置"><a href="#JAR配置" class="headerlink" title="JAR配置"></a>JAR配置</h4><p>点击右边绿色的 “+”号，然后选择【Archive】，打开浏览目录，找到我们的jar包，然后选择【打开】，【ok】<br><img src="/2024/08/1723797971551/1723797971551/20240816180639.png" alt="20240816180639"><br>注：VM Parameters中可以设置虚拟机的一下参数，-Dfile.encoding=utf-8是设置了utf-8的编码，以防中文乱码</p><h4 id="JRE配置"><a href="#JRE配置" class="headerlink" title="JRE配置"></a>JRE配置</h4><p>设置JRE的最小最高版本，我们根据自己的情况设置就ok，小版本设置成1.8就行；<br><img src="/2024/08/1723797971551/1723797971551/20240816180930.png" alt="20240816180930"></p><p>然后点击【Advanced Options】，选择【Search sequence】，将软件默认的三个配置需要全部删除，添加我们自己的JRE到软件中，<br>这样我们的代码可以在别的没有安装Java环境的电脑上运行；点击右边的添加，选择【Directory】，然后选择【浏览】，找到我们的JRE，然后添加；<br><img src="/2024/08/1723797971551/1723797971551/20240816181453.png" alt="20240816181453"><br><img src="/2024/08/1723797971551/1723797971551/20240816181729.png" alt="20240816181729"><br><img src="/2024/08/1723797971551/1723797971551/20240816181848.png" alt="20240816181848"></p><p>然后【Next】,点击左侧的【Preferred VM】，选择【Client hotspot VM】，然后【next】<br><img src="/2024/08/1723797971551/1723797971551/20240816182009.png" alt="20240816182009"><br>剩下的步骤直接一直next，这样exe文件生成了<br><img src="/2024/08/1723797971551/1723797971551/20240816182215.png" alt="20240816182215"><br>最后在Finished中选择save，保存现在的配置。</p><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>以下为完整内容，双击exe可以执行<br><img src="/2024/08/1723797971551/1723797971551/20240816182945.png" alt="20240816182945"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      exe4j
    
    </summary>
    
    
      <category term="J-Package" scheme="https://www.zhuqiaolun.com/categories/J-Package/"/>
    
    
      <category term="exe4j" scheme="https://www.zhuqiaolun.com/tags/exe4j/"/>
    
  </entry>
  
  <entry>
    <title>部署OceanBase社区版(4.2.2.0)</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723180766825/1723180766825/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723180766825/1723180766825/</id>
    <published>2024-08-09T05:19:26.000Z</published>
    <updated>2024-08-13T05:45:49.426Z</updated>
    
    <content type="html"><![CDATA[<p>本文仅学习体验 OceanBase 的功能，使用1台机器部署单节点集群即可。</p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>OceanBase 支持部署在主流的Linux操作系统上，下面列出了常用的操作系统：</p><ul><li>Redhat / CentOS 7.x/8.x</li><li>SUSE / OpenSUSE 15.x</li><li>Anlios 7.x/8.x</li><li>Debian 9.x</li><li>Ubuntu 20.x</li></ul><h2 id="主机资源"><a href="#主机资源" class="headerlink" title="主机资源"></a>主机资源</h2><p>下表列出了部署OceanBase所需的单台主机的资源，如果需要集群部署，推荐使用相同规格的主机</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPU：2c，生产环境推荐4c以上</span><br><span class="line">内存：8G，生产环境推荐16G以上</span><br><span class="line">磁盘：内存的6倍以上，推荐使用 SSD, 生产环境要配置多块磁盘，将日志盘和数据盘分开</span><br><span class="line">文件系统：EXT4 戓 XFS，当数据超过 16T 时，使用 XFS</span><br></pre></td></tr></tbody></table></figure></div><h2 id="部署前置"><a href="#部署前置" class="headerlink" title="部署前置"></a>部署前置</h2><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>防火墙状态：systemctl status firewalld，如果输出结果非 inactive, 可以通过如下命令进行关闭：<br>防火墙停止：systemctl stop firewalld<br>防火墙禁用：systemctl disable firewalld</p><h3 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h3><p>修改配置文件，将SELINUX的配置修改为disabled，vi /etc/selinux/config</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"># SELINUXTYPE= can take one of three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></tbody></table></figure></div><p>配置文件修改后只会重启后生效，还需要使用下面命令立即生效：<br>setenforce 0</p><h3 id="修改配置-limits-conf"><a href="#修改配置-limits-conf" class="headerlink" title="修改配置 limits.conf"></a>修改配置 limits.conf</h3><p>执行以下命令解决安装时出现的资源性错误，打开 vi /etc/security/limits.conf 配置文件，添加以下内容：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root soft nofile 655350</span><br><span class="line">root hard nofile 655350</span><br><span class="line">* soft nofile 655350</span><br><span class="line">* hard nofile 655350</span><br><span class="line">* soft stack unlimited</span><br><span class="line">* hard stack unlimited</span><br><span class="line">* soft nproc 655360</span><br><span class="line">* hard nproc 655360</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723180766825/1723180766825/20240809133727.png" alt="20240809133727"></p><h3 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h3><p>参考：<a href="https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561" target="_blank" rel="noopener">https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561</a></p><p>退出当前会话，重新登录。执行以下命令，查看配置是否生效。</p><blockquote><p>ulimit -a</p></blockquote><p>输出如下:<br><img src="/2024/08/1723180766825/1723180766825/20240809134315.png" alt="20240809134315"></p><h3 id="修改内核-etc-sysctl-conf"><a href="#修改内核-etc-sysctl-conf" class="headerlink" title="修改内核 /etc/sysctl.conf"></a>修改内核 /etc/sysctl.conf</h3><p>打开 vi /etc/sysctl.conf 配置文件，修改或添加以下内容：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.aio-max-nr=1048576</span><br><span class="line">fs.file-max=6573688</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></tbody></table></figure></div><p>执行如下命令让配置生效<br>sysctl -p</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/oceanbase</span><br><span class="line">cd /usr/local/oceanbase</span><br><span class="line"></span><br><span class="line"># 下载文件</span><br><span class="line">wget https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/download-center/opensource/oceanbase-all-in-one/7/x86_64/oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压文件</span><br><span class="line">tar -xzf oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">bin/install.sh</span><br><span class="line"></span><br><span class="line">    安装脚本会在主机上部署好OBD和OBClient, 并且将携带的rpm包都导入到OBD的环境中，安装后的输出结果如下。</span><br><span class="line">    Install Finished</span><br><span class="line">      =====================================================================</span><br><span class="line">      Setup Environment:     source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line">      Quick Start:           obd demo</span><br><span class="line">      More Details:          obd -h</span><br><span class="line">      =====================================================================</span><br><span class="line"></span><br><span class="line"># 在执行下一步操作之前，需要根据提示设置环境变量，命令如下：</span><br><span class="line"># set environment</span><br><span class="line">source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line"># check obd and obclient command</span><br><span class="line">which obd</span><br><span class="line">which obclient</span><br></pre></td></tr></tbody></table></figure></div><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>采用快速部署模式：obd demo<br>demo 部署方式采用最小规格部署，部署的组件版本默认为最新版本默认部署的组件包含 oceanbase-ce、obproxy-ce、obagent、grafana、prometheus。</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># use obd demo command to quickly launch a demo cluster</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">obd demo</span><br></pre></td></tr></tbody></table></figure></div><p>部署完成后，OBD会将各个组件的连接方式打印出来：<br><img src="/2024/08/1723180766825/1723180766825/20240809135908.png" alt="20240809135908"></p><p>说明：<br>Grafana访问：<a href="http://127.0.0.1:3000/d/oceanbase，" target="_blank" rel="noopener">http://127.0.0.1:3000/d/oceanbase，</a> 用户名和密码：admin/Kx7FPKTDh7</p><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>安装后，可以使用 OBClient 客户端连接进行验证：obclient -h127.0.0.1 -uroot -P2881<br>授予所有特权：grant all privileges on <em>.</em> to root@’%’;<br><img src="/2024/08/1723180766825/1723180766825/20240809135934.png" alt="20240809135934"></p><h2 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h2><p>安装完成后 root用户是默认没密码</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">初次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot</span><br><span class="line"></span><br><span class="line">设置密码(!root)</span><br><span class="line">ALTER USER root@'%' IDENTIFIED BY '!root';</span><br><span class="line"></span><br><span class="line">再次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot -p</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723180766825/1723180766825/20240809145241.png" alt="20240809145241"></p><h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动：obd cluster start demo</span><br><span class="line">停止：obd cluster stop demo</span><br></pre></td></tr></tbody></table></figure></div><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=2881/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=2881/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有2881端口</span><br><span class="line">ss -ntulp | grep 2881   //查看所有2881端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      OceanBase
    
    </summary>
    
    
      <category term="OceanBase" scheme="https://www.zhuqiaolun.com/categories/OceanBase/"/>
    
    
      <category term="OceanBase" scheme="https://www.zhuqiaolun.com/tags/OceanBase/"/>
    
  </entry>
  
  <entry>
    <title>在Linux下安装RabbitMQ及配置</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723102274931/1723102274931/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723102274931/1723102274931/</id>
    <published>2024-08-08T07:31:14.000Z</published>
    <updated>2024-08-09T07:21:39.487Z</updated>
    
    <content type="html"><![CDATA[<p>Rabbitmq依赖于Erlan 对应版本查看：<a href="https://www.rabbitmq.com/docs/which-erlang" target="_blank" rel="noopener">https://www.rabbitmq.com/docs/which-erlang</a></p><h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol><li>otp_src_24.1.7.tar.gz</li><li>rabbitmq-server-generic-unix-3.9.11.tar.xz</li></ol><ul><li><p>otp_src_24.1.7.tar.gz</p><blockquote><p>官网地址：<a href="https://www.erlang.org/" target="_blank" rel="noopener">https://www.erlang.org/</a><br>文件地址：<a href="https://www.erlang.org/patches/otp-24.1.7" target="_blank" rel="noopener">https://www.erlang.org/patches/otp-24.1.7</a><br>下载地址：<a href="https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz" target="_blank" rel="noopener">https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</a></p></blockquote></li><li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p><blockquote><p>官网地址：<a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">https://www.rabbitmq.com/</a><br>文件地址：<a href="https://github.com/rabbitmq/rabbitmq-server" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server</a><br>下载地址：<a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf otp_src_24.1.7.tar.gz</span><br><span class="line">tar -xf rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723102274931/1723102274931/20240808172416.png" alt="20240808172416"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li><p>otp_src_24.1.7.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/otp_src_24.1.7</span><br><span class="line">./configure --prefix=/usr/local/erlang</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/erlang/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">测试安装是否成功</span><br><span class="line">erl --version</span><br><span class="line">输出：</span><br><span class="line">Erlang/OTP 24 [erts-12.1.5] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1]</span><br><span class="line">Eshell V12.1.5  (abort with ^G)</span><br><span class="line"></span><br><span class="line">退出</span><br><span class="line">halt(). 或者 q().</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/</span><br><span class="line">mv rabbitmq_server-3.9.11 /usr/local/</span><br><span class="line">mv /usr/local/rabbitmq_server-3.9.11 /usr/local/rabbitmq</span><br><span class="line">cd /usr/local/rabbitmq</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/rabbitmq/sbin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h4 id="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config"><a href="#rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config" class="headerlink" title="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config"></a>rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config</h4><p>mkdir /etc/rabbitmq/<br>创建文件 vim /etc/rabbitmq/rabbitmq-env.conf，内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 应用根目录</span><br><span class="line">RABBITMQ_HOME=/usr/local/rabbitmq</span><br><span class="line"># 插件的路径</span><br><span class="line">RABBITMQ_PLUGINS_DIR=/usr/local/rabbitmq/plugins</span><br><span class="line"># 需要使用的MNESIA数据库的路径（创建）</span><br><span class="line">RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/data</span><br><span class="line"># 日志文件的路径（创建）</span><br><span class="line">RABBITMQ_LOG_BASE=/usr/local/rabbitmq/logs</span><br><span class="line"># 配置文件的路径（创建）</span><br><span class="line">RABBITMQ_CONFIG_FILE=/usr/local/rabbitmq/conf/rabbitmq.config</span><br><span class="line">NODENAME=rabbit@localhost</span><br></pre></td></tr></tbody></table></figure></div><p>查看：cat /etc/rabbitmq/rabbitmq-env.conf</p><p>mkdir /usr/local/rabbitmq/conf<br>创建配置文件 vim /usr/local/rabbitmq/conf/rabbitmq.config，内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">## Clustering</span><br><span class="line">cluster_partition_handling = ignore</span><br><span class="line"></span><br><span class="line">## Defaults</span><br><span class="line"># During the first start, RabbitMQ will create a vhost and a user</span><br><span class="line"># These config items control what gets created</span><br><span class="line">default_permissions.configure = .*</span><br><span class="line">default_permissions.read = .*</span><br><span class="line">default_permissions.write = .*</span><br><span class="line">default_vhost = /</span><br><span class="line">default_user = admin</span><br><span class="line">default_pass = admin</span><br><span class="line"></span><br><span class="line">## Networking</span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line"></span><br><span class="line">## Management</span><br><span class="line">management.tcp.ip = 0.0.0.0</span><br><span class="line">management.tcp.port = 15672</span><br><span class="line"></span><br><span class="line">## Resource limits</span><br><span class="line"># Set a free disk space limit relative to total available RAM</span><br><span class="line">disk_free_limit.relative = 1.0</span><br></pre></td></tr></tbody></table></figure></div><p>查看：cat /usr/local/rabbitmq/conf/rabbitmq.config</p><h2 id="常用RabbitMQ命令"><a href="#常用RabbitMQ命令" class="headerlink" title="常用RabbitMQ命令"></a>常用RabbitMQ命令</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.服务启动：rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line">2.服务停止：rabbitmqctl stop</span><br><span class="line"></span><br><span class="line">3.服务状态：rabbitmqctl status</span><br><span class="line"></span><br><span class="line">4.服务重启：rabbitmq-server restart</span><br></pre></td></tr></tbody></table></figure></div><h2 id="安装RabbitMQ-Web界面"><a href="#安装RabbitMQ-Web界面" class="headerlink" title="安装RabbitMQ Web界面"></a>安装RabbitMQ Web界面</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">开启插件：rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"></span><br><span class="line">浏览器访问：http://127.0.0.1:15672/</span><br><span class="line"></span><br><span class="line">RabbitMQ默认提供了一个guest/guest用户，但是从3.3.0 版本以后该账号只能localhost登陆（User can only log in via localhost）</span><br><span class="line"></span><br><span class="line">通过以下命令创建一个用户admin，密码为admin</span><br><span class="line">rabbitmqctl add_user admin admin</span><br><span class="line"></span><br><span class="line">创建完成之后通过以下命令设置用户标签为administrator</span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line"></span><br><span class="line">给用户user赋予权限，授予user用户可访问虚拟主机 /，并在所有的资源上具备可配置、可写及可读的权限</span><br><span class="line">rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"</span><br><span class="line"></span><br><span class="line">最后，通过以下命令可以看出当前的所有用户</span><br><span class="line">rabbitmqctl list_users</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723102274931/1723102274931/20240808180724.png" alt="20240808180724"></p><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=15672/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=15672/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有15672端口</span><br><span class="line">ss -ntulp | grep 15672   //查看所有15672端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Linux下RabbitMQ安装及配置
    
    </summary>
    
    
      <category term="RabbitMq" scheme="https://www.zhuqiaolun.com/categories/RabbitMq/"/>
    
    
      <category term="rabbitMq" scheme="https://www.zhuqiaolun.com/tags/rabbitMq/"/>
    
  </entry>
  
  <entry>
    <title>Linux安装 Redis - 绿色版</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723099472324/1723099472324/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723099472324/1723099472324/</id>
    <published>2024-08-08T06:44:32.000Z</published>
    <updated>2024-08-09T07:21:39.481Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ tcl cmake</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ul><li>redis-3.2.10.tar.gz<blockquote><p>官网地址：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a><br>文件地址：<a href="https://download.redis.io/releases/" target="_blank" rel="noopener">https://download.redis.io/releases/</a><br>下载地址：<a href="https://download.redis.io/releases/redis-3.2.10.tar.gz" target="_blank" rel="noopener">https://download.redis.io/releases/redis-3.2.10.tar.gz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://download.redis.io/releases/redis-3.2.10.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf redis-3.2.10.tar.gz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808145352.png" alt="20240808145352"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li>redis-3.2.10.tar.gz<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/redis-3.2.10</span><br><span class="line"></span><br><span class="line"># 指定安装目录</span><br><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="配置文件redis-conf"><a href="#配置文件redis-conf" class="headerlink" title="配置文件redis.conf"></a>配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">从redis的源码目录中复制redis.conf到redis的bin目录下：</span><br><span class="line">cp /usr/local/software/redis-3.2.10/redis.conf /usr/local/redis/bin/</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808150953.png" alt="20240808150953"></p><h2 id="修改配置文件redis-conf"><a href="#修改配置文件redis-conf" class="headerlink" title="修改配置文件redis.conf"></a>修改配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line">//显示行号</span><br><span class="line">:set nu</span><br><span class="line"></span><br><span class="line">//61行左右</span><br><span class="line">注释掉# bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">//80行左右</span><br><span class="line">修改 protected-mode yes 改为 protected-mode no</span><br><span class="line"></span><br><span class="line">//128行左右</span><br><span class="line">daemonize no 改为 daemonize yes</span><br><span class="line"></span><br><span class="line">:wq! 保存退出</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808151306.png" alt="20240808151306"></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>在bin目录下，启动redis服务：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-server redis.conf</span><br></pre></td></tr></tbody></table></figure></div><h2 id="停止服务："><a href="#停止服务：" class="headerlink" title="停止服务："></a>停止服务：</h2><p>利用redis-cli来执行 shutdown 命令，即可停止 Redis 服务，</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-cli shutdown</span><br></pre></td></tr></tbody></table></figure></div><h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/redis.service , 内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div><p>查看：<br>cat /etc/systemd/system/redis.service</p><p>然后重载系统服务：<br>systemctl daemon-reload</p><p>可以用下面这组命令来操作redis了：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start redis</span><br><span class="line"># 停止</span><br><span class="line">systemctl stop redis</span><br><span class="line"># 重启</span><br><span class="line">systemctl restart redis</span><br><span class="line"># 查看状态</span><br><span class="line">systemctl status redis</span><br></pre></td></tr></tbody></table></figure></div><p>执行下面的命令，可以让redis开机自启：<br>systemctl enable redis</p><h2 id="添加端口到防火墙里："><a href="#添加端口到防火墙里：" class="headerlink" title="添加端口到防火墙里："></a>添加端口到防火墙里：</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=6379/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=6379/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有6379端口</span><br><span class="line">ss -ntulp | grep 6379   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Linux安装 Redis - 绿色版
    
    </summary>
    
    
      <category term="Redis" scheme="https://www.zhuqiaolun.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="https://www.zhuqiaolun.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>在Linux中安装subversion环境</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723020746262/1723020746262/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723020746262/1723020746262/</id>
    <published>2024-08-07T08:52:26.000Z</published>
    <updated>2024-08-09T07:21:46.020Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol><li>apr-1.6.5.tar.gz</li><li>apr-util-1.6.1.tar.gz</li><li>sqlite-autoconf-3250100.tar.gz</li><li>zlib-1.2.11.tar.gz</li><li>subversion-1.10.6.tar.gz</li></ol><ul><li><p>apr-1.6.5.tar.gz、apr-util-1.6.1.tar.gz</p><blockquote><p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="http://archive.apache.org/dist/apr" target="_blank" rel="noopener">http://archive.apache.org/dist/apr</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</a></p></blockquote></li><li><p>zlib-1.2.11.tar.gz </p><blockquote><p>文件地址：<a href="http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml" target="_blank" rel="noopener">http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml</a><br>下载地址：<a href="https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1" target="_blank" rel="noopener">https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1</a></p></blockquote></li><li><p>sqlite-autoconf-3250100.tar.gz</p><blockquote><p>官网地址：<a href="http://www.sqlite.org" target="_blank" rel="noopener">http://www.sqlite.org</a><br>下载地址：<a href="https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz" target="_blank" rel="noopener">https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</a></p></blockquote></li><li><p>subversion-1.10.6.tar.gz</p><blockquote><p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="https://archive.apache.org/dist/subversion" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion</a><br>下载地址：<a href="https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件目录</span><br><span class="line">mkdir /usr/local/subversion</span><br><span class="line"></span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/subversion/svn</span><br><span class="line"></span><br><span class="line">项目目录</span><br><span class="line">mkdir /usr/local/subversion/svn/project</span><br><span class="line"></span><br><span class="line">软件依赖安装目录</span><br><span class="line">mkdir /usr/local/subversion/software</span><br><span class="line"></span><br><span class="line">1.下载文件</span><br><span class="line">cd /usr/local/subversion/software</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz</span><br><span class="line">wget https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf apr-1.6.5.tar.gz</span><br><span class="line">tar -xzvf apr-util-1.6.1.tar.gz</span><br><span class="line">tar -xf zlib-1.2.11.tar.xz</span><br><span class="line">tar -xzvf sqlite-autoconf-3250100.tar.gz</span><br><span class="line">tar -zxvf subversion-1.10.6.tar.gz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723020746262/1723020746262/20240807172108.png" alt="20240807172108"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li><p>apr-1.6.5.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-1.6.5</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>apr-util-1.6.1.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-util-1.6.1</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-util-1.6.1 --with-apr=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>zlib-1.2.11.tar.xz（可以不安装）</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/zlib-1.2.11</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/zlib-1.2.11</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>sqlite-autoconf-3250100.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/sqlite-autoconf-3250100</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/sqlite</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>subversion-1.10.6.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/subversion-1.10.6</span><br><span class="line"></span><br><span class="line">（--with-apr等参数后面的路径，取决于前面几个插件安装的路径，插件也应该放在/usr/local/下面，我这里插件都放在/home/svn/其实不推荐这么干，</span><br><span class="line">在使用 ./configure 脚本时，如果需要在命令行中换行拼接多个选项，可以使用 \ 符号在多行中分割长命令。这样做可以提高命令的可读性，使其不会过长。）</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/subversion-1.10.6  \</span><br><span class="line">            --with-apr=/usr/local/subversion/svn/apr-1.6.5  \</span><br><span class="line">            --with-apr-util=/usr/local/subversion/svn/apr-util-1.6.1  \</span><br><span class="line">            --with-sqlite=/usr/local/subversion/svn/sqlite  \</span><br><span class="line">            --with-lz4=internal  \</span><br><span class="line">            --with-utf8proc=internal</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><p>安装完成，添加环境变量path</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">添加</span><br><span class="line">echo "export PATH=/usr/local/subversion/svn/subversion-1.10.6/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">生效</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">cat /etc/profile</span><br><span class="line"></span><br><span class="line">验证：</span><br><span class="line">svnserve --version</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723020746262/1723020746262/20240808142507.png" alt="20240808142507"></p><h2 id="添加项目库"><a href="#添加项目库" class="headerlink" title="添加项目库"></a>添加项目库</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">创建两个库</span><br><span class="line">svnadmin create /usr/local/subversion/svn/javaproject/</span><br><span class="line">svnadmin create /usr/local/subversion/svn/webproject/</span><br><span class="line"></span><br><span class="line">进两个库里面设置权限，分别进入库的conf目录下，设置各自的权限……</span><br><span class="line"></span><br><span class="line">例如配置：</span><br><span class="line">cd /usr/local/subversion/svn/javaproject/conf</span><br><span class="line">    vim svnserve.conf</span><br><span class="line">        修改以下内容（大约在27行）：</span><br><span class="line">        password-db = passwd    # 指明密码文件路径</span><br><span class="line"></span><br><span class="line">修改passwd文件</span><br><span class="line">vim passwd</span><br><span class="line">添加以下内容：</span><br><span class="line">[users]</span><br><span class="line">test1=test1</span><br><span class="line">test2=test2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动（默认端口），指向库的父级目录</span><br><span class="line">svnserve -d -r  /usr/local/subversion/svn/</span><br><span class="line"></span><br><span class="line">关闭svn服务</span><br><span class="line">killall svnserve</span><br><span class="line"></span><br><span class="line">通过客户端访问</span><br><span class="line">svn://服务器ip:端口(默认端口3690可以不写)/javaproject/</span><br><span class="line">例如：svn://10.200.47.87/javaproject/</span><br></pre></td></tr></tbody></table></figure></div><h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/svnserver.service , 内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=SVN Server Service</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -d -r /usr/local/subversion/svn/</span><br><span class="line">ExecStop=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -q –pid-file /var/run/svnserve.pid</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div><p>wq!保存</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查看服务： cat /etc/systemd/system/svnserver.service</span><br><span class="line"></span><br><span class="line">加载服务：systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">服务启动：systemctl start svnserver</span><br><span class="line">服务停止：systemctl stop svnserver</span><br><span class="line">服务状态：systemctl status svnserver</span><br><span class="line"></span><br><span class="line">开机启动：systemctl enable svnserver</span><br></pre></td></tr></tbody></table></figure></div><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=3690/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=3690/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有3690端口</span><br><span class="line">ss -ntulp | grep 3690   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      subversion
    
    </summary>
    
    
      <category term="SVN" scheme="https://www.zhuqiaolun.com/categories/SVN/"/>
    
    
      <category term="subversion" scheme="https://www.zhuqiaolun.com/tags/subversion/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722839250449/1722839250449/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722839250449/1722839250449/</id>
    <published>2024-08-05T06:27:30.000Z</published>
    <updated>2024-08-15T06:09:25.837Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个RabbitMq的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3.9.11-management</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag rabbitmq:3.9.11-management 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>文件（rabbitmq-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-rabbitmq-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/rabbitmq/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">"10.200.40.39:8080/component/rabbitmq:3.9.11-management"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5672</span> <span class="comment"># amqp</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">4369</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5671</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">15672</span> <span class="comment"># http</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">25672</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="comment">#存储</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/home/rabbitmq/</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HOSTNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_CLEANUP</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_USE_LONGNAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_LOG_LEVEL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"debug"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_INTERVAL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"60"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_WARN_ONLY</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"false"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_TYPE</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"k8s"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LANG</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"en_US.UTF-8"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-rabbitmq-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-rabbitmq-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster rabbitmq]# kubectl exec -it my-rabbitmq-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-rabbitmq-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：Redis3.2.10（单机）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722839201478/1722839201478/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722839201478/1722839201478/</id>
    <published>2024-08-05T06:26:41.000Z</published>
    <updated>2024-08-15T06:09:22.455Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个Redis的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:3.2.10</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag redis:3.2.10 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/redis:3.2.10</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（redis-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">redis.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">bind</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="string">protected-mode</span> <span class="literal">no</span></span><br><span class="line">    <span class="string">port</span> <span class="number">6379</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（redis-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-redis-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/redis/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-redis</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/redis:3.2.10</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/usr/local/etc/redis/redis.conf</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">redis.conf</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/var/log/redis</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">redis.conf</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">redis.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span> </span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/logs</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-6379</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31379</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f redis-configmap.yaml</span><br><span class="line">kubectl apply -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f redis-configmap.yaml</span><br><span class="line">kubectl delete -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-redis-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-redis-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster redis]# kubectl exec -it my-redis-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-redis-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：MySql8.0.27</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722836311451/1722836311451/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722836311451/1722836311451/</id>
    <published>2024-08-05T05:38:31.000Z</published>
    <updated>2024-08-15T06:09:19.449Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0.27</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag mysql:8.0.27 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/mysql:8.0.27</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">my.cnf:</span> <span class="string">|-</span></span><br><span class="line">       <span class="string">[client]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysql]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysqld]</span></span><br><span class="line">       <span class="string">port=3308</span></span><br><span class="line">       <span class="string">max_connections</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line">       <span class="comment">#secure_file_priv=/var/lib/mysql</span></span><br><span class="line">       <span class="string">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line">       <span class="string">skip-name-resolve</span></span><br><span class="line">       <span class="string">open_files_limit</span> <span class="string">=</span> <span class="number">65535</span></span><br><span class="line">       <span class="string">table_open_cache</span> <span class="string">=</span> <span class="number">128</span></span><br><span class="line">       <span class="string">log_error</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-errorlog</span> <span class="comment">#错误日志路径</span></span><br><span class="line">       <span class="string">slow_query_log</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">long_query_time</span> <span class="string">=</span> <span class="number">1</span> <span class="comment">#慢查询时间 超过1秒则为慢查询</span></span><br><span class="line">       <span class="string">slow_query_log_file</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-slowlog</span></span><br><span class="line">       <span class="string">default-storage-engine</span> <span class="string">=</span> <span class="string">InnoDB</span> <span class="comment">#默认存储引擎</span></span><br><span class="line">       <span class="string">innodb_file_per_table</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_open_files</span> <span class="string">=</span> <span class="number">500</span></span><br><span class="line">       <span class="string">innodb_buffer_pool_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">       <span class="string">innodb_write_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_read_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_thread_concurrency</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">       <span class="string">innodb_purge_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line">       <span class="string">innodb_log_buffer_size</span> <span class="string">=</span> <span class="string">2M</span></span><br><span class="line">       <span class="string">innodb_log_file_size</span> <span class="string">=</span> <span class="string">32M</span></span><br><span class="line">       <span class="string">innodb_log_files_in_group</span> <span class="string">=</span> <span class="number">3</span></span><br><span class="line">       <span class="string">innodb_max_dirty_pages_pct</span> <span class="string">=</span> <span class="number">90</span></span><br><span class="line">       <span class="string">innodb_lock_wait_timeout</span> <span class="string">=</span> <span class="number">120</span></span><br><span class="line">       <span class="string">bulk_insert_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_max_sort_file_size</span> <span class="string">=</span> <span class="string">10G</span></span><br><span class="line">       <span class="string">myisam_repair_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">interactive_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">wait_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">[mysqldump]</span></span><br><span class="line">       <span class="string">quick</span></span><br><span class="line">       <span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">16M</span> <span class="comment">#服务器发送和接受的最大包长度</span></span><br><span class="line">       <span class="string">[myisamchk]</span></span><br><span class="line">       <span class="string">key_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">read_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br><span class="line">       <span class="string">write_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（mysql8-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限）</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-mysql8-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/mysql8/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-mysql8</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/mysql:8.0.27</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATEBASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"myblog"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">3308</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新128M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>                            <span class="comment">#容器内挂载点名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>              <span class="comment">#容器内挂载点路径，可以是文件或目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/my.cnf</span>       <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">my.cnf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span>  </span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span>   <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>          <span class="comment">#数据卷名称，需要与容器内挂载点名称一致</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span>      <span class="comment">#挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3308</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3308</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30308</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f mysql8-configmap.yaml</span><br><span class="line">kubectl apply -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f mysql8-configmap.yaml</span><br><span class="line">kubectl delete -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-mysql8-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-mysql8-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster mysql8]# kubectl exec -it my-mysql8-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-mysql8-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如遇见未知错误可删除已经生成的data目录，重新生成data<br>如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：<br>1进入MySQL的Pod中：<br>    kubectl exec -it my-mysql8-deployment-88f575676-2h2nn – /bin/bash<br>2进入MySQL命令行：<br>    mysql -uroot -proot -P 3306<br>3执行以下SQL语句，允许root用户从任意主机访问MySQL：<br>    GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION;<br>    FLUSH PRIVILEGES;<br>4退出MySQL命令行和Pod：exit；</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：MySql5.6.51</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722836276725/1722836276725/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722836276725/1722836276725/</id>
    <published>2024-08-05T05:37:56.000Z</published>
    <updated>2024-08-15T06:09:16.693Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.6.51</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag mysql:5.6.51 10.200.40.39:8080/component/mysql:5.6.51</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/mysql:5.6.51</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/mysql:5.6.51</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql5-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">my.cnf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">[mysql]</span></span><br><span class="line">    <span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line">    <span class="string">default-character-set=utf8</span></span><br><span class="line">    <span class="string">[mysqld]</span></span><br><span class="line">    <span class="comment">#默认编码</span></span><br><span class="line">    <span class="string">character_set_server=utf8</span> </span><br><span class="line">    <span class="string">bind-address</span> <span class="string">=</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="comment">#端口</span></span><br><span class="line">    <span class="string">port</span> <span class="string">=</span> <span class="number">3306</span> </span><br><span class="line">    <span class="comment">#引擎</span></span><br><span class="line">    <span class="string">default-storage-engine=INNODB</span></span><br><span class="line">    <span class="comment"># 最大连接数量</span></span><br><span class="line">    <span class="string">max_connections</span> <span class="string">=</span> <span class="number">100</span></span><br><span class="line">    <span class="comment">#单个内存表的最大值限定</span></span><br><span class="line">    <span class="string">max_heap_table_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="comment">#为每个线程分配的排序缓冲大小</span></span><br><span class="line">    <span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">    <span class="comment">#join 连表操作的缓冲大小,根据实际业务来设置，默认8M</span></span><br><span class="line">    <span class="string">join_buffer_size</span> <span class="string">=</span> <span class="string">32M</span></span><br><span class="line">    <span class="comment"># sql查询缓存，如果提交的查询与几次中的某查询相同，并且在query缓存中存在，则直接返回缓存中的结果</span></span><br><span class="line">    <span class="string">query_cache_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">    <span class="comment"># sql模式</span></span><br><span class="line">    <span class="string">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span> </span><br><span class="line">    <span class="comment">#表示开启binlog并指定binglog文件名</span></span><br><span class="line">    <span class="string">log_bin</span> <span class="string">=</span> <span class="string">mysql-bin</span> </span><br><span class="line">    <span class="comment">#默认</span></span><br><span class="line">    <span class="string">binlog_format</span> <span class="string">=</span> <span class="string">ROW</span> </span><br><span class="line">    <span class="comment">#binlog保留天数</span></span><br><span class="line">    <span class="string">expire_logs_days=15</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（mysql6-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql5-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限）</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-mysql5-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/mysql5/data/"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/mysql5/data/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-mysql5</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/mysql:5.6.51</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATEBASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"myblog"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新128M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>                            <span class="comment">#容器内挂载点名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>              <span class="comment">#容器内挂载点路径，可以是文件或目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/my.cnf</span>       <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">my.cnf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span>  </span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span>   <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>          <span class="comment">#数据卷名称，需要与容器内挂载点名称一致</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span>      <span class="comment">#挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mysql5-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/mysql5/data/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql5-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.102</span><span class="number">.102</span><span class="number">.249</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.102</span><span class="number">.102</span><span class="number">.249</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-mysql5</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30306</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f mysql5-configmap.yaml</span><br><span class="line">kubectl apply -f mysql5-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f mysql5-configmap.yaml</span><br><span class="line">kubectl delete -f mysql5-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-mysql5-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-mysql5-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster mysql5]# kubectl exec -it my-mysql5-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-mysql5-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如遇见未知错误可删除已经生成的data目录，重新生成data<br>如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：<br>1进入MySQL的Pod中：<br>    kubectl exec -it my-mysql5-deployment-88f575676-2h2nn – /bin/bash<br>2进入MySQL命令行：<br>    mysql -uroot -proot -P 3306<br>3执行以下SQL语句，允许root用户从任意主机访问MySQL：<br>    GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION;<br>    FLUSH PRIVILEGES;<br>4退出MySQL命令行和Pod：exit；</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：Tomcat9.0.56</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722586402699/1722586402699/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722586402699/1722586402699/</id>
    <published>2024-08-02T08:13:22.000Z</published>
    <updated>2024-08-15T06:09:13.865Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个Tomcat的Pod程序，以后的后端项目均存放在一个webapps目录即可，本文采用 nfs 存储。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat:9.0.56</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag tomcat:9.0.56 10.200.40.39:8080/component/tomcat:9.0.56</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/tomcat:9.0.56</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/tomcat:9.0.56</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（tomcat-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-conf</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">server.xml:</span> <span class="string">|-</span></span><br><span class="line">   <span class="string">&lt;?xml</span> <span class="string">version="1.0"</span> <span class="string">encoding="UTF-8"?&gt;</span></span><br><span class="line">       <span class="string">&lt;Server</span> <span class="string">port="8005"</span> <span class="string">shutdown="SHUTDOWN"&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.startup.VersionLoggerListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.AprLifecycleListener"</span> <span class="string">SSLEngine="on"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;Listener</span> <span class="string">className="org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;GlobalNamingResources&gt;</span></span><br><span class="line">           <span class="string">&lt;Resource</span> <span class="string">name="UserDatabase"</span> <span class="string">auth="Container"</span></span><br><span class="line">                     <span class="string">type="org.apache.catalina.UserDatabase"</span></span><br><span class="line">                     <span class="string">description="User</span> <span class="string">database</span> <span class="string">that</span> <span class="string">can</span> <span class="string">be</span> <span class="string">updated</span> <span class="string">and</span> <span class="string">saved"</span></span><br><span class="line">                     <span class="string">factory="org.apache.catalina.users.MemoryUserDatabaseFactory"</span></span><br><span class="line">                     <span class="string">pathname="conf/tomcat-users.xml"</span> <span class="string">/&gt;</span></span><br><span class="line">         <span class="string">&lt;/GlobalNamingResources&gt;</span></span><br><span class="line">         <span class="string">&lt;Service</span> <span class="string">name="Catalina"&gt;</span></span><br><span class="line">           <span class="string">&lt;Connector</span> <span class="string">port="8080"</span> <span class="string">protocol="HTTP/1.1"</span></span><br><span class="line">                      <span class="string">connectionTimeout="20000"</span></span><br><span class="line">                      <span class="string">redirectPort="8443"</span> <span class="string">/&gt;</span></span><br><span class="line">           <span class="string">&lt;Engine</span> <span class="string">name="Catalina"</span> <span class="string">defaultHost="localhost"&gt;</span></span><br><span class="line">             <span class="string">&lt;Realm</span> <span class="string">className="org.apache.catalina.realm.LockOutRealm"&gt;</span></span><br><span class="line">               <span class="string">&lt;Realm</span> <span class="string">className="org.apache.catalina.realm.UserDatabaseRealm"</span></span><br><span class="line">                      <span class="string">resourceName="UserDatabase"/&gt;</span></span><br><span class="line">             <span class="string">&lt;/Realm&gt;</span></span><br><span class="line">             <span class="string">&lt;Host</span> <span class="string">name="localhost"</span>  <span class="string">appBase="webapps"</span></span><br><span class="line">                   <span class="string">unpackWARs="true"</span> <span class="string">autoDeploy="true"&gt;</span></span><br><span class="line">               <span class="string">&lt;Valve</span> <span class="string">className="org.apache.catalina.valves.AccessLogValve"</span> <span class="string">directory="logs"</span></span><br><span class="line">                      <span class="string">prefix="localhost_access_log"</span> <span class="string">suffix=".txt"</span></span><br><span class="line">                      <span class="string">pattern="%h</span> <span class="string">%l</span> <span class="string">%u</span> <span class="string">%t</span> <span class="string">&amp;quot;%r&amp;quot;</span> <span class="string">%s</span> <span class="string">%b"</span> <span class="string">/&gt;</span></span><br><span class="line">             <span class="string">&lt;/Host&gt;</span></span><br><span class="line">           <span class="string">&lt;/Engine&gt;</span></span><br><span class="line">         <span class="string">&lt;/Service&gt;</span></span><br><span class="line">       <span class="string">&lt;/Server&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（tomcat-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-tomcat</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/tomcat:9.0.56</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JAVA_OPTS</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"-Xmx512m -Xms256m"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新256M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新512M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用1核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/conf/server.xml</span> <span class="comment">#  挂载配置了 tomcat-conf 的 volume</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">server.xml</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-log</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/logs/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-webapps</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/local/tomcat/webapps/</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">tomcat-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-log</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/tomcat/logs/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-webapps</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/tomcat/webapps/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.109</span><span class="number">.128</span><span class="number">.67</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.109</span><span class="number">.128</span><span class="number">.67</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-tomcat</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30808</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-tomcat-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">my.tomcat.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">my-tomcat-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">8080</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f tomcat-configmap.yaml</span><br><span class="line">kubectl apply -f tomcat-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f tomcat-configmap.yaml</span><br><span class="line">kubectl delete -f tomcat-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用信息</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmap tomcat-conf</span><br><span class="line">kubectl describe deployment my-tomcat-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service my-tomcat-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress my-tomcat-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com my.nginx.com my.tomcat.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com my.nginx.com my.tomcat.com</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用在容器的部署信息<br>kubectl describe pod my-tomcat-deployment<br>kubectl logs my-tomcat-deployment-???????</p><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster tomcat]# kubectl exec -it my-tomcat-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-tomcat-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30808/" target="_blank" rel="noopener">http://10.200.40.40:30808/</a><br>    域名访问：<a href="http://my.tomcat.com/，" target="_blank" rel="noopener">http://my.tomcat.com/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：Nginx1.21.5</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722586394326/1722586394326/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722586394326/1722586394326/</id>
    <published>2024-08-02T08:13:14.000Z</published>
    <updated>2024-08-15T06:09:11.237Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个Nginx的Pod程序，以后的前端项目均存放在一个html目录即可，本文采用 nfs 存储。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:1.21.5</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag nginx:1.21.5 10.200.40.39:8080/component/nginx:1.21.5</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/nginx:1.21.5</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/nginx:1.21.5</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（nginx-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-conf</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">nginx.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">user</span>  <span class="string">nginx;</span></span><br><span class="line">    <span class="string">worker_processes</span>  <span class="number">1</span><span class="string">;</span></span><br><span class="line">    <span class="string">error_log</span>  <span class="string">/var/log/nginx/error.log</span> <span class="string">warn;</span></span><br><span class="line">    <span class="string">pid</span>        <span class="string">/var/run/nginx.pid;</span></span><br><span class="line"> </span><br><span class="line">    <span class="string">events</span> <span class="string">{</span></span><br><span class="line">      <span class="string">worker_connections</span>  <span class="number">1024</span><span class="string">;</span></span><br><span class="line">    <span class="string">}</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">http</span> <span class="string">{</span></span><br><span class="line">      <span class="string">include</span>       <span class="string">/etc/nginx/mime.types;</span></span><br><span class="line">      <span class="string">default_type</span>  <span class="string">application/octet-stream;</span></span><br><span class="line">      <span class="comment">#log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">      <span class="comment">#                  '$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">      <span class="comment">#                  '"$http_user_agent" "$http_x_forwarded_for"';</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">      <span class="string">sendfile</span>        <span class="string">on;</span></span><br><span class="line">      <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">      <span class="string">keepalive_timeout</span>  <span class="number">65</span><span class="string">;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">#gzip  on;</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">        <span class="string">server</span> <span class="string">{</span></span><br><span class="line">            <span class="string">listen</span>       <span class="number">80</span><span class="string">;</span></span><br><span class="line">            <span class="string">server_name</span>  <span class="string">_;</span></span><br><span class="line">            </span><br><span class="line">            <span class="string">location</span> <span class="string">/</span> <span class="string">{</span></span><br><span class="line">                <span class="string">root</span>   <span class="string">/usr/share/nginx/html;</span></span><br><span class="line">                <span class="string">index</span>  <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">/sip-web</span> <span class="string">{</span></span><br><span class="line">                <span class="string">alias</span>  <span class="string">/usr/share/nginx/html/sip-web/dist/;</span></span><br><span class="line">                <span class="string">try_files</span> <span class="string">$uri</span> <span class="string">$uri/</span> <span class="string">/hello/index.html;</span></span><br><span class="line">                <span class="string">index</span> <span class="string">index.html</span> <span class="string">index.htm;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">location</span> <span class="string">^~</span> <span class="string">/sip-api/</span> <span class="string">{</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">Host</span> <span class="string">$http_host;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">X-Real-IP</span> <span class="string">$remote_addr;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">REMOTE-HOST</span> <span class="string">$remote_addr;</span></span><br><span class="line">                <span class="string">proxy_set_header</span> <span class="string">X-Forwarded-For</span> <span class="string">$proxy_add_x_forwarded_for;</span></span><br><span class="line">                <span class="string">proxy_pass</span>  <span class="string">http://10.200.40.40:30088/sip-admin/;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 避免actuator暴露</span></span><br><span class="line">            <span class="string">if</span> <span class="string">($request_uri</span> <span class="string">~</span> <span class="string">"/actuator"</span><span class="string">)</span> <span class="string">{</span></span><br><span class="line">                <span class="string">return</span> <span class="number">403</span><span class="string">;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line"></span><br><span class="line">            <span class="string">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  <span class="string">/50x.html;</span></span><br><span class="line">            <span class="string">location</span> <span class="string">=</span> <span class="string">/50x.html</span> <span class="string">{</span></span><br><span class="line">                <span class="string">root</span>   <span class="string">html;</span></span><br><span class="line">            <span class="string">}</span></span><br><span class="line">              </span><br><span class="line">        <span class="string">}</span></span><br><span class="line">    <span class="string">}</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（nginx-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-nginx</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/nginx:1.21.5</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"64Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"250m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"128Mi"</span> <span class="comment"># 内存最新128M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-config</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/nginx/nginx.conf</span> <span class="comment">#  挂载配置了 nginx.conf 的 volume</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">nginx.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-log</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/log/nginx/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-html</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html/</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-config</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">nginx-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-log</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/nginx/logs/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-html</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/nginx/html/</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.110</span><span class="number">.23</span><span class="number">.182</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.110</span><span class="number">.23</span><span class="number">.182</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30080</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-nginx-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">my.nginx.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">my-nginx-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx-configmap.yaml</span><br><span class="line">kubectl apply -f nginx-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f nginx-configmap.yaml</span><br><span class="line">kubectl delete -f nginx-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用信息</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmap nginx-conf</span><br><span class="line">kubectl describe deployment my-nginx-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service my-nginx-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress my-nginx-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com my.nginx.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com my.nginx.com</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用在容器的部署信息<br>kubectl describe pod my-nginx-deployment<br>kubectl logs my-nginx-deployment-???????</p><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster nginx]# kubectl exec -it my-nginx-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-nginx-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30080/" target="_blank" rel="noopener">http://10.200.40.40:30080/</a><br>    域名访问：<a href="http://my.nginx.com/，" target="_blank" rel="noopener">http://my.nginx.com/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722586325029/1722586325029/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722586325029/1722586325029/</id>
    <published>2024-08-02T08:12:05.000Z</published>
    <updated>2024-08-15T06:31:17.153Z</updated>
    
    <content type="html"><![CDATA[<h2 id="制作-springboot（jar）-程序-镜像"><a href="#制作-springboot（jar）-程序-镜像" class="headerlink" title="制作 springboot（jar） 程序 镜像"></a>制作 springboot（jar） 程序 镜像</h2><p>打包可运行的jar文件，放到同层目录下，如：/usr/local/java，目录下存在jar文件和Dockerfile文件</p><h3 id="Dockerfile文件内容："><a href="#Dockerfile文件内容：" class="headerlink" title="Dockerfile文件内容："></a>Dockerfile文件内容：</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DOCKERFILE"><figure class="iseeu highlight /dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基于我们刚刚创建的jdk镜像</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="number">10.200</span>.<span class="number">40.39</span>:<span class="number">8080</span>/jdk/openjdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> kgf</span><br><span class="line"><span class="comment">#j镜像解压出来的目录</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk/jdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> k8s-demo.jar /opt</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /opt/k8s-demo.jar</span></span><br><span class="line"><span class="comment">#运行jar</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"sh"</span>,<span class="string">"-c"</span>,<span class="string">"java -Xms256m -Xmx512m -jar /opt/k8s-demo.jar"</span>]</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="build镜像"><a href="#build镜像" class="headerlink" title="build镜像"></a>build镜像</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">在公网构建镜像(后面的 空格+点 不能漏掉)：</span><br><span class="line">    docker build -t k8s-demo:v1.0 .</span><br><span class="line">给镜像打标签：</span><br><span class="line">    docker build -t 10.200.40.39:8080/testproject/k8s-demo:v1.0 .</span><br><span class="line">把镜像 push 到本地仓库：</span><br><span class="line">    docker push 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">查看镜像</span><br><span class="line">    docker image</span><br><span class="line"></span><br><span class="line">其他节点下载镜像</span><br><span class="line">    docker pull 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">    </span><br><span class="line">验证镜像（测试运行）</span><br><span class="line">    docker run -it -p 8235:8235 10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br></pre></td></tr></tbody></table></figure></div><h3 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a>部署应用</h3><h4 id="创建文件（k8s-demo-service-yaml），内容如下："><a href="#创建文件（k8s-demo-service-yaml），内容如下：" class="headerlink" title="创建文件（k8s-demo-service.yaml），内容如下："></a>创建文件（k8s-demo-service.yaml），内容如下：</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">k8s-demo</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/testproject/k8s-demo:v1.0</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">8235</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="comment"># 解决Java程序时区问题</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="comment"># 这里的名称将来会被用作请求的域名来被集群外部和内部对象使用</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment"># 默认类型</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.101</span><span class="number">.65</span><span class="number">.14</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.101</span><span class="number">.65</span><span class="number">.14</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="comment"># 选择器，Service 会通过满足选择器的Pod去建立和Pod的映射关系，一般是1对多</span></span><br><span class="line">    <span class="comment"># 会找对应 这个 xxx label 的 Pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">k8s-demo</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8235</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8235</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30235</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">k8s-demo-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">test.k8s.com</span></span><br><span class="line">      <span class="attr">http:</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/k8s-demo</span></span><br><span class="line">            <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">            <span class="attr">backend:</span></span><br><span class="line">              <span class="attr">service:</span> </span><br><span class="line">                <span class="attr">name:</span> <span class="string">k8s-demo-service</span></span><br><span class="line">                <span class="attr">port:</span> </span><br><span class="line">                  <span class="attr">number:</span> <span class="number">8235</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8smaster k8s-demo]# kubectl apply -f k8s-demo-service.yaml</span><br><span class="line">    deployment.apps/k8s-demo-deployment created</span><br><span class="line">    service/k8s-demo-service created</span><br><span class="line">    ingress.networking.k8s.io/k8s-demo-ingress created</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8smaster k8s-demo]# kubectl delete -f k8s-demo-service.yaml</span><br><span class="line">    deployment.apps "k8s-demo-deployment" deleted</span><br><span class="line">    service "k8s-demo-service" deleted</span><br><span class="line">    ingress.networking.k8s.io "k8s-demo-ingress" deleted</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用信息</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe deployment k8s-demo-deployment</span><br><span class="line"></span><br><span class="line">kubectl describe service k8s-demo-service</span><br><span class="line"></span><br><span class="line">kubectl describe ingress k8s-demo-ingress</span><br><span class="line">    由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开</span><br><span class="line">    vi /etc/hosts</span><br><span class="line">    </span><br><span class="line">    [root@k8snode-1 /]# cat /etc/hosts</span><br><span class="line">    127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">    ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">    10.200.40.40 k8smaster</span><br><span class="line">    10.200.40.41 k8snode-1 test.k8s.com</span><br><span class="line">    10.200.40.42 k8snode-2 test.k8s.com</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用在容器的部署信息</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">Pod执行记录，通过执行流程，可以看出是否部署成功</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl describe pod k8s-demo-deployment</span><br><span class="line">Name:         k8s-demo-deployment-76f6dcccd4-zv5sc</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         k8snode-2/10.200.40.42</span><br><span class="line">Start Time:   Fri, 02 Aug 2024 04:32:28 -0400</span><br><span class="line">Labels:       app=k8s-demo</span><br><span class="line">              pod-template-hash=76f6dcccd4</span><br><span class="line">Annotations:  cni.projectcalico.org/podIP: 192.168.163.144/32</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           192.168.163.144</span><br><span class="line">IPs:</span><br><span class="line">  IP:           192.168.163.144</span><br><span class="line">Controlled By:  ReplicaSet/k8s-demo-deployment-76f6dcccd4</span><br><span class="line">Containers:</span><br><span class="line">  k8s-demo:</span><br><span class="line">    Container ID:   docker://11d995c49cb2d90e7c8b7fc48742e002d83d0e3f5bb0a84d577f76f1bd8f2a61</span><br><span class="line">    Image:          10.200.40.39:8080/testproject/k8s-demo:v1.0</span><br><span class="line">    Image ID:       docker-pullable://10.200.40.39:8080/testproject/k8s-demo@sha256:c39c992f2cbfdcd79895749f1470cb0eec3bb10b90eca95be515ef9883d88c9b</span><br><span class="line">    Port:           8235/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Fri, 02 Aug 2024 04:32:32 -0400</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:</span><br><span class="line">      TZ:  Asia/Shanghai</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-w7684 (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-w7684:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-w7684</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  <span class="tag">&lt;<span class="name">none</span>&gt;</span></span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  Normal  Scheduled  13m   default-scheduler  Successfully assigned default/k8s-demo-deployment-76f6dcccd4-zv5sc to k8snode-2</span><br><span class="line">  Normal  Pulled     11m   kubelet            Container image "10.200.40.39:8080/testproject/k8s-demo:v1.0" already present on machine</span><br><span class="line">  Normal  Created    11m   kubelet            Created container k8s-demo</span><br><span class="line">  Normal  Started    11m   kubelet            Started container k8s-demo</span><br></pre></td></tr></tbody></table></figure></div><p>查看应用在容器的执行日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl logs k8s-demo-deployment-76f6dcccd4-zv5sc</span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  '  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::                (v2.4.2)</span><br><span class="line"></span><br><span class="line">2024-08-02 16:32:33.703  INFO 1 --- [           main] com.example.demo.DemoApplication         : Starting DemoApplication v1.0.0 using Java 11 on k8s-demo-deployment-76f6dcccd4-zv5sc with PID 1 (/opt/k8s-demo.jar started by root in /)</span><br><span class="line">2024-08-02 16:32:33.706  INFO 1 --- [           main] com.example.demo.DemoApplication         : No active profile set, falling back to default profiles: default</span><br><span class="line">2024-08-02 16:32:34.621  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8235 (http)</span><br><span class="line">2024-08-02 16:32:34.630  INFO 1 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2024-08-02 16:32:34.630  INFO 1 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.41]</span><br><span class="line">2024-08-02 16:32:34.680  INFO 1 --- [           main] o.a.c.c.C.[.[localhost].[/k8s-demo]      : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2024-08-02 16:32:34.680  INFO 1 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 922 ms</span><br><span class="line">2024-08-02 16:32:35.433  INFO 1 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'</span><br><span class="line">2024-08-02 16:32:35.628  INFO 1 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8235 (http) with context path '/k8s-demo'</span><br><span class="line">2024-08-02 16:32:35.763  INFO 1 --- [           main] com.example.demo.DemoApplication         : Started DemoApplication in 2.615 seconds (JVM running for 3.272)</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster k8s-demo]# kubectl exec -it k8s-demo-deployment-76f6dcccd4-zv5sc -- /bin/bash</span><br><span class="line">[root@k8s-demo-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment k8s-demo-deployment --replicas 3</span><br></pre></td></tr></tbody></table></figure></div><h3 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h3><p>定义service的type类型NodePort,故可以外部访问：<br>    IP访问：<a href="http://10.200.40.40:30235/k8s-demo/" target="_blank" rel="noopener">http://10.200.40.40:30235/k8s-demo/</a><br>    域名访问：<a href="http://test.k8s.com/k8s-demo/，" target="_blank" rel="noopener">http://test.k8s.com/k8s-demo/，</a>   需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：openjdk-11</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722585036230/1722585036230/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722585036230/1722585036230/</id>
    <published>2024-08-02T07:50:36.000Z</published>
    <updated>2024-08-15T06:09:04.096Z</updated>
    
    <content type="html"><![CDATA[<p>下载想要制作的镜像的对应jdk文件，放到同层目录下，如：/usr/local/project/jdk/，目录下存在tar.gz文件和Dockerfile文件<br><img src="/2024/08/1722585036230/1722585036230/20240802160151.png" alt="20240802160151"></p><h3 id="下载openjdk-11"><a href="#下载openjdk-11" class="headerlink" title="下载openjdk-11"></a>下载openjdk-11</h3><p><a href="https://openjdk.org/" target="_blank" rel="noopener">openjdk</a>：<a href="https://openjdk.org/" target="_blank" rel="noopener">https://openjdk.org/</a><br><a href="https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz" target="_blank" rel="noopener">下载地址</a>：<a href="https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz" target="_blank" rel="noopener">https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz</a></p><h3 id="Dockerfile文件内容："><a href="#Dockerfile文件内容：" class="headerlink" title="Dockerfile文件内容："></a>Dockerfile文件内容：</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="DOCKERFILE"><figure class="iseeu highlight /dockerfile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建立一个新的镜像文件，配置模板：新建立的镜像是以centos为基础模板</span></span><br><span class="line"><span class="comment">#因为jdk必须运行在操作系统之上</span></span><br><span class="line"><span class="comment">#每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</span></span><br><span class="line"><span class="comment">#第一条FROM，指定使用哪个镜像源</span></span><br><span class="line"><span class="keyword">FROM</span> centos:centos7</span><br><span class="line"></span><br><span class="line"><span class="comment">#维护者 作者 邮箱</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> demon</span><br><span class="line"></span><br><span class="line"><span class="comment">#RUN 指令告诉docker 在镜像内执行命令，安装了什么</span></span><br><span class="line"><span class="comment">#创建一个新目录来存储jdk文件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  mkdir <span class="string">"/usr/local/jdk"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将jdk压缩文件复制到镜像中，它将自动解压缩tar文件</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> openjdk-11_linux-x64_bin.tar.gz /usr/<span class="built_in">local</span>/jdk</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量《jdk-11》是解压tat.gz出来的文件名</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk/jdk-<span class="number">11</span></span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="comment"># VOLUME 指定了临时文件目录为/tmp</span></span><br><span class="line"><span class="comment"># 其效果是在主机 /var/lib/docker 目录下创建了一个临时文件，并链接到容器的/tmp</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="build镜像"><a href="#build镜像" class="headerlink" title="build镜像"></a>build镜像</h3><h4 id="1-在公网构建镜像-后面的-空格-点-不能漏掉-："><a href="#1-在公网构建镜像-后面的-空格-点-不能漏掉-：" class="headerlink" title="1.在公网构建镜像(后面的 空格+点 不能漏掉)："></a>1.在公网构建镜像(后面的 空格+点 不能漏掉)：</h4><pre><code>docker build -t openjdk-11 .</code></pre><h4 id="2-给镜像打标签："><a href="#2-给镜像打标签：" class="headerlink" title="2.给镜像打标签："></a>2.给镜像打标签：</h4><pre><code>docker tag openjdk-11 10.200.40.39:8080/jdk/openjdk-11</code></pre><h4 id="3-把镜像-push-到本地仓库："><a href="#3-把镜像-push-到本地仓库：" class="headerlink" title="3.把镜像 push 到本地仓库："></a>3.把镜像 push 到本地仓库：</h4><pre><code>docker push 10.200.40.39:8080/jdk/openjdk-11</code></pre><h4 id="4-查看镜像"><a href="#4-查看镜像" class="headerlink" title="4.查看镜像"></a>4.查看镜像</h4><pre><code>docker images</code></pre><h4 id="5-验证镜像"><a href="#5-验证镜像" class="headerlink" title="5.验证镜像"></a>5.验证镜像</h4><pre><code>docker run -id --name checkJdk11 10.200.40.39:8080/jdk/openjdk-11docker psdocker exec -it checkJdk11 bashjava -versionexitdocker stop checkJdk11docker rm checkJdk11</code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722583767468/1722583767468/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722583767468/1722583767468/</id>
    <published>2024-08-02T07:29:27.000Z</published>
    <updated>2024-08-15T06:08:58.556Z</updated>
    
    <content type="html"><![CDATA[<p>该Nginx是经过改造的，而不是传统的Nginx。由于K8S的版本为1.20.6，故我们下载的版本为：nginx-0.30.0。<br><a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">Ingress-Nginx官网地址</a>：<a href="https://kubernetes.github.io/ingress-nginx/" target="_blank" rel="noopener">https://kubernetes.github.io/ingress-nginx/</a><br><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">Ingress-Nginx GitHub地址</a>：<a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx</a><br><a href="https://github.com/kubernetes/ingress-nginx/releases?page=21" target="_blank" rel="noopener">nginx-0.30.0</a>：<a href="https://github.com/kubernetes/ingress-nginx/releases?page=21" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx/releases?page=21</a></p><h3 id="镜像下载"><a href="#镜像下载" class="headerlink" title="镜像下载"></a>镜像下载</h3><pre><code>公网拉取镜像docker pull registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0给镜像添加标签docker tag registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0</code></pre><h3 id="Ingress-Nginx下载"><a href="#Ingress-Nginx下载" class="headerlink" title="Ingress-Nginx下载"></a>Ingress-Nginx下载</h3><pre><code>下载文件：wget https://github.com/kubernetes/ingress-nginx/archive/nginx-0.30.0.tar.gz解压文件：tar xf nginx-0.30.0.tar.gz编辑文件：ingress-nginx-nginx-0.30.0/deploy/static/mandatory.yaml</code></pre><h3 id="yaml文件修改后的配置-mandatory-yaml"><a href="#yaml文件修改后的配置-mandatory-yaml" class="headerlink" title="yaml文件修改后的配置(mandatory.yaml)"></a>yaml文件修改后的配置(mandatory.yaml)</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-configuration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tcp-services</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">udp-services</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"extensions"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"extensions"</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">resourceNames:</span></span><br><span class="line">      <span class="comment"># Defaults to "&lt;election-id&gt;-&lt;ingress-class&gt;"</span></span><br><span class="line">      <span class="comment"># Here: "&lt;ingress-controller-leader&gt;-&lt;nginx&gt;"</span></span><br><span class="line">      <span class="comment"># This has to be adapted if you change either parameter</span></span><br><span class="line">      <span class="comment"># when launching the nginx-ingress-controller.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"ingress-controller-leader-nginx"</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role-nisa-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-role</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole-nisa-binding</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-clusterrole</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span>   <span class="comment"># 从Deployment改为DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="comment">#replicas: 1   # 注释掉</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">prometheus.io/port:</span> <span class="string">"10254"</span></span><br><span class="line">        <span class="attr">prometheus.io/scrape:</span> <span class="string">"true"</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># wait up to five minutes for the drain of connections</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">300</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nginx-ingress-serviceaccount</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">kubernetes.io/os:</span> <span class="string">linux</span></span><br><span class="line">      <span class="comment"># 添加 hostNetwork: true,否则无法通过 K8s 节点 IP 地址绑定域名外部访问</span></span><br><span class="line">      <span class="comment"># ingress-controller 会直接使用 K8s 物理机的 DNS 来解析域名，而不再使用 K8s 内部的 DNS 来解析域名</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line">          <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/nginx-ingress-controller:0.30.0</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--configmap=$(POD_NAMESPACE)/nginx-configuration</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--tcp-services-configmap=$(POD_NAMESPACE)/tcp-services</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--udp-services-configmap=$(POD_NAMESPACE)/udp-services</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--publish-service=$(POD_NAMESPACE)/ingress-nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--annotations-prefix=nginx.ingress.kubernetes.io</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">              <span class="attr">drop:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">              <span class="attr">add:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">            <span class="comment"># www-data -&gt; 101</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">101</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">80</span>    <span class="comment"># 添加处【可在宿主机通过该端口访问Pod】</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">443</span>   <span class="comment"># 添加处【可在宿主机通过该端口访问Pod】</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">lifecycle:</span></span><br><span class="line">            <span class="attr">preStop:</span></span><br><span class="line">              <span class="attr">exec:</span></span><br><span class="line">                <span class="attr">command:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">/wait-shutdown</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ingress-nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> <span class="string">ingress-nginx</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/part-of:</span> <span class="string">ingress-nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">min:</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">90Mi</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="ingress-nginx部署"><a href="#ingress-nginx部署" class="headerlink" title="ingress-nginx部署"></a>ingress-nginx部署</h3><pre><code>应用：    kubectl apply -f mandatory.yaml查看：    kubectl get ds -n ingress-nginx -o wide    kubectl get pod -n ingress-nginx -o wide验证：    kubectl get pods -n ingress-nginx        确保Ingress Controller的Pod状态为Running</code></pre><h3 id="ingress-nginx更新"><a href="#ingress-nginx更新" class="headerlink" title="ingress-nginx更新"></a>ingress-nginx更新</h3><pre><code>先执行 kubectl delete -f mandatory.yaml 清空已安装的pod和configmap，然后根据实际报错修改 mandatory.yaml 再 kubectl apply -f mandatory.yaml</code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
</feed>
