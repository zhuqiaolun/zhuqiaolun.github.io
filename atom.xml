<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>zhuqiaolun - 个人博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.zhuqiaolun.com/"/>
  <updated>2025-12-05T05:39:51.223Z</updated>
  <id>https://www.zhuqiaolun.com/</id>
  
  <author>
    <name>十二</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>JavaFx之过渡动画</title>
    <link href="https://www.zhuqiaolun.com/2025/12/1764912927964/1764912927964/"/>
    <id>https://www.zhuqiaolun.com/2025/12/1764912927964/1764912927964/</id>
    <published>2025-12-05T05:35:27.000Z</published>
    <updated>2025-12-05T05:39:51.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p><h2 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h2><p><img src="/2025/12/1764912927964/1764912927964/20251205133736.png" alt="20251205133736"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 虚拟数据，实际map放自己需要的内容</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> objectMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">objectMap.put("result", new Random().nextInt(2));</span><br><span class="line">// 导出</span><br><span class="line">try {</span><br><span class="line">    Dialog dialog = SystemAlert.getDialog(window, "导出中···", FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource("fxml/Export.fxml"))));</span><br><span class="line">    dialog.initStyle(StageStyle.UNDECORATED);</span><br><span class="line">    ExportController exportController = ExportController.getInstance();</span><br><span class="line">    exportController.loadProgress(dialog.getTitle(), objectMap, dialog);</span><br><span class="line">    dialog.showAndWait();</span><br><span class="line">} catch (Exception e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="ExportController"><a href="#ExportController" class="headerlink" title="ExportController"></a>ExportController</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.controller;</span><br><span class="line"></span><br><span class="line">import cn.hutool.core.util.StrUtil;</span><br><span class="line">import com.demon.ui.SystemAlert;</span><br><span class="line">import javafx.concurrent.Service;</span><br><span class="line">import javafx.concurrent.Task;</span><br><span class="line">import javafx.fxml.FXML;</span><br><span class="line">import javafx.fxml.Initializable;</span><br><span class="line">import javafx.scene.control.Button;</span><br><span class="line">import javafx.scene.control.Dialog;</span><br><span class="line">import javafx.scene.control.Label;</span><br><span class="line">import javafx.scene.control.ProgressIndicator;</span><br><span class="line">import javafx.stage.Window;</span><br><span class="line"></span><br><span class="line">import java.net.URL;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.ResourceBundle;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">public class ExportController implements Initializable {</span><br><span class="line"></span><br><span class="line">    private static ExportController exportController;</span><br><span class="line"></span><br><span class="line">    @FXML</span><br><span class="line">    public ProgressIndicator downloadProgressIndicator;</span><br><span class="line">    @FXML</span><br><span class="line">    public Label exportStatus;</span><br><span class="line">    @FXML</span><br><span class="line">    public Button downloadYes;</span><br><span class="line"></span><br><span class="line">    private Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> dataMap;</span><br><span class="line">    /**</span><br><span class="line">     * 异步 Service</span><br><span class="line">     */</span><br><span class="line">    private Service<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> serviceExecute = new Service<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() {</span><br><span class="line">        @Override</span><br><span class="line">        protected Task<span class="tag">&lt;<span class="name">Integer</span>&gt;</span> createTask() {</span><br><span class="line">            return new Task<span class="tag">&lt;<span class="name">Integer</span>&gt;</span>() {</span><br><span class="line">                @Override</span><br><span class="line">                protected Integer call() {</span><br><span class="line">                    //业务逻辑，每执行一次 updateProgress 则可以 调用监听事件</span><br><span class="line">                    try {</span><br><span class="line">                        // 导出操作</span><br><span class="line">                        int result = (int)dataMap.get("result");</span><br><span class="line">                        System.out.println(result);</span><br><span class="line">                        TimeUnit.SECONDS.sleep(5); // 休眠10s 模拟导出过程，真实场景不需要</span><br><span class="line">                        // 以上为自己业务的逻辑</span><br><span class="line">                        if (result == 0) {</span><br><span class="line">                            System.out.println("导出完成！！！");</span><br><span class="line">                            downloadYes.setUserData(true);</span><br><span class="line">                            this.updateProgress(1, 1);</span><br><span class="line">                        } else {</span><br><span class="line">                            System.out.println("导出失败！！！");</span><br><span class="line">                            exportStatus.setUserData("自定义是失败原因");</span><br><span class="line">                            downloadYes.setUserData(false);</span><br><span class="line">                            this.updateProgress(0, 0);</span><br><span class="line">                        }</span><br><span class="line">                    } catch (Exception e) {</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        downloadYes.setUserData(false);</span><br><span class="line">                        exportStatus.setUserData(String.valueOf(e.toString()));</span><br><span class="line">                        System.out.println("导出异常");</span><br><span class="line">                        updateProgress(0, 0);</span><br><span class="line">                    } finally {</span><br><span class="line">                        downloadYes.setDisable(false);</span><br><span class="line">                    }</span><br><span class="line">                    return null;</span><br><span class="line">                }</span><br><span class="line">            };</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    static ExportController getInstance() {</span><br><span class="line">        return exportController;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initialize(URL location, ResourceBundle resources) {</span><br><span class="line">        exportController = this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    void loadProgress(String title, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> dataMap, Dialog dialog) {</span><br><span class="line">        this.dataMap = dataMap;</span><br><span class="line">        exportStatus.setText(title);</span><br><span class="line">        downloadYes.setOnMouseClicked(event -&gt; SystemAlert.getCloseDialogPane(downloadYes));</span><br><span class="line">        // 执行  调用 updateProgress 的 监听事件</span><br><span class="line">        serviceExecute.progressProperty().addListener((observable, oldValue, newValue) -&gt; {</span><br><span class="line">            Window window = downloadYes.getScene().getWindow();</span><br><span class="line">            System.out.println(newValue);</span><br><span class="line">            if ("NaN".equals(String.valueOf(newValue))) {</span><br><span class="line">                //导出异常-关闭loading</span><br><span class="line">                dialog.close();</span><br><span class="line">                exportStatus.setText("导出异常");</span><br><span class="line">                SystemAlert.getAlertToInfo(window, "提示", "导出异常", String.valueOf(exportStatus.getUserData()));</span><br><span class="line">                SystemAlert.getCloseDialogPane(downloadYes);</span><br><span class="line">            } else {</span><br><span class="line">                if (!StrUtil.isNullOrUndefined(String.valueOf(downloadYes.getUserData())) &amp;&amp; Boolean.parseBoolean(String.valueOf(downloadYes.getUserData()))) {</span><br><span class="line">                    //导出完成-关闭loading</span><br><span class="line">                    dialog.close();</span><br><span class="line">                    exportStatus.setText("导出成功");</span><br><span class="line">                    // 导出完成后的操作··</span><br><span class="line">                    //MainController.getInstance().loadData();</span><br><span class="line">                    // 以上为自己业务的逻辑</span><br><span class="line">                    SystemAlert.getCloseDialogPane(downloadYes);</span><br><span class="line">                } else {</span><br><span class="line">                    exportStatus.setText("导出中···");</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        });</span><br><span class="line">        serviceExecute.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="Fxml"><a href="#Fxml" class="headerlink" title="Fxml"></a>Fxml</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.geometry.Insets<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.Button<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.Label<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.control.ProgressIndicator<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="php"><span class="meta">&lt;?</span>import javafx.scene.layout.*<span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">AnchorPane</span> <span class="attr">xmlns</span>=<span class="string">"http://javafx.com/javafx"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:fx</span>=<span class="string">"http://javafx.com/fxml"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">fx:controller</span>=<span class="string">"com.demon.controller.ExportController"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prefHeight</span>=<span class="string">"150.0"</span> <span class="attr">prefWidth</span>=<span class="string">"300.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">BorderPane</span> <span class="attr">layoutX</span>=<span class="string">"30.0"</span> <span class="attr">layoutY</span>=<span class="string">"30.0"</span> <span class="attr">style</span>=<span class="string">"-fx-background-color: #FFFFFF;"</span> <span class="attr">AnchorPane.bottomAnchor</span>=<span class="string">"-40.0"</span> <span class="attr">AnchorPane.leftAnchor</span>=<span class="string">"0.0"</span> <span class="attr">AnchorPane.rightAnchor</span>=<span class="string">"0.0"</span> <span class="attr">AnchorPane.topAnchor</span>=<span class="string">"0.0"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ProgressIndicator</span> <span class="attr">fx:id</span>=<span class="string">"downloadProgressIndicator"</span> <span class="attr">prefHeight</span>=<span class="string">"123.0"</span> <span class="attr">prefWidth</span>=<span class="string">"300.0"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">top</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">HBox</span> <span class="attr">alignment</span>=<span class="string">"CENTER_LEFT"</span> <span class="attr">prefHeight</span>=<span class="string">"25.0"</span> <span class="attr">style</span>=<span class="string">"-fx-background-color: #F8F8F8;"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Label</span> <span class="attr">fx:id</span>=<span class="string">"exportStatus"</span> <span class="attr">text</span>=<span class="string">"加载提示中···"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">padding</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Insets</span> <span class="attr">left</span>=<span class="string">"10.0"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">padding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">HBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">top</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bottom</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">HBox</span> <span class="attr">alignment</span>=<span class="string">"CENTER"</span> <span class="attr">prefHeight</span>=<span class="string">"20.0"</span> <span class="attr">BorderPane.alignment</span>=<span class="string">"CENTER"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">children</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">fx:id</span>=<span class="string">"downloadYes"</span> <span class="attr">disable</span>=<span class="string">"true"</span> <span class="attr">mnemonicParsing</span>=<span class="string">"false"</span> <span class="attr">text</span>=<span class="string">"确定"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">padding</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">Insets</span> <span class="attr">bottom</span>=<span class="string">"2.0"</span> <span class="attr">left</span>=<span class="string">"2.0"</span> <span class="attr">right</span>=<span class="string">"2.0"</span> <span class="attr">top</span>=<span class="string">"15.0"</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">padding</span>&gt;</span><span class="tag">&lt;/<span class="name">HBox</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bottom</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">BorderPane</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">children</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">AnchorPane</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      过渡动画
    
    </summary>
    
    
      <category term="JavaFx" scheme="https://www.zhuqiaolun.com/categories/JavaFx/"/>
    
    
      <category term="ProgressIndicator" scheme="https://www.zhuqiaolun.com/tags/ProgressIndicator/"/>
    
  </entry>
  
  <entry>
    <title>JavaFx之Alert提示框</title>
    <link href="https://www.zhuqiaolun.com/2025/12/1764905210595/1764905210595/"/>
    <id>https://www.zhuqiaolun.com/2025/12/1764905210595/1764905210595/</id>
    <published>2025-12-05T03:26:50.000Z</published>
    <updated>2025-12-05T05:39:47.129Z</updated>
    
    <content type="html"><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getAlertToInfo(this.window, "提示", "没有选中的数据", null);</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getAlertToConfig(this.getWindow(), "信息", "选中的数据", jsonString);</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">File file = new File("C:\\Users\\Demon\\Desktop\\将近酒.txt");</span><br><span class="line">Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> optionalButtonType = SystemAlert.getOpenFile(this.window, file.getName(), file.getAbsolutePath());</span><br><span class="line">if (optionalButtonType.isPresent()) {</span><br><span class="line">    ButtonType buttonType = optionalButtonType.get();</span><br><span class="line">    System.out.println(buttonType.getButtonData().name());</span><br><span class="line">    if (buttonType.getButtonData() == ButtonType.FINISH.getButtonData()) {</span><br><span class="line">        try {</span><br><span class="line">            Desktop.getDesktop().open(file);</span><br><span class="line">        } catch (IOException e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File file = new File("C:\\Users\\Demon\\Desktop");</span><br><span class="line">String fileName = "test";</span><br><span class="line">Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> filterMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">filterMap.put("Excel 工作簿", "*.xlsx");</span><br><span class="line">filterMap.put("Excel 97-2003 工作簿", "*.xls");</span><br><span class="line">try {</span><br><span class="line">    File openFileDir = SystemAlert.getOpenDir(this.window, file, fileName, filterMap);</span><br><span class="line">    System.out.println(openFileDir);</span><br><span class="line">} catch (IOException e) {</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="SystemAlert"><a href="#SystemAlert" class="headerlink" title="SystemAlert"></a>SystemAlert</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.ui;</span><br><span class="line"></span><br><span class="line">import javafx.scene.Node;</span><br><span class="line">import javafx.scene.control.*;</span><br><span class="line">import javafx.stage.FileChooser;</span><br><span class="line">import javafx.stage.Window;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-12-04 004 15:31</span><br><span class="line"> * description: 提示框   Alert.AlertType  自行扩展</span><br><span class="line"> */</span><br><span class="line">public class SystemAlert {</span><br><span class="line"></span><br><span class="line">    // 提示 INFORMATION</span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getAlertToInfo(Window window, String title, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span><br><span class="line">        alert.setTitle(title);</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        alert.getButtonTypes().set(0, ButtonType.CLOSE);</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    // 提示 CONFIRMATION</span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getAlertToConfig(Window window, String title, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.CONFIRMATION);</span><br><span class="line">        alert.setTitle(title);</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        alert.getButtonTypes().set(0, new ButtonType("确定", ButtonType.OK.getButtonData()));</span><br><span class="line">        alert.getButtonTypes().set(1, new ButtonType("取消", ButtonType.NO.getButtonData()));</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Optional<span class="tag">&lt;<span class="name">ButtonType</span>&gt;</span> getOpenFile(Window window, String headerText, String contentText) {</span><br><span class="line">        Alert alert = new Alert(Alert.AlertType.INFORMATION);</span><br><span class="line">        alert.setTitle("打开文件");</span><br><span class="line">        alert.setHeaderText(headerText);</span><br><span class="line">        alert.setContentText(contentText);</span><br><span class="line">        ButtonType finalButtonType = new ButtonType("打开", ButtonType.FINISH.getButtonData());</span><br><span class="line">        ButtonType closeButtonType = new ButtonType("关闭", ButtonType.CLOSE.getButtonData());</span><br><span class="line">        alert.getButtonTypes().clear();</span><br><span class="line">        alert.getButtonTypes().add(0, finalButtonType);</span><br><span class="line">        alert.getButtonTypes().add(1, closeButtonType);</span><br><span class="line">        alert.initOwner(window);</span><br><span class="line">        return alert.showAndWait();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 弹窗选择目录框</span><br><span class="line">     *</span><br><span class="line">     * @param fileName  文件名（不含后缀）</span><br><span class="line">     * @param filterMap key=描述,value=过滤</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    public static File getOpenDir(Window window, File file, String fileName, Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> filterMap) throws IOException {</span><br><span class="line">        FileChooser fileChooser = new FileChooser();</span><br><span class="line">        fileChooser.setTitle("选择目录");</span><br><span class="line">        //打开选择目录，设置默认文件名</span><br><span class="line">        fileChooser.setInitialFileName(fileName);</span><br><span class="line">        //打开选择目录，设置默认路径为桌面</span><br><span class="line">        //fileChooser.setInitialDirectory(FileSystemView.getFileSystemView().getHomeDirectory());</span><br><span class="line">        fileChooser.setInitialDirectory(file);</span><br><span class="line">        //打开选择目录，设置过滤目录文件</span><br><span class="line">        if (filterMap != null &amp;&amp; filterMap.size() &gt; 0) {</span><br><span class="line">            for (Map.Entry<span class="tag">&lt;<span class="name">String,</span> <span class="attr">String</span>&gt;</span> entry : filterMap.entrySet()) {</span><br><span class="line">                String description = entry.getKey(), extensions = entry.getValue();</span><br><span class="line">                fileChooser.getExtensionFilters().add(new FileChooser.ExtensionFilter(description, extensions));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return fileChooser.showSaveDialog(window);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static Dialog getDialog(Window window, String title, Node content) {</span><br><span class="line">        Dialog dialog = new Dialog<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        dialog.setTitle(title);</span><br><span class="line">        dialog.setHeaderText(null);</span><br><span class="line">        ButtonType closeButtonType = new ButtonType("关闭", ButtonBar.ButtonData.CANCEL_CLOSE);</span><br><span class="line">        dialog.getDialogPane().getButtonTypes().addAll(closeButtonType);</span><br><span class="line">        //添加组件</span><br><span class="line">        dialog.getDialogPane().setContent(content);</span><br><span class="line">        dialog.initOwner(window);</span><br><span class="line">        //隐藏按钮</span><br><span class="line">        Node closeButton = dialog.getDialogPane().lookupButton(closeButtonType);</span><br><span class="line">        closeButton.setVisible(false);</span><br><span class="line">        return dialog;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 关闭当前弹窗面板</span><br><span class="line">     */</span><br><span class="line">    public static void getCloseDialogPane(Button closeBtn) {</span><br><span class="line">        DialogPane dialogPane = (DialogPane) closeBtn.getScene().getRoot();</span><br><span class="line">        for (ButtonType bt : dialogPane.getButtonTypes()) {</span><br><span class="line">            if (bt.getButtonData() == ButtonBar.ButtonData.CANCEL_CLOSE) {</span><br><span class="line">                closeBtn = (Button) dialogPane.lookupButton(bt);</span><br><span class="line">                closeBtn.fire();</span><br><span class="line">                break;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Alert提示框
    
    </summary>
    
    
      <category term="JavaFx" scheme="https://www.zhuqiaolun.com/categories/JavaFx/"/>
    
    
      <category term="Alert" scheme="https://www.zhuqiaolun.com/tags/Alert/"/>
    
  </entry>
  
  <entry>
    <title>JavaFx之TableView工具</title>
    <link href="https://www.zhuqiaolun.com/2025/12/1764903803268/1764903803268/"/>
    <id>https://www.zhuqiaolun.com/2025/12/1764903803268/1764903803268/</id>
    <published>2025-12-05T03:03:23.000Z</published>
    <updated>2025-12-05T05:40:00.416Z</updated>
    
    <content type="html"><![CDATA[<h2 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h2><p><a href="https://github.com/zhuqiaolun/Javafx-TableView" target="_blank" rel="noopener">传送门</a></p><h2 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h2><p><img src="/2025/12/1764903803268/1764903803268/20251205112533.png" alt="20251205112533"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 初始化 表格样式</span><br><span class="line">TableViewUi<span class="tag">&lt;<span class="name">TableViewDemo</span>&gt;</span> tableViewUi = new TableViewUi<span class="tag">&lt;&gt;</span>(true);</span><br><span class="line">// 加载表格列表0</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn0 = tableViewUi.addTableColumn("序号");</span><br><span class="line">nameTableColumn0.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getIndex()));</span><br><span class="line">nameTableColumn0.setMinWidth(50);</span><br><span class="line">nameTableColumn0.setMaxWidth(50);</span><br><span class="line">// 加载表格列表1</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn1 = tableViewUi.addTableColumn("姓名");</span><br><span class="line">nameTableColumn1.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getName()));</span><br><span class="line">nameTableColumn1.setMinWidth(60);</span><br><span class="line">nameTableColumn1.setMaxWidth(80);</span><br><span class="line">// 加载表格列表2</span><br><span class="line">TableColumn<span class="tag">&lt;<span class="name">TableViewDemo,</span> <span class="attr">String</span>&gt;</span> nameTableColumn2 = tableViewUi.addTableColumn("年龄");</span><br><span class="line">nameTableColumn2.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getAge()));</span><br><span class="line">nameTableColumn2.setMinWidth(60);</span><br><span class="line">nameTableColumn2.setMaxWidth(80);</span><br><span class="line">// 加载表格数据</span><br><span class="line">List<span class="tag">&lt;<span class="name">TableViewDemo</span>&gt;</span> tableViewDemoList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">for (int i = 0; i <span class="tag">&lt;<span class="name">20</span> ; <span class="attr">i</span>++) {</span></span><br><span class="line"><span class="tag">    <span class="attr">tableViewDemoList.add</span>(<span class="attr">new</span> <span class="attr">TableViewDemo</span>()<span class="attr">.setIndex</span>(<span class="attr">String.valueOf</span>(<span class="attr">i</span>+<span class="attr">1</span>))<span class="attr">.setName</span>("张三"+<span class="attr">i</span>)<span class="attr">.setAge</span>(<span class="attr">String.valueOf</span>(<span class="attr">ThreadLocalRandom.current</span>()<span class="attr">.nextInt</span>(<span class="attr">10</span>, <span class="attr">100</span>))));</span></span><br><span class="line"><span class="tag">}</span></span><br><span class="line"><span class="tag"><span class="attr">tableViewUi.initData</span>(<span class="attr">tableViewDemoList</span>);</span></span><br><span class="line"><span class="tag">// 将表格添加到容器组件</span></span><br><span class="line">TableView&lt;TableViewDemo&gt; tableView = tableViewUi.getTableView();</span><br></pre></td></tr></tbody></table></figure><h2 id="TableViewUi"><a href="#TableViewUi" class="headerlink" title="TableViewUi"></a>TableViewUi</h2><p>创建一个表格UI，快速加载表格数据</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line">import javafx.beans.InvalidationListener;</span><br><span class="line">import javafx.beans.value.ChangeListener;</span><br><span class="line">import javafx.beans.value.ObservableValue;</span><br><span class="line">import javafx.collections.FXCollections;</span><br><span class="line">import javafx.collections.ObservableList;</span><br><span class="line">import javafx.scene.control.CheckBox;</span><br><span class="line">import javafx.scene.control.TableCell;</span><br><span class="line">import javafx.scene.control.TableColumn;</span><br><span class="line">import javafx.scene.control.TableView;</span><br><span class="line">import javafx.util.Callback;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  author: Demon</span><br><span class="line"> *  date: 2025-12-04 004 14:48</span><br><span class="line"> *  description: 表格UI</span><br><span class="line"> */ </span><br><span class="line">public class TableViewUi<span class="tag">&lt;<span class="name">T</span> <span class="attr">extends</span> <span class="attr">TableViewUi.TableViewData</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    private TableView<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableView = new TableView<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    private CheckBox checkBoxAll = new CheckBox("全选");</span><br><span class="line"></span><br><span class="line">    public TableViewUi(boolean isNeedCheckBoxAll) {</span><br><span class="line">        tableView.getStylesheets().add("css/table.css");</span><br><span class="line">        this.tableView.setEditable(false);</span><br><span class="line">        this.tableView.setColumnResizePolicy((param) -&gt; true);</span><br><span class="line">        this.tableView.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY);</span><br><span class="line">        this.tableView.setFocusTraversable(false);</span><br><span class="line">        if (isNeedCheckBoxAll) {</span><br><span class="line">            this.checkBoxAll.setText("");</span><br><span class="line">            this.checkBoxAll.setSelected(false);</span><br><span class="line">            this.checkBoxAll.setOnAction(event -&gt; this.getSelectAllEvent());</span><br><span class="line">            // 第一列</span><br><span class="line">            TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> checkBoxTableColumn = new TableColumn<span class="tag">&lt;&gt;</span>();</span><br><span class="line">            checkBoxTableColumn.setCellValueFactory(cellData -&gt; cellData.getValue().getCb().getCheckBox());</span><br><span class="line">            checkBoxTableColumn.setCellFactory(this.getTableCellFactoryToCheckBox());</span><br><span class="line">            checkBoxTableColumn.setMinWidth(50);</span><br><span class="line">            checkBoxTableColumn.setMaxWidth(50);</span><br><span class="line">            //checkBoxTableColumn.setStyle("-fx-alignment:center");</span><br><span class="line">            checkBoxTableColumn.setGraphic(checkBoxAll);</span><br><span class="line">            checkBoxTableColumn.setSortable(false);</span><br><span class="line">            tableView.getColumns().add(checkBoxTableColumn);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableView<span class="tag">&lt;<span class="name">T</span>&gt;</span> getTableView() {</span><br><span class="line">        return tableView;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 添加列：</span><br><span class="line">     * tableColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue()));</span><br><span class="line">     * tableColumn.setMinWidth(60);</span><br><span class="line">     * tableColumn.setMaxWidth(80);</span><br><span class="line">     *</span><br><span class="line">     * @param tableColumnName 列名</span><br><span class="line">     */</span><br><span class="line">    public TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">String</span>&gt;</span> addTableColumn(String tableColumnName) {</span><br><span class="line">        TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">String</span>&gt;</span> tableColumn = new TableColumn<span class="tag">&lt;&gt;</span>(tableColumnName);</span><br><span class="line">        tableColumn.setVisible(true);</span><br><span class="line">        this.tableView.getColumns().add(tableColumn);</span><br><span class="line">        return tableColumn;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void initData(List<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableViewList) {</span><br><span class="line">        tableView.getItems().clear();</span><br><span class="line">        tableView.setItems(FXCollections.observableArrayList(tableViewList));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public List<span class="tag">&lt;<span class="name">T</span>&gt;</span> getTableViewToSelectData() {</span><br><span class="line">        List<span class="tag">&lt;<span class="name">T</span>&gt;</span> dataList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> tableViewItems = tableView.getItems();</span><br><span class="line">        if (tableViewItems.size() &gt; 0) {</span><br><span class="line">            for (T t : tableViewItems) {</span><br><span class="line">                if (t.getCb().isSelected()) {</span><br><span class="line">                    dataList.add(t);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        return dataList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化复选框-监听-所有checkbox复选框都勾选则全选框勾选，</span><br><span class="line">     * 所有checkbox复选框不勾选则全选框不勾选</span><br><span class="line">     *</span><br><span class="line">     * @return 返回</span><br><span class="line">     */</span><br><span class="line">    private Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt; getTableCellFactoryToCheckBox() {</span><br><span class="line">        return new Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt;() {</span><br><span class="line">            @Override</span><br><span class="line">            public TableCell<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> call(TableColumn<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span> param) {</span><br><span class="line">                return new TableCell<span class="tag">&lt;<span class="name">T,</span> <span class="attr">CheckBox</span>&gt;</span>() {</span><br><span class="line">                    @Override</span><br><span class="line">                    public void updateItem(CheckBox item, boolean empty) {</span><br><span class="line">                        super.updateItem(item, empty);</span><br><span class="line">                        setGraphic(item);</span><br><span class="line">                        if (item != null) {</span><br><span class="line">                            item.selectedProperty().addListener((observable, oldValue, newValue) -&gt; {</span><br><span class="line">                                boolean flagSelectAll = true;</span><br><span class="line">                                ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> items2 = tableView.getItems();</span><br><span class="line">                                for (T t : items2) {</span><br><span class="line">                                    if (!t.getCb().isSelected()) {</span><br><span class="line">                                        flagSelectAll = false;</span><br><span class="line">                                        break;</span><br><span class="line">                                    }</span><br><span class="line">                                }</span><br><span class="line">                                checkBoxAll.setSelected(flagSelectAll);</span><br><span class="line">                            });</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                };</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private void getSelectAllEvent() {</span><br><span class="line">        ObservableList<span class="tag">&lt;<span class="name">T</span>&gt;</span> items = tableView.getItems();</span><br><span class="line">        if (checkBoxAll.isSelected()) {</span><br><span class="line">            for (T t : items) {</span><br><span class="line">                t.getCb().setCheckbox(true);</span><br><span class="line">            }</span><br><span class="line">            checkBoxAll.setSelected(true);</span><br><span class="line">        } else {</span><br><span class="line">            for (T t : items) {</span><br><span class="line">                t.getCb().setCheckbox(false);</span><br><span class="line">            }</span><br><span class="line">            checkBoxAll.setSelected(false);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class TableViewData {</span><br><span class="line"></span><br><span class="line">        private CheckboxUi cb = new CheckboxUi();</span><br><span class="line"></span><br><span class="line">        CheckboxUi getCb() {</span><br><span class="line">            return cb;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static class CheckboxUi {</span><br><span class="line"></span><br><span class="line">        private CheckBox checkbox = new CheckBox();</span><br><span class="line"></span><br><span class="line">        ObservableValue<span class="tag">&lt;<span class="name">CheckBox</span>&gt;</span> getCheckBox() {</span><br><span class="line">            return new ObservableValue<span class="tag">&lt;<span class="name">CheckBox</span>&gt;</span>() {</span><br><span class="line">                @Override</span><br><span class="line">                public CheckBox getValue() {</span><br><span class="line">                    return checkbox;</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void addListener(ChangeListener<span class="php"><span class="meta">&lt;?</span> super CheckBox&gt; listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void removeListener(ChangeListener<span class="meta">&lt;?</span> super CheckBox&gt; listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void addListener(InvalidationListener listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"></span><br><span class="line"><span class="php">                @Override</span></span><br><span class="line"><span class="php">                <span class="keyword">public</span> void removeListener(InvalidationListener listener) {</span></span><br><span class="line"><span class="php">                }</span></span><br><span class="line"><span class="php">            };</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"></span><br><span class="line"><span class="php">        Boolean isSelected() {</span></span><br><span class="line"><span class="php">            <span class="keyword">return</span> checkbox.isSelected();</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"></span><br><span class="line"><span class="php">        void setCheckbox(boolean value) {</span></span><br><span class="line"><span class="php">            checkbox.setSelected(value);</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"><span class="php">}</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="TableViewDemo"><a href="#TableViewDemo" class="headerlink" title="TableViewDemo"></a>TableViewDemo</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.ui.TableViewUi;</span><br><span class="line"></span><br><span class="line">public class TableViewDemo extends TableViewUi.TableViewData {</span><br><span class="line">    private String index;</span><br><span class="line">    private String name;</span><br><span class="line">    private String age;</span><br><span class="line">    public String getIndex() {</span><br><span class="line">        return index;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setIndex(String index) {</span><br><span class="line">        this.index = index;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getName() {</span><br><span class="line">        return name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setName(String name) {</span><br><span class="line">        this.name = name;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public String getAge() {</span><br><span class="line">        return age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public TableViewDemo setAge(String age) {</span><br><span class="line">        this.age = age;</span><br><span class="line">        return this;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      TableView工具
    
    </summary>
    
    
      <category term="JavaFx" scheme="https://www.zhuqiaolun.com/categories/JavaFx/"/>
    
    
      <category term="TableView" scheme="https://www.zhuqiaolun.com/tags/TableView/"/>
    
  </entry>
  
  <entry>
    <title>MongoTemplate的封装应用：MongoTemplateUtil</title>
    <link href="https://www.zhuqiaolun.com/2025/08/1755659266090/1755659266090/"/>
    <id>https://www.zhuqiaolun.com/2025/08/1755659266090/1755659266090/</id>
    <published>2025-08-20T03:07:46.000Z</published>
    <updated>2025-08-20T05:27:53.953Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/2020/11/1605079105126/1605079105126/">SpringUtils类</a></p><p><a href="/2025/08/1755658946010/1755658946010/">MongoTemplate配置</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.utils;</span><br><span class="line"></span><br><span class="line">import com.mongodb.bulk.BulkWriteResult;</span><br><span class="line">import com.mongodb.client.result.DeleteResult;</span><br><span class="line">import com.mongodb.client.result.UpdateResult;</span><br><span class="line">import com.demon.common.core.utils.SpringUtils;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.domain.PageRequest;</span><br><span class="line">import org.springframework.data.mongodb.core.BulkOperations;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Query;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Update;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongo 工具类</span><br><span class="line"> *</span><br><span class="line"> * @author demon</span><br><span class="line"> * <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line"> * 参考：https://blog.csdn.net/mouday/article/details/128706828</span><br><span class="line"> * 参考：https://www.cnblogs.com/mihutao/p/17522327.html</span><br><span class="line"> * 参考：https://www.cnblogs.com/gongchengship/p/18306392</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public class MongoTemplateUtil {</span><br><span class="line"></span><br><span class="line">    private static final MongoTemplate mongoTemplate = SpringUtils.getBean(MongoTemplate.class);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入一条记录（选择字段，策略插入）</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> T save(T entity) {</span><br><span class="line">        return mongoTemplate.insert(entity);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 插入（批量）</span><br><span class="line">     */</span><br><span class="line">    public static <span class="tag">&lt;<span class="name">T</span>&gt;</span> Collection<span class="tag">&lt;<span class="name">T</span>&gt;</span> saveBatch(Collection<span class="php"><span class="meta">&lt;?</span> extends T&gt; entityList, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.insert(entityList, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 删除</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> DeleteResult removeById(String id, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.remove(new Query(Criteria.where("_id").is(id)), entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除（根据ID 批量删除）</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeByIds(Collection<span class="php"><span class="meta">&lt;?</span> extends Serializable&gt; idList, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.remove(new Query(Criteria.where("_id").in(idList)), entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 columnMap 条件，删除记录</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeByMap(Map<span class="tag">&lt;<span class="name">String,</span> <span class="attr">Object</span>&gt;</span> columnMap, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        Criteria criteria = <span class="keyword">new</span> Criteria();</span></span><br><span class="line"><span class="php">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : columnMap.entrySet()) {</span></span><br><span class="line"><span class="php">            criteria.<span class="keyword">and</span>(entry.getKey()).is(entry.getValue());</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.remove(<span class="keyword">new</span> Query(criteria), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 设置的条件，删除记录</span><br><span class="line">     * eg: Query query = new Query(Criteria.where("_id").is("123456912").and("age").gt(11));</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> DeleteResult removeByQuery(Query query, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        log.info("MongoTemplateUtil.removeByQuery执行语句：{}", query.toString());</span><br><span class="line">        return mongoTemplate.remove(query, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除文档全部数据</span><br><span class="line">     */</span><br><span class="line">    public static DeleteResult removeAll(Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.remove(<span class="keyword">new</span> Query(), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 Query条件 更新</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> UpdateResult update(Query query, Update update, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.updateMulti(query, update, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 更新</span><br><span class="line">     */</span><br><span class="line">    public static UpdateResult updateById(String id, Update update, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.updateMulti(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).is(id)), update, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据ID 批量更新</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> UpdateResult updateBatchById(Collection&lt;String&gt; ids, Update update, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.updateMulti(new Query(Criteria.where("_id").in(ids)), update, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 Query条件 批量更新</span><br><span class="line">     */</span><br><span class="line">    public static BulkWriteResult updateBatchByQuery(Map<span class="tag">&lt;<span class="name">Query,</span> <span class="attr">Update</span>&gt;</span> queryUpdateMap, Class<span class="php"><span class="meta">&lt;?</span>&gt; entityClass) {</span></span><br><span class="line"><span class="php">        BulkOperations bulkOperations = mongoTemplate.bulkOps(BulkOperations.BulkMode.ORDERED, entityClass);</span></span><br><span class="line"><span class="php">        <span class="keyword">for</span> (Map.Entry&lt;Query, Update&gt; entry : queryUpdateMap.entrySet()) {</span></span><br><span class="line"><span class="php">            bulkOperations.updateMulti(entry.getKey(), entry.getValue());</span></span><br><span class="line"><span class="php">        }</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> bulkOperations.execute();</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 ID 查询</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T selectById(String id, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findById(id, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询（根据ID 批量查询）</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectBatchIds(Collection&lt;String&gt; ids, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(<span class="keyword">new</span> Query(Criteria.where(<span class="string">"_id"</span>).in(ids)), entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询一条记录，结果集如果是多个会取第一条</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T selectOne(Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findOne(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询全部记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectList(Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询全部记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectList(<span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.findAll(entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询分页记录</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">List</span>&lt;T&gt; selectPage(int page, int size, Query query, <span class="class"><span class="keyword">Class</span>&lt;<span class="title">T</span>&gt; <span class="title">entityClass</span>) </span>{</span></span><br><span class="line"><span class="php">        query.with(PageRequest.of(page, size));</span></span><br><span class="line"><span class="php">        log.info(<span class="string">"MongoTemplateUtil.selectPage执行语句：{}"</span>, query.toString());</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> mongoTemplate.find(query, entityClass);</span></span><br><span class="line"><span class="php">    }</span></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据 query 条件，查询总记录数</span><br><span class="line"><span class="php">     */</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="keyword">static</span> long selectCount(Query query, <span class="class"><span class="keyword">Class</span>&lt;?&gt;</span></span> entityClass) {</span><br><span class="line">        return mongoTemplate.count(query, entityClass);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      MongoTemplateUtil
    
    </summary>
    
    
      <category term="SpringBoot" scheme="https://www.zhuqiaolun.com/categories/SpringBoot/"/>
    
    
      <category term="MongoDb" scheme="https://www.zhuqiaolun.com/tags/MongoDb/"/>
    
  </entry>
  
  <entry>
    <title>MongoTemplate的简单应用（spring-boot-starter-data-mongodb）</title>
    <link href="https://www.zhuqiaolun.com/2025/08/1755658946010/1755658946010/"/>
    <id>https://www.zhuqiaolun.com/2025/08/1755658946010/1755658946010/</id>
    <published>2025-08-20T03:02:26.000Z</published>
    <updated>2025-08-20T05:25:31.064Z</updated>
    
    <content type="html"><![CDATA[<p>MongoDB是一款开源的文档型数据库，它以动态的模式存储类似JSON的BSON文档，能够处理大量的非结构化数据。<br>其特点包括灵活的数据模型、高效的索引机制、支持数据复制和分片，以及易于使用的API。<br>MongoDB适用于需要快速迭代和存储多样化数据格式的应用场景。  </p><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 可选：用于 JSON 序列化/反序列化 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-driver-legacy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="yml-配置"><a href="#yml-配置" class="headerlink" title="yml 配置"></a>yml 配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># mongodb 配置</span><br><span class="line">mongodb:</span><br><span class="line">  uri: mongodb://127.0.0.1:27017/dataBaseName</span><br><span class="line">  database: dataBaseName</span><br></pre></td></tr></tbody></table></figure></div><h3 id="config-配置"><a href="#config-配置" class="headerlink" title="config 配置"></a>config 配置</h3><p>当前的uri为无密码写法</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.config.properties;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongodb 配置属性</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@ConfigurationProperties(prefix = "mongodb")</span><br><span class="line">public class MongodbProperties {</span><br><span class="line"></span><br><span class="line">    private String uri;</span><br><span class="line">    private String database;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="convert-转换器"><a href="#convert-转换器" class="headerlink" title="convert 转换器"></a>convert 转换器</h3><p>针对存储类型转换 Mongodb存储的基本数据字段类型有：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">1.1 String</span><br><span class="line">1.描述:字符串类型，用于存储文本数据，支持 UTF-8 编码。</span><br><span class="line">2.示例:“name”: “Alice”</span><br><span class="line"></span><br><span class="line">1.2 Number</span><br><span class="line">1.Int32/Int64: 整数类型（32 位或 64 位）。“age”: 30</span><br><span class="line">2.示例:Double: 双精度浮点数。“height”: 1.75</span><br><span class="line"></span><br><span class="line">1.3 Boolean</span><br><span class="line">1.布尔类型，用于存储 true 或 false。</span><br><span class="line">2.示例:“isStudent”: true</span><br><span class="line"></span><br><span class="line">1.4 Date</span><br><span class="line">1.描述:日期类型，用于存储日期和时间，存储为 UTC 时间。</span><br><span class="line">2.示例:“createdAt”: ISODate(“2023-10-01T00:00:00Z”)</span><br><span class="line"></span><br><span class="line">1.5 Null</span><br><span class="line">1.描述:空值类型，用于表示字段值为空或不存在。</span><br><span class="line">2.示例:“middleName”: null</span><br><span class="line"></span><br><span class="line">1.6 ObjectId</span><br><span class="line">1.描述:唯一标识符类型，MongoDB 默认的 _id 字段类型，用于唯一标识文档。</span><br><span class="line">2.示例:“_id”: ObjectId(“6523f1c7e8b8d4a5b3c1d2e3”)</span><br><span class="line"></span><br><span class="line">1.7 Array</span><br><span class="line">1.描述:数组类型，用于存储一组值，可以是任意数据类型的混合。</span><br><span class="line">2.示例:“tags”: [“mongodb”, “database”, “nosql”]</span><br><span class="line"></span><br><span class="line">1.8 Binary Data</span><br><span class="line">1.描述:二进制数据类型，用于存储二进制数据（如图片、文件等）。</span><br><span class="line">2.示例:“imageData”: BinData(0, “base64data==”)</span><br><span class="line"></span><br><span class="line">1.9 Object</span><br><span class="line">1.描述:嵌套文档类型，用于存储嵌套的键值对（类似于 JSON 对象）。</span><br><span class="line">2.示例:“address”: { “city”: “New York”, “zip”: “10001” }</span><br></pre></td></tr></tbody></table></figure></div><h4 id="BigDecimal-转-Decimal128"><a href="#BigDecimal-转-Decimal128" class="headerlink" title="BigDecimal 转 Decimal128"></a>BigDecimal 转 Decimal128</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.bson.types.Decimal128;</span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.WritingConverter;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-15 015 14:33</span><br><span class="line"> * description: 配置 BigDecimal 转 Decimal128 的转换器 BigDecimalToDecimal128Converter</span><br><span class="line"> */</span><br><span class="line">@WritingConverter</span><br><span class="line">public class BigDecimalToDecimal128Converter implements Converter<span class="tag">&lt;<span class="name">BigDecimal,</span> <span class="attr">Decimal128</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Decimal128 convert(@NotNull BigDecimal bigDecimal) {</span><br><span class="line">        return new Decimal128(bigDecimal);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="Decimal128-转-BigDecimal"><a href="#Decimal128-转-BigDecimal" class="headerlink" title="Decimal128 转 BigDecimal"></a>Decimal128 转 BigDecimal</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.bson.types.Decimal128;</span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.ReadingConverter;</span><br><span class="line"></span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-15 015 14:33</span><br><span class="line"> * description: 配置 Decimal128 转 BigDecimal 的转换器 Decimal128ToBigDecimalConverter</span><br><span class="line"> */</span><br><span class="line">@ReadingConverter</span><br><span class="line">public class Decimal128ToBigDecimalConverter implements Converter<span class="tag">&lt;<span class="name">Decimal128,</span> <span class="attr">BigDecimal</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public BigDecimal convert(@NotNull Decimal128 decimal128) {</span><br><span class="line">        return decimal128.bigDecimalValue();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="Date-转-ZonedDateTime"><a href="#Date-转-ZonedDateTime" class="headerlink" title="Date 转 ZonedDateTime"></a>Date 转 ZonedDateTime</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.ReadingConverter;</span><br><span class="line"></span><br><span class="line">import java.time.ZoneOffset;</span><br><span class="line">import java.time.ZonedDateTime;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-14 014 17:16</span><br><span class="line"> * description: Date 转 ZonedDateTime</span><br><span class="line"> */</span><br><span class="line">@ReadingConverter</span><br><span class="line">public class ZonedDateTimeReadConverter implements Converter<span class="tag">&lt;<span class="name">Date,</span> <span class="attr">ZonedDateTime</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ZonedDateTime convert(@NotNull Date date) {</span><br><span class="line">        System.out.println("Date 转 ZonedDateTime");</span><br><span class="line">        return date.toInstant().atZone(ZoneOffset.systemDefault());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h4 id="ZonedDateTime-转-Date"><a href="#ZonedDateTime-转-Date" class="headerlink" title="ZonedDateTime 转 Date"></a>ZonedDateTime 转 Date</h4><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.convert;</span><br><span class="line"></span><br><span class="line">import org.jetbrains.annotations.NotNull;</span><br><span class="line">import org.springframework.core.convert.converter.Converter;</span><br><span class="line">import org.springframework.data.convert.WritingConverter;</span><br><span class="line"></span><br><span class="line">import java.time.ZonedDateTime;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-08-14 014 17:17</span><br><span class="line"> * description: ZonedDateTime 转 Date</span><br><span class="line"> */</span><br><span class="line">@WritingConverter</span><br><span class="line">public class ZonedDateTimeWriteConverter implements Converter<span class="tag">&lt;<span class="name">ZonedDateTime,</span> <span class="attr">Date</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Date convert(@NotNull ZonedDateTime zonedDateTime) {</span><br><span class="line">        System.out.println("ZonedDateTime 转 Date");</span><br><span class="line">        return Date.from(zonedDateTime.toInstant());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Mongodb配置"><a href="#Mongodb配置" class="headerlink" title="Mongodb配置"></a>Mongodb配置</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.common.mongodb.config;</span><br><span class="line"></span><br><span class="line">import com.mongodb.ConnectionString;</span><br><span class="line">import com.mongodb.MongoClientSettings;</span><br><span class="line">import com.mongodb.client.MongoClient;</span><br><span class="line">import com.mongodb.client.MongoClients;</span><br><span class="line">import com.demon.common.mongodb.config.properties.MongodbProperties;</span><br><span class="line">import com.demon.common.mongodb.convert.BigDecimalToDecimal128Converter;</span><br><span class="line">import com.demon.common.mongodb.convert.Decimal128ToBigDecimalConverter;</span><br><span class="line">import com.demon.common.mongodb.convert.ZonedDateTimeReadConverter;</span><br><span class="line">import com.demon.common.mongodb.convert.ZonedDateTimeWriteConverter;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.autoconfigure.AutoConfiguration;</span><br><span class="line">import org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.data.mongodb.MongoDatabaseFactory;</span><br><span class="line">import org.springframework.data.mongodb.MongoTransactionManager;</span><br><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line">import org.springframework.data.mongodb.core.SimpleMongoClientDatabaseFactory;</span><br><span class="line">import org.springframework.data.mongodb.core.convert.*;</span><br><span class="line">import org.springframework.data.mongodb.core.mapping.MongoMappingContext;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Mongodb配置</span><br><span class="line"> * https://www.mongodb.com/zh-cn/docs/manual/administration/connection-pool-overview/</span><br><span class="line"> *</span><br><span class="line"> * @author demon</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@AutoConfiguration</span><br><span class="line">@EnableCaching</span><br><span class="line">@EnableConfigurationProperties(MongodbProperties.class)</span><br><span class="line">public class MongodbConfiguration {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private MongodbProperties mongodbProperties;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MongoDatabaseFactory mongoDatabaseFactory() {</span><br><span class="line">        MongoClientSettings.Builder builder = MongoClientSettings.builder();</span><br><span class="line">        // 设置应用程序的逻辑名称</span><br><span class="line">        builder.applicationName("yet-platform-saas");</span><br><span class="line">        // 设置应用</span><br><span class="line">        builder.applyConnectionString(new ConnectionString(mongodbProperties.getUri()));</span><br><span class="line">        // 连接池</span><br><span class="line">        builder.applyToConnectionPoolSettings(b -&gt; {</span><br><span class="line">            // 允许的最大连接数。这些连接在空闲时将保留在池中。一旦池耗尽，任何需要连接的操作都将阻塞等待可用连接 默认: 100</span><br><span class="line">            b.maxSize(100);</span><br><span class="line">            // 最小连接数。这些连接在空闲时将保留在池中，并且池将确保它至少包含这个最小数量 默认: 0</span><br><span class="line">            b.minSize(18);</span><br><span class="line">            // 池连接可以存活的最长时间。零值表示寿命没有限制。超过其生命周期的池连接将被关闭并在必要时由新连接替换</span><br><span class="line">            b.maxConnectionLifeTime(0, TimeUnit.SECONDS);</span><br><span class="line">            // 池连接的最大空闲时间。零值表示对空闲时间没有限制。超过其空闲时间的池连接将被关闭并在必要时由新连接替换</span><br><span class="line">            b.maxConnectionIdleTime(5, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">            b.maxWaitTime(120, TimeUnit.SECONDS);</span><br><span class="line">        });</span><br><span class="line">        MongoClient mongoClient = MongoClients.create(builder.build());</span><br><span class="line">        return new SimpleMongoClientDatabaseFactory(mongoClient, mongodbProperties.getDatabase());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public MongoMappingContext mongoMappingContext() {</span><br><span class="line">        return new MongoMappingContext();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义 MongoTemplate</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MongoTemplate mongoTemplate(MongoDatabaseFactory mongoDatabaseFactory, MappingMongoConverter converter) {</span><br><span class="line">        return new MongoTemplate(mongoDatabaseFactory, converter);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    //配置 mongodb 事务管理器，能够让 mongodb 支持事务操作</span><br><span class="line">    @Bean</span><br><span class="line">    MongoTransactionManager mongoTransactionManager(MongoDatabaseFactory mongoDatabaseFactory) {</span><br><span class="line">        return new MongoTransactionManager(mongoDatabaseFactory);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义 MappingMongoConverter</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MappingMongoConverter mappingMongoConverter(MongoDatabaseFactory mongoDatabaseFactory, MongoMappingContext mongoMappingContext, MongoCustomConversions mongoCustomConversions) {</span><br><span class="line"></span><br><span class="line">        DbRefResolver dbRefResolver = new DefaultDbRefResolver(mongoDatabaseFactory);</span><br><span class="line">        MappingMongoConverter mappingMongoConverter = new MappingMongoConverter(dbRefResolver, mongoMappingContext);</span><br><span class="line"></span><br><span class="line">        // 自定义配置</span><br><span class="line">        mappingMongoConverter.setTypeMapper(new DefaultMongoTypeMapper(null)); // 移除 _class 字段</span><br><span class="line">        mappingMongoConverter.setCustomConversions(mongoCustomConversions); // 注册自定义转换器</span><br><span class="line">        mappingMongoConverter.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        return mappingMongoConverter;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注册自定义类型转换器</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public MongoCustomConversions mongoCustomConversions() {</span><br><span class="line"></span><br><span class="line">        return new MongoCustomConversions(Arrays.asList(</span><br><span class="line">                // 添加自定义转换器 - BigDecimal 类型</span><br><span class="line">                new BigDecimalToDecimal128Converter(), new Decimal128ToBigDecimalConverter(),</span><br><span class="line">                // 添加自定义转换器 - ZonedDateTime 类型</span><br><span class="line">                new ZonedDateTimeReadConverter(), new ZonedDateTimeWriteConverter()</span><br><span class="line">        ));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="方法使用"><a href="#方法使用" class="headerlink" title="方法使用"></a>方法使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    @Resource</span><br><span class="line">    private MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.新增</span><br><span class="line">    mongoTemplate.insert()</span><br><span class="line">    </span><br><span class="line">2.删除</span><br><span class="line">    mongoTemplate.remove()</span><br><span class="line">    </span><br><span class="line">2.修改</span><br><span class="line">    mongoTemplate.updateMulti()</span><br><span class="line">    </span><br><span class="line">2.查询</span><br><span class="line">    mongoTemplate.find()</span><br><span class="line">    </span><br><span class="line">2.统计</span><br><span class="line">    mongoTemplate.count()</span><br></pre></td></tr></tbody></table></figure></div><h3 id="Query使用"><a href="#Query使用" class="headerlink" title="Query使用"></a>Query使用</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// 创建条件对象</span><br><span class="line">Criteria criteria = new Criteria();</span><br><span class="line"></span><br><span class="line">// 等于</span><br><span class="line">criteria.and("_id").is(123457);</span><br><span class="line"></span><br><span class="line">// 模糊查询 忽略大小写，匹配正则</span><br><span class="line">criteria.and("userName").regex(Pattern.compile("^.*W.*$", Pattern.CASE_INSENSITIVE));</span><br><span class="line"></span><br><span class="line">// 查询多个字段  等于  或</span><br><span class="line">criteria.orOperator(Criteria.where("_id").is("123457"), Criteria.where("_id").is("123456"));</span><br><span class="line"></span><br><span class="line">// 查询日期范围  大于等于createTime  小于等于updateTime 并且，传入当前时间即可，mongodb 会自动转换UTC时间格式处理</span><br><span class="line">criteria.andOperator(Criteria.where("createTime").gte(DateUtils.parseDate("2025-08-11 09:41:23.449")), Criteria.where("updateTime").lte(DateUtils.parseDate("2025-08-18 11:41:23.449")));</span><br><span class="line"></span><br><span class="line">// 查询int数值范围  大于等于22  小于等于33 并且，</span><br><span class="line">criteria.and("age").gte(22).lte(33);</span><br><span class="line"></span><br><span class="line">// 查询BigDecimal数值范围  大于等于10.5  小于等于12.5 并且</span><br><span class="line">criteria.and("balance").gte(10.5).lte(12.5);</span><br><span class="line"></span><br><span class="line">// 匹配多个内容</span><br><span class="line">criteria.and("age").in(Arrays.asList(22, 33));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 组装SQL语句</span><br><span class="line">Query query = new Query(criteria);</span><br><span class="line">// 查询返回指定字段 (自定义列表)</span><br><span class="line">query.fields().include("_id", "userName", "nickName", "age", "createTime");</span><br><span class="line">// 排序，这里以age升序为例</span><br><span class="line">query.with(Sort.by(Sort.Direction.ASC, "age"));</span><br><span class="line"></span><br><span class="line">// 分页查询，page为当前页面，size为当前页的条数，初始page=0</span><br><span class="line">query.with(PageRequest.of(page, size));</span><br></pre></td></tr></tbody></table></figure></div><p><a href="/2025/08/1755659266090/1755659266090/">工具类</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      MongoTemplate的简单应用
    
    </summary>
    
    
      <category term="SpringBoot" scheme="https://www.zhuqiaolun.com/categories/SpringBoot/"/>
    
    
      <category term="MongoDb" scheme="https://www.zhuqiaolun.com/tags/MongoDb/"/>
    
  </entry>
  
  <entry>
    <title>定时任务的简单应用（spring-boot-starter-quartz）</title>
    <link href="https://www.zhuqiaolun.com/2025/06/1749008291584/1749008291584/"/>
    <id>https://www.zhuqiaolun.com/2025/06/1749008291584/1749008291584/</id>
    <published>2025-06-04T03:38:11.000Z</published>
    <updated>2025-06-04T05:40:44.787Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/2020/11/1605079105126/1605079105126/">配置</a></p><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="任务定义"><a href="#任务定义" class="headerlink" title="任务定义"></a>任务定义</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.TaskManager;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.*;</span><br><span class="line"></span><br><span class="line">import javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-03 003 17:34</span><br><span class="line"> * description: 任务定义</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">public abstract class ScheduledJob implements Job {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化任务</span><br><span class="line">     */</span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void init() {</span><br><span class="line">        boolean run = this.isRun();</span><br><span class="line">        log.info("初始化任务【{}】，是否添加任务:{}",this.getClass().getName(),run);</span><br><span class="line">        if(run){</span><br><span class="line">            TaskManager.JOB_LIST.add(this);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 任务是否需求</span><br><span class="line">     */</span><br><span class="line">    public abstract boolean isRun();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * cron表达式在线生成 http://cron.qqe2.com/</span><br><span class="line">     * cron表达式在线生成 https://cron.ciding.cc/</span><br><span class="line">     */</span><br><span class="line">    public abstract String getCron();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param scheduler 0/5 * * * * ?</span><br><span class="line">     * @throws SchedulerException 异常</span><br><span class="line">     */</span><br><span class="line">    public void startJob(Scheduler scheduler) throws SchedulerException {</span><br><span class="line">        JobDetail jobDetail = JobBuilder.newJob(this.getClass()).withIdentity(this.getClass().getName() + "-job", "group1").build();</span><br><span class="line">        CronScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(this.getCron());</span><br><span class="line">        CronTrigger cronTrigger = this.getCronTrigger(scheduleBuilder);</span><br><span class="line">        scheduler.scheduleJob(jobDetail, cronTrigger);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 若要自定义触发器,请在子类重写此方法</span><br><span class="line">     */</span><br><span class="line">    private CronTrigger getCronTrigger(CronScheduleBuilder scheduleBuilder) {</span><br><span class="line">        return TriggerBuilder.newTrigger().withIdentity(this.getClass().getName() + "-trigger", "group1").withSchedule(scheduleBuilder).build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="任务管理器"><a href="#任务管理器" class="headerlink" title="任务管理器"></a>任务管理器</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import com.demon.springbootquartzsimple.support.ApplicationContextHelper;</span><br><span class="line">import org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  author: Demon</span><br><span class="line"> *  date: 2025-06-04 004 11:25</span><br><span class="line"> *  description: 任务管理器</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@EnableScheduling</span><br><span class="line">public class TaskManager {</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 存放所有定时任务</span><br><span class="line">     */</span><br><span class="line">    public static final List<span class="tag">&lt;<span class="name">ScheduledJob</span>&gt;</span> JOB_LIST = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 执行所有定时任务</span><br><span class="line">     */</span><br><span class="line">    public void executeTasks() {</span><br><span class="line">        if (JOB_LIST.size() &gt; 0) {</span><br><span class="line">            SchedulerFactoryBean schedulerFactoryBean = ApplicationContextHelper.getBean(SchedulerFactoryBean.class);</span><br><span class="line">            for (ScheduledJob job : JOB_LIST) {</span><br><span class="line">                try {</span><br><span class="line">                    // 运行</span><br><span class="line">                    job.startJob(schedulerFactoryBean.getScheduler());</span><br><span class="line">                } catch (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="任务监听"><a href="#任务监听" class="headerlink" title="任务监听"></a>任务监听</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.listener;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.TaskManager;</span><br><span class="line">import org.springframework.context.ApplicationListener;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.event.ContextRefreshedEvent;</span><br><span class="line">import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;</span><br><span class="line">import org.springframework.scheduling.quartz.SchedulerFactoryBean;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-03 003 16:42</span><br><span class="line"> * description: 任务监听</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class SchedulerListener implements ApplicationListener<span class="tag">&lt;<span class="name">ContextRefreshedEvent</span>&gt;</span> {</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    public TaskManager taskManager;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onApplicationEvent(ContextRefreshedEvent event) {</span><br><span class="line">        try {</span><br><span class="line">            taskManager.executeTasks();</span><br><span class="line">        } catch (Exception e) {</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * scheduled调度器：调度什么时候去做什么事情</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public SchedulerFactoryBean schedulerFactoryBean() {</span><br><span class="line">       Properties properties = new Properties();</span><br><span class="line">       // 实例化ThreadPool时，使用的线程类为SimpleThreadPool（一般使用SimpleThreadPool即可满足几乎所有用户的需求）</span><br><span class="line">       properties.put("org.quartz.threadPool.class", "org.quartz.simpl.SimpleThreadPool");</span><br><span class="line">       // 并发个数,指定线程数，至少为1（无默认值）(一般设置为1-100之间的的整数合适)</span><br><span class="line">       properties.put("org.quartz.threadPool.threadCount", "5");</span><br><span class="line">       //设置线程的优先级（最大为java.lang.Thread.MAX_PRIORITY 10，最小为Thread.MIN_PRIORITY 1，默认为5）</span><br><span class="line">       properties.put("org.quartz.threadPool.threadPriority", "5");</span><br><span class="line"></span><br><span class="line">       SchedulerFactoryBean schedulerFactoryBean = new SchedulerFactoryBean();</span><br><span class="line">       schedulerFactoryBean.setSchedulerName("scheduled-task-");</span><br><span class="line">       schedulerFactoryBean.setQuartzProperties(properties);</span><br><span class="line">       return schedulerFactoryBean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="执行任务1"><a href="#执行任务1" class="headerlink" title="执行任务1"></a>执行任务1</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job.task;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-04 004 10:53</span><br><span class="line"> * description: 任务1</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class MyTaskJob1 extends ScheduledJob {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isRun() {</span><br><span class="line">        return true;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表示每5秒 执行任务</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String getCron() {</span><br><span class="line">        return "0/5 * * * * ?";</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void execute(JobExecutionContext jobExecutionContext) {</span><br><span class="line">        log.info("=======开始执行========MyTaskJob1================");</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="执行任务2"><a href="#执行任务2" class="headerlink" title="执行任务2"></a>执行任务2</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package com.demon.springbootquartzsimple.quartz.job.task;</span><br><span class="line"></span><br><span class="line">import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;</span><br><span class="line">import lombok.SneakyThrows;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.quartz.JobExecutionContext;</span><br><span class="line">import org.quartz.JobExecutionException;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2025-06-04 004 10:54</span><br><span class="line"> * description: 任务2</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class MyTaskJob2 extends ScheduledJob {</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isRun() {</span><br><span class="line">        return false;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 表示每5秒 执行任务</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public String getCron() {</span><br><span class="line">        return "0/5 * * * * ?";</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    @Override</span><br><span class="line">    public void execute(JobExecutionContext jobExecutionContext) {</span><br><span class="line">        log.info("=======开始执行========MyTaskJob2================");</span><br><span class="line">        throw new JobExecutionException("MyTaskJob2抛出任务异常");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><p>启动程序即会执行<br><img src="/2025/06/1749008291584/1749008291584/20250604134001.png" alt="20250604134001"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      定时任务的简单应用
    
    </summary>
    
    
      <category term="SpringBoot" scheme="https://www.zhuqiaolun.com/categories/SpringBoot/"/>
    
    
      <category term="Quartz" scheme="https://www.zhuqiaolun.com/tags/Quartz/"/>
    
  </entry>
  
  <entry>
    <title>Windows中同时安装MySQL5和MySQL8</title>
    <link href="https://www.zhuqiaolun.com/2025/02/1739425332925/1739425332925/"/>
    <id>https://www.zhuqiaolun.com/2025/02/1739425332925/1739425332925/</id>
    <published>2025-02-13T05:42:12.000Z</published>
    <updated>2025-02-13T09:13:40.119Z</updated>
    
    <content type="html"><![CDATA[<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>官网地址：<a href="https://www.mysql.com/" target="_blank" rel="noopener">https://www.mysql.com/</a><br>下载地址：<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener">https://downloads.mysql.com/archives/community/</a></p><h4 id="1-下载MySql-5-7-24"><a href="#1-下载MySql-5-7-24" class="headerlink" title="1.下载MySql-5.7.24"></a>1.下载MySql-5.7.24</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213134906.png" alt="20250213134906"></p><h4 id="2-下载MySql-8-0-16"><a href="#2-下载MySql-8-0-16" class="headerlink" title="2.下载MySql-8.0.16"></a>2.下载MySql-8.0.16</h4><p><img src="/2025/02/1739425332925/1739425332925/20250213135151.png" alt="20250213135151"></p><h2 id="解压文件并配置环境变量"><a href="#解压文件并配置环境变量" class="headerlink" title="解压文件并配置环境变量"></a>解压文件并配置环境变量</h2><p>下载下来的文件是压缩包，解压缩放在系统盘符目录下，并配置配置环境变量：MYSQL5_HOME,MYSQL8_HOME，同时在PATH内添加，<br><img src="/2025/02/1739425332925/1739425332925/20250213142910.png" alt="20250213142910"></p><h2 id="安装数据库"><a href="#安装数据库" class="headerlink" title="安装数据库"></a>安装数据库</h2><h3 id="安装MySQL5"><a href="#安装MySQL5" class="headerlink" title="安装MySQL5"></a>安装MySQL5</h3><p>1.创建必要文件 my.ini</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">innodb_flush_method=normal</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-5.7.24-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不要手动创建，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-5.7.24-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"># 连接时间</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br><span class="line"></span><br><span class="line"># 关闭5.7 密码验证</span><br><span class="line"># validate_password=off</span><br></pre></td></tr></tbody></table></figure></div><p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL5的 bin 路径下，输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div><p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213145411.png" alt="20250213145411"></p><p>3.安装MySQL5服务<br>输入命令</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --install MYSQL5</span><br></pre></td></tr></tbody></table></figure></div><p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL8冲突）<br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213145744.png" alt="20250213145744"></p><p>4.开启MySQL5服务<br>输入命令：net start MYSQL5<br><img src="/2025/02/1739425332925/1739425332925/20250213150037.png" alt="20250213150037"></p><p>5.登录MySQL5修改密码并开启远程访问</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3306 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问：GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2025/02/1739425332925/1739425332925/20250213153023.png" alt="20250213153023"></p><h3 id="安装MySQL8"><a href="#安装MySQL8" class="headerlink" title="安装MySQL8"></a>安装MySQL8</h3><ol><li>创建必要文件 my.ini<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3308端口</span><br><span class="line">port = 3308</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=D:\\MySql\\mysql-8.0.16-winx64</span><br><span class="line"># 设置mysql数据库的数据的存放目录（自动生成，不然可能报错）</span><br><span class="line">datadir=D:\\MySql\\mysql-8.0.16-winx64\\data</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=10000</span><br><span class="line"># 允许最大连接人数</span><br><span class="line">max_user_connections=1000</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"># 绑定到所有IP地址</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line"># 连接时间一年</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br></pre></td></tr></tbody></table></figure></div></li></ol><p>2.初始化，生成 data 文件夹，如果以前有就删除它<br>以管理员身份打开命令提示符，切换到MySQL8的 bin 路径下，输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize</span><br></pre></td></tr></tbody></table></figure></div><p>等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。<br><img src="/2025/02/1739425332925/1739425332925/20250213153903.png" alt="20250213153903"></p><p>3.安装MySQL8服务<br>输入命令：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --install MYSQL8</span><br></pre></td></tr></tbody></table></figure></div><p>安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL5冲突）<br><img src="/2025/02/1739425332925/1739425332925/20250213153321.png" alt="20250213153321"><br><span style="color:red">由于在安装服务的时候 会使用MYSQL5的目录下的mysqld文件，故需要将注册表的内容 变更为MYSQL8的目录下的mysqld文件</span><br>注册表：计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155551.png" alt="20250213155551"></p><p>4.开启MySQL8服务<br>输入命令：net start MYSQL8<br><img src="/2025/02/1739425332925/1739425332925/20250213155713.png" alt="20250213155713"></p><p>5.登录MySQL8修改密码并开启远程访问</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">登录输入：mysql -h localhost -P 3308 -u root -p</span><br><span class="line">登录指定端口数据库，回车输入密码</span><br><span class="line">修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';</span><br><span class="line">刷新权限：FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line">设置远程访问</span><br><span class="line"># 使用mysql数据库</span><br><span class="line">use mysql;</span><br><span class="line"># 查看用户及权限</span><br><span class="line">select user,host from mysql.user;</span><br><span class="line"># 更新root用户的host属性为%</span><br><span class="line">update user set host='%' where user='root';</span><br><span class="line"># 刷新下权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br><span class="line"># 再执行就可以了，就可以使用navicat连接了</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;</span><br><span class="line"># 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2025/02/1739425332925/1739425332925/20250213160902.png" alt="20250213160902"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Windows中同时安装MySQL5和MySQL8
    
    </summary>
    
    
      <category term="MySql" scheme="https://www.zhuqiaolun.com/categories/MySql/"/>
    
    
      <category term="MySql" scheme="https://www.zhuqiaolun.com/tags/MySql/"/>
    
  </entry>
  
  <entry>
    <title>【XML配置】日志之 log4j2 配置（控制台输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734677869669/1734677869669/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734677869669/1734677869669/</id>
    <published>2024-12-20T06:57:49.000Z</published>
    <updated>2025-09-16T07:13:12.082Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/2024/12/1734417756349/1734417756349/">编程式配置</a></p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h2><p>log4j2.xml</p><h3 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="单文件输出"><a href="#单文件输出" class="headerlink" title="单文件输出"></a>单文件输出</h3><p><a href="/2024/12/1734663400620/1734663400620/">编程式配置#单文件输出</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"FILE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/app.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/app.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"FILE_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h3 id="多文件输出"><a href="#多文件输出" class="headerlink" title="多文件输出"></a>多文件输出</h3><p><a href="/2024/12/1734663522947/1734663522947/">编程式配置#多文件输出</a></p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">"LOG_HOME"</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"CONSOLE_APPENDER"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"TRACE_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/trace.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/trace.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"TRACE"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"DEBUG_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/debug.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/debug.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"INFO_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/info.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/info.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"WARN_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/warn.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/warn.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"ERROR_APPENDER"</span> <span class="attr">fileName</span>=<span class="string">"${LOG_HOME}/error.log"</span> <span class="attr">filePattern</span>=<span class="string">"${LOG_HOME}/%d{yyyy-MM-dd}/error.logs-%i.log"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LevelMatchFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span> <span class="attr">interval</span>=<span class="string">"1"</span> <span class="attr">modulate</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 文件大小达到10KB进行一次rollover --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"10KB"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"ALL"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"TRACE_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"DEBUG_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"INFO_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"WARN_APPENDER"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"ERROR_APPENDER"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><blockquote><p>private static final Logger log = LogManager.getLogger(App.class);</p></blockquote><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line"></span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（多文件输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734663522947/1734663522947/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734663522947/1734663522947/</id>
    <published>2024-12-20T02:58:42.000Z</published>
    <updated>2024-12-20T07:59:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>多文件输出：输出指定级别及以上的日志信息且写入对应的日志级别文件<br><a href="/2024/12/1734677869669/1734677869669/#多文件输出">XML配置#多文件输出</a></p><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.LevelMatchFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private boolean traceFlag;</span><br><span class="line">    private boolean debugFlag;</span><br><span class="line">    private boolean infoFlag;</span><br><span class="line">    private boolean warnFlag;</span><br><span class="line">    private boolean errorFlag;</span><br><span class="line">    private boolean fatalFlag;</span><br><span class="line">    private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(boolean traceFlag, boolean debugFlag, boolean infoFlag, boolean warnFlag, boolean errorFlag, boolean fatalFlag, List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList) {</span><br><span class="line">        this.traceFlag = traceFlag;</span><br><span class="line">        this.debugFlag = debugFlag;</span><br><span class="line">        this.infoFlag = infoFlag;</span><br><span class="line">        this.warnFlag = warnFlag;</span><br><span class="line">        this.errorFlag = errorFlag;</span><br><span class="line">        this.fatalFlag = fatalFlag;</span><br><span class="line">        this.packLoggerList = packLoggerList;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    private static Appender getFileAppender(PatternLayout layout, String logRootPath, Level level, String appenderName) {</span><br><span class="line">        //  日志文件名，根据日志级别取名</span><br><span class="line">        String fileName = level.toString().toLowerCase();</span><br><span class="line">        return RollingFileAppender.newBuilder().setName(appenderName)</span><br><span class="line">                // 过滤日志文件内容</span><br><span class="line">                .setFilter(LevelMatchFilter.newBuilder().setLevel(level).setOnMatch(Filter.Result.ACCEPT).setOnMismatch(Filter.Result.DENY).build())</span><br><span class="line">                // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                // 设置日志输出格式</span><br><span class="line">                .setLayout(layout)</span><br><span class="line">                // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     *</span><br><span class="line">     * @param logRootPath ，传 null 则不输出文件日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath) {</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">AppenderRef</span>&gt;</span> appenderRefMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        Map<span class="tag">&lt;<span class="name">Level,</span> <span class="attr">Appender</span>&gt;</span> appenderMap = new LinkedHashMap<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line"></span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            if (traceFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String traceAppenderName = "TRACE_APPENDER";</span><br><span class="line">                Appender traceAppender = getFileAppender(layout, logRootPath, Level.TRACE, traceAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.TRACE, AppenderRef.createAppenderRef(traceAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.TRACE, traceAppender);</span><br><span class="line">            }</span><br><span class="line">            if (debugFlag) {</span><br><span class="line">                // TRACE</span><br><span class="line">                String debugAppenderName = "DEBUG_APPENDER";</span><br><span class="line">                Appender debugAppender = getFileAppender(layout, logRootPath, Level.DEBUG, debugAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.DEBUG, AppenderRef.createAppenderRef(debugAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.DEBUG, debugAppender);</span><br><span class="line">            }</span><br><span class="line">            if (infoFlag) {</span><br><span class="line">                // INFO</span><br><span class="line">                String infoAppenderName = "INFO_APPENDER";</span><br><span class="line">                Appender infoAppender = getFileAppender(layout, logRootPath, Level.INFO, infoAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.INFO, AppenderRef.createAppenderRef(infoAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.INFO, infoAppender);</span><br><span class="line">            }</span><br><span class="line">            if (warnFlag) {</span><br><span class="line">                // WARN</span><br><span class="line">                String warnAppenderName = "WARN_APPENDER";</span><br><span class="line">                Appender warnAppender = getFileAppender(layout, logRootPath, Level.WARN, warnAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.WARN, AppenderRef.createAppenderRef(warnAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.WARN, warnAppender);</span><br><span class="line">            }</span><br><span class="line">            if (errorFlag) {</span><br><span class="line">                // ERROR</span><br><span class="line">                String errorAppenderName = "ERROR_APPENDER";</span><br><span class="line">                Appender errorAppender = getFileAppender(layout, logRootPath, Level.ERROR, errorAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.ERROR, AppenderRef.createAppenderRef(errorAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.ERROR, errorAppender);</span><br><span class="line">            }</span><br><span class="line">            if (fatalFlag) {</span><br><span class="line">                // FATAL</span><br><span class="line">                String fatalAppenderName = "FATAL_APPENDER";</span><br><span class="line">                Appender fatalAppender = getFileAppender(layout, logRootPath, Level.FATAL, fatalAppenderName);</span><br><span class="line">                appenderRefMap.put(Level.FATAL, AppenderRef.createAppenderRef(fatalAppenderName, null, null));</span><br><span class="line">                appenderMap.put(Level.FATAL, fatalAppender);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>(appenderRefMap.values());</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderMap.values()) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        // 选配</span><br><span class="line">        if (packLoggerList.size() &gt; 0) {</span><br><span class="line">            for (PackLoggerVo packLoggerVo : packLoggerList) {</span><br><span class="line">                List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderListTemp = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">                if (packLoggerVo.isConsoleFlag()) {</span><br><span class="line">                    appenderRefListTemp.add(consoleAppenderRef);</span><br><span class="line">                    appenderListTemp.add(consoleAppender);</span><br><span class="line">                }</span><br><span class="line">                if (packLoggerVo.isFileFlag()) {</span><br><span class="line">                    Level[] packLoggerVoLevels = packLoggerVo.getLevels();</span><br><span class="line">                    for (Level loggerVoLevel : packLoggerVoLevels) {</span><br><span class="line">                        if (appenderRefMap.containsKey(loggerVoLevel)) {</span><br><span class="line">                            appenderRefListTemp.add(appenderRefMap.get(loggerVoLevel));</span><br><span class="line">                            appenderListTemp.add(appenderMap.get(loggerVoLevel));</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">                if (appenderRefListTemp.size() &gt; 0) {</span><br><span class="line">                    LoggerConfig loggerConfig2 = LoggerConfig.createLogger(false, Level.ALL, packLoggerVo.getPackageName(), "true", appenderRefListTemp.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">                    for (Appender appender : appenderListTemp) {</span><br><span class="line">                        loggerConfig2.addAppender(appender, null, null);</span><br><span class="line">                    }</span><br><span class="line">                    config.addLogger(packLoggerVo.getPackageName(), loggerConfig2);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private boolean traceFlag = false;</span><br><span class="line">        private boolean debugFlag = false;</span><br><span class="line">        private boolean infoFlag = false;</span><br><span class="line">        private boolean warnFlag = false;</span><br><span class="line">        private boolean errorFlag = false;</span><br><span class="line">        private boolean fatalFlag = false;</span><br><span class="line">        private List<span class="tag">&lt;<span class="name">PackLoggerVo</span>&gt;</span> packLoggerList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line"></span><br><span class="line">        public Builder withTraceFlag(final boolean traceFlag) {</span><br><span class="line">            this.traceFlag = traceFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withDebugFlag(boolean debugFlag) {</span><br><span class="line">            this.debugFlag = debugFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withInfoFlag(boolean infoFlag) {</span><br><span class="line">            this.infoFlag = infoFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withWarnFlag(boolean warnFlag) {</span><br><span class="line">            this.warnFlag = warnFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withErrorFlag(boolean errorFlag) {</span><br><span class="line">            this.errorFlag = errorFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder withFatalFlag(boolean fatalFlag) {</span><br><span class="line">            this.fatalFlag = fatalFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Builder addPackLogger(final String packageName, boolean consoleFlag, boolean fileFlag, final Level... levels) {</span><br><span class="line">            if (packageName != null &amp;&amp; packageName.length() &gt; 0) {</span><br><span class="line">                packLoggerList.add(new PackLoggerVo().setPackageName(packageName).setConsoleFlag(consoleFlag).setFileFlag(fileFlag).setLevels(levels));</span><br><span class="line">            }</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(traceFlag, debugFlag, infoFlag, warnFlag, errorFlag, fatalFlag, packLoggerList);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class PackLoggerVo {</span><br><span class="line">        private String packageName;</span><br><span class="line">        private boolean consoleFlag;</span><br><span class="line">        private boolean fileFlag;</span><br><span class="line">        private Level[] levels;</span><br><span class="line"></span><br><span class="line">        String getPackageName() {</span><br><span class="line">            return packageName;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setPackageName(String packageName) {</span><br><span class="line">            this.packageName = packageName;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isConsoleFlag() {</span><br><span class="line">            return consoleFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setConsoleFlag(boolean consoleFlag) {</span><br><span class="line">            this.consoleFlag = consoleFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        boolean isFileFlag() {</span><br><span class="line">            return fileFlag;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setFileFlag(boolean fileFlag) {</span><br><span class="line">            this.fileFlag = fileFlag;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Level[] getLevels() {</span><br><span class="line">            return levels;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PackLoggerVo setLevels(Level[] levels) {</span><br><span class="line">            this.levels = levels;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>定义日志配置1：控制台输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init();</span><br></pre></td></tr></tbody></table></figure></div><p>定义日志配置2：文件输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div><p>定义日志配置2：过滤包且指定日志级别输出</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                    .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true)</span><br><span class="line">                    .withFatalFlag(false)</span><br><span class="line">                    .addPackLogger("cn.hutool.log", true, false, Level.TRACE, Level.DEBUG, Level.INFO)</span><br><span class="line">                    .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                    .build().init("D:\\logs");</span><br></pre></td></tr></tbody></table></figure></div><h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">                        </span><br><span class="line">        // 定义日志配置</span><br><span class="line">        Log4j2Util.newBuilder().withTraceFlag(false)</span><br><span class="line">                   .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true).withFatalFlag(false)</span><br><span class="line">                   .addPackLogger("cn.hutool.setting", true, false, Level.TRACE, Level.DEBUG)</span><br><span class="line">                   .build().init("D:\\logs");</span><br><span class="line">                   </span><br><span class="line">        // 输出日志</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（单文件输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734663400620/1734663400620/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734663400620/1734663400620/</id>
    <published>2024-12-20T02:56:40.000Z</published>
    <updated>2025-09-16T07:07:56.359Z</updated>
    
    <content type="html"><![CDATA[<p>单文件输出：输出指定级别及以上的日志信息且写入同一个文件<br><a href="/2024/12/1734677869669/1734677869669/#单文件输出">XML配置#单文件输出</a></p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.Appender;</span><br><span class="line">import org.apache.logging.log4j.core.Filter;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.RollingFileAppender;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.filter.ThresholdFilter;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public void init() {</span><br><span class="line">        this.init(null, null);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init(String logRootPath, String logName) {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        List<span class="tag">&lt;<span class="name">AppenderRef</span>&gt;</span> appenderRefList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        List<span class="tag">&lt;<span class="name">Appender</span>&gt;</span> appenderList = new ArrayList<span class="tag">&lt;&gt;</span>();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null);</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        appenderRefList.add(consoleAppenderRef);</span><br><span class="line">        appenderList.add(consoleAppender);</span><br><span class="line">        // 2.输出到文件，按照每天生成日志文件</span><br><span class="line">        if (logRootPath != null) {</span><br><span class="line">            // 日志输出级别</span><br><span class="line">            String fileAppenderName = "FILE_APPENDER";</span><br><span class="line">            AppenderRef fileAppenderRef = AppenderRef.createAppenderRef(fileAppenderName, null, null);</span><br><span class="line">            //  日志文件名，根据日志级别取名</span><br><span class="line">            String fileName = "logs" + File.separator + ((logName != null &amp;&amp; logName.length() &gt; 0) ? logName : "app");</span><br><span class="line">            Appender fileAppender = RollingFileAppender.newBuilder().setName(fileAppenderName)</span><br><span class="line">                    // 过滤日志文件内容</span><br><span class="line">                    .setFilter(ThresholdFilter.createFilter(level, Filter.Result.ACCEPT, Filter.Result.DENY))</span><br><span class="line">                    // 日志文件输出的文件名，每天滚动生成一个新的日志文件</span><br><span class="line">                    .withFileName(logRootPath + File.separator + fileName + ".log").withFilePattern(logRootPath + File.separator + "%d{yyyy-MM-dd}" + File.separator + fileName + ".logs-%i.log")</span><br><span class="line">                    // 设置日志输出格式</span><br><span class="line">                    .setLayout(layout)</span><br><span class="line">                    // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置</span><br><span class="line">                    .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build())</span><br><span class="line">                    // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB</span><br><span class="line">                    .withPolicy(SizeBasedTriggeringPolicy.createPolicy("10KB"))</span><br><span class="line">                    // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i</span><br><span class="line">                    .withStrategy(DefaultRolloverStrategy.newBuilder().withMax("30").build())</span><br><span class="line">                    .build();</span><br><span class="line">            appenderRefList.add(fileAppenderRef);</span><br><span class="line">            appenderList.add(fileAppender);</span><br><span class="line">        }</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefList.toArray(new AppenderRef[0]), null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, null, null);</span><br><span class="line">        for (Appender appender : appenderList) {</span><br><span class="line">            loggerConfig.addAppender(appender, null, null);</span><br><span class="line">        }</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h3 id="完整示例"><a href="#完整示例" class="headerlink" title="完整示例"></a>完整示例</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // Log4j2Util.newBuilder().build().init();</span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLevel(Level.INFO).build().init("D:\\logs","app");</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>【编程式配置】日志之 log4j2 配置（控制台输出）</title>
    <link href="https://www.zhuqiaolun.com/2024/12/1734417756349/1734417756349/"/>
    <id>https://www.zhuqiaolun.com/2024/12/1734417756349/1734417756349/</id>
    <published>2024-12-17T06:42:36.000Z</published>
    <updated>2025-09-16T07:08:13.207Z</updated>
    
    <content type="html"><![CDATA[<p><a href="/2024/12/1734677869669/1734677869669">XML配置</a></p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></div><h2 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.core.LoggerContext;</span><br><span class="line">import org.apache.logging.log4j.core.appender.ConsoleAppender;</span><br><span class="line">import org.apache.logging.log4j.core.config.AppenderRef;</span><br><span class="line">import org.apache.logging.log4j.core.config.Configuration;</span><br><span class="line">import org.apache.logging.log4j.core.config.LoggerConfig;</span><br><span class="line">import org.apache.logging.log4j.core.layout.PatternLayout;</span><br><span class="line"></span><br><span class="line">import java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author: Demon</span><br><span class="line"> * date: 2024-12-17 017 11:19</span><br><span class="line"> * description: 日志类</span><br><span class="line"> * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="line"> * 两个配置项的三个属性值：</span><br><span class="line"> * onMatch="ACCEPT" 表示匹配该级别及以上</span><br><span class="line"> * onMatch="DENY" 表示不匹配该级别及以上</span><br><span class="line"> * onMatch="NEUTRAL" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上</span><br><span class="line"> * onMismatch="ACCEPT" 表示匹配该级别以下</span><br><span class="line"> * onMismatch="NEUTRAL" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的</span><br><span class="line"> * onMismatch="DENY" 表示不匹配该级别以下的</span><br><span class="line"> */</span><br><span class="line">public class Log4j2Util {</span><br><span class="line"></span><br><span class="line">    private Level level;</span><br><span class="line"></span><br><span class="line">    private Log4j2Util(Level level) {</span><br><span class="line">        this.level = level;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static Builder newBuilder() {</span><br><span class="line">        return new Builder();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载日志</span><br><span class="line">     */</span><br><span class="line">    public void init() {</span><br><span class="line">        // 配置</span><br><span class="line">        final LoggerContext ctx = (LoggerContext) LogManager.getContext(false);</span><br><span class="line">        final Configuration config = ctx.getConfiguration();</span><br><span class="line">        // 输出格式</span><br><span class="line">        final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName("UTF-8")).withConfiguration(config).withPattern("%d{yyyy-MM-dd HH:mm:ss.SSS,CTT}[%p][%t] %c[%L] %m %n").build();</span><br><span class="line">        // 1.输出到控制台</span><br><span class="line">        String consoleAppenderName = "CONSOLE_APPENDER";</span><br><span class="line">        ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build();</span><br><span class="line">        AppenderRef[] appenderRefs = {AppenderRef.createAppenderRef(consoleAppenderName, null, null)};</span><br><span class="line">        // Root -&gt; Logger配置</span><br><span class="line">        LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, "true", appenderRefs, null, config, null);</span><br><span class="line">        loggerConfig.addAppender(consoleAppender, level, null);</span><br><span class="line">        // 针对特定包的Logger配置,"" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig</span><br><span class="line">        // 必须</span><br><span class="line">        config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig);</span><br><span class="line">        ctx.updateLoggers();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    public static class Builder {</span><br><span class="line"></span><br><span class="line">        private Level level = Level.ALL;</span><br><span class="line"></span><br><span class="line">        public Builder setLoggerLevel(Level level) {</span><br><span class="line">            this.level = level;</span><br><span class="line">            return this;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        public Log4j2Util build() {</span><br><span class="line">            return new Log4j2Util(level);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import com.demon.util.Log4j2Util;</span><br><span class="line">import org.apache.logging.log4j.Level;</span><br><span class="line">import org.apache.logging.log4j.LogManager;</span><br><span class="line">import org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line">public class App {</span><br><span class="line"></span><br><span class="line">    private static final Logger log = LogManager.getLogger(App.class);</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) {</span><br><span class="line">    </span><br><span class="line">        // 配置 INFO级别及以上的信息输出</span><br><span class="line">        Log4j2Util.newBuilder().setLoggerLevel(Level.INFO).build().init();</span><br><span class="line">        </span><br><span class="line">        log.trace("This is trace");</span><br><span class="line">        log.debug("This is debug");</span><br><span class="line">        log.info("This is info");</span><br><span class="line">        log.warn("This is warning");</span><br><span class="line">        log.error("This is error");</span><br><span class="line">        log.fatal("This is fatal");</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">private static String getJarDir() {</span><br><span class="line">    String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath();</span><br><span class="line">    try {</span><br><span class="line">        String decodedPath = URLDecoder.decode(jarPath, "UTF-8");</span><br><span class="line">        return new File(decodedPath).getParent();</span><br><span class="line">    } catch (UnsupportedEncodingException e) {</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        return null;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      log4j2 配置
    
    </summary>
    
    
      <category term="Logger" scheme="https://www.zhuqiaolun.com/categories/Logger/"/>
    
    
      <category term="log4j2" scheme="https://www.zhuqiaolun.com/tags/log4j2/"/>
    
  </entry>
  
  <entry>
    <title>innosetup进行exe打包成安装文件</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723804410469/1723804410469/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723804410469/1723804410469/</id>
    <published>2024-08-16T10:33:30.000Z</published>
    <updated>2025-02-07T10:07:54.893Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>官网地址：<a href="https://jrsoftware.org/" target="_blank" rel="noopener">https://jrsoftware.org/</a><br>下载地址：<a href="https://files.jrsoftware.org/is/6/" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/</a><br>文件下载：<a href="https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe" target="_blank" rel="noopener">https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe</a></p><p>按照默认选择 一路点击“Next” 即可安装完成。</p><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>待续···</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      innosetup进行exe打包成安装文件
    
    </summary>
    
    
      <category term="J-Package" scheme="https://www.zhuqiaolun.com/categories/J-Package/"/>
    
    
      <category term="innosetup" scheme="https://www.zhuqiaolun.com/tags/innosetup/"/>
    
  </entry>
  
  <entry>
    <title>exe4j将Java程序打包（EXE执行或者Win服务）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723797971551/1723797971551/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723797971551/1723797971551/</id>
    <published>2024-08-16T08:46:11.000Z</published>
    <updated>2025-12-02T08:04:05.272Z</updated>
    
    <content type="html"><![CDATA[<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>官网地址：<a href="https://www.ej-technologies.com/exe4j/download" target="_blank" rel="noopener">https://www.ej-technologies.com/exe4j/download</a><br>进入网址，选择需要的版本，点击下载就可以了，需要注意的是exe4j 6.0 需要的jdk版本为1.8及以上。</p><p>下载地址：<a href="https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe" target="_blank" rel="noopener">https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe</a><br><img src="/2024/08/1723797971551/1723797971551/20240816165442.png" alt="20240816165442"></p><p>一键式安装，下载完成和平时安装软件以下，基本上直接下一步就可安装完成。</p><h3 id="激活"><a href="#激活" class="headerlink" title="激活"></a>激活</h3><p>安装完成运行软件，点击Enter License, 填写用户名、注册码即可,然后，点OK即可注册成功。<br><img src="/2024/08/1723797971551/1723797971551/20240816171223.png" alt="20240816171223"><br>注意：用户名可随便填写，公司可不填，注册码下面的随便选择复制一个即可</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A-XVK258563F-1p4lv7mg7sav</span><br><span class="line">A-XVK209982F-1y0i3h4ywx2h1</span><br><span class="line">A-XVK267351F-dpurrhnyarva</span><br><span class="line">A-XVK204432F-1kkoilo1jy2h3r</span><br><span class="line">A-XVK246130F-1l7msieqiwqnq</span><br><span class="line">A-XVK249554F-pllh351kcke50</span><br><span class="line">A-XVK238729F-25yn13iea25i</span><br><span class="line">A-XVK222711F-134h5ta8yxbm0</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br><span class="line">A-XVK275016F-15wjjcbn4tpj</span><br></pre></td></tr></tbody></table></figure></div><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在 VM Parameters中输入:-Dexe.path=${EXE4J_EXEDIR}；然后可以用它在程序中找到exe所在目录，这样无论生成的exe放到哪都可以找到当前目录，<br>代码中的用法（String exePath = System.getProperty(“exe.path”);）<br>exe执行路径的获取，在把exe文件打包成可安装文件的操作和查找配置文件等操作中至关重要</p><p>Exe4j的内置VM变量：<br>%EXE4J_EXEDIR%：exe执行路径<br>%EXE4J_JVM_HOME%：运行可执行文件的JRE目录</p><h4 id="打开exe4j，点击Next"><a href="#打开exe4j，点击Next" class="headerlink" title="打开exe4j，点击Next"></a>打开exe4j，点击Next</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173007.png" alt="20240816173007"></p><h4 id="选择项目类型，点击Next"><a href="#选择项目类型，点击Next" class="headerlink" title="选择项目类型，点击Next"></a>选择项目类型，点击Next</h4><h5 id="这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，"><a href="#这里选择第一个-把Jar文件跟exe文件分开-方便后期更新只需替换Jar文件即可，" class="headerlink" title="这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，"></a>这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可，</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816172746.png" alt="20240816172746"></p><h4 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h4><p><img src="/2024/08/1723797971551/1723797971551/20240816173731.png" alt="20240816173731"></p><h4 id="生成配置"><a href="#生成配置" class="headerlink" title="生成配置"></a>生成配置</h4><p>如果需要cmd窗体调试，可以选择第二个Console</p><h5 id="客户端（含有界面操作，选择第一个"><a href="#客户端（含有界面操作，选择第一个" class="headerlink" title="客户端（含有界面操作，选择第一个"></a>客户端（含有界面操作，选择第一个</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174643.png" alt="20240816174643"></p><h5 id="服务端（可配置在系统服务内运行，开机自启"><a href="#服务端（可配置在系统服务内运行，开机自启" class="headerlink" title="服务端（可配置在系统服务内运行，开机自启"></a>服务端（可配置在系统服务内运行，开机自启</h5><p><img src="/2024/08/1723797971551/1723797971551/20240906174526.png" alt="20240906174526"><br><img src="/2024/08/1723797971551/1723797971551/20240906174608.png" alt="20240906174608"></p><blockquote><p>服务安装：hello.exe /install hello<br>服务卸载：hello.exe /uninstall hello<br>服务启动：hello.exe /start hello<br>服务停止：hello.exe /stop hello  </p></blockquote><h5 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h5><p><img src="/2024/08/1723797971551/1723797971551/20240816174809.png" alt="20240816174809"><br><img src="/2024/08/1723797971551/1723797971551/20240816174852.png" alt="20240816174852"></p><h4 id="JAR配置"><a href="#JAR配置" class="headerlink" title="JAR配置"></a>JAR配置</h4><p>点击右边绿色的 “+”号，然后选择【Archive】，打开浏览目录，找到我们的jar包，然后选择【打开】，【ok】<br><img src="/2024/08/1723797971551/1723797971551/20240816180639.png" alt="20240816180639"><br>注：VM Parameters中可以设置虚拟机的一下参数，-Dfile.encoding=utf-8是设置了utf-8的编码，以防中文乱码</p><h4 id="JRE配置"><a href="#JRE配置" class="headerlink" title="JRE配置"></a>JRE配置</h4><p>设置JRE的最小最高版本，我们根据自己的情况设置就ok，小版本设置成1.8就行；<br><img src="/2024/08/1723797971551/1723797971551/20240816180930.png" alt="20240816180930"></p><p>然后点击【Advanced Options】，选择【Search sequence】，将软件默认的三个配置需要全部删除，添加我们自己的JRE到软件中，<br>这样我们的代码可以在别的没有安装Java环境的电脑上运行；点击右边的添加，选择【Directory】，然后选择【浏览】，找到我们的JRE，然后添加；<br><img src="/2024/08/1723797971551/1723797971551/20240816181453.png" alt="20240816181453"><br><img src="/2024/08/1723797971551/1723797971551/20240816181729.png" alt="20240816181729"><br><img src="/2024/08/1723797971551/1723797971551/20240816181848.png" alt="20240816181848"></p><p>然后【Next】,点击左侧的【Preferred VM】，选择【Client hotspot VM】，然后【next】<br><img src="/2024/08/1723797971551/1723797971551/20240816182009.png" alt="20240816182009"><br>剩下的步骤直接一直next，这样exe文件生成了<br><img src="/2024/08/1723797971551/1723797971551/20240816182215.png" alt="20240816182215"><br>最后在Finished中选择save，保存现在的配置。</p><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><p>以下为完整内容，双击exe可以执行<br><img src="/2024/08/1723797971551/1723797971551/20240816182945.png" alt="20240816182945"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      exe4j
    
    </summary>
    
    
      <category term="J-Package" scheme="https://www.zhuqiaolun.com/categories/J-Package/"/>
    
    
      <category term="exe4j" scheme="https://www.zhuqiaolun.com/tags/exe4j/"/>
    
  </entry>
  
  <entry>
    <title>部署OceanBase社区版(4.2.2.0)</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723180766825/1723180766825/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723180766825/1723180766825/</id>
    <published>2024-08-09T05:19:26.000Z</published>
    <updated>2024-08-13T05:45:49.426Z</updated>
    
    <content type="html"><![CDATA[<p>本文仅学习体验 OceanBase 的功能，使用1台机器部署单节点集群即可。</p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>OceanBase 支持部署在主流的Linux操作系统上，下面列出了常用的操作系统：</p><ul><li>Redhat / CentOS 7.x/8.x</li><li>SUSE / OpenSUSE 15.x</li><li>Anlios 7.x/8.x</li><li>Debian 9.x</li><li>Ubuntu 20.x</li></ul><h2 id="主机资源"><a href="#主机资源" class="headerlink" title="主机资源"></a>主机资源</h2><p>下表列出了部署OceanBase所需的单台主机的资源，如果需要集群部署，推荐使用相同规格的主机</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CPU：2c，生产环境推荐4c以上</span><br><span class="line">内存：8G，生产环境推荐16G以上</span><br><span class="line">磁盘：内存的6倍以上，推荐使用 SSD, 生产环境要配置多块磁盘，将日志盘和数据盘分开</span><br><span class="line">文件系统：EXT4 戓 XFS，当数据超过 16T 时，使用 XFS</span><br></pre></td></tr></tbody></table></figure></div><h2 id="部署前置"><a href="#部署前置" class="headerlink" title="部署前置"></a>部署前置</h2><h3 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h3><p>防火墙状态：systemctl status firewalld，如果输出结果非 inactive, 可以通过如下命令进行关闭：<br>防火墙停止：systemctl stop firewalld<br>防火墙禁用：systemctl disable firewalld</p><h3 id="关闭SELinux"><a href="#关闭SELinux" class="headerlink" title="关闭SELinux"></a>关闭SELinux</h3><p>修改配置文件，将SELINUX的配置修改为disabled，vi /etc/selinux/config</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX= can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX=disabled</span><br><span class="line"># SELINUXTYPE= can take one of three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected.</span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE=targeted</span><br></pre></td></tr></tbody></table></figure></div><p>配置文件修改后只会重启后生效，还需要使用下面命令立即生效：<br>setenforce 0</p><h3 id="修改配置-limits-conf"><a href="#修改配置-limits-conf" class="headerlink" title="修改配置 limits.conf"></a>修改配置 limits.conf</h3><p>执行以下命令解决安装时出现的资源性错误，打开 vi /etc/security/limits.conf 配置文件，添加以下内容：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root soft nofile 655350</span><br><span class="line">root hard nofile 655350</span><br><span class="line">* soft nofile 655350</span><br><span class="line">* hard nofile 655350</span><br><span class="line">* soft stack unlimited</span><br><span class="line">* hard stack unlimited</span><br><span class="line">* soft nproc 655360</span><br><span class="line">* hard nproc 655360</span><br><span class="line">* soft core unlimited</span><br><span class="line">* hard core unlimited</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723180766825/1723180766825/20240809133727.png" alt="20240809133727"></p><h3 id="查看配置"><a href="#查看配置" class="headerlink" title="查看配置"></a>查看配置</h3><p>参考：<a href="https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561" target="_blank" rel="noopener">https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561</a></p><p>退出当前会话，重新登录。执行以下命令，查看配置是否生效。</p><blockquote><p>ulimit -a</p></blockquote><p>输出如下:<br><img src="/2024/08/1723180766825/1723180766825/20240809134315.png" alt="20240809134315"></p><h3 id="修改内核-etc-sysctl-conf"><a href="#修改内核-etc-sysctl-conf" class="headerlink" title="修改内核 /etc/sysctl.conf"></a>修改内核 /etc/sysctl.conf</h3><p>打开 vi /etc/sysctl.conf 配置文件，修改或添加以下内容：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.aio-max-nr=1048576</span><br><span class="line">fs.file-max=6573688</span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></tbody></table></figure></div><p>执行如下命令让配置生效<br>sysctl -p</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/oceanbase</span><br><span class="line">cd /usr/local/oceanbase</span><br><span class="line"></span><br><span class="line"># 下载文件</span><br><span class="line">wget https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/download-center/opensource/oceanbase-all-in-one/7/x86_64/oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压文件</span><br><span class="line">tar -xzf oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 安装</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">bin/install.sh</span><br><span class="line"></span><br><span class="line">    安装脚本会在主机上部署好OBD和OBClient, 并且将携带的rpm包都导入到OBD的环境中，安装后的输出结果如下。</span><br><span class="line">    Install Finished</span><br><span class="line">      =====================================================================</span><br><span class="line">      Setup Environment:     source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line">      Quick Start:           obd demo</span><br><span class="line">      More Details:          obd -h</span><br><span class="line">      =====================================================================</span><br><span class="line"></span><br><span class="line"># 在执行下一步操作之前，需要根据提示设置环境变量，命令如下：</span><br><span class="line"># set environment</span><br><span class="line">source ~/.oceanbase-all-in-one/bin/env.sh</span><br><span class="line"># check obd and obclient command</span><br><span class="line">which obd</span><br><span class="line">which obclient</span><br></pre></td></tr></tbody></table></figure></div><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>采用快速部署模式：obd demo<br>demo 部署方式采用最小规格部署，部署的组件版本默认为最新版本默认部署的组件包含 oceanbase-ce、obproxy-ce、obagent、grafana、prometheus。</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># use obd demo command to quickly launch a demo cluster</span><br><span class="line">cd /usr/local/oceanbase/oceanbase-all-in-one</span><br><span class="line">obd demo</span><br></pre></td></tr></tbody></table></figure></div><p>部署完成后，OBD会将各个组件的连接方式打印出来：<br><img src="/2024/08/1723180766825/1723180766825/20240809135908.png" alt="20240809135908"></p><p>说明：<br>Grafana访问：<a href="http://127.0.0.1:3000/d/oceanbase，" target="_blank" rel="noopener">http://127.0.0.1:3000/d/oceanbase，</a> 用户名和密码：admin/Kx7FPKTDh7</p><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>安装后，可以使用 OBClient 客户端连接进行验证：obclient -h127.0.0.1 -uroot -P2881<br>授予所有特权：grant all privileges on <em>.</em> to root@’%’;<br><img src="/2024/08/1723180766825/1723180766825/20240809135934.png" alt="20240809135934"></p><h2 id="设置密码"><a href="#设置密码" class="headerlink" title="设置密码"></a>设置密码</h2><p>安装完成后 root用户是默认没密码</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">初次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot</span><br><span class="line"></span><br><span class="line">设置密码(!root)</span><br><span class="line">ALTER USER root@'%' IDENTIFIED BY '!root';</span><br><span class="line"></span><br><span class="line">再次登录：</span><br><span class="line">obclient -h127.0.0.1 -P2881 -uroot -p</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723180766825/1723180766825/20240809145241.png" alt="20240809145241"></p><h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">启动：obd cluster start demo</span><br><span class="line">停止：obd cluster stop demo</span><br></pre></td></tr></tbody></table></figure></div><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=2881/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=2881/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有2881端口</span><br><span class="line">ss -ntulp | grep 2881   //查看所有2881端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      OceanBase
    
    </summary>
    
    
      <category term="OceanBase" scheme="https://www.zhuqiaolun.com/categories/OceanBase/"/>
    
    
      <category term="OceanBase" scheme="https://www.zhuqiaolun.com/tags/OceanBase/"/>
    
  </entry>
  
  <entry>
    <title>在Linux下安装RabbitMQ及配置</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723102274931/1723102274931/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723102274931/1723102274931/</id>
    <published>2024-08-08T07:31:14.000Z</published>
    <updated>2024-08-09T07:21:39.487Z</updated>
    
    <content type="html"><![CDATA[<p>Rabbitmq依赖于Erlan 对应版本查看：<a href="https://www.rabbitmq.com/docs/which-erlang" target="_blank" rel="noopener">https://www.rabbitmq.com/docs/which-erlang</a></p><h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol><li>otp_src_24.1.7.tar.gz</li><li>rabbitmq-server-generic-unix-3.9.11.tar.xz</li></ol><ul><li><p>otp_src_24.1.7.tar.gz</p><blockquote><p>官网地址：<a href="https://www.erlang.org/" target="_blank" rel="noopener">https://www.erlang.org/</a><br>文件地址：<a href="https://www.erlang.org/patches/otp-24.1.7" target="_blank" rel="noopener">https://www.erlang.org/patches/otp-24.1.7</a><br>下载地址：<a href="https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz" target="_blank" rel="noopener">https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</a></p></blockquote></li><li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p><blockquote><p>官网地址：<a href="https://www.rabbitmq.com/" target="_blank" rel="noopener">https://www.rabbitmq.com/</a><br>文件地址：<a href="https://github.com/rabbitmq/rabbitmq-server" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server</a><br>下载地址：<a href="https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz</span><br><span class="line">wget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf otp_src_24.1.7.tar.gz</span><br><span class="line">tar -xf rabbitmq-server-generic-unix-3.9.11.tar.xz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723102274931/1723102274931/20240808172416.png" alt="20240808172416"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li><p>otp_src_24.1.7.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/otp_src_24.1.7</span><br><span class="line">./configure --prefix=/usr/local/erlang</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/erlang/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line">测试安装是否成功</span><br><span class="line">erl --version</span><br><span class="line">输出：</span><br><span class="line">Erlang/OTP 24 [erts-12.1.5] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1]</span><br><span class="line">Eshell V12.1.5  (abort with ^G)</span><br><span class="line"></span><br><span class="line">退出</span><br><span class="line">halt(). 或者 q().</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>rabbitmq-server-generic-unix-3.9.11.tar.xz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/</span><br><span class="line">mv rabbitmq_server-3.9.11 /usr/local/</span><br><span class="line">mv /usr/local/rabbitmq_server-3.9.11 /usr/local/rabbitmq</span><br><span class="line">cd /usr/local/rabbitmq</span><br><span class="line"></span><br><span class="line">添加环境变量</span><br><span class="line">echo "export PATH=/usr/local/rabbitmq/sbin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h4 id="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config"><a href="#rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env-conf、参数环境配置文件rabbitmq-config" class="headerlink" title="rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config"></a>rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.config</h4><p>mkdir /etc/rabbitmq/<br>创建文件 vim /etc/rabbitmq/rabbitmq-env.conf，内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 应用根目录</span><br><span class="line">RABBITMQ_HOME=/usr/local/rabbitmq</span><br><span class="line"># 插件的路径</span><br><span class="line">RABBITMQ_PLUGINS_DIR=/usr/local/rabbitmq/plugins</span><br><span class="line"># 需要使用的MNESIA数据库的路径（创建）</span><br><span class="line">RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/data</span><br><span class="line"># 日志文件的路径（创建）</span><br><span class="line">RABBITMQ_LOG_BASE=/usr/local/rabbitmq/logs</span><br><span class="line"># 配置文件的路径（创建）</span><br><span class="line">RABBITMQ_CONFIG_FILE=/usr/local/rabbitmq/conf/rabbitmq.config</span><br><span class="line">NODENAME=rabbit@localhost</span><br></pre></td></tr></tbody></table></figure></div><p>查看：cat /etc/rabbitmq/rabbitmq-env.conf</p><p>mkdir /usr/local/rabbitmq/conf<br>创建配置文件 vim /usr/local/rabbitmq/conf/rabbitmq.config，内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">## Clustering</span><br><span class="line">cluster_partition_handling = ignore</span><br><span class="line"></span><br><span class="line">## Defaults</span><br><span class="line"># During the first start, RabbitMQ will create a vhost and a user</span><br><span class="line"># These config items control what gets created</span><br><span class="line">default_permissions.configure = .*</span><br><span class="line">default_permissions.read = .*</span><br><span class="line">default_permissions.write = .*</span><br><span class="line">default_vhost = /</span><br><span class="line">default_user = admin</span><br><span class="line">default_pass = admin</span><br><span class="line"></span><br><span class="line">## Networking</span><br><span class="line">listeners.tcp.default = 5672</span><br><span class="line"></span><br><span class="line">## Management</span><br><span class="line">management.tcp.ip = 0.0.0.0</span><br><span class="line">management.tcp.port = 15672</span><br><span class="line"></span><br><span class="line">## Resource limits</span><br><span class="line"># Set a free disk space limit relative to total available RAM</span><br><span class="line">disk_free_limit.relative = 1.0</span><br></pre></td></tr></tbody></table></figure></div><p>查看：cat /usr/local/rabbitmq/conf/rabbitmq.config</p><h2 id="常用RabbitMQ命令"><a href="#常用RabbitMQ命令" class="headerlink" title="常用RabbitMQ命令"></a>常用RabbitMQ命令</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.服务启动：rabbitmq-server -detached</span><br><span class="line"></span><br><span class="line">2.服务停止：rabbitmqctl stop</span><br><span class="line"></span><br><span class="line">3.服务状态：rabbitmqctl status</span><br><span class="line"></span><br><span class="line">4.服务重启：rabbitmq-server restart</span><br></pre></td></tr></tbody></table></figure></div><h2 id="安装RabbitMQ-Web界面"><a href="#安装RabbitMQ-Web界面" class="headerlink" title="安装RabbitMQ Web界面"></a>安装RabbitMQ Web界面</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">开启插件：rabbitmq-plugins enable rabbitmq_management</span><br><span class="line"></span><br><span class="line">浏览器访问：http://127.0.0.1:15672/</span><br><span class="line"></span><br><span class="line">RabbitMQ默认提供了一个guest/guest用户，但是从3.3.0 版本以后该账号只能localhost登陆（User can only log in via localhost）</span><br><span class="line"></span><br><span class="line">通过以下命令创建一个用户admin，密码为admin</span><br><span class="line">rabbitmqctl add_user admin admin</span><br><span class="line"></span><br><span class="line">创建完成之后通过以下命令设置用户标签为administrator</span><br><span class="line">rabbitmqctl set_user_tags admin administrator</span><br><span class="line"></span><br><span class="line">给用户user赋予权限，授予user用户可访问虚拟主机 /，并在所有的资源上具备可配置、可写及可读的权限</span><br><span class="line">rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"</span><br><span class="line"></span><br><span class="line">最后，通过以下命令可以看出当前的所有用户</span><br><span class="line">rabbitmqctl list_users</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723102274931/1723102274931/20240808180724.png" alt="20240808180724"></p><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=15672/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=15672/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有15672端口</span><br><span class="line">ss -ntulp | grep 15672   //查看所有15672端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Linux下RabbitMQ安装及配置
    
    </summary>
    
    
      <category term="RabbitMq" scheme="https://www.zhuqiaolun.com/categories/RabbitMq/"/>
    
    
      <category term="rabbitMq" scheme="https://www.zhuqiaolun.com/tags/rabbitMq/"/>
    
  </entry>
  
  <entry>
    <title>Linux安装 Redis - 绿色版</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723099472324/1723099472324/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723099472324/1723099472324/</id>
    <published>2024-08-08T06:44:32.000Z</published>
    <updated>2024-08-09T07:21:39.481Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ tcl cmake</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ul><li>redis-3.2.10.tar.gz<blockquote><p>官网地址：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a><br>文件地址：<a href="https://download.redis.io/releases/" target="_blank" rel="noopener">https://download.redis.io/releases/</a><br>下载地址：<a href="https://download.redis.io/releases/redis-3.2.10.tar.gz" target="_blank" rel="noopener">https://download.redis.io/releases/redis-3.2.10.tar.gz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/software</span><br><span class="line">cd /usr/local/software</span><br><span class="line">wget https://download.redis.io/releases/redis-3.2.10.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf redis-3.2.10.tar.gz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808145352.png" alt="20240808145352"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li>redis-3.2.10.tar.gz<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/software/redis-3.2.10</span><br><span class="line"></span><br><span class="line"># 指定安装目录</span><br><span class="line">make &amp;&amp; make PREFIX=/usr/local/redis install</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="配置文件redis-conf"><a href="#配置文件redis-conf" class="headerlink" title="配置文件redis.conf"></a>配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">从redis的源码目录中复制redis.conf到redis的bin目录下：</span><br><span class="line">cp /usr/local/software/redis-3.2.10/redis.conf /usr/local/redis/bin/</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808150953.png" alt="20240808150953"></p><h2 id="修改配置文件redis-conf"><a href="#修改配置文件redis-conf" class="headerlink" title="修改配置文件redis.conf"></a>修改配置文件redis.conf</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line">//显示行号</span><br><span class="line">:set nu</span><br><span class="line"></span><br><span class="line">//61行左右</span><br><span class="line">注释掉# bind 127.0.0.1</span><br><span class="line"></span><br><span class="line">//80行左右</span><br><span class="line">修改 protected-mode yes 改为 protected-mode no</span><br><span class="line"></span><br><span class="line">//128行左右</span><br><span class="line">daemonize no 改为 daemonize yes</span><br><span class="line"></span><br><span class="line">:wq! 保存退出</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723099472324/1723099472324/20240808151306.png" alt="20240808151306"></p><h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>在bin目录下，启动redis服务：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-server redis.conf</span><br></pre></td></tr></tbody></table></figure></div><h2 id="停止服务："><a href="#停止服务：" class="headerlink" title="停止服务："></a>停止服务：</h2><p>利用redis-cli来执行 shutdown 命令，即可停止 Redis 服务，</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis/bin</span><br><span class="line">./redis-cli shutdown</span><br></pre></td></tr></tbody></table></figure></div><h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/redis.service , 内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div><p>查看：<br>cat /etc/systemd/system/redis.service</p><p>然后重载系统服务：<br>systemctl daemon-reload</p><p>可以用下面这组命令来操作redis了：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start redis</span><br><span class="line"># 停止</span><br><span class="line">systemctl stop redis</span><br><span class="line"># 重启</span><br><span class="line">systemctl restart redis</span><br><span class="line"># 查看状态</span><br><span class="line">systemctl status redis</span><br></pre></td></tr></tbody></table></figure></div><p>执行下面的命令，可以让redis开机自启：<br>systemctl enable redis</p><h2 id="添加端口到防火墙里："><a href="#添加端口到防火墙里：" class="headerlink" title="添加端口到防火墙里："></a>添加端口到防火墙里：</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=6379/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=6379/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有6379端口</span><br><span class="line">ss -ntulp | grep 6379   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      Linux安装 Redis - 绿色版
    
    </summary>
    
    
      <category term="Redis" scheme="https://www.zhuqiaolun.com/categories/Redis/"/>
    
    
      <category term="Redis" scheme="https://www.zhuqiaolun.com/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>在Linux中安装subversion环境</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1723020746262/1723020746262/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1723020746262/1723020746262/</id>
    <published>2024-08-07T08:52:26.000Z</published>
    <updated>2024-08-09T07:21:46.020Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h2><blockquote><p>yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel</p></blockquote><h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><ol><li>apr-1.6.5.tar.gz</li><li>apr-util-1.6.1.tar.gz</li><li>sqlite-autoconf-3250100.tar.gz</li><li>zlib-1.2.11.tar.gz</li><li>subversion-1.10.6.tar.gz</li></ol><ul><li><p>apr-1.6.5.tar.gz、apr-util-1.6.1.tar.gz</p><blockquote><p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="http://archive.apache.org/dist/apr" target="_blank" rel="noopener">http://archive.apache.org/dist/apr</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</a><br>下载地址：<a href="https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</a></p></blockquote></li><li><p>zlib-1.2.11.tar.gz </p><blockquote><p>文件地址：<a href="http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml" target="_blank" rel="noopener">http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml</a><br>下载地址：<a href="https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1" target="_blank" rel="noopener">https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1</a></p></blockquote></li><li><p>sqlite-autoconf-3250100.tar.gz</p><blockquote><p>官网地址：<a href="http://www.sqlite.org" target="_blank" rel="noopener">http://www.sqlite.org</a><br>下载地址：<a href="https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz" target="_blank" rel="noopener">https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</a></p></blockquote></li><li><p>subversion-1.10.6.tar.gz</p><blockquote><p>官网地址：<a href="http://subversion.apache.org" target="_blank" rel="noopener">http://subversion.apache.org</a><br>文件地址：<a href="https://archive.apache.org/dist/subversion" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion</a><br>下载地址：<a href="https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz" target="_blank" rel="noopener">https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</a></p></blockquote></li></ul><h2 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1.创建临时目录</span><br><span class="line">软件目录</span><br><span class="line">mkdir /usr/local/subversion</span><br><span class="line"></span><br><span class="line">软件根目录</span><br><span class="line">mkdir /usr/local/subversion/svn</span><br><span class="line"></span><br><span class="line">项目目录</span><br><span class="line">mkdir /usr/local/subversion/svn/project</span><br><span class="line"></span><br><span class="line">软件依赖安装目录</span><br><span class="line">mkdir /usr/local/subversion/software</span><br><span class="line"></span><br><span class="line">1.下载文件</span><br><span class="line">cd /usr/local/subversion/software</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz</span><br><span class="line">wget https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz</span><br><span class="line">wget https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz</span><br><span class="line">wget https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压文件</span><br><span class="line">tar -xzvf apr-1.6.5.tar.gz</span><br><span class="line">tar -xzvf apr-util-1.6.1.tar.gz</span><br><span class="line">tar -xf zlib-1.2.11.tar.xz</span><br><span class="line">tar -xzvf sqlite-autoconf-3250100.tar.gz</span><br><span class="line">tar -zxvf subversion-1.10.6.tar.gz</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723020746262/1723020746262/20240807172108.png" alt="20240807172108"></p><h2 id="安装程序"><a href="#安装程序" class="headerlink" title="安装程序"></a>安装程序</h2><ul><li><p>apr-1.6.5.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-1.6.5</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>apr-util-1.6.1.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/apr-util-1.6.1</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/apr-util-1.6.1 --with-apr=/usr/local/subversion/svn/apr-1.6.5</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>zlib-1.2.11.tar.xz（可以不安装）</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/zlib-1.2.11</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/zlib-1.2.11</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>sqlite-autoconf-3250100.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/sqlite-autoconf-3250100</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/sqlite</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li><li><p>subversion-1.10.6.tar.gz</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/subversion/software/subversion-1.10.6</span><br><span class="line"></span><br><span class="line">（--with-apr等参数后面的路径，取决于前面几个插件安装的路径，插件也应该放在/usr/local/下面，我这里插件都放在/home/svn/其实不推荐这么干，</span><br><span class="line">在使用 ./configure 脚本时，如果需要在命令行中换行拼接多个选项，可以使用 \ 符号在多行中分割长命令。这样做可以提高命令的可读性，使其不会过长。）</span><br><span class="line">./configure --prefix=/usr/local/subversion/svn/subversion-1.10.6  \</span><br><span class="line">            --with-apr=/usr/local/subversion/svn/apr-1.6.5  \</span><br><span class="line">            --with-apr-util=/usr/local/subversion/svn/apr-util-1.6.1  \</span><br><span class="line">            --with-sqlite=/usr/local/subversion/svn/sqlite  \</span><br><span class="line">            --with-lz4=internal  \</span><br><span class="line">            --with-utf8proc=internal</span><br><span class="line">make &amp; make install</span><br></pre></td></tr></tbody></table></figure></div></li></ul><h2 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h2><p>安装完成，添加环境变量path</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">添加</span><br><span class="line">echo "export PATH=/usr/local/subversion/svn/subversion-1.10.6/bin:$PATH" &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">生效</span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">cat /etc/profile</span><br><span class="line"></span><br><span class="line">验证：</span><br><span class="line">svnserve --version</span><br></pre></td></tr></tbody></table></figure></div><p><img src="/2024/08/1723020746262/1723020746262/20240808142507.png" alt="20240808142507"></p><h2 id="添加项目库"><a href="#添加项目库" class="headerlink" title="添加项目库"></a>添加项目库</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">创建两个库</span><br><span class="line">svnadmin create /usr/local/subversion/svn/javaproject/</span><br><span class="line">svnadmin create /usr/local/subversion/svn/webproject/</span><br><span class="line"></span><br><span class="line">进两个库里面设置权限，分别进入库的conf目录下，设置各自的权限……</span><br><span class="line"></span><br><span class="line">例如配置：</span><br><span class="line">cd /usr/local/subversion/svn/javaproject/conf</span><br><span class="line">    vim svnserve.conf</span><br><span class="line">        修改以下内容（大约在27行）：</span><br><span class="line">        password-db = passwd    # 指明密码文件路径</span><br><span class="line"></span><br><span class="line">修改passwd文件</span><br><span class="line">vim passwd</span><br><span class="line">添加以下内容：</span><br><span class="line">[users]</span><br><span class="line">test1=test1</span><br><span class="line">test2=test2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">启动（默认端口），指向库的父级目录</span><br><span class="line">svnserve -d -r  /usr/local/subversion/svn/</span><br><span class="line"></span><br><span class="line">关闭svn服务</span><br><span class="line">killall svnserve</span><br><span class="line"></span><br><span class="line">通过客户端访问</span><br><span class="line">svn://服务器ip:端口(默认端口3690可以不写)/javaproject/</span><br><span class="line">例如：svn://10.200.47.87/javaproject/</span><br></pre></td></tr></tbody></table></figure></div><h2 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h2><p>首先，新建一个系统服务文件：vim /etc/systemd/system/svnserver.service , 内容如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=SVN Server Service</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -d -r /usr/local/subversion/svn/</span><br><span class="line">ExecStop=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -q –pid-file /var/run/svnserve.pid</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure></div><p>wq!保存</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查看服务： cat /etc/systemd/system/svnserver.service</span><br><span class="line"></span><br><span class="line">加载服务：systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">服务启动：systemctl start svnserver</span><br><span class="line">服务停止：systemctl stop svnserver</span><br><span class="line">服务状态：systemctl status svnserver</span><br><span class="line"></span><br><span class="line">开机启动：systemctl enable svnserver</span><br></pre></td></tr></tbody></table></figure></div><h2 id="添加端口到防火墙里"><a href="#添加端口到防火墙里" class="headerlink" title="添加端口到防火墙里"></a>添加端口到防火墙里</h2><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1、开启防火墙 </span><br><span class="line">systemctl start firewalld</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2、开放指定端口</span><br><span class="line">firewall-cmd --permanent --add-port=3690/tcp</span><br><span class="line"> 命令含义：</span><br><span class="line">--add-port=3690/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent  #永久生效，没有此参数重启后失效</span><br><span class="line"></span><br><span class="line">3、重启防火墙</span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line">4、查看端口号</span><br><span class="line">ss -ntlp   //查看当前所有tcp端口·查看是否有3690端口</span><br><span class="line">ss -ntulp | grep 3690   //查看所有3690端口使用情况</span><br></pre></td></tr></tbody></table></figure></div><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      subversion
    
    </summary>
    
    
      <category term="SVN" scheme="https://www.zhuqiaolun.com/categories/SVN/"/>
    
    
      <category term="subversion" scheme="https://www.zhuqiaolun.com/tags/subversion/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722839250449/1722839250449/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722839250449/1722839250449/</id>
    <published>2024-08-05T06:27:30.000Z</published>
    <updated>2024-08-15T06:09:25.837Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个RabbitMq的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3.9.11-management</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag rabbitmq:3.9.11-management 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/rabbitmq:3.9.11-management</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>文件（rabbitmq-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-deployment</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-rabbitmq-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/rabbitmq/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">"10.200.40.39:8080/component/rabbitmq:3.9.11-management"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5672</span> <span class="comment"># amqp</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">4369</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">5671</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">15672</span> <span class="comment"># http</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">25672</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="comment">#存储</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/home/rabbitmq/</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">HOSTNAME</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MY_POD_IP</span></span><br><span class="line">            <span class="attr">valueFrom:</span></span><br><span class="line">              <span class="attr">fieldRef:</span></span><br><span class="line">                <span class="attr">fieldPath:</span> <span class="string">status.podIP</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_CLEANUP</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RABBITMQ_USE_LONGNAME</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"true"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_LOG_LEVEL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"debug"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_INTERVAL</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"60"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">CLEANUP_WARN_ONLY</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"false"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">AUTOCLUSTER_TYPE</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"k8s"</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">LANG</span></span><br><span class="line">            <span class="attr">value:</span> <span class="string">"en_US.UTF-8"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rabbitmq-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/rabbitmq/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-rabbitmq-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.98</span><span class="number">.104</span><span class="number">.75</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-rabbitmq</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">30672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">15672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-15672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31672</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-4369</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">4369</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-5671</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5671</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-25672</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">25672</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f rabbitmq-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-rabbitmq-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-rabbitmq-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster rabbitmq]# kubectl exec -it my-rabbitmq-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-rabbitmq-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：Redis3.2.10（单机）</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722839201478/1722839201478/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722839201478/1722839201478/</id>
    <published>2024-08-05T06:26:41.000Z</published>
    <updated>2024-08-15T06:09:22.455Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个Redis的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:3.2.10</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag redis:3.2.10 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/redis:3.2.10</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/redis:3.2.10</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（redis-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">redis.conf:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">bind</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">    <span class="string">protected-mode</span> <span class="literal">no</span></span><br><span class="line">    <span class="string">port</span> <span class="number">6379</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（redis-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-redis-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/redis/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-redis</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/redis:3.2.10</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/usr/local/etc/redis/redis.conf</span></span><br><span class="line">            <span class="attr">subPath:</span> <span class="string">redis.conf</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/data</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span></span><br><span class="line">            <span class="attr">mountPath:</span> <span class="string">/var/log/redis</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">redis-config</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">redis.conf</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">redis.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-data</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/data</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis-log</span> </span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/redis/logs</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-redis-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.102</span><span class="number">.96</span><span class="number">.83</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-redis</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">port-6379</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">6379</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31379</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f redis-configmap.yaml</span><br><span class="line">kubectl apply -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f redis-configmap.yaml</span><br><span class="line">kubectl delete -f redis-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-redis-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-redis-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster redis]# kubectl exec -it my-redis-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-redis-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8S v1.20.6 容器之部署：MySql8.0.27</title>
    <link href="https://www.zhuqiaolun.com/2024/08/1722836311451/1722836311451/"/>
    <id>https://www.zhuqiaolun.com/2024/08/1722836311451/1722836311451/</id>
    <published>2024-08-05T05:38:31.000Z</published>
    <updated>2024-08-15T06:09:19.449Z</updated>
    
    <content type="html"><![CDATA[<p>只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。</p><h3 id="拉取镜像并push到本地仓库"><a href="#拉取镜像并push到本地仓库" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span><br><span class="line">docker pull busybox</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag busybox 10.200.40.39:8080/component/busybox</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/busybox</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/busybox</span><br></pre></td></tr></tbody></table></figure></div><h3 id="拉取镜像并push到本地仓库-1"><a href="#拉取镜像并push到本地仓库-1" class="headerlink" title="拉取镜像并push到本地仓库"></a>拉取镜像并push到本地仓库</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0.27</span><br><span class="line">给镜像添加标签</span><br><span class="line">docker tag mysql:8.0.27 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">把镜像 push 到本地仓库</span><br><span class="line">docker push 10.200.40.39:8080/component/mysql:8.0.27</span><br><span class="line">节点拉取本地仓库的镜像</span><br><span class="line">docker pull 10.200.40.39:8080/component/mysql:8.0.27</span><br></pre></td></tr></tbody></table></figure></div><h4 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h4><p>使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">my.cnf:</span> <span class="string">|-</span></span><br><span class="line">       <span class="string">[client]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysql]</span></span><br><span class="line">       <span class="string">default-character-set=utf8mb4</span></span><br><span class="line">       <span class="string">[mysqld]</span></span><br><span class="line">       <span class="string">port=3308</span></span><br><span class="line">       <span class="string">max_connections</span> <span class="string">=</span> <span class="number">2000</span></span><br><span class="line">       <span class="comment">#secure_file_priv=/var/lib/mysql</span></span><br><span class="line">       <span class="string">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span></span><br><span class="line">       <span class="string">skip-name-resolve</span></span><br><span class="line">       <span class="string">open_files_limit</span> <span class="string">=</span> <span class="number">65535</span></span><br><span class="line">       <span class="string">table_open_cache</span> <span class="string">=</span> <span class="number">128</span></span><br><span class="line">       <span class="string">log_error</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-errorlog</span> <span class="comment">#错误日志路径</span></span><br><span class="line">       <span class="string">slow_query_log</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">long_query_time</span> <span class="string">=</span> <span class="number">1</span> <span class="comment">#慢查询时间 超过1秒则为慢查询</span></span><br><span class="line">       <span class="string">slow_query_log_file</span> <span class="string">=</span> <span class="string">varlibmysqlmysql-slowlog</span></span><br><span class="line">       <span class="string">default-storage-engine</span> <span class="string">=</span> <span class="string">InnoDB</span> <span class="comment">#默认存储引擎</span></span><br><span class="line">       <span class="string">innodb_file_per_table</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_open_files</span> <span class="string">=</span> <span class="number">500</span></span><br><span class="line">       <span class="string">innodb_buffer_pool_size</span> <span class="string">=</span> <span class="string">64M</span></span><br><span class="line">       <span class="string">innodb_write_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_read_io_threads</span> <span class="string">=</span> <span class="number">4</span></span><br><span class="line">       <span class="string">innodb_thread_concurrency</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">       <span class="string">innodb_purge_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">innodb_flush_log_at_trx_commit</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line">       <span class="string">innodb_log_buffer_size</span> <span class="string">=</span> <span class="string">2M</span></span><br><span class="line">       <span class="string">innodb_log_file_size</span> <span class="string">=</span> <span class="string">32M</span></span><br><span class="line">       <span class="string">innodb_log_files_in_group</span> <span class="string">=</span> <span class="number">3</span></span><br><span class="line">       <span class="string">innodb_max_dirty_pages_pct</span> <span class="string">=</span> <span class="number">90</span></span><br><span class="line">       <span class="string">innodb_lock_wait_timeout</span> <span class="string">=</span> <span class="number">120</span></span><br><span class="line">       <span class="string">bulk_insert_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">myisam_max_sort_file_size</span> <span class="string">=</span> <span class="string">10G</span></span><br><span class="line">       <span class="string">myisam_repair_threads</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">       <span class="string">interactive_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">wait_timeout</span> <span class="string">=</span> <span class="number">28800</span></span><br><span class="line">       <span class="string">[mysqldump]</span></span><br><span class="line">       <span class="string">quick</span></span><br><span class="line">       <span class="string">max_allowed_packet</span> <span class="string">=</span> <span class="string">16M</span> <span class="comment">#服务器发送和接受的最大包长度</span></span><br><span class="line">       <span class="string">[myisamchk]</span></span><br><span class="line">       <span class="string">key_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">sort_buffer_size</span> <span class="string">=</span> <span class="string">8M</span></span><br><span class="line">       <span class="string">read_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br><span class="line">       <span class="string">write_buffer</span> <span class="string">=</span> <span class="string">4M</span></span><br></pre></td></tr></tbody></table></figure></div><p>文件（mysql8-service.yaml）如下：</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限）</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">init-my-mysql8-data-chmod</span></span><br><span class="line">        <span class="comment"># 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/busybox</span></span><br><span class="line">        <span class="comment"># 使用root用户权限</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">runAsUser:</span> <span class="number">0</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">["chmod",</span> <span class="string">"-R"</span><span class="string">,</span> <span class="string">"755"</span><span class="string">,</span> <span class="string">"/mnt/nfs/k8s_share/mysql8/data"</span><span class="string">]</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-mysql8</span></span><br><span class="line">        <span class="comment">#刚刚push到私有仓库的镜像地址</span></span><br><span class="line">        <span class="attr">image:</span> <span class="number">10.200</span><span class="number">.40</span><span class="number">.39</span><span class="string">:8080/component/mysql:8.0.27</span></span><br><span class="line">        <span class="comment">#保证当本地有镜像的时候优先选用本地，没有才选择网络拉取</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">env:</span>  </span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">TZ</span> </span><br><span class="line">          <span class="attr">value:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_USER</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"root"</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_DATEBASE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">"myblog"</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">            <span class="comment">#内部程序端口</span></span><br><span class="line">            <span class="attr">containerPort:</span> <span class="number">3308</span></span><br><span class="line">        <span class="attr">resources:</span>  <span class="comment">#qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># 最小限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"256Mi"</span> <span class="comment"># 内存最新64M </span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"500m"</span> <span class="comment"># CPU最大使用0.25核</span></span><br><span class="line">          <span class="attr">limits:</span> <span class="comment"># 最大限制</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">"512Mi"</span> <span class="comment"># 内存最新128M</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">"1000m"</span> <span class="comment"># CPU最大使用0.5核</span></span><br><span class="line">        <span class="comment"># 容器内的路径</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>                            <span class="comment">#容器内挂载点名称</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span>              <span class="comment">#容器内挂载点路径，可以是文件或目录</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/my.cnf</span>       <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">          <span class="attr">subPath:</span> <span class="string">my.cnf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span>  </span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span>   <span class="comment">#容器内mysql的数据目录</span></span><br><span class="line">      <span class="comment"># 主机的路径</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">time-zone</span>          <span class="comment">#数据卷名称，需要与容器内挂载点名称一致</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/localtime</span>      <span class="comment">#挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-cinfig</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">mysql8-conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">mysql-data</span> <span class="comment">#和volumeMounts中的内容要对应</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/mnt/nfs/k8s_share/mysql8/data</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-mysql8-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.103</span><span class="number">.215</span><span class="number">.148</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">my-mysql8</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="comment"># Service对外暴露的端口，集群内部可访问</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3308</span></span><br><span class="line">    <span class="comment"># Pod内部容器监听的端口，默认使用和上面的 port 一致的</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">3308</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30308</span></span><br></pre></td></tr></tbody></table></figure></div><p>新建应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f mysql8-configmap.yaml</span><br><span class="line">kubectl apply -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>删除应用</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete -f mysql8-configmap.yaml</span><br><span class="line">kubectl delete -f mysql8-service.yaml</span><br></pre></td></tr></tbody></table></figure></div><p>查看容器日志</p><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pod my-mysql8-deployment</span><br><span class="line">查看启动日志：</span><br><span class="line">kubectl get pods（查看程序日志：kubectl logs <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span>）</span><br><span class="line">kubectl logs my-mysql8-deployment-6fc788f4c8-rsrl2</span><br></pre></td></tr></tbody></table></figure></div><h3 id="进入容器应用内部"><a href="#进入容器应用内部" class="headerlink" title="进入容器应用内部"></a>进入容器应用内部</h3><div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it <span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> -- /bin/bash ，<span class="tag">&lt;<span class="name">pod-name</span>&gt;</span> 由上一步命名执行得出</span><br><span class="line"></span><br><span class="line">[root@k8smaster mysql8]# kubectl exec -it my-mysql8-deployment-??????? -- /bin/bash</span><br><span class="line">[root@my-mysql8-deployment-76f6dcccd4-zv5sc /]# ls</span><br><span class="line">anaconda-post.log  bin  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></tbody></table></figure></div><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如遇见未知错误可删除已经生成的data目录，重新生成data<br>如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：<br>1进入MySQL的Pod中：<br>    kubectl exec -it my-mysql8-deployment-88f575676-2h2nn – /bin/bash<br>2进入MySQL命令行：<br>    mysql -uroot -proot -P 3306<br>3执行以下SQL语句，允许root用户从任意主机访问MySQL：<br>    GRANT ALL PRIVILEGES ON <em>.</em> TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION;<br>    FLUSH PRIVILEGES;<br>4退出MySQL命令行和Pod：exit；</p><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><a href="/2024/08/1722499285345/1722499285345/">K8S v1.20.6 容器之问题</a><br><a href="/2024/08/1722583767468/1722583767468/">K8S v1.20.6 容器之安装：ingress-nginx-0.30.0</a><br><a href="/2024/08/1722585036230/1722585036230/">K8S v1.20.6 容器之部署：openjdk-11</a><br><a href="/2024/08/1722586325029/1722586325029/">K8S v1.20.6 容器之部署：SpringBoot（Jar运行）</a><br><a href="/2024/08/1722586394326/1722586394326/">K8S v1.20.6 容器之部署：Nginx1.21.5</a><br><a href="/2024/08/1722586402699/1722586402699/">K8S v1.20.6 容器之部署：Tomcat9.0.56</a><br><a href="/2024/08/1722836276725/1722836276725/">K8S v1.20.6 容器之部署：MySql5.6.51</a><br><a href="/2024/08/1722836311451/1722836311451/">K8S v1.20.6 容器之部署：MySql8.0.27</a><br><a href="/2024/08/1722839201478/1722839201478/">K8S v1.20.6 容器之部署：Redis3.2.10（单机）</a><br><a href="/2024/08/1722839250449/1722839250449/">K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      k8s
    
    </summary>
    
    
      <category term="kubernetes" scheme="https://www.zhuqiaolun.com/categories/kubernetes/"/>
    
    
      <category term="k8s" scheme="https://www.zhuqiaolun.com/tags/k8s/"/>
    
  </entry>
  
</feed>
