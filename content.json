{"meta":{"title":"zhuqiaolun - 个人博客","subtitle":"","description":"zhuqiaolun的个人博客","author":"十二","url":"https://www.zhuqiaolun.com","root":"/"},"pages":[{"title":"","date":"2023-07-14T05:43:11.922Z","updated":"2020-05-29T13:21:34.674Z","comments":true,"path":"baidu_verify_KzupUF583A.html","permalink":"https://www.zhuqiaolun.com/baidu_verify_KzupUF583A.html","excerpt":"","text":"KzupUF583A document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"404 Not Found：该页无法显示","date":"2023-07-14T05:43:11.916Z","updated":"2020-05-21T02:45:41.758Z","comments":false,"path":"/404.html","permalink":"https://www.zhuqiaolun.com/404.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"},{"title":"关于","date":"2020-09-28T08:12:05.000Z","updated":"2024-08-13T06:57:17.571Z","comments":true,"path":"about/index.html","permalink":"https://www.zhuqiaolun.com/about/index.html","excerpt":"","text":"document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });"}],"posts":[{"title":"【JDK1.7】【properties配置】日志之 log4j 配置（控制台输出）","slug":"2026/01/1768813044601/1768813044601","date":"2026-01-19T08:57:24.000Z","updated":"2026-01-20T08:25:12.424Z","comments":false,"path":"2026/01/1768813044601/1768813044601/","link":"","permalink":"https://www.zhuqiaolun.com/2026/01/1768813044601/1768813044601/","excerpt":"log4j配置","text":"JDK1.8的版本 依赖123456789101112&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt;&lt;!--log4j 适配包。即面向 slf4j 调用 API，然后它内部调用适配包，最后适配包调用 log4j--&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt; log4j.properties12345678910111213#指定输出日志信息的级别与输出的位置#日志级别，包括 TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR .#console 表示下面的控制台，logFile 表示下面的日志文件.log4j.rootLogger=DEBUG,console#表示Logger不会在父Logger的appender里输出，默认为truelog4j.additivity.org.apache=true#控制台log4j.appender.console=org.apache.log4j.ConsoleAppenderlog4j.appender.console.layout=org.apache.log4j.PatternLayoutlog4j.appender.console.ImmediateFlush=truelog4j.appender.console.Target=System.out#日志输出的格式log4j.appender.console.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n 使用 private static final Logger log = LoggerFactory.getLogger(App.class); 1234567891011121314151617import org.slf4j.Logger;import org.slf4j.LoggerFactory;public class App { private static final Logger log = LoggerFactory.getLogger(App.class); public static void main(String[] args) { log.trace(\"This is trace\"); log.debug(\"This is debug\"); log.info(\"This is info\"); log.warn(\"This is warning\"); log.error(\"This is error\"); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"log4j","slug":"log4j","permalink":"https://www.zhuqiaolun.com/tags/log4j/"}]},{"title":"JavaFx之过渡动画","slug":"2025/12/1764912927964/1764912927964","date":"2025-12-05T05:35:27.000Z","updated":"2025-12-05T05:39:51.223Z","comments":false,"path":"2025/12/1764912927964/1764912927964/","link":"","permalink":"https://www.zhuqiaolun.com/2025/12/1764912927964/1764912927964/","excerpt":"过渡动画","text":"完整示例传送门 图例 使用12345678910111213// 虚拟数据，实际map放自己需要的内容Map&lt;String, Object&gt; objectMap = new LinkedHashMap&lt;&gt;();objectMap.put(\"result\", new Random().nextInt(2));// 导出try { Dialog dialog = SystemAlert.getDialog(window, \"导出中···\", FXMLLoader.load(Objects.requireNonNull(getClass().getClassLoader().getResource(\"fxml/Export.fxml\")))); dialog.initStyle(StageStyle.UNDECORATED); ExportController exportController = ExportController.getInstance(); exportController.loadProgress(dialog.getTitle(), objectMap, dialog); dialog.showAndWait();} catch (Exception e) { e.printStackTrace();} ExportController123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113package com.demon.controller;import cn.hutool.core.util.StrUtil;import com.demon.ui.SystemAlert;import javafx.concurrent.Service;import javafx.concurrent.Task;import javafx.fxml.FXML;import javafx.fxml.Initializable;import javafx.scene.control.Button;import javafx.scene.control.Dialog;import javafx.scene.control.Label;import javafx.scene.control.ProgressIndicator;import javafx.stage.Window;import java.net.URL;import java.util.Map;import java.util.ResourceBundle;import java.util.concurrent.TimeUnit;public class ExportController implements Initializable { private static ExportController exportController; @FXML public ProgressIndicator downloadProgressIndicator; @FXML public Label exportStatus; @FXML public Button downloadYes; private Map&lt;String, Object&gt; dataMap; /** * 异步 Service */ private Service&lt;Integer&gt; serviceExecute = new Service&lt;Integer&gt;() { @Override protected Task&lt;Integer&gt; createTask() { return new Task&lt;Integer&gt;() { @Override protected Integer call() { //业务逻辑，每执行一次 updateProgress 则可以 调用监听事件 try { // 导出操作 int result = (int)dataMap.get(\"result\"); System.out.println(result); TimeUnit.SECONDS.sleep(5); // 休眠10s 模拟导出过程，真实场景不需要 // 以上为自己业务的逻辑 if (result == 0) { System.out.println(\"导出完成！！！\"); downloadYes.setUserData(true); this.updateProgress(1, 1); } else { System.out.println(\"导出失败！！！\"); exportStatus.setUserData(\"自定义是失败原因\"); downloadYes.setUserData(false); this.updateProgress(0, 0); } } catch (Exception e) { e.printStackTrace(); downloadYes.setUserData(false); exportStatus.setUserData(String.valueOf(e.toString())); System.out.println(\"导出异常\"); updateProgress(0, 0); } finally { downloadYes.setDisable(false); } return null; } }; } }; static ExportController getInstance() { return exportController; } @Override public void initialize(URL location, ResourceBundle resources) { exportController = this; } void loadProgress(String title, Map&lt;String, Object&gt; dataMap, Dialog dialog) { this.dataMap = dataMap; exportStatus.setText(title); downloadYes.setOnMouseClicked(event -&gt; SystemAlert.getCloseDialogPane(downloadYes)); // 执行 调用 updateProgress 的 监听事件 serviceExecute.progressProperty().addListener((observable, oldValue, newValue) -&gt; { Window window = downloadYes.getScene().getWindow(); System.out.println(newValue); if (\"NaN\".equals(String.valueOf(newValue))) { //导出异常-关闭loading dialog.close(); exportStatus.setText(\"导出异常\"); SystemAlert.getAlertToInfo(window, \"提示\", \"导出异常\", String.valueOf(exportStatus.getUserData())); SystemAlert.getCloseDialogPane(downloadYes); } else { if (!StrUtil.isNullOrUndefined(String.valueOf(downloadYes.getUserData())) &amp;&amp; Boolean.parseBoolean(String.valueOf(downloadYes.getUserData()))) { //导出完成-关闭loading dialog.close(); exportStatus.setText(\"导出成功\"); // 导出完成后的操作·· //MainController.getInstance().loadData(); // 以上为自己业务的逻辑 SystemAlert.getCloseDialogPane(downloadYes); } else { exportStatus.setText(\"导出中···\"); } } }); serviceExecute.start(); }} Fxml1234567891011121314151617181920212223242526272829303132333435363738&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;?import javafx.geometry.Insets?&gt;&lt;?import javafx.scene.control.Button?&gt;&lt;?import javafx.scene.control.Label?&gt;&lt;?import javafx.scene.control.ProgressIndicator?&gt;&lt;?import javafx.scene.layout.*?&gt;&lt;AnchorPane xmlns=\"http://javafx.com/javafx\" xmlns:fx=\"http://javafx.com/fxml\" fx:controller=\"com.demon.controller.ExportController\" prefHeight=\"150.0\" prefWidth=\"300.0\"&gt; &lt;children&gt; &lt;BorderPane layoutX=\"30.0\" layoutY=\"30.0\" style=\"-fx-background-color: #FFFFFF;\" AnchorPane.bottomAnchor=\"-40.0\" AnchorPane.leftAnchor=\"0.0\" AnchorPane.rightAnchor=\"0.0\" AnchorPane.topAnchor=\"0.0\"&gt; &lt;center&gt; &lt;ProgressIndicator fx:id=\"downloadProgressIndicator\" prefHeight=\"123.0\" prefWidth=\"300.0\" BorderPane.alignment=\"CENTER\" /&gt; &lt;/center&gt; &lt;top&gt; &lt;HBox alignment=\"CENTER_LEFT\" prefHeight=\"25.0\" style=\"-fx-background-color: #F8F8F8;\" BorderPane.alignment=\"CENTER\"&gt; &lt;children&gt; &lt;Label fx:id=\"exportStatus\" text=\"加载提示中···\" /&gt; &lt;/children&gt; &lt;padding&gt; &lt;Insets left=\"10.0\" /&gt; &lt;/padding&gt; &lt;/HBox&gt; &lt;/top&gt; &lt;bottom&gt; &lt;HBox alignment=\"CENTER\" prefHeight=\"20.0\" BorderPane.alignment=\"CENTER\"&gt; &lt;children&gt; &lt;Button fx:id=\"downloadYes\" disable=\"true\" mnemonicParsing=\"false\" text=\"确定\" /&gt; &lt;/children&gt; &lt;padding&gt; &lt;Insets bottom=\"2.0\" left=\"2.0\" right=\"2.0\" top=\"15.0\" /&gt; &lt;/padding&gt;&lt;/HBox&gt; &lt;/bottom&gt; &lt;/BorderPane&gt; &lt;/children&gt;&lt;/AnchorPane&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"ProgressIndicator","slug":"ProgressIndicator","permalink":"https://www.zhuqiaolun.com/tags/ProgressIndicator/"}]},{"title":"JavaFx之Alert提示框","slug":"2025/12/1764905210595/1764905210595","date":"2025-12-05T03:26:50.000Z","updated":"2025-12-05T05:39:47.129Z","comments":false,"path":"2025/12/1764905210595/1764905210595/","link":"","permalink":"https://www.zhuqiaolun.com/2025/12/1764905210595/1764905210595/","excerpt":"Alert提示框","text":"完整示例传送门 使用1234567891011Optional&lt;ButtonType&gt; optionalButtonType = SystemAlert.getAlertToInfo(this.window, \"提示\", \"没有选中的数据\", null);if (optionalButtonType.isPresent()) { ButtonType buttonType = optionalButtonType.get(); System.out.println(buttonType.getButtonData().name());}Optional&lt;ButtonType&gt; optionalButtonType = SystemAlert.getAlertToConfig(this.getWindow(), \"信息\", \"选中的数据\", jsonString);if (optionalButtonType.isPresent()) { ButtonType buttonType = optionalButtonType.get(); System.out.println(buttonType.getButtonData().name());} 12345678910111213File file = new File(\"C:\\\\Users\\\\Demon\\\\Desktop\\\\将近酒.txt\");Optional&lt;ButtonType&gt; optionalButtonType = SystemAlert.getOpenFile(this.window, file.getName(), file.getAbsolutePath());if (optionalButtonType.isPresent()) { ButtonType buttonType = optionalButtonType.get(); System.out.println(buttonType.getButtonData().name()); if (buttonType.getButtonData() == ButtonType.FINISH.getButtonData()) { try { Desktop.getDesktop().open(file); } catch (IOException e) { e.printStackTrace(); } }} 1234567891011File file = new File(\"C:\\\\Users\\\\Demon\\\\Desktop\");String fileName = \"test\";Map&lt;String, String&gt; filterMap = new LinkedHashMap&lt;&gt;();filterMap.put(\"Excel 工作簿\", \"*.xlsx\");filterMap.put(\"Excel 97-2003 工作簿\", \"*.xls\");try { File openFileDir = SystemAlert.getOpenDir(this.window, file, fileName, filterMap); System.out.println(openFileDir);} catch (IOException e) { e.printStackTrace();} SystemAlert123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113package com.demon.ui;import javafx.scene.Node;import javafx.scene.control.*;import javafx.stage.FileChooser;import javafx.stage.Window;import java.io.File;import java.io.IOException;import java.util.Map;import java.util.Optional;/** * author: Demon * date: 2025-12-04 004 15:31 * description: 提示框 Alert.AlertType 自行扩展 */public class SystemAlert { // 提示 INFORMATION public static Optional&lt;ButtonType&gt; getAlertToInfo(Window window, String title, String headerText, String contentText) { Alert alert = new Alert(Alert.AlertType.INFORMATION); alert.setTitle(title); alert.setHeaderText(headerText); alert.setContentText(contentText); alert.getButtonTypes().set(0, ButtonType.CLOSE); alert.initOwner(window); return alert.showAndWait(); } // 提示 CONFIRMATION public static Optional&lt;ButtonType&gt; getAlertToConfig(Window window, String title, String headerText, String contentText) { Alert alert = new Alert(Alert.AlertType.CONFIRMATION); alert.setTitle(title); alert.setHeaderText(headerText); alert.setContentText(contentText); alert.getButtonTypes().set(0, new ButtonType(\"确定\", ButtonType.OK.getButtonData())); alert.getButtonTypes().set(1, new ButtonType(\"取消\", ButtonType.NO.getButtonData())); alert.initOwner(window); return alert.showAndWait(); } public static Optional&lt;ButtonType&gt; getOpenFile(Window window, String headerText, String contentText) { Alert alert = new Alert(Alert.AlertType.INFORMATION); alert.setTitle(\"打开文件\"); alert.setHeaderText(headerText); alert.setContentText(contentText); ButtonType finalButtonType = new ButtonType(\"打开\", ButtonType.FINISH.getButtonData()); ButtonType closeButtonType = new ButtonType(\"关闭\", ButtonType.CLOSE.getButtonData()); alert.getButtonTypes().clear(); alert.getButtonTypes().add(0, finalButtonType); alert.getButtonTypes().add(1, closeButtonType); alert.initOwner(window); return alert.showAndWait(); } /** * 弹窗选择目录框 * * @param fileName 文件名（不含后缀） * @param filterMap key=描述,value=过滤 * @return 返回 */ public static File getOpenDir(Window window, File file, String fileName, Map&lt;String, String&gt; filterMap) throws IOException { FileChooser fileChooser = new FileChooser(); fileChooser.setTitle(\"选择目录\"); //打开选择目录，设置默认文件名 fileChooser.setInitialFileName(fileName); //打开选择目录，设置默认路径为桌面 //fileChooser.setInitialDirectory(FileSystemView.getFileSystemView().getHomeDirectory()); fileChooser.setInitialDirectory(file); //打开选择目录，设置过滤目录文件 if (filterMap != null &amp;&amp; filterMap.size() &gt; 0) { for (Map.Entry&lt;String, String&gt; entry : filterMap.entrySet()) { String description = entry.getKey(), extensions = entry.getValue(); fileChooser.getExtensionFilters().add(new FileChooser.ExtensionFilter(description, extensions)); } } return fileChooser.showSaveDialog(window); } public static Dialog getDialog(Window window, String title, Node content) { Dialog dialog = new Dialog&lt;&gt;(); dialog.setTitle(title); dialog.setHeaderText(null); ButtonType closeButtonType = new ButtonType(\"关闭\", ButtonBar.ButtonData.CANCEL_CLOSE); dialog.getDialogPane().getButtonTypes().addAll(closeButtonType); //添加组件 dialog.getDialogPane().setContent(content); dialog.initOwner(window); //隐藏按钮 Node closeButton = dialog.getDialogPane().lookupButton(closeButtonType); closeButton.setVisible(false); return dialog; } /** * 关闭当前弹窗面板 */ public static void getCloseDialogPane(Button closeBtn) { DialogPane dialogPane = (DialogPane) closeBtn.getScene().getRoot(); for (ButtonType bt : dialogPane.getButtonTypes()) { if (bt.getButtonData() == ButtonBar.ButtonData.CANCEL_CLOSE) { closeBtn = (Button) dialogPane.lookupButton(bt); closeBtn.fire(); break; } } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"Alert","slug":"Alert","permalink":"https://www.zhuqiaolun.com/tags/Alert/"}]},{"title":"JavaFx之TableView工具","slug":"2025/12/1764903803268/1764903803268","date":"2025-12-05T03:03:23.000Z","updated":"2025-12-05T05:40:00.416Z","comments":false,"path":"2025/12/1764903803268/1764903803268/","link":"","permalink":"https://www.zhuqiaolun.com/2025/12/1764903803268/1764903803268/","excerpt":"TableView工具","text":"完整示例传送门 图例 使用12345678910111213141516171819202122232425// 初始化 表格样式TableViewUi&lt;TableViewDemo&gt; tableViewUi = new TableViewUi&lt;&gt;(true);// 加载表格列表0TableColumn&lt;TableViewDemo, String&gt; nameTableColumn0 = tableViewUi.addTableColumn(\"序号\");nameTableColumn0.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getIndex()));nameTableColumn0.setMinWidth(50);nameTableColumn0.setMaxWidth(50);// 加载表格列表1TableColumn&lt;TableViewDemo, String&gt; nameTableColumn1 = tableViewUi.addTableColumn(\"姓名\");nameTableColumn1.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getName()));nameTableColumn1.setMinWidth(60);nameTableColumn1.setMaxWidth(80);// 加载表格列表2TableColumn&lt;TableViewDemo, String&gt; nameTableColumn2 = tableViewUi.addTableColumn(\"年龄\");nameTableColumn2.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue().getAge()));nameTableColumn2.setMinWidth(60);nameTableColumn2.setMaxWidth(80);// 加载表格数据List&lt;TableViewDemo&gt; tableViewDemoList = new ArrayList&lt;&gt;();for (int i = 0; i &lt;20 ; i++) { tableViewDemoList.add(new TableViewDemo().setIndex(String.valueOf(i+1)).setName(\"张三\"+i).setAge(String.valueOf(ThreadLocalRandom.current().nextInt(10, 100))));}tableViewUi.initData(tableViewDemoList);// 将表格添加到容器组件TableView&lt;TableViewDemo&gt; tableView = tableViewUi.getTableView(); TableViewUi创建一个表格UI，快速加载表格数据 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182import javafx.beans.InvalidationListener;import javafx.beans.value.ChangeListener;import javafx.beans.value.ObservableValue;import javafx.collections.FXCollections;import javafx.collections.ObservableList;import javafx.scene.control.CheckBox;import javafx.scene.control.TableCell;import javafx.scene.control.TableColumn;import javafx.scene.control.TableView;import javafx.util.Callback;import java.util.ArrayList;import java.util.List;/** * author: Demon * date: 2025-12-04 004 14:48 * description: 表格UI */ public class TableViewUi&lt;T extends TableViewUi.TableViewData&gt; { private TableView&lt;T&gt; tableView = new TableView&lt;&gt;(); private CheckBox checkBoxAll = new CheckBox(\"全选\"); public TableViewUi(boolean isNeedCheckBoxAll) { tableView.getStylesheets().add(\"css/table.css\"); this.tableView.setEditable(false); this.tableView.setColumnResizePolicy((param) -&gt; true); this.tableView.setColumnResizePolicy(TableView.CONSTRAINED_RESIZE_POLICY); this.tableView.setFocusTraversable(false); if (isNeedCheckBoxAll) { this.checkBoxAll.setText(\"\"); this.checkBoxAll.setSelected(false); this.checkBoxAll.setOnAction(event -&gt; this.getSelectAllEvent()); // 第一列 TableColumn&lt;T, CheckBox&gt; checkBoxTableColumn = new TableColumn&lt;&gt;(); checkBoxTableColumn.setCellValueFactory(cellData -&gt; cellData.getValue().getCb().getCheckBox()); checkBoxTableColumn.setCellFactory(this.getTableCellFactoryToCheckBox()); checkBoxTableColumn.setMinWidth(50); checkBoxTableColumn.setMaxWidth(50); //checkBoxTableColumn.setStyle(\"-fx-alignment:center\"); checkBoxTableColumn.setGraphic(checkBoxAll); checkBoxTableColumn.setSortable(false); tableView.getColumns().add(checkBoxTableColumn); } } public TableView&lt;T&gt; getTableView() { return tableView; } /** * 添加列： * tableColumn.setCellValueFactory(cellData -&gt; new SimpleStringProperty(cellData.getValue())); * tableColumn.setMinWidth(60); * tableColumn.setMaxWidth(80); * * @param tableColumnName 列名 */ public TableColumn&lt;T, String&gt; addTableColumn(String tableColumnName) { TableColumn&lt;T, String&gt; tableColumn = new TableColumn&lt;&gt;(tableColumnName); tableColumn.setVisible(true); this.tableView.getColumns().add(tableColumn); return tableColumn; } public void initData(List&lt;T&gt; tableViewList) { tableView.getItems().clear(); tableView.setItems(FXCollections.observableArrayList(tableViewList)); } public List&lt;T&gt; getTableViewToSelectData() { List&lt;T&gt; dataList = new ArrayList&lt;&gt;(); ObservableList&lt;T&gt; tableViewItems = tableView.getItems(); if (tableViewItems.size() &gt; 0) { for (T t : tableViewItems) { if (t.getCb().isSelected()) { dataList.add(t); } } } return dataList; } /** * 初始化复选框-监听-所有checkbox复选框都勾选则全选框勾选， * 所有checkbox复选框不勾选则全选框不勾选 * * @return 返回 */ private Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt; getTableCellFactoryToCheckBox() { return new Callback&lt;TableColumn&lt;T, CheckBox&gt;, TableCell&lt;T, CheckBox&gt;&gt;() { @Override public TableCell&lt;T, CheckBox&gt; call(TableColumn&lt;T, CheckBox&gt; param) { return new TableCell&lt;T, CheckBox&gt;() { @Override public void updateItem(CheckBox item, boolean empty) { super.updateItem(item, empty); setGraphic(item); if (item != null) { item.selectedProperty().addListener((observable, oldValue, newValue) -&gt; { boolean flagSelectAll = true; ObservableList&lt;T&gt; items2 = tableView.getItems(); for (T t : items2) { if (!t.getCb().isSelected()) { flagSelectAll = false; break; } } checkBoxAll.setSelected(flagSelectAll); }); } } }; } }; } private void getSelectAllEvent() { ObservableList&lt;T&gt; items = tableView.getItems(); if (checkBoxAll.isSelected()) { for (T t : items) { t.getCb().setCheckbox(true); } checkBoxAll.setSelected(true); } else { for (T t : items) { t.getCb().setCheckbox(false); } checkBoxAll.setSelected(false); } } public static class TableViewData { private CheckboxUi cb = new CheckboxUi(); CheckboxUi getCb() { return cb; } } public static class CheckboxUi { private CheckBox checkbox = new CheckBox(); ObservableValue&lt;CheckBox&gt; getCheckBox() { return new ObservableValue&lt;CheckBox&gt;() { @Override public CheckBox getValue() { return checkbox; } @Override public void addListener(ChangeListener&lt;? super CheckBox&gt; listener) { } @Override public void removeListener(ChangeListener&lt;? super CheckBox&gt; listener) { } @Override public void addListener(InvalidationListener listener) { } @Override public void removeListener(InvalidationListener listener) { } }; } Boolean isSelected() { return checkbox.isSelected(); } void setCheckbox(boolean value) { checkbox.setSelected(value); } }} TableViewDemo123456789101112131415161718192021222324252627282930313233import com.demon.ui.TableViewUi;public class TableViewDemo extends TableViewUi.TableViewData { private String index; private String name; private String age; public String getIndex() { return index; } public TableViewDemo setIndex(String index) { this.index = index; return this; } public String getName() { return name; } public TableViewDemo setName(String name) { this.name = name; return this; } public String getAge() { return age; } public TableViewDemo setAge(String age) { this.age = age; return this; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"TableView","slug":"TableView","permalink":"https://www.zhuqiaolun.com/tags/TableView/"}]},{"title":"MongoTemplate的封装应用：MongoTemplateUtil","slug":"2025/08/1755659266090/1755659266090","date":"2025-08-20T03:07:46.000Z","updated":"2025-08-20T05:27:53.953Z","comments":false,"path":"2025/08/1755659266090/1755659266090/","link":"","permalink":"https://www.zhuqiaolun.com/2025/08/1755659266090/1755659266090/","excerpt":"MongoTemplateUtil","text":"SpringUtils类 MongoTemplate配置 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174package com.demon.common.mongodb.utils;import com.mongodb.bulk.BulkWriteResult;import com.mongodb.client.result.DeleteResult;import com.mongodb.client.result.UpdateResult;import com.demon.common.core.utils.SpringUtils;import lombok.extern.slf4j.Slf4j;import org.springframework.data.domain.PageRequest;import org.springframework.data.mongodb.core.BulkOperations;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.query.Criteria;import org.springframework.data.mongodb.core.query.Query;import org.springframework.data.mongodb.core.query.Update;import java.io.Serializable;import java.util.Collection;import java.util.List;import java.util.Map;/** * Mongo 工具类 * * @author demon * &lt;p&gt; * 参考：https://blog.csdn.net/mouday/article/details/128706828 * 参考：https://www.cnblogs.com/mihutao/p/17522327.html * 参考：https://www.cnblogs.com/gongchengship/p/18306392 */@Slf4jpublic class MongoTemplateUtil { private static final MongoTemplate mongoTemplate = SpringUtils.getBean(MongoTemplate.class); /** * 插入一条记录（选择字段，策略插入） */ public static &lt;T&gt; T save(T entity) { return mongoTemplate.insert(entity); } /** * 插入（批量） */ public static &lt;T&gt; Collection&lt;T&gt; saveBatch(Collection&lt;? extends T&gt; entityList, Class&lt;T&gt; entityClass) { return mongoTemplate.insert(entityList, entityClass); } /** * 根据 ID 删除 */ public static DeleteResult removeById(String id, Class&lt;?&gt; entityClass) { return mongoTemplate.remove(new Query(Criteria.where(\"_id\").is(id)), entityClass); } /** * 删除（根据ID 批量删除） */ public static DeleteResult removeByIds(Collection&lt;? extends Serializable&gt; idList, Class&lt;?&gt; entityClass) { return mongoTemplate.remove(new Query(Criteria.where(\"_id\").in(idList)), entityClass); } /** * 根据 columnMap 条件，删除记录 */ public static DeleteResult removeByMap(Map&lt;String, Object&gt; columnMap, Class&lt;?&gt; entityClass) { Criteria criteria = new Criteria(); for (Map.Entry&lt;String, Object&gt; entry : columnMap.entrySet()) { criteria.and(entry.getKey()).is(entry.getValue()); } return mongoTemplate.remove(new Query(criteria), entityClass); } /** * 根据 query 设置的条件，删除记录 * eg: Query query = new Query(Criteria.where(\"_id\").is(\"123456912\").and(\"age\").gt(11)); */ public static DeleteResult removeByQuery(Query query, Class&lt;?&gt; entityClass) { log.info(\"MongoTemplateUtil.removeByQuery执行语句：{}\", query.toString()); return mongoTemplate.remove(query, entityClass); } /** * 删除文档全部数据 */ public static DeleteResult removeAll(Class&lt;?&gt; entityClass) { return mongoTemplate.remove(new Query(), entityClass); } /** * 根据 Query条件 更新 */ public static UpdateResult update(Query query, Update update, Class&lt;?&gt; entityClass) { return mongoTemplate.updateMulti(query, update, entityClass); } /** * 根据 ID 更新 */ public static UpdateResult updateById(String id, Update update, Class&lt;?&gt; entityClass) { return mongoTemplate.updateMulti(new Query(Criteria.where(\"_id\").is(id)), update, entityClass); } /** * 根据ID 批量更新 */ public static UpdateResult updateBatchById(Collection&lt;String&gt; ids, Update update, Class&lt;?&gt; entityClass) { return mongoTemplate.updateMulti(new Query(Criteria.where(\"_id\").in(ids)), update, entityClass); } /** * 根据 Query条件 批量更新 */ public static BulkWriteResult updateBatchByQuery(Map&lt;Query, Update&gt; queryUpdateMap, Class&lt;?&gt; entityClass) { BulkOperations bulkOperations = mongoTemplate.bulkOps(BulkOperations.BulkMode.ORDERED, entityClass); for (Map.Entry&lt;Query, Update&gt; entry : queryUpdateMap.entrySet()) { bulkOperations.updateMulti(entry.getKey(), entry.getValue()); } return bulkOperations.execute(); } /** * 根据 ID 查询 */ public static &lt;T&gt; T selectById(String id, Class&lt;T&gt; entityClass) { return mongoTemplate.findById(id, entityClass); } /** * 查询（根据ID 批量查询） */ public static &lt;T&gt; List&lt;T&gt; selectBatchIds(Collection&lt;String&gt; ids, Class&lt;T&gt; entityClass) { return mongoTemplate.find(new Query(Criteria.where(\"_id\").in(ids)), entityClass); } /** * 根据 query 条件，查询一条记录，结果集如果是多个会取第一条 */ public static &lt;T&gt; T selectOne(Query query, Class&lt;T&gt; entityClass) { return mongoTemplate.findOne(query, entityClass); } /** * 根据 query 条件，查询全部记录 */ public static &lt;T&gt; List&lt;T&gt; selectList(Query query, Class&lt;T&gt; entityClass) { return mongoTemplate.find(query, entityClass); } /** * 查询全部记录 */ public static &lt;T&gt; List&lt;T&gt; selectList(Class&lt;T&gt; entityClass) { return mongoTemplate.findAll(entityClass); } /** * 根据 query 条件，查询分页记录 */ public static &lt;T&gt; List&lt;T&gt; selectPage(int page, int size, Query query, Class&lt;T&gt; entityClass) { query.with(PageRequest.of(page, size)); log.info(\"MongoTemplateUtil.selectPage执行语句：{}\", query.toString()); return mongoTemplate.find(query, entityClass); } /** * 根据 query 条件，查询总记录数 */ public static long selectCount(Query query, Class&lt;?&gt; entityClass) { return mongoTemplate.count(query, entityClass); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"MongoDb","slug":"MongoDb","permalink":"https://www.zhuqiaolun.com/tags/MongoDb/"}]},{"title":"MongoTemplate的简单应用（spring-boot-starter-data-mongodb）","slug":"2025/08/1755658946010/1755658946010","date":"2025-08-20T03:02:26.000Z","updated":"2025-08-20T05:25:31.064Z","comments":false,"path":"2025/08/1755658946010/1755658946010/","link":"","permalink":"https://www.zhuqiaolun.com/2025/08/1755658946010/1755658946010/","excerpt":"MongoTemplate的简单应用","text":"MongoDB是一款开源的文档型数据库，它以动态的模式存储类似JSON的BSON文档，能够处理大量的非结构化数据。其特点包括灵活的数据模型、高效的索引机制、支持数据复制和分片，以及易于使用的API。MongoDB适用于需要快速迭代和存储多样化数据格式的应用场景。 依赖1234567891011&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt; &lt;version&gt;2.7.18&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 可选：用于 JSON 序列化/反序列化 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.mongodb&lt;/groupId&gt; &lt;artifactId&gt;mongodb-driver-legacy&lt;/artifactId&gt; &lt;version&gt;4.6.1&lt;/version&gt;&lt;/dependency&gt; yml 配置1234# mongodb 配置mongodb: uri: mongodb://127.0.0.1:27017/dataBaseName database: dataBaseName config 配置当前的uri为无密码写法 12345678910111213141516package com.demon.common.mongodb.config.properties;import lombok.Data;import org.springframework.boot.context.properties.ConfigurationProperties;/** * Mongodb 配置属性 */@Data@ConfigurationProperties(prefix = \"mongodb\")public class MongodbProperties { private String uri; private String database;} convert 转换器针对存储类型转换 Mongodb存储的基本数据字段类型有： 12345678910111213141516171819202122232425262728293031323334351.1 String1.描述:字符串类型，用于存储文本数据，支持 UTF-8 编码。2.示例:“name”: “Alice”1.2 Number1.Int32/Int64: 整数类型（32 位或 64 位）。“age”: 302.示例:Double: 双精度浮点数。“height”: 1.751.3 Boolean1.布尔类型，用于存储 true 或 false。2.示例:“isStudent”: true1.4 Date1.描述:日期类型，用于存储日期和时间，存储为 UTC 时间。2.示例:“createdAt”: ISODate(“2023-10-01T00:00:00Z”)1.5 Null1.描述:空值类型，用于表示字段值为空或不存在。2.示例:“middleName”: null1.6 ObjectId1.描述:唯一标识符类型，MongoDB 默认的 _id 字段类型，用于唯一标识文档。2.示例:“_id”: ObjectId(“6523f1c7e8b8d4a5b3c1d2e3”)1.7 Array1.描述:数组类型，用于存储一组值，可以是任意数据类型的混合。2.示例:“tags”: [“mongodb”, “database”, “nosql”]1.8 Binary Data1.描述:二进制数据类型，用于存储二进制数据（如图片、文件等）。2.示例:“imageData”: BinData(0, “base64data==”)1.9 Object1.描述:嵌套文档类型，用于存储嵌套的键值对（类似于 JSON 对象）。2.示例:“address”: { “city”: “New York”, “zip”: “10001” } BigDecimal 转 Decimal1281234567891011121314151617181920212223package com.demon.common.mongodb.convert;import org.bson.types.Decimal128;import org.jetbrains.annotations.NotNull;import org.springframework.core.convert.converter.Converter;import org.springframework.data.convert.WritingConverter;import java.math.BigDecimal;/** * author: Demon * date: 2025-08-15 015 14:33 * description: 配置 BigDecimal 转 Decimal128 的转换器 BigDecimalToDecimal128Converter */@WritingConverterpublic class BigDecimalToDecimal128Converter implements Converter&lt;BigDecimal, Decimal128&gt; { @Override public Decimal128 convert(@NotNull BigDecimal bigDecimal) { return new Decimal128(bigDecimal); }} Decimal128 转 BigDecimal12345678910111213141516171819202122package com.demon.common.mongodb.convert;import org.bson.types.Decimal128;import org.jetbrains.annotations.NotNull;import org.springframework.core.convert.converter.Converter;import org.springframework.data.convert.ReadingConverter;import java.math.BigDecimal;/** * author: Demon * date: 2025-08-15 015 14:33 * description: 配置 Decimal128 转 BigDecimal 的转换器 Decimal128ToBigDecimalConverter */@ReadingConverterpublic class Decimal128ToBigDecimalConverter implements Converter&lt;Decimal128, BigDecimal&gt; { @Override public BigDecimal convert(@NotNull Decimal128 decimal128) { return decimal128.bigDecimalValue(); }} Date 转 ZonedDateTime12345678910111213141516171819202122232425package com.demon.common.mongodb.convert;import org.jetbrains.annotations.NotNull;import org.springframework.core.convert.converter.Converter;import org.springframework.data.convert.ReadingConverter;import java.time.ZoneOffset;import java.time.ZonedDateTime;import java.util.Date;/** * author: Demon * date: 2025-08-14 014 17:16 * description: Date 转 ZonedDateTime */@ReadingConverterpublic class ZonedDateTimeReadConverter implements Converter&lt;Date, ZonedDateTime&gt; { @Override public ZonedDateTime convert(@NotNull Date date) { System.out.println(\"Date 转 ZonedDateTime\"); return date.toInstant().atZone(ZoneOffset.systemDefault()); }} ZonedDateTime 转 Date123456789101112131415161718192021222324package com.demon.common.mongodb.convert;import org.jetbrains.annotations.NotNull;import org.springframework.core.convert.converter.Converter;import org.springframework.data.convert.WritingConverter;import java.time.ZonedDateTime;import java.util.Date;/** * author: Demon * date: 2025-08-14 014 17:17 * description: ZonedDateTime 转 Date */@WritingConverterpublic class ZonedDateTimeWriteConverter implements Converter&lt;ZonedDateTime, Date&gt; { @Override public Date convert(@NotNull ZonedDateTime zonedDateTime) { System.out.println(\"ZonedDateTime 转 Date\"); return Date.from(zonedDateTime.toInstant()); }} Mongodb配置123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118package com.demon.common.mongodb.config;import com.mongodb.ConnectionString;import com.mongodb.MongoClientSettings;import com.mongodb.client.MongoClient;import com.mongodb.client.MongoClients;import com.demon.common.mongodb.config.properties.MongodbProperties;import com.demon.common.mongodb.convert.BigDecimalToDecimal128Converter;import com.demon.common.mongodb.convert.Decimal128ToBigDecimalConverter;import com.demon.common.mongodb.convert.ZonedDateTimeReadConverter;import com.demon.common.mongodb.convert.ZonedDateTimeWriteConverter;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.autoconfigure.AutoConfiguration;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.cache.annotation.EnableCaching;import org.springframework.context.annotation.Bean;import org.springframework.data.mongodb.MongoDatabaseFactory;import org.springframework.data.mongodb.MongoTransactionManager;import org.springframework.data.mongodb.core.MongoTemplate;import org.springframework.data.mongodb.core.SimpleMongoClientDatabaseFactory;import org.springframework.data.mongodb.core.convert.*;import org.springframework.data.mongodb.core.mapping.MongoMappingContext;import java.util.Arrays;import java.util.concurrent.TimeUnit;/** * Mongodb配置 * https://www.mongodb.com/zh-cn/docs/manual/administration/connection-pool-overview/ * * @author demon */@Slf4j@AutoConfiguration@EnableCaching@EnableConfigurationProperties(MongodbProperties.class)public class MongodbConfiguration { @Autowired private MongodbProperties mongodbProperties; @Bean public MongoDatabaseFactory mongoDatabaseFactory() { MongoClientSettings.Builder builder = MongoClientSettings.builder(); // 设置应用程序的逻辑名称 builder.applicationName(\"yet-platform-saas\"); // 设置应用 builder.applyConnectionString(new ConnectionString(mongodbProperties.getUri())); // 连接池 builder.applyToConnectionPoolSettings(b -&gt; { // 允许的最大连接数。这些连接在空闲时将保留在池中。一旦池耗尽，任何需要连接的操作都将阻塞等待可用连接 默认: 100 b.maxSize(100); // 最小连接数。这些连接在空闲时将保留在池中，并且池将确保它至少包含这个最小数量 默认: 0 b.minSize(18); // 池连接可以存活的最长时间。零值表示寿命没有限制。超过其生命周期的池连接将被关闭并在必要时由新连接替换 b.maxConnectionLifeTime(0, TimeUnit.SECONDS); // 池连接的最大空闲时间。零值表示对空闲时间没有限制。超过其空闲时间的池连接将被关闭并在必要时由新连接替换 b.maxConnectionIdleTime(5, TimeUnit.MINUTES); b.maxWaitTime(120, TimeUnit.SECONDS); }); MongoClient mongoClient = MongoClients.create(builder.build()); return new SimpleMongoClientDatabaseFactory(mongoClient, mongodbProperties.getDatabase()); } @Bean public MongoMappingContext mongoMappingContext() { return new MongoMappingContext(); } /** * 自定义 MongoTemplate */ @Bean public MongoTemplate mongoTemplate(MongoDatabaseFactory mongoDatabaseFactory, MappingMongoConverter converter) { return new MongoTemplate(mongoDatabaseFactory, converter); } //配置 mongodb 事务管理器，能够让 mongodb 支持事务操作 @Bean MongoTransactionManager mongoTransactionManager(MongoDatabaseFactory mongoDatabaseFactory) { return new MongoTransactionManager(mongoDatabaseFactory); } /** * 自定义 MappingMongoConverter */ @Bean public MappingMongoConverter mappingMongoConverter(MongoDatabaseFactory mongoDatabaseFactory, MongoMappingContext mongoMappingContext, MongoCustomConversions mongoCustomConversions) { DbRefResolver dbRefResolver = new DefaultDbRefResolver(mongoDatabaseFactory); MappingMongoConverter mappingMongoConverter = new MappingMongoConverter(dbRefResolver, mongoMappingContext); // 自定义配置 mappingMongoConverter.setTypeMapper(new DefaultMongoTypeMapper(null)); // 移除 _class 字段 mappingMongoConverter.setCustomConversions(mongoCustomConversions); // 注册自定义转换器 mappingMongoConverter.afterPropertiesSet(); return mappingMongoConverter; } /** * 注册自定义类型转换器 */ @Bean public MongoCustomConversions mongoCustomConversions() { return new MongoCustomConversions(Arrays.asList( // 添加自定义转换器 - BigDecimal 类型 new BigDecimalToDecimal128Converter(), new Decimal128ToBigDecimalConverter(), // 添加自定义转换器 - ZonedDateTime 类型 new ZonedDateTimeReadConverter(), new ZonedDateTimeWriteConverter() )); }} 方法使用123456789101112131415161718 @Resource private MongoTemplate mongoTemplate;1.新增 mongoTemplate.insert() 2.删除 mongoTemplate.remove() 2.修改 mongoTemplate.updateMulti() 2.查询 mongoTemplate.find() 2.统计 mongoTemplate.count() Query使用12345678910111213141516171819202122232425262728293031323334// 创建条件对象Criteria criteria = new Criteria();// 等于criteria.and(\"_id\").is(123457);// 模糊查询 忽略大小写，匹配正则criteria.and(\"userName\").regex(Pattern.compile(\"^.*W.*$\", Pattern.CASE_INSENSITIVE));// 查询多个字段 等于 或criteria.orOperator(Criteria.where(\"_id\").is(\"123457\"), Criteria.where(\"_id\").is(\"123456\"));// 查询日期范围 大于等于createTime 小于等于updateTime 并且，传入当前时间即可，mongodb 会自动转换UTC时间格式处理criteria.andOperator(Criteria.where(\"createTime\").gte(DateUtils.parseDate(\"2025-08-11 09:41:23.449\")), Criteria.where(\"updateTime\").lte(DateUtils.parseDate(\"2025-08-18 11:41:23.449\")));// 查询int数值范围 大于等于22 小于等于33 并且，criteria.and(\"age\").gte(22).lte(33);// 查询BigDecimal数值范围 大于等于10.5 小于等于12.5 并且criteria.and(\"balance\").gte(10.5).lte(12.5);// 匹配多个内容criteria.and(\"age\").in(Arrays.asList(22, 33));// 组装SQL语句Query query = new Query(criteria);// 查询返回指定字段 (自定义列表)query.fields().include(\"_id\", \"userName\", \"nickName\", \"age\", \"createTime\");// 排序，这里以age升序为例query.with(Sort.by(Sort.Direction.ASC, \"age\"));// 分页查询，page为当前页面，size为当前页的条数，初始page=0query.with(PageRequest.of(page, size)); 工具类 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"MongoDb","slug":"MongoDb","permalink":"https://www.zhuqiaolun.com/tags/MongoDb/"}]},{"title":"定时任务的简单应用（spring-boot-starter-quartz）","slug":"2025/06/1749008291584/1749008291584","date":"2025-06-04T03:38:11.000Z","updated":"2025-06-04T05:40:44.787Z","comments":false,"path":"2025/06/1749008291584/1749008291584/","link":"","permalink":"https://www.zhuqiaolun.com/2025/06/1749008291584/1749008291584/","excerpt":"定时任务的简单应用","text":"配置 依赖12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt; &lt;version&gt;2.4.3&lt;/version&gt;&lt;/dependency&gt; 任务定义123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package com.demon.springbootquartzsimple.quartz.job;import com.demon.springbootquartzsimple.quartz.TaskManager;import lombok.extern.slf4j.Slf4j;import org.quartz.*;import javax.annotation.PostConstruct;/** * author: Demon * date: 2025-06-03 003 17:34 * description: 任务定义 */@Slf4jpublic abstract class ScheduledJob implements Job { /** * 初始化任务 */ @PostConstruct public void init() { boolean run = this.isRun(); log.info(\"初始化任务【{}】，是否添加任务:{}\",this.getClass().getName(),run); if(run){ TaskManager.JOB_LIST.add(this); } } /** * 任务是否需求 */ public abstract boolean isRun(); /** * cron表达式在线生成 http://cron.qqe2.com/ * cron表达式在线生成 https://cron.ciding.cc/ */ public abstract String getCron(); /** * @param scheduler 0/5 * * * * ? * @throws SchedulerException 异常 */ public void startJob(Scheduler scheduler) throws SchedulerException { JobDetail jobDetail = JobBuilder.newJob(this.getClass()).withIdentity(this.getClass().getName() + \"-job\", \"group1\").build(); CronScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(this.getCron()); CronTrigger cronTrigger = this.getCronTrigger(scheduleBuilder); scheduler.scheduleJob(jobDetail, cronTrigger); } /** * 若要自定义触发器,请在子类重写此方法 */ private CronTrigger getCronTrigger(CronScheduleBuilder scheduleBuilder) { return TriggerBuilder.newTrigger().withIdentity(this.getClass().getName() + \"-trigger\", \"group1\").withSchedule(scheduleBuilder).build(); }} 任务管理器1234567891011121314151617181920212223242526272829303132333435363738394041package com.demon.springbootquartzsimple.quartz;import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;import com.demon.springbootquartzsimple.support.ApplicationContextHelper;import org.springframework.scheduling.quartz.SchedulerFactoryBean;import org.springframework.stereotype.Component;import java.util.ArrayList;import java.util.List;/** * author: Demon * date: 2025-06-04 004 11:25 * description: 任务管理器 */@Component@EnableSchedulingpublic class TaskManager { /** * 存放所有定时任务 */ public static final List&lt;ScheduledJob&gt; JOB_LIST = new ArrayList&lt;&gt;(); /** * 执行所有定时任务 */ public void executeTasks() { if (JOB_LIST.size() &gt; 0) { SchedulerFactoryBean schedulerFactoryBean = ApplicationContextHelper.getBean(SchedulerFactoryBean.class); for (ScheduledJob job : JOB_LIST) { try { // 运行 job.startJob(schedulerFactoryBean.getScheduler()); } catch (Exception e) { e.printStackTrace(); } } } }} 任务监听12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.demon.springbootquartzsimple.quartz.listener;import com.demon.springbootquartzsimple.quartz.TaskManager;import org.springframework.context.ApplicationListener;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.event.ContextRefreshedEvent;import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;import org.springframework.scheduling.quartz.SchedulerFactoryBean;import javax.annotation.Resource;import java.util.concurrent.ThreadPoolExecutor;/** * author: Demon * date: 2025-06-03 003 16:42 * description: 任务监听 */@Configurationpublic class SchedulerListener implements ApplicationListener&lt;ContextRefreshedEvent&gt; { @Resource public TaskManager taskManager; @Override public void onApplicationEvent(ContextRefreshedEvent event) { try { taskManager.executeTasks(); } catch (Exception e) { e.printStackTrace(); } } /** * scheduled调度器：调度什么时候去做什么事情 */ @Bean public SchedulerFactoryBean schedulerFactoryBean() { Properties properties = new Properties(); // 实例化ThreadPool时，使用的线程类为SimpleThreadPool（一般使用SimpleThreadPool即可满足几乎所有用户的需求） properties.put(\"org.quartz.threadPool.class\", \"org.quartz.simpl.SimpleThreadPool\"); // 并发个数,指定线程数，至少为1（无默认值）(一般设置为1-100之间的的整数合适) properties.put(\"org.quartz.threadPool.threadCount\", \"5\"); //设置线程的优先级（最大为java.lang.Thread.MAX_PRIORITY 10，最小为Thread.MIN_PRIORITY 1，默认为5） properties.put(\"org.quartz.threadPool.threadPriority\", \"5\"); SchedulerFactoryBean schedulerFactoryBean = new SchedulerFactoryBean(); schedulerFactoryBean.setSchedulerName(\"scheduled-task-\"); schedulerFactoryBean.setQuartzProperties(properties); return schedulerFactoryBean; }} 执行任务11234567891011121314151617181920212223242526272829303132333435package com.demon.springbootquartzsimple.quartz.job.task;import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;import lombok.extern.slf4j.Slf4j;import org.quartz.JobExecutionContext;import org.springframework.stereotype.Component;/** * author: Demon * date: 2025-06-04 004 10:53 * description: 任务1 */@Slf4j@Componentpublic class MyTaskJob1 extends ScheduledJob { @Override public boolean isRun() { return true; } /** * 表示每5秒 执行任务 */ @Override public String getCron() { return \"0/5 * * * * ?\"; } @Override public void execute(JobExecutionContext jobExecutionContext) { log.info(\"=======开始执行========MyTaskJob1================\"); } } 执行任务21234567891011121314151617181920212223242526272829303132333435363738package com.demon.springbootquartzsimple.quartz.job.task;import com.demon.springbootquartzsimple.quartz.job.ScheduledJob;import lombok.SneakyThrows;import lombok.extern.slf4j.Slf4j;import org.quartz.JobExecutionContext;import org.quartz.JobExecutionException;import org.springframework.stereotype.Component;/** * author: Demon * date: 2025-06-04 004 10:54 * description: 任务2 */@Slf4j@Componentpublic class MyTaskJob2 extends ScheduledJob { @Override public boolean isRun() { return false; } /** * 表示每5秒 执行任务 */ @Override public String getCron() { return \"0/5 * * * * ?\"; } @SneakyThrows @Override public void execute(JobExecutionContext jobExecutionContext) { log.info(\"=======开始执行========MyTaskJob2================\"); throw new JobExecutionException(\"MyTaskJob2抛出任务异常\"); }} 启动程序即会执行 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Quartz","slug":"Quartz","permalink":"https://www.zhuqiaolun.com/tags/Quartz/"}]},{"title":"Windows中同时安装MySQL5和MySQL8","slug":"2025/02/1739425332925/1739425332925","date":"2025-02-13T05:42:12.000Z","updated":"2025-02-13T09:13:40.119Z","comments":false,"path":"2025/02/1739425332925/1739425332925/","link":"","permalink":"https://www.zhuqiaolun.com/2025/02/1739425332925/1739425332925/","excerpt":"MySql","text":"下载文件官网地址：https://www.mysql.com/下载地址：https://downloads.mysql.com/archives/community/ 1.下载MySql-5.7.24 2.下载MySql-8.0.16 解压文件并配置环境变量下载下来的文件是压缩包，解压缩放在系统盘符目录下，并配置配置环境变量：MYSQL5_HOME,MYSQL8_HOME，同时在PATH内添加， 安装数据库安装MySQL51.创建必要文件 my.ini 1234567891011121314151617181920212223242526[mysql]# 设置mysql客户端默认字符集default-character-set=utf8[mysqld]innodb_flush_method=normal# 设置3306端口port = 3306# 设置mysql的安装目录basedir=D:\\\\MySql\\\\mysql-5.7.24-winx64# 设置mysql数据库的数据的存放目录（自动生成，不要手动创建，不然可能报错）datadir=D:\\\\MySql\\\\mysql-5.7.24-winx64\\\\data# 允许最大连接数max_connections=10000# 允许最大连接人数max_user_connections=1000# 服务端使用的字符集默认为8比特编码的latin1字符集character-set-server=utf8# 创建新表时将使用的默认存储引擎default-storage-engine=INNODB# 连接时间wait_timeout=31536000interactive_timeout=31536000# 关闭5.7 密码验证# validate_password=off 2.初始化，生成 data 文件夹，如果以前有就删除它以管理员身份打开命令提示符，切换到MySQL5的 bin 路径下，输入命令： 1mysqld --initialize 等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。 3.安装MySQL5服务输入命令 1mysqld --install MYSQL5 安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL8冲突）注册表：计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MYSQL5 4.开启MySQL5服务输入命令：net start MYSQL5 5.登录MySQL5修改密码并开启远程访问 1234567登录输入：mysql -h localhost -P 3306 -u root -p登录指定端口数据库，回车输入密码修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';刷新权限：FLUSH PRIVILEGES;设置远程访问：GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'root' WITH GRANT OPTION;刷新权限：FLUSH PRIVILEGES; 安装MySQL8 创建必要文件 my.ini123456789101112131415161718192021222324[mysql]# 设置mysql客户端默认字符集default-character-set=utf8[mysqld]# 设置3308端口port = 3308# 设置mysql的安装目录basedir=D:\\\\MySql\\\\mysql-8.0.16-winx64# 设置mysql数据库的数据的存放目录（自动生成，不然可能报错）datadir=D:\\\\MySql\\\\mysql-8.0.16-winx64\\\\data# 允许最大连接数max_connections=10000# 允许最大连接人数max_user_connections=1000# 服务端使用的字符集默认为8比特编码的latin1字符集character-set-server=utf8# 创建新表时将使用的默认存储引擎default-storage-engine=INNODB# 绑定到所有IP地址bind-address = 0.0.0.0# 连接时间一年wait_timeout=31536000interactive_timeout=31536000 2.初始化，生成 data 文件夹，如果以前有就删除它以管理员身份打开命令提示符，切换到MySQL8的 bin 路径下，输入命令： 1mysqld --initialize 等一段时间，它会重新生成一个 data 文件，找到其中后缀为 .err 的文件，打开查找密码password，如遇见empty密码，基本是my.ini文件不存在。 3.安装MySQL8服务输入命令： 1mysqld --install MYSQL8 安装特定服务名称，不能默认。（默认是MySQL，这样就会与MySQL5冲突）由于在安装服务的时候 会使用MYSQL5的目录下的mysqld文件，故需要将注册表的内容 变更为MYSQL8的目录下的mysqld文件注册表：计算机\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\MYSQL8 4.开启MySQL8服务输入命令：net start MYSQL8 5.登录MySQL8修改密码并开启远程访问 123456789101112131415161718登录输入：mysql -h localhost -P 3308 -u root -p登录指定端口数据库，回车输入密码修改密码输入：ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';刷新权限：FLUSH PRIVILEGES;设置远程访问# 使用mysql数据库use mysql;# 查看用户及权限select user,host from mysql.user;# 更新root用户的host属性为%update user set host='%' where user='root';# 刷新下权限FLUSH PRIVILEGES;# 再执行就可以了，就可以使用navicat连接了GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;# 刷新权限FLUSH PRIVILEGES; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/categories/MySql/"}],"tags":[{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/tags/MySql/"}]},{"title":"【JDK1.8】【XML配置】日志之 log4j2 配置（控制台输出）","slug":"2024/12/1734677869669/1734677869669","date":"2024-12-20T06:57:49.000Z","updated":"2026-01-20T08:22:35.759Z","comments":false,"path":"2024/12/1734677869669/1734677869669/","link":"","permalink":"https://www.zhuqiaolun.com/2024/12/1734677869669/1734677869669/","excerpt":"log4j2之XML配置","text":"JDK1.8的编程式配置JDK1.7的版本 依赖123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; XML配置log4j2.xml 控制台输出1234567891011121314&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;&lt;configuration debug=\"true\"&gt; &lt;Appenders&gt; &lt;Console name=\"CONSOLE_APPENDER\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;/Console&gt; &lt;/Appenders&gt; &lt;Loggers&gt; &lt;Root level=\"ALL\"&gt; &lt;AppenderRef ref=\"CONSOLE_APPENDER\" level=\"INFO\" /&gt; &lt;/Root&gt; &lt;/Loggers&gt;&lt;/configuration&gt; 单文件输出编程式配置#单文件输出 12345678910111213141516171819202122232425262728&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration debug=\"true\"&gt; &lt;Properties&gt; &lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt; &lt;Property name=\"LOG_HOME\"&gt;logs&lt;/Property&gt; &lt;/Properties&gt; &lt;appenders&gt; &lt;Console name=\"CONSOLE_APPENDER\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;/Console&gt; &lt;RollingFile name=\"FILE_APPENDER\" fileName=\"${LOG_HOME}/app.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/app.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;ThresholdFilter level=\"INFO\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;root level=\"ALL\"&gt; &lt;appender-ref ref=\"CONSOLE_APPENDER\"/&gt; &lt;appender-ref ref=\"FILE_APPENDER\"/&gt; &lt;/root&gt; &lt;/loggers&gt;&lt;/configuration&gt; 多文件输出编程式配置#多文件输出 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;configuration debug=\"true\"&gt; &lt;Properties&gt; &lt;!-- 配置日志文件输出目录 ${sys:user.home} --&gt; &lt;Property name=\"LOG_HOME\"&gt;logs&lt;/Property&gt; &lt;/Properties&gt; &lt;appenders&gt; &lt;Console name=\"CONSOLE_APPENDER\" target=\"SYSTEM_OUT\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;/Console&gt; &lt;RollingFile name=\"TRACE_APPENDER\" fileName=\"${LOG_HOME}/trace.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/trace.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;LevelMatchFilter level=\"TRACE\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;RollingFile name=\"DEBUG_APPENDER\" fileName=\"${LOG_HOME}/debug.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/debug.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;LevelMatchFilter level=\"DEBUG\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;RollingFile name=\"INFO_APPENDER\" fileName=\"${LOG_HOME}/info.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/info.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;LevelMatchFilter level=\"INFO\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;RollingFile name=\"WARN_APPENDER\" fileName=\"${LOG_HOME}/warn.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/warn.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;LevelMatchFilter level=\"WARN\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;RollingFile name=\"ERROR_APPENDER\" fileName=\"${LOG_HOME}/error.log\" filePattern=\"${LOG_HOME}/%d{yyyy-MM-dd}/error.logs-%i.log\"&gt; &lt;PatternLayout pattern=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;LevelMatchFilter level=\"ERROR\" onMatch=\"ACCEPT\" onMismatch=\"DENY\"/&gt; &lt;Policies&gt; &lt;TimeBasedTriggeringPolicy interval=\"1\" modulate=\"true\"/&gt; &lt;!-- 文件大小达到10KB进行一次rollover --&gt; &lt;SizeBasedTriggeringPolicy size=\"10KB\"/&gt; &lt;/Policies&gt; &lt;DefaultRolloverStrategy max=\"30\" /&gt; &lt;/RollingFile&gt; &lt;/appenders&gt; &lt;loggers&gt; &lt;root level=\"ALL\"&gt; &lt;appender-ref ref=\"CONSOLE_APPENDER\"/&gt; &lt;appender-ref ref=\"TRACE_APPENDER\"/&gt; &lt;appender-ref ref=\"DEBUG_APPENDER\"/&gt; &lt;appender-ref ref=\"INFO_APPENDER\"/&gt; &lt;appender-ref ref=\"WARN_APPENDER\"/&gt; &lt;appender-ref ref=\"ERROR_APPENDER\"/&gt; &lt;/root&gt; &lt;/loggers&gt;&lt;/configuration&gt; 使用 private static final Logger log = LogManager.getLogger(App.class); 1234567891011121314151617import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;public class App { private static final Logger log = LogManager.getLogger(App.class); public static void main(String[] args) { log.trace(\"This is trace\"); log.debug(\"This is debug\"); log.info(\"This is info\"); log.warn(\"This is warning\"); log.error(\"This is error\"); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"log4j2","slug":"log4j2","permalink":"https://www.zhuqiaolun.com/tags/log4j2/"}]},{"title":"【JDK1.8】【编程式配置】日志之 log4j2 配置（多文件输出）","slug":"2024/12/1734663522947/1734663522947","date":"2024-12-20T02:58:42.000Z","updated":"2026-01-20T08:22:35.775Z","comments":false,"path":"2024/12/1734663522947/1734663522947/","link":"","permalink":"https://www.zhuqiaolun.com/2024/12/1734663522947/1734663522947/","excerpt":"log4j2编码配置","text":"多文件输出：输出指定级别及以上的日志信息且写入对应的日志级别文件XML配置#多文件输出 使用场景当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录： 12345678910private static String getJarDir() { String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath(); try { String decodedPath = URLDecoder.decode(jarPath, \"UTF-8\"); return new File(decodedPath).getParent(); } catch (UnsupportedEncodingException e) { e.printStackTrace(); return null; }} 依赖123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.core.Appender;import org.apache.logging.log4j.core.Filter;import org.apache.logging.log4j.core.LoggerContext;import org.apache.logging.log4j.core.appender.ConsoleAppender;import org.apache.logging.log4j.core.appender.RollingFileAppender;import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;import org.apache.logging.log4j.core.config.AppenderRef;import org.apache.logging.log4j.core.config.Configuration;import org.apache.logging.log4j.core.config.LoggerConfig;import org.apache.logging.log4j.core.filter.LevelMatchFilter;import org.apache.logging.log4j.core.layout.PatternLayout;import java.io.File;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;/** * author: Demon * date: 2024-12-17 017 11:19 * description: 日志类 * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL * 两个配置项的三个属性值： * onMatch=\"ACCEPT\" 表示匹配该级别及以上 * onMatch=\"DENY\" 表示不匹配该级别及以上 * onMatch=\"NEUTRAL\" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上 * onMismatch=\"ACCEPT\" 表示匹配该级别以下 * onMismatch=\"NEUTRAL\" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的 * onMismatch=\"DENY\" 表示不匹配该级别以下的 */public class Log4j2Util { private boolean traceFlag; private boolean debugFlag; private boolean infoFlag; private boolean warnFlag; private boolean errorFlag; private boolean fatalFlag; private List&lt;PackLoggerVo&gt; packLoggerList; private Log4j2Util(boolean traceFlag, boolean debugFlag, boolean infoFlag, boolean warnFlag, boolean errorFlag, boolean fatalFlag, List&lt;PackLoggerVo&gt; packLoggerList) { this.traceFlag = traceFlag; this.debugFlag = debugFlag; this.infoFlag = infoFlag; this.warnFlag = warnFlag; this.errorFlag = errorFlag; this.fatalFlag = fatalFlag; this.packLoggerList = packLoggerList; } public static Builder newBuilder() { return new Builder(); } private static Appender getFileAppender(PatternLayout layout, String logRootPath, Level level, String appenderName) { // 日志文件名，根据日志级别取名 String fileName = level.toString().toLowerCase(); return RollingFileAppender.newBuilder().setName(appenderName) // 过滤日志文件内容 .setFilter(LevelMatchFilter.newBuilder().setLevel(level).setOnMatch(Filter.Result.ACCEPT).setOnMismatch(Filter.Result.DENY).build()) // 日志文件输出的文件名，每天滚动生成一个新的日志文件 .withFileName(logRootPath + File.separator + fileName + \".log\").withFilePattern(logRootPath + File.separator + \"%d{yyyy-MM-dd}\" + File.separator + fileName + \".logs-%i.log\") // 设置日志输出格式 .setLayout(layout) // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置 .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build()) // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB .withPolicy(SizeBasedTriggeringPolicy.createPolicy(\"10KB\")) // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i .withStrategy(DefaultRolloverStrategy.newBuilder().withMax(\"30\").build()) .build(); } /** * 加载日志 * * @param logRootPath ，传 null 则不输出文件日志 */ public void init(String logRootPath) { Map&lt;Level, AppenderRef&gt; appenderRefMap = new LinkedHashMap&lt;&gt;(); Map&lt;Level, Appender&gt; appenderMap = new LinkedHashMap&lt;&gt;(); // 配置 final LoggerContext ctx = (LoggerContext) LogManager.getContext(false); final Configuration config = ctx.getConfiguration(); // 输出格式 final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName(\"UTF-8\")).withConfiguration(config).withPattern(\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\").build(); // 1.输出到控制台 String consoleAppenderName = \"CONSOLE_APPENDER\"; ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build(); AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null); // 2.输出到文件，按照每天生成日志文件 if (logRootPath != null) { // 日志输出级别 if (traceFlag) { // TRACE String traceAppenderName = \"TRACE_APPENDER\"; Appender traceAppender = getFileAppender(layout, logRootPath, Level.TRACE, traceAppenderName); appenderRefMap.put(Level.TRACE, AppenderRef.createAppenderRef(traceAppenderName, null, null)); appenderMap.put(Level.TRACE, traceAppender); } if (debugFlag) { // TRACE String debugAppenderName = \"DEBUG_APPENDER\"; Appender debugAppender = getFileAppender(layout, logRootPath, Level.DEBUG, debugAppenderName); appenderRefMap.put(Level.DEBUG, AppenderRef.createAppenderRef(debugAppenderName, null, null)); appenderMap.put(Level.DEBUG, debugAppender); } if (infoFlag) { // INFO String infoAppenderName = \"INFO_APPENDER\"; Appender infoAppender = getFileAppender(layout, logRootPath, Level.INFO, infoAppenderName); appenderRefMap.put(Level.INFO, AppenderRef.createAppenderRef(infoAppenderName, null, null)); appenderMap.put(Level.INFO, infoAppender); } if (warnFlag) { // WARN String warnAppenderName = \"WARN_APPENDER\"; Appender warnAppender = getFileAppender(layout, logRootPath, Level.WARN, warnAppenderName); appenderRefMap.put(Level.WARN, AppenderRef.createAppenderRef(warnAppenderName, null, null)); appenderMap.put(Level.WARN, warnAppender); } if (errorFlag) { // ERROR String errorAppenderName = \"ERROR_APPENDER\"; Appender errorAppender = getFileAppender(layout, logRootPath, Level.ERROR, errorAppenderName); appenderRefMap.put(Level.ERROR, AppenderRef.createAppenderRef(errorAppenderName, null, null)); appenderMap.put(Level.ERROR, errorAppender); } if (fatalFlag) { // FATAL String fatalAppenderName = \"FATAL_APPENDER\"; Appender fatalAppender = getFileAppender(layout, logRootPath, Level.FATAL, fatalAppenderName); appenderRefMap.put(Level.FATAL, AppenderRef.createAppenderRef(fatalAppenderName, null, null)); appenderMap.put(Level.FATAL, fatalAppender); } } // Root -&gt; Logger配置 List&lt;AppenderRef&gt; appenderRefList = new ArrayList&lt;&gt;(appenderRefMap.values()); appenderRefList.add(consoleAppenderRef); LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, \"true\", appenderRefList.toArray(new AppenderRef[0]), null, config, null); loggerConfig.addAppender(consoleAppender, null, null); for (Appender appender : appenderMap.values()) { loggerConfig.addAppender(appender, null, null); } // 针对特定包的Logger配置,\"\" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig // 必须 config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig); // 选配 if (packLoggerList.size() &gt; 0) { for (PackLoggerVo packLoggerVo : packLoggerList) { List&lt;AppenderRef&gt; appenderRefListTemp = new ArrayList&lt;&gt;(); List&lt;Appender&gt; appenderListTemp = new ArrayList&lt;&gt;(); if (packLoggerVo.isConsoleFlag()) { appenderRefListTemp.add(consoleAppenderRef); appenderListTemp.add(consoleAppender); } if (packLoggerVo.isFileFlag()) { Level[] packLoggerVoLevels = packLoggerVo.getLevels(); for (Level loggerVoLevel : packLoggerVoLevels) { if (appenderRefMap.containsKey(loggerVoLevel)) { appenderRefListTemp.add(appenderRefMap.get(loggerVoLevel)); appenderListTemp.add(appenderMap.get(loggerVoLevel)); } } } if (appenderRefListTemp.size() &gt; 0) { LoggerConfig loggerConfig2 = LoggerConfig.createLogger(false, Level.ALL, packLoggerVo.getPackageName(), \"true\", appenderRefListTemp.toArray(new AppenderRef[0]), null, config, null); for (Appender appender : appenderListTemp) { loggerConfig2.addAppender(appender, null, null); } config.addLogger(packLoggerVo.getPackageName(), loggerConfig2); } } } ctx.updateLoggers(); } public static class Builder { private boolean traceFlag = false; private boolean debugFlag = false; private boolean infoFlag = false; private boolean warnFlag = false; private boolean errorFlag = false; private boolean fatalFlag = false; private List&lt;PackLoggerVo&gt; packLoggerList = new ArrayList&lt;&gt;(); public Builder withTraceFlag(final boolean traceFlag) { this.traceFlag = traceFlag; return this; } public Builder withDebugFlag(boolean debugFlag) { this.debugFlag = debugFlag; return this; } public Builder withInfoFlag(boolean infoFlag) { this.infoFlag = infoFlag; return this; } public Builder withWarnFlag(boolean warnFlag) { this.warnFlag = warnFlag; return this; } public Builder withErrorFlag(boolean errorFlag) { this.errorFlag = errorFlag; return this; } public Builder withFatalFlag(boolean fatalFlag) { this.fatalFlag = fatalFlag; return this; } public Builder addPackLogger(final String packageName, boolean consoleFlag, boolean fileFlag, final Level... levels) { if (packageName != null &amp;&amp; packageName.length() &gt; 0) { packLoggerList.add(new PackLoggerVo().setPackageName(packageName).setConsoleFlag(consoleFlag).setFileFlag(fileFlag).setLevels(levels)); } return this; } public Log4j2Util build() { return new Log4j2Util(traceFlag, debugFlag, infoFlag, warnFlag, errorFlag, fatalFlag, packLoggerList); } } public static class PackLoggerVo { private String packageName; private boolean consoleFlag; private boolean fileFlag; private Level[] levels; String getPackageName() { return packageName; } PackLoggerVo setPackageName(String packageName) { this.packageName = packageName; return this; } boolean isConsoleFlag() { return consoleFlag; } PackLoggerVo setConsoleFlag(boolean consoleFlag) { this.consoleFlag = consoleFlag; return this; } boolean isFileFlag() { return fileFlag; } PackLoggerVo setFileFlag(boolean fileFlag) { this.fileFlag = fileFlag; return this; } Level[] getLevels() { return levels; } PackLoggerVo setLevels(Level[] levels) { this.levels = levels; return this; } }} 示例定义日志配置1：控制台输出 1234Log4j2Util.newBuilder().withTraceFlag(false) .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true) .withFatalFlag(false) .build().init(); 定义日志配置2：文件输出 1234Log4j2Util.newBuilder().withTraceFlag(false) .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true) .withFatalFlag(false) .build().init(\"D:\\\\logs\"); 定义日志配置2：过滤包且指定日志级别输出 123456Log4j2Util.newBuilder().withTraceFlag(false) .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true) .withFatalFlag(false) .addPackLogger(\"cn.hutool.log\", true, false, Level.TRACE, Level.DEBUG, Level.INFO) .addPackLogger(\"cn.hutool.setting\", true, false, Level.TRACE, Level.DEBUG) .build().init(\"D:\\\\logs\"); 完整示例12345678910111213141516171819202122232425import com.demon.util.Log4j2Util;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;public class App { private static final Logger log = LogManager.getLogger(App.class); public static void main(String[] args) { // 定义日志配置 Log4j2Util.newBuilder().withTraceFlag(false) .withDebugFlag(true).withInfoFlag(true).withWarnFlag(true).withErrorFlag(true).withFatalFlag(false) .addPackLogger(\"cn.hutool.setting\", true, false, Level.TRACE, Level.DEBUG) .build().init(\"D:\\\\logs\"); // 输出日志 log.debug(\"This is debug\"); log.warn(\"This is warning\"); log.info(\"This is info\"); log.trace(\"This is trace\"); log.error(\"This is error\"); log.fatal(\"This is fatal\"); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"log4j2","slug":"log4j2","permalink":"https://www.zhuqiaolun.com/tags/log4j2/"}]},{"title":"【JDK1.8】【编程式配置】日志之 log4j2 配置（单文件输出）","slug":"2024/12/1734663400620/1734663400620","date":"2024-12-20T02:56:40.000Z","updated":"2026-01-20T08:22:35.770Z","comments":false,"path":"2024/12/1734663400620/1734663400620/","link":"","permalink":"https://www.zhuqiaolun.com/2024/12/1734663400620/1734663400620/","excerpt":"log4j2编码配置","text":"单文件输出：输出指定级别及以上的日志信息且写入同一个文件XML配置#单文件输出 依赖123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.core.Appender;import org.apache.logging.log4j.core.Filter;import org.apache.logging.log4j.core.LoggerContext;import org.apache.logging.log4j.core.appender.ConsoleAppender;import org.apache.logging.log4j.core.appender.RollingFileAppender;import org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy;import org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy;import org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy;import org.apache.logging.log4j.core.config.AppenderRef;import org.apache.logging.log4j.core.config.Configuration;import org.apache.logging.log4j.core.config.LoggerConfig;import org.apache.logging.log4j.core.filter.ThresholdFilter;import org.apache.logging.log4j.core.layout.PatternLayout;import java.io.File;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.List;/** * author: Demon * date: 2024-12-17 017 11:19 * description: 日志类 * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL * 两个配置项的三个属性值： * onMatch=\"ACCEPT\" 表示匹配该级别及以上 * onMatch=\"DENY\" 表示不匹配该级别及以上 * onMatch=\"NEUTRAL\" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上 * onMismatch=\"ACCEPT\" 表示匹配该级别以下 * onMismatch=\"NEUTRAL\" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的 * onMismatch=\"DENY\" 表示不匹配该级别以下的 */public class Log4j2Util { private Level level; private Log4j2Util(Level level) { this.level = level; } public static Builder newBuilder() { return new Builder(); } public void init() { this.init(null, null); } /** * 加载日志 */ public void init(String logRootPath, String logName) { // 配置 final LoggerContext ctx = (LoggerContext) LogManager.getContext(false); final Configuration config = ctx.getConfiguration(); // 输出格式 final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName(\"UTF-8\")).withConfiguration(config).withPattern(\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\").build(); // Root -&gt; Logger配置 List&lt;AppenderRef&gt; appenderRefList = new ArrayList&lt;&gt;(); List&lt;Appender&gt; appenderList = new ArrayList&lt;&gt;(); // 1.输出到控制台 String consoleAppenderName = \"CONSOLE_APPENDER\"; AppenderRef consoleAppenderRef = AppenderRef.createAppenderRef(consoleAppenderName, null, null); ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build(); appenderRefList.add(consoleAppenderRef); appenderList.add(consoleAppender); // 2.输出到文件，按照每天生成日志文件 if (logRootPath != null) { // 日志输出级别 String fileAppenderName = \"FILE_APPENDER\"; AppenderRef fileAppenderRef = AppenderRef.createAppenderRef(fileAppenderName, null, null); // 日志文件名，根据日志级别取名 String fileName = \"logs\" + File.separator + ((logName != null &amp;&amp; logName.length() &gt; 0) ? logName : \"app\"); Appender fileAppender = RollingFileAppender.newBuilder().setName(fileAppenderName) // 过滤日志文件内容 .setFilter(ThresholdFilter.createFilter(level, Filter.Result.ACCEPT, Filter.Result.DENY)) // 日志文件输出的文件名，每天滚动生成一个新的日志文件 .withFileName(logRootPath + File.separator + fileName + \".log\").withFilePattern(logRootPath + File.separator + \"%d{yyyy-MM-dd}\" + File.separator + fileName + \".logs-%i.log\") // 设置日志输出格式 .setLayout(layout) // 基于时间间隔的滚动策略，设置日志文件滚动更新的时间(1个小时)，依赖于文件命名filePattern的设置 .withPolicy(TimeBasedTriggeringPolicy.newBuilder().withModulate(true).withInterval(1).build()) // 基于文件大小的滚动策略, 设置日志基础文件大小，超过该大小就触发日志文件滚动更新，单位可为 KB, MB, GB，TB, 比如：10MB .withPolicy(SizeBasedTriggeringPolicy.createPolicy(\"10KB\")) // 设置日志的文件个数上限，不设置默认为7个，超过大小后会被覆盖；依赖于filePattern中的%i .withStrategy(DefaultRolloverStrategy.newBuilder().withMax(\"30\").build()) .build(); appenderRefList.add(fileAppenderRef); appenderList.add(fileAppender); } LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, \"true\", appenderRefList.toArray(new AppenderRef[0]), null, config, null); loggerConfig.addAppender(consoleAppender, null, null); for (Appender appender : appenderList) { loggerConfig.addAppender(appender, null, null); } // 针对特定包的Logger配置,\"\" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig); ctx.updateLoggers(); } public static class Builder { private Level level = Level.ALL; public Builder setLevel(Level level) { this.level = level; return this; } public Log4j2Util build() { return new Log4j2Util(level); } }} 完整示例1234567891011121314151617181920212223import com.demon.util.Log4j2Util;import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;public class App { private static final Logger log = LogManager.getLogger(App.class); public static void main(String[] args) { // Log4j2Util.newBuilder().build().init(); // 配置 INFO级别及以上的信息输出 Log4j2Util.newBuilder().setLevel(Level.INFO).build().init(\"D:\\\\logs\",\"app\"); log.trace(\"This is trace\"); log.debug(\"This is debug\"); log.info(\"This is info\"); log.warn(\"This is warning\"); log.error(\"This is error\"); log.fatal(\"This is fatal\"); }} 使用场景当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录： 12345678910private static String getJarDir() { String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath(); try { String decodedPath = URLDecoder.decode(jarPath, \"UTF-8\"); return new File(decodedPath).getParent(); } catch (UnsupportedEncodingException e) { e.printStackTrace(); return null; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"log4j2","slug":"log4j2","permalink":"https://www.zhuqiaolun.com/tags/log4j2/"}]},{"title":"【JDK1.8】【编程式配置】日志之 log4j2 配置（控制台输出）","slug":"2024/12/1734417756349/1734417756349","date":"2024-12-17T06:42:36.000Z","updated":"2026-01-20T08:22:35.780Z","comments":false,"path":"2024/12/1734417756349/1734417756349/","link":"","permalink":"https://www.zhuqiaolun.com/2024/12/1734417756349/1734417756349/","excerpt":"log4j2编码配置","text":"XML配置 依赖123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-api&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j-core&lt;/artifactId&gt; &lt;version&gt;2.13.3&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 代码配置123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.core.LoggerContext;import org.apache.logging.log4j.core.appender.ConsoleAppender;import org.apache.logging.log4j.core.config.AppenderRef;import org.apache.logging.log4j.core.config.Configuration;import org.apache.logging.log4j.core.config.LoggerConfig;import org.apache.logging.log4j.core.layout.PatternLayout;import java.nio.charset.Charset;/** * author: Demon * date: 2024-12-17 017 11:19 * description: 日志类 * // 日志级别：ALL &lt; TRACE &lt;&nbsp;DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL * 两个配置项的三个属性值： * onMatch=\"ACCEPT\" 表示匹配该级别及以上 * onMatch=\"DENY\" 表示不匹配该级别及以上 * onMatch=\"NEUTRAL\" 表示该级别及以上的，由下一个filter处理，如果当前是最后一个，则表示匹配该级别及以上 * onMismatch=\"ACCEPT\" 表示匹配该级别以下 * onMismatch=\"NEUTRAL\" 表示该级别及以下的，由下一个filter处理，如果当前是最后一个，则不匹配该级别以下的 * onMismatch=\"DENY\" 表示不匹配该级别以下的 */public class Log4j2Util { private Level level; private Log4j2Util(Level level) { this.level = level; } public static Builder newBuilder() { return new Builder(); } /** * 加载日志 */ public void init() { // 配置 final LoggerContext ctx = (LoggerContext) LogManager.getContext(false); final Configuration config = ctx.getConfiguration(); // 输出格式 final PatternLayout layout = PatternLayout.newBuilder().withCharset(Charset.forName(\"UTF-8\")).withConfiguration(config).withPattern(\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\").build(); // 1.输出到控制台 String consoleAppenderName = \"CONSOLE_APPENDER\"; ConsoleAppender consoleAppender = ConsoleAppender.newBuilder().setName(consoleAppenderName).setLayout(layout).build(); AppenderRef[] appenderRefs = {AppenderRef.createAppenderRef(consoleAppenderName, null, null)}; // Root -&gt; Logger配置 LoggerConfig loggerConfig = LoggerConfig.createLogger(false, Level.ALL, LogManager.ROOT_LOGGER_NAME, \"true\", appenderRefs, null, config, null); loggerConfig.addAppender(consoleAppender, level, null); // 针对特定包的Logger配置,\"\" 就是所有,也可以指定路径输出，可多个addLogger&amp;loggerConfig // 必须 config.addLogger(LogManager.ROOT_LOGGER_NAME, loggerConfig); ctx.updateLoggers(); } public static class Builder { private Level level = Level.ALL; public Builder setLoggerLevel(Level level) { this.level = level; return this; } public Log4j2Util build() { return new Log4j2Util(level); } }} 使用12345678910111213141516171819202122import com.demon.util.Log4j2Util;import org.apache.logging.log4j.Level;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;public class App { private static final Logger log = LogManager.getLogger(App.class); public static void main(String[] args) { // 配置 INFO级别及以上的信息输出 Log4j2Util.newBuilder().setLoggerLevel(Level.INFO).build().init(); log.trace(\"This is trace\"); log.debug(\"This is debug\"); log.info(\"This is info\"); log.warn(\"This is warning\"); log.error(\"This is error\"); log.fatal(\"This is fatal\"); }} 使用场景当需要自定义日志目录的时候使用，一般在打包为jar的运行,获取jar打包之后的所在执行目录： 12345678910private static String getJarDir() { String jarPath = App.class.getProtectionDomain().getCodeSource().getLocation().getPath(); try { String decodedPath = URLDecoder.decode(jarPath, \"UTF-8\"); return new File(decodedPath).getParent(); } catch (UnsupportedEncodingException e) { e.printStackTrace(); return null; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"log4j2","slug":"log4j2","permalink":"https://www.zhuqiaolun.com/tags/log4j2/"}]},{"title":"innosetup进行exe打包成安装文件","slug":"2024/08/1723804410469/1723804410469","date":"2024-08-16T10:33:30.000Z","updated":"2025-02-07T10:07:54.893Z","comments":false,"path":"2024/08/1723804410469/1723804410469/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723804410469/1723804410469/","excerpt":"innosetup","text":"安装官网地址：https://jrsoftware.org/下载地址：https://files.jrsoftware.org/is/6/文件下载：https://files.jrsoftware.org/is/6/innosetup-6.2.2.exe 按照默认选择 一路点击“Next” 即可安装完成。 打包待续··· document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"innosetup","slug":"innosetup","permalink":"https://www.zhuqiaolun.com/tags/innosetup/"}]},{"title":"exe4j将Java程序打包（EXE执行或者Win服务）","slug":"2024/08/1723797971551/1723797971551","date":"2024-08-16T08:46:11.000Z","updated":"2025-12-02T08:04:05.272Z","comments":false,"path":"2024/08/1723797971551/1723797971551/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723797971551/1723797971551/","excerpt":"exe4j","text":"下载官网地址：https://www.ej-technologies.com/exe4j/download进入网址，选择需要的版本，点击下载就可以了，需要注意的是exe4j 6.0 需要的jdk版本为1.8及以上。 下载地址：https://download.ej-technologies.com/exe4j/exe4j_windows-x64_6_0_2.exe 一键式安装，下载完成和平时安装软件以下，基本上直接下一步就可安装完成。 激活安装完成运行软件，点击Enter License, 填写用户名、注册码即可,然后，点OK即可注册成功。注意：用户名可随便填写，公司可不填，注册码下面的随便选择复制一个即可 12345678910A-XVK258563F-1p4lv7mg7savA-XVK209982F-1y0i3h4ywx2h1A-XVK267351F-dpurrhnyarvaA-XVK204432F-1kkoilo1jy2h3rA-XVK246130F-1l7msieqiwqnqA-XVK249554F-pllh351kcke50A-XVK238729F-25yn13iea25iA-XVK222711F-134h5ta8yxbm0A-XVK275016F-15wjjcbn4tpjA-XVK275016F-15wjjcbn4tpj 使用在 VM Parameters中输入:-Dexe.path=${EXE4J_EXEDIR}；然后可以用它在程序中找到exe所在目录，这样无论生成的exe放到哪都可以找到当前目录，代码中的用法（String exePath = System.getProperty(“exe.path”);）exe执行路径的获取，在把exe文件打包成可安装文件的操作和查找配置文件等操作中至关重要 Exe4j的内置VM变量：%EXE4J_EXEDIR%：exe执行路径%EXE4J_JVM_HOME%：运行可执行文件的JRE目录 打开exe4j，点击Next 选择项目类型，点击Next这里选择第一个,把Jar文件跟exe文件分开 方便后期更新只需替换Jar文件即可， 应用配置 生成配置如果需要cmd窗体调试，可以选择第二个Console 客户端（含有界面操作，选择第一个 服务端（可配置在系统服务内运行，开机自启 服务安装：hello.exe /install hello服务卸载：hello.exe /uninstall hello服务启动：hello.exe /start hello服务停止：hello.exe /stop hello 日志 JAR配置点击右边绿色的 “+”号，然后选择【Archive】，打开浏览目录，找到我们的jar包，然后选择【打开】，【ok】注：VM Parameters中可以设置虚拟机的一下参数，-Dfile.encoding=utf-8是设置了utf-8的编码，以防中文乱码 JRE配置设置JRE的最小最高版本，我们根据自己的情况设置就ok，小版本设置成1.8就行； 然后点击【Advanced Options】，选择【Search sequence】，将软件默认的三个配置需要全部删除，添加我们自己的JRE到软件中，这样我们的代码可以在别的没有安装Java环境的电脑上运行；点击右边的添加，选择【Directory】，然后选择【浏览】，找到我们的JRE，然后添加； 然后【Next】,点击左侧的【Preferred VM】，选择【Client hotspot VM】，然后【next】剩下的步骤直接一直next，这样exe文件生成了最后在Finished中选择save，保存现在的配置。 目录结构以下为完整内容，双击exe可以执行 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"exe4j","slug":"exe4j","permalink":"https://www.zhuqiaolun.com/tags/exe4j/"}]},{"title":"部署OceanBase社区版(4.2.2.0)","slug":"2024/08/1723180766825/1723180766825","date":"2024-08-09T05:19:26.000Z","updated":"2024-08-13T05:45:49.426Z","comments":false,"path":"2024/08/1723180766825/1723180766825/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723180766825/1723180766825/","excerpt":"OceanBase","text":"本文仅学习体验 OceanBase 的功能，使用1台机器部署单节点集群即可。 操作系统OceanBase 支持部署在主流的Linux操作系统上，下面列出了常用的操作系统： Redhat / CentOS 7.x/8.x SUSE / OpenSUSE 15.x Anlios 7.x/8.x Debian 9.x Ubuntu 20.x 主机资源下表列出了部署OceanBase所需的单台主机的资源，如果需要集群部署，推荐使用相同规格的主机 1234CPU：2c，生产环境推荐4c以上内存：8G，生产环境推荐16G以上磁盘：内存的6倍以上，推荐使用 SSD, 生产环境要配置多块磁盘，将日志盘和数据盘分开文件系统：EXT4 戓 XFS，当数据超过 16T 时，使用 XFS 部署前置关闭防火墙防火墙状态：systemctl status firewalld，如果输出结果非 inactive, 可以通过如下命令进行关闭：防火墙停止：systemctl stop firewalld防火墙禁用：systemctl disable firewalld 关闭SELinux修改配置文件，将SELINUX的配置修改为disabled，vi /etc/selinux/config 1234567891011# This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:# enforcing - SELinux security policy is enforced.# permissive - SELinux prints warnings instead of enforcing.# disabled - No SELinux policy is loaded.SELINUX=disabled# SELINUXTYPE= can take one of three values:# targeted - Targeted processes are protected,# minimum - Modification of targeted policy. Only selected processes are protected.# mls - Multi Level Security protection.SELINUXTYPE=targeted 配置文件修改后只会重启后生效，还需要使用下面命令立即生效：setenforce 0 修改配置 limits.conf执行以下命令解决安装时出现的资源性错误，打开 vi /etc/security/limits.conf 配置文件，添加以下内容： 12345678910root soft nofile 655350root hard nofile 655350* soft nofile 655350* hard nofile 655350* soft stack unlimited* hard stack unlimited* soft nproc 655360* hard nproc 655360* soft core unlimited* hard core unlimited 查看配置参考：https://www.oceanbase.com/docs/common-oceanbase-database-cn-1000000000642561 退出当前会话，重新登录。执行以下命令，查看配置是否生效。 ulimit -a 输出如下: 修改内核 /etc/sysctl.conf打开 vi /etc/sysctl.conf 配置文件，修改或添加以下内容： 123fs.aio-max-nr=1048576fs.file-max=6573688vm.max_map_count=655360 执行如下命令让配置生效sysctl -p 部署123456789101112131415161718192021222324252627mkdir /usr/local/oceanbasecd /usr/local/oceanbase# 下载文件wget https://obbusiness-private.oss-cn-shanghai.aliyuncs.com/download-center/opensource/oceanbase-all-in-one/7/x86_64/oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz# 解压文件tar -xzf oceanbase-all-in-one-4.2.2.0-100000192024011915.el7.x86_64.tar.gz# 安装cd /usr/local/oceanbase/oceanbase-all-in-onebin/install.sh 安装脚本会在主机上部署好OBD和OBClient, 并且将携带的rpm包都导入到OBD的环境中，安装后的输出结果如下。 Install Finished ===================================================================== Setup Environment: source ~/.oceanbase-all-in-one/bin/env.sh Quick Start: obd demo More Details: obd -h =====================================================================# 在执行下一步操作之前，需要根据提示设置环境变量，命令如下：# set environmentsource ~/.oceanbase-all-in-one/bin/env.sh# check obd and obclient commandwhich obdwhich obclient 启动采用快速部署模式：obd demodemo 部署方式采用最小规格部署，部署的组件版本默认为最新版本默认部署的组件包含 oceanbase-ce、obproxy-ce、obagent、grafana、prometheus。 123# use obd demo command to quickly launch a demo clustercd /usr/local/oceanbase/oceanbase-all-in-oneobd demo 部署完成后，OBD会将各个组件的连接方式打印出来： 说明：Grafana访问：http://127.0.0.1:3000/d/oceanbase， 用户名和密码：admin/Kx7FPKTDh7 验证安装后，可以使用 OBClient 客户端连接进行验证：obclient -h127.0.0.1 -uroot -P2881授予所有特权：grant all privileges on . to root@’%’; 设置密码安装完成后 root用户是默认没密码 12345678初次登录：obclient -h127.0.0.1 -P2881 -uroot设置密码(!root)ALTER USER root@'%' IDENTIFIED BY '!root';再次登录：obclient -h127.0.0.1 -P2881 -uroot -p 命名12启动：obd cluster start demo停止：obd cluster stop demo 添加端口到防火墙里123456789101112131415161、开启防火墙 systemctl start firewalldsystemctl status firewalld2、开放指定端口firewall-cmd --permanent --add-port=2881/tcp 命令含义：--add-port=2881/tcp #添加端口，格式为：端口/通讯协议--permanent #永久生效，没有此参数重启后失效3、重启防火墙firewall-cmd --reload4、查看端口号ss -ntlp //查看当前所有tcp端口·查看是否有2881端口ss -ntulp | grep 2881 //查看所有2881端口使用情况 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"OceanBase","slug":"OceanBase","permalink":"https://www.zhuqiaolun.com/categories/OceanBase/"}],"tags":[{"name":"OceanBase","slug":"OceanBase","permalink":"https://www.zhuqiaolun.com/tags/OceanBase/"}]},{"title":"在Linux下安装RabbitMQ及配置","slug":"2024/08/1723102274931/1723102274931","date":"2024-08-08T07:31:14.000Z","updated":"2024-08-09T07:21:39.487Z","comments":false,"path":"2024/08/1723102274931/1723102274931/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723102274931/1723102274931/","excerpt":"Linux下RabbitMQ安装及配置","text":"Rabbitmq依赖于Erlan 对应版本查看：https://www.rabbitmq.com/docs/which-erlang 安装编译环境 yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel 下载文件 otp_src_24.1.7.tar.gz rabbitmq-server-generic-unix-3.9.11.tar.xz otp_src_24.1.7.tar.gz 官网地址：https://www.erlang.org/文件地址：https://www.erlang.org/patches/otp-24.1.7下载地址：https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gz rabbitmq-server-generic-unix-3.9.11.tar.xz 官网地址：https://www.rabbitmq.com/文件地址：https://github.com/rabbitmq/rabbitmq-server下载地址：https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz 解压文件123456789101.创建临时目录软件根目录mkdir /usr/local/softwarecd /usr/local/softwarewget https://github.com/erlang/otp/releases/download/OTP-24.1.7/otp_src_24.1.7.tar.gzwget https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.9.11/rabbitmq-server-generic-unix-3.9.11.tar.xz2.解压文件tar -xzvf otp_src_24.1.7.tar.gztar -xf rabbitmq-server-generic-unix-3.9.11.tar.xz 安装程序 otp_src_24.1.7.tar.gz 12345678910111213141516cd /usr/local/software/otp_src_24.1.7./configure --prefix=/usr/local/erlangmake &amp;&amp; make install添加环境变量echo \"export PATH=/usr/local/erlang/bin:$PATH\" &gt;&gt; /etc/profilesource /etc/profile测试安装是否成功erl --version输出：Erlang/OTP 24 [erts-12.1.5] [source] [64-bit] [smp:1:1] [ds:1:1:10] [async-threads:1]Eshell V12.1.5 (abort with ^G)退出halt(). 或者 q(). rabbitmq-server-generic-unix-3.9.11.tar.xz 12345678cd /usr/local/software/mv rabbitmq_server-3.9.11 /usr/local/mv /usr/local/rabbitmq_server-3.9.11 /usr/local/rabbitmqcd /usr/local/rabbitmq添加环境变量echo \"export PATH=/usr/local/rabbitmq/sbin:$PATH\" &gt;&gt; /etc/profilesource /etc/profile 配置文件rabbitmq配置文件有2个：系统环境配置文件rabbitmq-env.conf、参数环境配置文件rabbitmq.configmkdir /etc/rabbitmq/创建文件 vim /etc/rabbitmq/rabbitmq-env.conf，内容如下： 1234567891011# 应用根目录RABBITMQ_HOME=/usr/local/rabbitmq# 插件的路径RABBITMQ_PLUGINS_DIR=/usr/local/rabbitmq/plugins# 需要使用的MNESIA数据库的路径（创建）RABBITMQ_MNESIA_BASE=/usr/local/rabbitmq/data# 日志文件的路径（创建）RABBITMQ_LOG_BASE=/usr/local/rabbitmq/logs# 配置文件的路径（创建）RABBITMQ_CONFIG_FILE=/usr/local/rabbitmq/conf/rabbitmq.configNODENAME=rabbit@localhost 查看：cat /etc/rabbitmq/rabbitmq-env.conf mkdir /usr/local/rabbitmq/conf创建配置文件 vim /usr/local/rabbitmq/conf/rabbitmq.config，内容如下： 1234567891011121314151617181920212223## Clusteringcluster_partition_handling = ignore## Defaults# During the first start, RabbitMQ will create a vhost and a user# These config items control what gets createddefault_permissions.configure = .*default_permissions.read = .*default_permissions.write = .*default_vhost = /default_user = admindefault_pass = admin## Networkinglisteners.tcp.default = 5672## Managementmanagement.tcp.ip = 0.0.0.0management.tcp.port = 15672## Resource limits# Set a free disk space limit relative to total available RAMdisk_free_limit.relative = 1.0 查看：cat /usr/local/rabbitmq/conf/rabbitmq.config 常用RabbitMQ命令12345671.服务启动：rabbitmq-server -detached2.服务停止：rabbitmqctl stop3.服务状态：rabbitmqctl status4.服务重启：rabbitmq-server restart 安装RabbitMQ Web界面1234567891011121314151617开启插件：rabbitmq-plugins enable rabbitmq_management浏览器访问：http://127.0.0.1:15672/RabbitMQ默认提供了一个guest/guest用户，但是从3.3.0 版本以后该账号只能localhost登陆（User can only log in via localhost）通过以下命令创建一个用户admin，密码为adminrabbitmqctl add_user admin admin创建完成之后通过以下命令设置用户标签为administratorrabbitmqctl set_user_tags admin administrator给用户user赋予权限，授予user用户可访问虚拟主机 /，并在所有的资源上具备可配置、可写及可读的权限rabbitmqctl set_permissions -p / admin \".*\" \".*\" \".*\"最后，通过以下命令可以看出当前的所有用户rabbitmqctl list_users 添加端口到防火墙里123456789101112131415161、开启防火墙 systemctl start firewalldsystemctl status firewalld2、开放指定端口firewall-cmd --permanent --add-port=15672/tcp 命令含义：--add-port=15672/tcp #添加端口，格式为：端口/通讯协议--permanent #永久生效，没有此参数重启后失效3、重启防火墙firewall-cmd --reload4、查看端口号ss -ntlp //查看当前所有tcp端口·查看是否有15672端口ss -ntulp | grep 15672 //查看所有15672端口使用情况 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"RabbitMq","slug":"RabbitMq","permalink":"https://www.zhuqiaolun.com/categories/RabbitMq/"}],"tags":[{"name":"rabbitMq","slug":"rabbitMq","permalink":"https://www.zhuqiaolun.com/tags/rabbitMq/"}]},{"title":"Linux安装 Redis - 绿色版","slug":"2024/08/1723099472324/1723099472324","date":"2024-08-08T06:44:32.000Z","updated":"2024-08-09T07:21:39.481Z","comments":false,"path":"2024/08/1723099472324/1723099472324/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723099472324/1723099472324/","excerpt":"Linux安装 Redis","text":"安装编译环境 yum install -y gcc gcc-c++ tcl cmake 下载文件 redis-3.2.10.tar.gz 官网地址：https://redis.io/文件地址：https://download.redis.io/releases/下载地址：https://download.redis.io/releases/redis-3.2.10.tar.gz 解压文件123456781.创建临时目录软件根目录mkdir /usr/local/softwarecd /usr/local/softwarewget https://download.redis.io/releases/redis-3.2.10.tar.gz2.解压文件tar -xzvf redis-3.2.10.tar.gz 安装程序 redis-3.2.10.tar.gz1234cd /usr/local/software/redis-3.2.10# 指定安装目录make &amp;&amp; make PREFIX=/usr/local/redis install 配置文件redis.conf12从redis的源码目录中复制redis.conf到redis的bin目录下：cp /usr/local/software/redis-3.2.10/redis.conf /usr/local/redis/bin/ 修改配置文件redis.conf123456789101112131415vim redis.conf//显示行号:set nu//61行左右注释掉# bind 127.0.0.1//80行左右修改 protected-mode yes 改为 protected-mode no//128行左右daemonize no 改为 daemonize yes:wq! 保存退出 启动服务在bin目录下，启动redis服务： 12cd /usr/local/redis/bin./redis-server redis.conf 停止服务：利用redis-cli来执行 shutdown 命令，即可停止 Redis 服务， 12cd /usr/local/redis/bin./redis-cli shutdown 开机自启首先，新建一个系统服务文件：vim /etc/systemd/system/redis.service , 内容如下： 123456789[Unit]Description=redis-serverAfter=network.target[Service]Type=forkingExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.confPrivateTmp=true[Install]WantedBy=multi-user.target 查看：cat /etc/systemd/system/redis.service 然后重载系统服务：systemctl daemon-reload 可以用下面这组命令来操作redis了： 12345678# 启动systemctl start redis# 停止systemctl stop redis# 重启systemctl restart redis# 查看状态systemctl status redis 执行下面的命令，可以让redis开机自启：systemctl enable redis 添加端口到防火墙里：123456789101112131415161、开启防火墙 systemctl start firewalldsystemctl status firewalld2、开放指定端口firewall-cmd --permanent --add-port=6379/tcp 命令含义：--add-port=6379/tcp #添加端口，格式为：端口/通讯协议--permanent #永久生效，没有此参数重启后失效3、重启防火墙firewall-cmd --reload4、查看端口号ss -ntlp //查看当前所有tcp端口·查看是否有6379端口ss -ntulp | grep 6379 //查看所有3690端口使用情况 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"}]},{"title":"在Linux中安装subversion环境","slug":"2024/08/1723020746262/1723020746262","date":"2024-08-07T08:52:26.000Z","updated":"2024-08-09T07:21:46.020Z","comments":false,"path":"2024/08/1723020746262/1723020746262/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1723020746262/1723020746262/","excerpt":"subversion","text":"安装编译环境 yum install -y gcc gcc-c++ cmake zlib zlib-devel ncurses-devel openssl openssl-devel socat expat-devel 下载文件 apr-1.6.5.tar.gz apr-util-1.6.1.tar.gz sqlite-autoconf-3250100.tar.gz zlib-1.2.11.tar.gz subversion-1.10.6.tar.gz apr-1.6.5.tar.gz、apr-util-1.6.1.tar.gz 官网地址：http://subversion.apache.org文件地址：http://archive.apache.org/dist/apr下载地址：https://archive.apache.org/dist/apr/apr-1.6.5.tar.gz下载地址：https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gz zlib-1.2.11.tar.gz 文件地址：http://linux.softpedia.com/get/Programming/Libraries/zlib-159.shtml下载地址：https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xz?viasf=1 sqlite-autoconf-3250100.tar.gz 官网地址：http://www.sqlite.org下载地址：https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gz subversion-1.10.6.tar.gz 官网地址：http://subversion.apache.org文件地址：https://archive.apache.org/dist/subversion下载地址：https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz 解压文件1234567891011121314151617181920212223242526271.创建临时目录软件目录mkdir /usr/local/subversion软件根目录mkdir /usr/local/subversion/svn项目目录mkdir /usr/local/subversion/svn/project软件依赖安装目录mkdir /usr/local/subversion/software1.下载文件cd /usr/local/subversion/softwarewget https://archive.apache.org/dist/apr/apr-1.6.5.tar.gzwget https://archive.apache.org/dist/apr/apr-util-1.6.1.tar.gzwget https://nchc.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.xzwget https://sqlite.org/2018/sqlite-autoconf-3250100.tar.gzwget https://archive.apache.org/dist/subversion/subversion-1.10.6.tar.gz2.解压文件tar -xzvf apr-1.6.5.tar.gztar -xzvf apr-util-1.6.1.tar.gztar -xf zlib-1.2.11.tar.xztar -xzvf sqlite-autoconf-3250100.tar.gztar -zxvf subversion-1.10.6.tar.gz 安装程序 apr-1.6.5.tar.gz 123cd /usr/local/subversion/software/apr-1.6.5./configure --prefix=/usr/local/subversion/svn/apr-1.6.5make &amp;&amp; make install apr-util-1.6.1.tar.gz 123cd /usr/local/subversion/software/apr-util-1.6.1./configure --prefix=/usr/local/subversion/svn/apr-util-1.6.1 --with-apr=/usr/local/subversion/svn/apr-1.6.5make &amp; make install zlib-1.2.11.tar.xz（可以不安装） 123cd /usr/local/subversion/software/zlib-1.2.11./configure --prefix=/usr/local/subversion/svn/zlib-1.2.11make &amp; make install sqlite-autoconf-3250100.tar.gz 123cd /usr/local/subversion/software/sqlite-autoconf-3250100./configure --prefix=/usr/local/subversion/svn/sqlitemake &amp;&amp; make install subversion-1.10.6.tar.gz 1234567891011cd /usr/local/subversion/software/subversion-1.10.6（--with-apr等参数后面的路径，取决于前面几个插件安装的路径，插件也应该放在/usr/local/下面，我这里插件都放在/home/svn/其实不推荐这么干，在使用 ./configure 脚本时，如果需要在命令行中换行拼接多个选项，可以使用 \\ 符号在多行中分割长命令。这样做可以提高命令的可读性，使其不会过长。）./configure --prefix=/usr/local/subversion/svn/subversion-1.10.6 \\ --with-apr=/usr/local/subversion/svn/apr-1.6.5 \\ --with-apr-util=/usr/local/subversion/svn/apr-util-1.6.1 \\ --with-sqlite=/usr/local/subversion/svn/sqlite \\ --with-lz4=internal \\ --with-utf8proc=internalmake &amp; make install 添加环境变量安装完成，添加环境变量path 1234567891011添加echo \"export PATH=/usr/local/subversion/svn/subversion-1.10.6/bin:$PATH\" &gt;&gt; /etc/profile生效source /etc/profile# 查看cat /etc/profile验证：svnserve --version 添加项目库123456789101112131415161718192021222324252627282930创建两个库svnadmin create /usr/local/subversion/svn/javaproject/svnadmin create /usr/local/subversion/svn/webproject/进两个库里面设置权限，分别进入库的conf目录下，设置各自的权限……例如配置：cd /usr/local/subversion/svn/javaproject/conf vim svnserve.conf 修改以下内容（大约在27行）： password-db = passwd # 指明密码文件路径修改passwd文件 vim passwd 添加以下内容： [users] test1=test1 test2=test2启动（默认端口），指向库的父级目录svnserve -d -r /usr/local/subversion/svn/关闭svn服务killall svnserve通过客户端访问svn://服务器ip:端口(默认端口3690可以不写)/javaproject/例如：svn://10.200.47.87/javaproject/ 开机自启首先，新建一个系统服务文件：vim /etc/systemd/system/svnserver.service , 内容如下： 123456789[Unit]Description=SVN Server ServiceAfter=network.target[Service]Type=forkingExecStart=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -d -r /usr/local/subversion/svn/ExecStop=/usr/local/subversion/svn/subversion-1.10.6/bin/svnserve -q –pid-file /var/run/svnserve.pid[Install]WantedBy=multi-user.target wq!保存 123456789查看服务： cat /etc/systemd/system/svnserver.service加载服务：systemctl daemon-reload服务启动：systemctl start svnserver服务停止：systemctl stop svnserver服务状态：systemctl status svnserver开机启动：systemctl enable svnserver 添加端口到防火墙里123456789101112131415161、开启防火墙 systemctl start firewalldsystemctl status firewalld2、开放指定端口firewall-cmd --permanent --add-port=3690/tcp 命令含义：--add-port=3690/tcp #添加端口，格式为：端口/通讯协议--permanent #永久生效，没有此参数重启后失效3、重启防火墙firewall-cmd --reload4、查看端口号ss -ntlp //查看当前所有tcp端口·查看是否有3690端口ss -ntulp | grep 3690 //查看所有3690端口使用情况 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SVN","slug":"SVN","permalink":"https://www.zhuqiaolun.com/categories/SVN/"}],"tags":[{"name":"subversion","slug":"subversion","permalink":"https://www.zhuqiaolun.com/tags/subversion/"}]},{"title":"K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机）","slug":"2024/08/1722839250449/1722839250449","date":"2024-08-05T06:27:30.000Z","updated":"2024-08-15T06:09:25.837Z","comments":false,"path":"2024/08/1722839250449/1722839250449/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722839250449/1722839250449/","excerpt":"k8s","text":"只运行一个RabbitMq的Pod程序，本文采用 nfs 作为持久化储存。 拉取镜像并push到本地仓库12345678一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务docker pull busybox给镜像添加标签docker tag busybox 10.200.40.39:8080/component/busybox把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/busybox节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/busybox 拉取镜像并push到本地仓库1234567docker pull rabbitmq:3.9.11-management给镜像添加标签docker tag rabbitmq:3.9.11-management 10.200.40.39:8080/component/rabbitmq:3.9.11-management把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/rabbitmq:3.9.11-management节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/rabbitmq:3.9.11-management 编写配置文件文件（rabbitmq-service.yaml）如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109apiVersion: apps/v1kind: Deploymentmetadata: name: my-rabbitmq-deployment labels: app: my-rabbitmqspec: replicas: 1 selector: matchLabels: app: my-rabbitmq template: metadata: labels: app: my-rabbitmq spec: initContainers: - name: init-my-rabbitmq-data-chmod # 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务 image: 10.200.40.39:8080/component/busybox # 使用root用户权限 securityContext: runAsUser: 0 command: [\"chmod\", \"-R\", \"755\", \"/mnt/nfs/k8s_share/rabbitmq/data\"] volumeMounts: - name: rabbitmq-data mountPath: /mnt/nfs/k8s_share/rabbitmq/data containers: - name: my-rabbitmq image: \"10.200.40.39:8080/component/rabbitmq:3.9.11-management\" ports: - containerPort: 5672 # amqp name: port-5672 - containerPort: 4369 name: port-4369 - containerPort: 5671 name: port-5671 - containerPort: 15672 # http name: port-15672 - containerPort: 25672 name: port-25672 volumeMounts: #存储 - name: rabbitmq-data mountPath: /home/rabbitmq/ env: - name: HOSTNAME valueFrom: fieldRef: fieldPath: status.podIP - name: MY_POD_IP valueFrom: fieldRef: fieldPath: status.podIP - name: AUTOCLUSTER_CLEANUP value: \"true\" - name: RABBITMQ_USE_LONGNAME value: \"true\" - name: AUTOCLUSTER_LOG_LEVEL value: \"debug\" - name: CLEANUP_INTERVAL value: \"60\" - name: CLEANUP_WARN_ONLY value: \"false\" - name: AUTOCLUSTER_TYPE value: \"k8s\" - name: LANG value: \"en_US.UTF-8\" volumes: - name: rabbitmq-data hostPath: path: /mnt/nfs/k8s_share/rabbitmq/data type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-rabbitmq-servicespec: type: NodePort clusterIP: 10.98.104.75 clusterIPs: - 10.98.104.75 selector: app: my-rabbitmq ports: - port: 5672 name: port-5672 targetPort: 5672 protocol: TCP nodePort: 30672 - port: 15672 targetPort: 15672 name: port-15672 protocol: TCP nodePort: 31672 - port: 4369 name: port-4369 targetPort: 4369 protocol: TCP - port: 5671 name: port-5671 targetPort: 5671 protocol: TCP - port: 25672 name: port-25672 targetPort: 25672 protocol: TCP 新建应用 1kubectl apply -f rabbitmq-service.yaml 删除应用 1kubectl delete -f rabbitmq-service.yaml 查看容器日志 1234kubectl describe pod my-rabbitmq-deployment查看启动日志：kubectl get pods（查看程序日志：kubectl logs &lt;pod-name&gt;）kubectl logs my-rabbitmq-deployment-6fc788f4c8-rsrl2 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster rabbitmq]# kubectl exec -it my-rabbitmq-deployment-??????? -- /bin/bash[root@my-rabbitmq-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：Redis3.2.10（单机）","slug":"2024/08/1722839201478/1722839201478","date":"2024-08-05T06:26:41.000Z","updated":"2024-08-15T06:09:22.455Z","comments":false,"path":"2024/08/1722839201478/1722839201478/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722839201478/1722839201478/","excerpt":"k8s","text":"只运行一个Redis的Pod程序，本文采用 nfs 作为持久化储存。 拉取镜像并push到本地仓库12345678一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务docker pull busybox给镜像添加标签docker tag busybox 10.200.40.39:8080/component/busybox把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/busybox节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/busybox 拉取镜像并push到本地仓库1234567docker pull redis:3.2.10给镜像添加标签docker tag redis:3.2.10 10.200.40.39:8080/component/redis:3.2.10把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/redis:3.2.10节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/redis:3.2.10 编写配置文件使用全局 configmap 变量管理配置文件，文件（redis-configmap.yaml）如下： 123456789apiVersion: v1kind: ConfigMapmetadata: name: redis-configdata: redis.conf: | bind 0.0.0.0 protected-mode no port 6379 文件（redis-service.yaml）如下： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677apiVersion: apps/v1kind: Deploymentmetadata: name: my-redis-deploymentspec: selector: matchLabels: app: my-redis template: metadata: labels: app: my-redis spec: initContainers: - name: init-my-redis-data-chmod # 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务 image: 10.200.40.39:8080/component/busybox # 使用root用户权限 securityContext: runAsUser: 0 command: [\"chmod\", \"-R\", \"755\", \"/mnt/nfs/k8s_share/redis/data\"] volumeMounts: - name: redis-data mountPath: /mnt/nfs/k8s_share/redis/data containers: - name: my-redis image: 10.200.40.39:8080/component/redis:3.2.10 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent ports: - containerPort: 6379 volumeMounts: - name: redis-config mountPath: /usr/local/etc/redis/redis.conf subPath: redis.conf - name: redis-data mountPath: /data - name: redis-log mountPath: /var/log/redis resources: limits: memory: \"256Mi\" cpu: \"500m\" volumes: #和volumeMounts中的内容要对应 - name: redis-config configMap: name: redis-config items: - key: redis.conf path: redis.conf - name: redis-data hostPath: path: /mnt/nfs/k8s_share/redis/data type: DirectoryOrCreate - name: redis-log hostPath: path: /mnt/nfs/k8s_share/redis/logs type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-redis-servicespec: type: NodePort clusterIP: 10.102.96.83 clusterIPs: - 10.102.96.83 selector: app: my-redis ports: - port: 6379 name: port-6379 targetPort: 6379 protocol: TCP nodePort: 31379 新建应用 12kubectl apply -f redis-configmap.yamlkubectl apply -f redis-service.yaml 删除应用 12kubectl delete -f redis-configmap.yamlkubectl delete -f redis-service.yaml 查看容器日志 1234kubectl describe pod my-redis-deployment查看启动日志：kubectl get pods（查看程序日志：kubectl logs &lt;pod-name&gt;）kubectl logs my-redis-deployment-6fc788f4c8-rsrl2 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster redis]# kubectl exec -it my-redis-deployment-??????? -- /bin/bash[root@my-redis-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：MySql8.0.27","slug":"2024/08/1722836311451/1722836311451","date":"2024-08-05T05:38:31.000Z","updated":"2024-08-15T06:09:19.449Z","comments":false,"path":"2024/08/1722836311451/1722836311451/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722836311451/1722836311451/","excerpt":"k8s","text":"只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。 拉取镜像并push到本地仓库12345678一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务docker pull busybox给镜像添加标签docker tag busybox 10.200.40.39:8080/component/busybox把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/busybox节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/busybox 拉取镜像并push到本地仓库1234567docker pull mysql:8.0.27给镜像添加标签docker tag mysql:8.0.27 10.200.40.39:8080/component/mysql:8.0.27把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/mysql:8.0.27节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/mysql:8.0.27 编写配置文件使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051apiVersion: v1kind: ConfigMapmetadata: name: mysql8-conf namespace: defaultdata: my.cnf: |- [client] default-character-set=utf8mb4 [mysql] default-character-set=utf8mb4 [mysqld] port=3308 max_connections = 2000 #secure_file_priv=/var/lib/mysql sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION skip-name-resolve open_files_limit = 65535 table_open_cache = 128 log_error = varlibmysqlmysql-errorlog #错误日志路径 slow_query_log = 1 long_query_time = 1 #慢查询时间 超过1秒则为慢查询 slow_query_log_file = varlibmysqlmysql-slowlog default-storage-engine = InnoDB #默认存储引擎 innodb_file_per_table = 1 innodb_open_files = 500 innodb_buffer_pool_size = 64M innodb_write_io_threads = 4 innodb_read_io_threads = 4 innodb_thread_concurrency = 0 innodb_purge_threads = 1 innodb_flush_log_at_trx_commit = 2 innodb_log_buffer_size = 2M innodb_log_file_size = 32M innodb_log_files_in_group = 3 innodb_max_dirty_pages_pct = 90 innodb_lock_wait_timeout = 120 bulk_insert_buffer_size = 8M myisam_sort_buffer_size = 8M myisam_max_sort_file_size = 10G myisam_repair_threads = 1 interactive_timeout = 28800 wait_timeout = 28800 [mysqldump] quick max_allowed_packet = 16M #服务器发送和接受的最大包长度 [myisamchk] key_buffer_size = 8M sort_buffer_size = 8M read_buffer = 4M write_buffer = 4M 文件（mysql8-service.yaml）如下： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495apiVersion: apps/v1kind: Deploymentmetadata: name: my-mysql8-deployment namespace: defaultspec: replicas: 1 selector: matchLabels: app: my-mysql8 template: metadata: labels: app: my-mysql8 spec: # 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限） initContainers: - name: init-my-mysql8-data-chmod # 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务 image: 10.200.40.39:8080/component/busybox # 使用root用户权限 securityContext: runAsUser: 0 command: [\"chmod\", \"-R\", \"755\", \"/mnt/nfs/k8s_share/mysql8/data\"] volumeMounts: - name: mysql-data mountPath: /mnt/nfs/k8s_share/mysql8/data containers: - name: my-mysql8 #刚刚push到私有仓库的镜像地址 image: 10.200.40.39:8080/component/mysql:8.0.27 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent env: - name: TZ value: Asia/Shanghai - name: MYSQL_ROOT_USER value: \"root\" - name: MYSQL_ROOT_PASSWORD value: \"root\" - name: MYSQL_DATEBASE value: \"myblog\" ports: - name: http #内部程序端口 containerPort: 3308 resources: #qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低 requests: # 最小限制 memory: \"256Mi\" # 内存最新64M cpu: \"500m\" # CPU最大使用0.25核 limits: # 最大限制 memory: \"512Mi\" # 内存最新128M cpu: \"1000m\" # CPU最大使用0.5核 # 容器内的路径 volumeMounts: - name: time-zone #容器内挂载点名称 mountPath: /etc/localtime #容器内挂载点路径，可以是文件或目录 - name: mysql-cinfig mountPath: /etc/mysql/conf.d/my.cnf #容器内mysql的数据目录 subPath: my.cnf - name: mysql-data mountPath: /var/lib/mysql #容器内mysql的数据目录 # 主机的路径 volumes: - name: time-zone #数据卷名称，需要与容器内挂载点名称一致 hostPath: path: /etc/localtime #挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区 - name: mysql-cinfig configMap: name: mysql8-conf - name: mysql-data #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/mysql8/data type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-mysql8-service namespace: defaultspec: type: NodePort clusterIP: 10.103.215.148 clusterIPs: - 10.103.215.148 selector: app: my-mysql8 ports: - name: http protocol: TCP # Service对外暴露的端口，集群内部可访问 port: 3308 # Pod内部容器监听的端口，默认使用和上面的 port 一致的 targetPort: 3308 nodePort: 30308 新建应用 12kubectl apply -f mysql8-configmap.yamlkubectl apply -f mysql8-service.yaml 删除应用 12kubectl delete -f mysql8-configmap.yamlkubectl delete -f mysql8-service.yaml 查看容器日志 1234kubectl describe pod my-mysql8-deployment查看启动日志：kubectl get pods（查看程序日志：kubectl logs &lt;pod-name&gt;）kubectl logs my-mysql8-deployment-6fc788f4c8-rsrl2 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster mysql8]# kubectl exec -it my-mysql8-deployment-??????? -- /bin/bash[root@my-mysql8-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 说明如遇见未知错误可删除已经生成的data目录，重新生成data如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：1进入MySQL的Pod中： kubectl exec -it my-mysql8-deployment-88f575676-2h2nn – /bin/bash2进入MySQL命令行： mysql -uroot -proot -P 33063执行以下SQL语句，允许root用户从任意主机访问MySQL： GRANT ALL PRIVILEGES ON . TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION; FLUSH PRIVILEGES;4退出MySQL命令行和Pod：exit； 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：MySql5.6.51","slug":"2024/08/1722836276725/1722836276725","date":"2024-08-05T05:37:56.000Z","updated":"2024-08-15T06:09:16.693Z","comments":false,"path":"2024/08/1722836276725/1722836276725/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722836276725/1722836276725/","excerpt":"k8s","text":"只运行一个MySql的Pod程序，本文采用 nfs 作为持久化储存。 拉取镜像并push到本地仓库12345678一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务docker pull busybox给镜像添加标签docker tag busybox 10.200.40.39:8080/component/busybox把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/busybox节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/busybox 拉取镜像并push到本地仓库1234567docker pull mysql:5.6.51给镜像添加标签docker tag mysql:5.6.51 10.200.40.39:8080/component/mysql:5.6.51把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/mysql:5.6.51节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/mysql:5.6.51 编写配置文件使用全局 configmap 变量管理配置文件，文件（mysql5-configmap.yaml）如下： 12345678910111213141516171819202122232425262728293031323334353637apiVersion: v1kind: ConfigMapmetadata: name: mysql5-conf namespace: defaultdata: my.cnf: | [mysql] # 设置mysql客户端默认字符集 default-character-set=utf8 [mysqld] #默认编码 character_set_server=utf8 bind-address = 0.0.0.0 #端口 port = 3306 #引擎 default-storage-engine=INNODB # 最大连接数量 max_connections = 100 #单个内存表的最大值限定 max_heap_table_size = 64M max_allowed_packet = 64M #为每个线程分配的排序缓冲大小 sort_buffer_size = 8M #join 连表操作的缓冲大小,根据实际业务来设置，默认8M join_buffer_size = 32M # sql查询缓存，如果提交的查询与几次中的某查询相同，并且在query缓存中存在，则直接返回缓存中的结果 query_cache_size = 64M # sql模式 sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES #表示开启binlog并指定binglog文件名 log_bin = mysql-bin #默认 binlog_format = ROW #binlog保留天数 expire_logs_days=15 文件（mysql6-service.yaml）如下： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495apiVersion: apps/v1kind: Deploymentmetadata: name: my-mysql5-deployment namespace: defaultspec: replicas: 1 selector: matchLabels: app: my-mysql5 template: metadata: labels: app: my-mysql5 spec: # 初始化容器（初始化数据库数据，本次是赋予挂载盘读写权限） initContainers: - name: init-my-mysql5-data-chmod # 一个常用的轻量级镜像，只有几兆字节大小，常用于初始化任务 image: 10.200.40.39:8080/component/busybox # 使用root用户权限 securityContext: runAsUser: 0 command: [\"chmod\", \"-R\", \"755\", \"/mnt/nfs/k8s_share/mysql5/data/\"] volumeMounts: - name: mysql-data mountPath: /mnt/nfs/k8s_share/mysql5/data/ containers: - name: my-mysql5 #刚刚push到私有仓库的镜像地址 image: 10.200.40.39:8080/component/mysql:5.6.51 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent env: - name: TZ value: Asia/Shanghai - name: MYSQL_ROOT_USER value: \"root\" - name: MYSQL_ROOT_PASSWORD value: \"root\" - name: MYSQL_DATEBASE value: \"myblog\" ports: - name: http #内部程序端口 containerPort: 3306 resources: #qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低 requests: # 最小限制 memory: \"256Mi\" # 内存最新64M cpu: \"500m\" # CPU最大使用0.25核 limits: # 最大限制 memory: \"512Mi\" # 内存最新128M cpu: \"1000m\" # CPU最大使用0.5核 # 容器内的路径 volumeMounts: - name: time-zone #容器内挂载点名称 mountPath: /etc/localtime #容器内挂载点路径，可以是文件或目录 - name: mysql-cinfig mountPath: /etc/mysql/conf.d/my.cnf #容器内mysql的数据目录 subPath: my.cnf - name: mysql-data mountPath: /var/lib/mysql #容器内mysql的数据目录 # 主机的路径 volumes: - name: time-zone #数据卷名称，需要与容器内挂载点名称一致 hostPath: path: /etc/localtime #挂载到容器里的路径，将localtime文件挂载到容器里，可让容器使用本地的时区 - name: mysql-cinfig configMap: name: mysql5-conf - name: mysql-data #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/mysql5/data/ type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-mysql5-service namespace: defaultspec: type: NodePort clusterIP: 10.102.102.249 clusterIPs: - 10.102.102.249 selector: app: my-mysql5 ports: - name: http protocol: TCP # Service对外暴露的端口，集群内部可访问 port: 3306 # Pod内部容器监听的端口，默认使用和上面的 port 一致的 targetPort: 3306 nodePort: 30306 新建应用 12kubectl apply -f mysql5-configmap.yamlkubectl apply -f mysql5-service.yaml 删除应用 12kubectl delete -f mysql5-configmap.yamlkubectl delete -f mysql5-service.yaml 查看容器日志 1234kubectl describe pod my-mysql5-deployment查看启动日志：kubectl get pods（查看程序日志：kubectl logs &lt;pod-name&gt;）kubectl logs my-mysql5-deployment-6fc788f4c8-rsrl2 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster mysql5]# kubectl exec -it my-mysql5-deployment-??????? -- /bin/bash[root@my-mysql5-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 说明如遇见未知错误可删除已经生成的data目录，重新生成data如不能远程访问，则可进行以下允许远程访问MySQL的步骤如下：1进入MySQL的Pod中： kubectl exec -it my-mysql5-deployment-88f575676-2h2nn – /bin/bash2进入MySQL命令行： mysql -uroot -proot -P 33063执行以下SQL语句，允许root用户从任意主机访问MySQL： GRANT ALL PRIVILEGES ON . TO ‘root’@’%’ IDENTIFIED BY ‘root’ WITH GRANT OPTION; FLUSH PRIVILEGES;4退出MySQL命令行和Pod：exit； 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：Tomcat9.0.56","slug":"2024/08/1722586402699/1722586402699","date":"2024-08-02T08:13:22.000Z","updated":"2024-08-15T06:09:13.865Z","comments":false,"path":"2024/08/1722586402699/1722586402699/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722586402699/1722586402699/","excerpt":"k8s","text":"只运行一个Tomcat的Pod程序，以后的后端项目均存放在一个webapps目录即可，本文采用 nfs 存储。 拉取镜像并push到本地仓库1234567docker pull tomcat:9.0.56给镜像添加标签docker tag tomcat:9.0.56 10.200.40.39:8080/component/tomcat:9.0.56把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/tomcat:9.0.56节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/tomcat:9.0.56 编写配置文件使用全局 configmap 变量管理配置文件，文件（tomcat-configmap.yaml）如下： 1234567891011121314151617181920212223242526272829303132333435363738apiVersion: v1kind: ConfigMapmetadata: name: tomcat-confdata: server.xml: |- &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;Server port=\"8005\" shutdown=\"SHUTDOWN\"&gt; &lt;Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /&gt; &lt;Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /&gt; &lt;Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /&gt; &lt;/GlobalNamingResources&gt; &lt;Service name=\"Catalina\"&gt; &lt;Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt; &lt;/Realm&gt; &lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt; &lt;/Server&gt; 文件（tomcat-service.yaml）如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100apiVersion: apps/v1kind: Deploymentmetadata: name: my-tomcat-deployment namespace: defaultspec: replicas: 1 selector: matchLabels: app: my-tomcat template: metadata: labels: app: my-tomcat spec: containers: - name: my-tomcat #刚刚push到私有仓库的镜像地址 image: 10.200.40.39:8080/component/tomcat:9.0.56 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent env: - name: TZ value: Asia/Shanghai - name: JAVA_OPTS value: \"-Xmx512m -Xms256m\" ports: - name: http #内部程序端口 containerPort: 8080 resources: #qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低 requests: # 最小限制 memory: \"256Mi\" # 内存最新256M cpu: \"500m\" # CPU最大使用0.5核 limits: # 最大限制 memory: \"512Mi\" # 内存最新512M cpu: \"1000m\" # CPU最大使用1核 # 容器内的路径 volumeMounts: - name: tomcat-cinfig mountPath: /usr/local/tomcat/conf/server.xml # 挂载配置了 tomcat-conf 的 volume subPath: server.xml - name: tomcat-log mountPath: /usr/local/tomcat/logs/ - name: tomcat-webapps mountPath: /usr/local/tomcat/webapps/ # 主机的路径 volumes: - name: tomcat-cinfig configMap: name: tomcat-conf - name: tomcat-log #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/tomcat/logs/ type: DirectoryOrCreate - name: tomcat-webapps #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/tomcat/webapps/ type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-tomcat-service namespace: defaultspec: type: NodePort clusterIP: 10.109.128.67 clusterIPs: - 10.109.128.67 selector: app: my-tomcat ports: - name: http protocol: TCP # Service对外暴露的端口，集群内部可访问 port: 8080 # Pod内部容器监听的端口，默认使用和上面的 port 一致的 targetPort: 8080 nodePort: 30808---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: my-tomcat-ingress namespace: default annotations: kubernetes.io/ingress.class: \"nginx\"spec: rules: - host: my.tomcat.com http: paths: - path: / pathType: Prefix backend: service: name: my-tomcat-service port: number: 8080 新建应用 12kubectl apply -f tomcat-configmap.yamlkubectl apply -f tomcat-service.yaml 删除应用 12kubectl delete -f tomcat-configmap.yamlkubectl delete -f tomcat-service.yaml 查看应用信息 123456789101112131415kubectl describe configmap tomcat-confkubectl describe deployment my-tomcat-deploymentkubectl describe service my-tomcat-servicekubectl describe ingress my-tomcat-ingress 由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开 vi /etc/hosts [root@k8snode-1 /]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 10.200.40.40 k8smaster 10.200.40.41 k8snode-1 test.k8s.com my.nginx.com my.tomcat.com 10.200.40.42 k8snode-2 test.k8s.com my.nginx.com my.tomcat.com 查看应用在容器的部署信息kubectl describe pod my-tomcat-deploymentkubectl logs my-tomcat-deployment-??????? 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster tomcat]# kubectl exec -it my-tomcat-deployment-??????? -- /bin/bash[root@my-tomcat-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 客户端访问定义service的type类型NodePort,故可以外部访问： IP访问：http://10.200.40.40:30808/ 域名访问：http://my.tomcat.com/， 需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：Nginx1.21.5","slug":"2024/08/1722586394326/1722586394326","date":"2024-08-02T08:13:14.000Z","updated":"2024-08-15T06:09:11.237Z","comments":false,"path":"2024/08/1722586394326/1722586394326/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722586394326/1722586394326/","excerpt":"k8s","text":"只运行一个Nginx的Pod程序，以后的前端项目均存放在一个html目录即可，本文采用 nfs 存储。 拉取镜像并push到本地仓库1234567docker pull nginx:1.21.5给镜像添加标签docker tag nginx:1.21.5 10.200.40.39:8080/component/nginx:1.21.5把镜像 push 到本地仓库docker push 10.200.40.39:8080/component/nginx:1.21.5节点拉取本地仓库的镜像docker pull 10.200.40.39:8080/component/nginx:1.21.5 编写配置文件使用全局 configmap 变量管理配置文件，文件（nginx-configmap.yaml）如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869apiVersion: v1kind: ConfigMapmetadata: name: nginx-confdata: nginx.conf: | user nginx; worker_processes 1; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server { listen 80; server_name _; location / { root /usr/share/nginx/html; index index.html index.htm; } location /sip-web { alias /usr/share/nginx/html/sip-web/dist/; try_files $uri $uri/ /hello/index.html; index index.html index.htm; } location ^~ /sip-api/ { proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://10.200.40.40:30088/sip-admin/; } # 避免actuator暴露 if ($request_uri ~ \"/actuator\") { return 403; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } } 文件（nginx-service.yaml）如下： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798apiVersion: apps/v1kind: Deploymentmetadata: name: my-nginx-deployment namespace: defaultspec: replicas: 1 selector: matchLabels: app: my-nginx template: metadata: labels: app: my-nginx spec: containers: - name: my-nginx #刚刚push到私有仓库的镜像地址 image: 10.200.40.39:8080/component/nginx:1.21.5 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent env: - name: TZ value: Asia/Shanghai ports: - name: http #内部程序端口 containerPort: 80 resources: #qos限制 1.QoS 主要分为Guaranteed、Burstable 和 Best-Effort三类，优先级从高到低 requests: # 最小限制 memory: \"64Mi\" # 内存最新64M cpu: \"250m\" # CPU最大使用0.25核 limits: # 最大限制 memory: \"128Mi\" # 内存最新128M cpu: \"500m\" # CPU最大使用0.5核 # 容器内的路径 volumeMounts: - name: nginx-config mountPath: /etc/nginx/nginx.conf # 挂载配置了 nginx.conf 的 volume subPath: nginx.conf - name: nginx-log mountPath: /var/log/nginx/ - name: nginx-html mountPath: /usr/share/nginx/html/ # 主机的路径 volumes: - name: nginx-config configMap: name: nginx-conf - name: nginx-log #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/nginx/logs/ type: DirectoryOrCreate - name: nginx-html #和volumeMounts中的内容要对应 hostPath: path: /mnt/nfs/k8s_share/nginx/html/ type: DirectoryOrCreate---apiVersion: v1kind: Servicemetadata: name: my-nginx-service namespace: defaultspec: type: NodePort clusterIP: 10.110.23.182 clusterIPs: - 10.110.23.182 selector: app: my-nginx ports: - name: http protocol: TCP # Service对外暴露的端口，集群内部可访问 port: 80 # Pod内部容器监听的端口，默认使用和上面的 port 一致的 targetPort: 80 nodePort: 30080---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: my-nginx-ingress namespace: default annotations: kubernetes.io/ingress.class: \"nginx\"spec: rules: - host: my.nginx.com http: paths: - path: / pathType: Prefix backend: service: name: my-nginx-service port: number: 80 新建应用 12kubectl apply -f nginx-configmap.yamlkubectl apply -f nginx-service.yaml 删除应用 12kubectl delete -f nginx-configmap.yamlkubectl delete -f nginx-service.yaml 查看应用信息 123456789101112131415kubectl describe configmap nginx-confkubectl describe deployment my-nginx-deploymentkubectl describe service my-nginx-servicekubectl describe ingress my-nginx-ingress 由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开 vi /etc/hosts [root@k8snode-1 /]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 10.200.40.40 k8smaster 10.200.40.41 k8snode-1 test.k8s.com my.nginx.com 10.200.40.42 k8snode-2 test.k8s.com my.nginx.com 查看应用在容器的部署信息kubectl describe pod my-nginx-deploymentkubectl logs my-nginx-deployment-??????? 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster nginx]# kubectl exec -it my-nginx-deployment-??????? -- /bin/bash[root@my-nginx-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 客户端访问定义service的type类型NodePort,故可以外部访问： IP访问：http://10.200.40.40:30080/ 域名访问：http://my.nginx.com/， 需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：SpringBoot（Jar运行）","slug":"2024/08/1722586325029/1722586325029","date":"2024-08-02T08:12:05.000Z","updated":"2024-08-15T06:31:17.153Z","comments":false,"path":"2024/08/1722586325029/1722586325029/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722586325029/1722586325029/","excerpt":"k8s","text":"制作 springboot（jar） 程序 镜像打包可运行的jar文件，放到同层目录下，如：/usr/local/java，目录下存在jar文件和Dockerfile文件 Dockerfile文件内容：12345678910#基于我们刚刚创建的jdk镜像FROM 10.200.40.39:8080/jdk/openjdk-11MAINTAINER kgf#j镜像解压出来的目录ENV JAVA_HOME /usr/local/jdk/jdk-11ENV PATH $JAVA_HOME/bin:$PATHADD k8s-demo.jar /optRUN chmod +x /opt/k8s-demo.jar#运行jarENTRYPOINT [\"sh\",\"-c\",\"java -Xms256m -Xmx512m -jar /opt/k8s-demo.jar\"] build镜像1234567891011121314在公网构建镜像(后面的 空格+点 不能漏掉)： docker build -t k8s-demo:v1.0 .给镜像打标签： docker build -t 10.200.40.39:8080/testproject/k8s-demo:v1.0 .把镜像 push 到本地仓库： docker push 10.200.40.39:8080/testproject/k8s-demo:v1.0查看镜像 docker image 其他节点下载镜像 docker pull 10.200.40.39:8080/testproject/k8s-demo:v1.0 验证镜像（测试运行） docker run -it -p 8235:8235 10.200.40.39:8080/testproject/k8s-demo:v1.0 部署应用创建文件（k8s-demo-service.yaml），内容如下：1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374apiVersion: apps/v1kind: Deploymentmetadata: name: k8s-demo-deployment namespace: defaultspec: replicas: 1 selector: matchLabels: app: k8s-demo template: metadata: labels: app: k8s-demo spec: containers: - name: k8s-demo #刚刚push到私有仓库的镜像地址 image: 10.200.40.39:8080/testproject/k8s-demo:v1.0 #保证当本地有镜像的时候优先选用本地，没有才选择网络拉取 imagePullPolicy: IfNotPresent ports: - name: http #内部程序端口 containerPort: 8235 env: # 解决Java程序时区问题 - name: TZ value: Asia/Shanghai---apiVersion: v1kind: Servicemetadata: # 这里的名称将来会被用作请求的域名来被集群外部和内部对象使用 name: k8s-demo-service namespace: defaultspec: # 默认类型 type: NodePort clusterIP: 10.101.65.14 clusterIPs: - 10.101.65.14 selector: # 选择器，Service 会通过满足选择器的Pod去建立和Pod的映射关系，一般是1对多 # 会找对应 这个 xxx label 的 Pod app: k8s-demo ports: - name: http protocol: TCP # Service对外暴露的端口，集群内部可访问 port: 8235 # Pod内部容器监听的端口，默认使用和上面的 port 一致的 targetPort: 8235 nodePort: 30235---apiVersion: networking.k8s.io/v1kind: Ingressmetadata: name: k8s-demo-ingress namespace: default annotations: kubernetes.io/ingress.class: nginxspec: rules: - host: test.k8s.com http: paths: - path: /k8s-demo pathType: Prefix backend: service: name: k8s-demo-service port: number: 8235 新建应用 1234[root@k8smaster k8s-demo]# kubectl apply -f k8s-demo-service.yaml deployment.apps/k8s-demo-deployment created service/k8s-demo-service created ingress.networking.k8s.io/k8s-demo-ingress created 删除应用 1234[root@k8smaster k8s-demo]# kubectl delete -f k8s-demo-service.yaml deployment.apps \"k8s-demo-deployment\" deleted service \"k8s-demo-service\" deleted ingress.networking.k8s.io \"k8s-demo-ingress\" deleted 查看应用信息 1234567891011121314kubectl describe deployment k8s-demo-deploymentkubectl describe service k8s-demo-servicekubectl describe ingress k8s-demo-ingress 由于配置了ingress且定义了域名，故需要在所有node节点中绑定域名，可以一个IP对应多个域名，中间空格隔开 vi /etc/hosts [root@k8snode-1 /]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 10.200.40.40 k8smaster 10.200.40.41 k8snode-1 test.k8s.com 10.200.40.42 k8snode-2 test.k8s.com 查看应用在容器的部署信息 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253Pod执行记录，通过执行流程，可以看出是否部署成功[root@k8smaster k8s-demo]# kubectl describe pod k8s-demo-deploymentName: k8s-demo-deployment-76f6dcccd4-zv5scNamespace: defaultPriority: 0Node: k8snode-2/10.200.40.42Start Time: Fri, 02 Aug 2024 04:32:28 -0400Labels: app=k8s-demo pod-template-hash=76f6dcccd4Annotations: cni.projectcalico.org/podIP: 192.168.163.144/32Status: RunningIP: 192.168.163.144IPs: IP: 192.168.163.144Controlled By: ReplicaSet/k8s-demo-deployment-76f6dcccd4Containers: k8s-demo: Container ID: docker://11d995c49cb2d90e7c8b7fc48742e002d83d0e3f5bb0a84d577f76f1bd8f2a61 Image: 10.200.40.39:8080/testproject/k8s-demo:v1.0 Image ID: docker-pullable://10.200.40.39:8080/testproject/k8s-demo@sha256:c39c992f2cbfdcd79895749f1470cb0eec3bb10b90eca95be515ef9883d88c9b Port: 8235/TCP Host Port: 0/TCP State: Running Started: Fri, 02 Aug 2024 04:32:32 -0400 Ready: True Restart Count: 0 Environment: TZ: Asia/Shanghai Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-w7684 (ro)Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled TrueVolumes: default-token-w7684: Type: Secret (a volume populated by a Secret) SecretName: default-token-w7684 Optional: falseQoS Class: BestEffortNode-Selectors: &lt;none&gt;Tolerations: node.kubernetes.io/not-ready:NoExecute op=Exists for 300s node.kubernetes.io/unreachable:NoExecute op=Exists for 300sEvents: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 13m default-scheduler Successfully assigned default/k8s-demo-deployment-76f6dcccd4-zv5sc to k8snode-2 Normal Pulled 11m kubelet Container image \"10.200.40.39:8080/testproject/k8s-demo:v1.0\" already present on machine Normal Created 11m kubelet Created container k8s-demo Normal Started 11m kubelet Started container k8s-demo 查看应用在容器的执行日志 12345678910111213141516171819202122kubectl logs &lt;pod-name&gt; ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster k8s-demo]# kubectl logs k8s-demo-deployment-76f6dcccd4-zv5sc . ____ _ __ _ _ /\\\\ / ___'_ __ _ _(_)_ __ __ _ \\ \\ \\ \\( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\ \\\\/ ___)| |_)| | | | | || (_| | ) ) ) ) ' |____| .__|_| |_|_| |_\\__, | / / / / =========|_|==============|___/=/_/_/_/ :: Spring Boot :: (v2.4.2)2024-08-02 16:32:33.703 INFO 1 --- [ main] com.example.demo.DemoApplication : Starting DemoApplication v1.0.0 using Java 11 on k8s-demo-deployment-76f6dcccd4-zv5sc with PID 1 (/opt/k8s-demo.jar started by root in /)2024-08-02 16:32:33.706 INFO 1 --- [ main] com.example.demo.DemoApplication : No active profile set, falling back to default profiles: default2024-08-02 16:32:34.621 INFO 1 --- [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat initialized with port(s): 8235 (http)2024-08-02 16:32:34.630 INFO 1 --- [ main] o.apache.catalina.core.StandardService : Starting service [Tomcat]2024-08-02 16:32:34.630 INFO 1 --- [ main] org.apache.catalina.core.StandardEngine : Starting Servlet engine: [Apache Tomcat/9.0.41]2024-08-02 16:32:34.680 INFO 1 --- [ main] o.a.c.c.C.[.[localhost].[/k8s-demo] : Initializing Spring embedded WebApplicationContext2024-08-02 16:32:34.680 INFO 1 --- [ main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 922 ms2024-08-02 16:32:35.433 INFO 1 --- [ main] o.s.s.concurrent.ThreadPoolTaskExecutor : Initializing ExecutorService 'applicationTaskExecutor'2024-08-02 16:32:35.628 INFO 1 --- [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat started on port(s): 8235 (http) with context path '/k8s-demo'2024-08-02 16:32:35.763 INFO 1 --- [ main] com.example.demo.DemoApplication : Started DemoApplication in 2.615 seconds (JVM running for 3.272) 进入容器应用内部12345kubectl exec -it &lt;pod-name&gt; -- /bin/bash ，&lt;pod-name&gt; 由上一步命名执行得出[root@k8smaster k8s-demo]# kubectl exec -it k8s-demo-deployment-76f6dcccd4-zv5sc -- /bin/bash[root@k8s-demo-deployment-76f6dcccd4-zv5sc /]# lsanaconda-post.log bin dev etc home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var 扩容1kubectl scale deployment k8s-demo-deployment --replicas 3 客户端访问定义service的type类型NodePort,故可以外部访问： IP访问：http://10.200.40.40:30235/k8s-demo/ 域名访问：http://test.k8s.com/k8s-demo/， 需要在host文件内配置任一节点的ip即可，如：10.200.40.41 test.k8s.com my.nginx.com my.tomcat.com 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之部署：openjdk-11","slug":"2024/08/1722585036230/1722585036230","date":"2024-08-02T07:50:36.000Z","updated":"2024-08-15T06:09:04.096Z","comments":false,"path":"2024/08/1722585036230/1722585036230/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722585036230/1722585036230/","excerpt":"k8s","text":"下载想要制作的镜像的对应jdk文件，放到同层目录下，如：/usr/local/project/jdk/，目录下存在tar.gz文件和Dockerfile文件 下载openjdk-11openjdk：https://openjdk.org/下载地址：https://download.java.net/java/ga/jdk11/openjdk-11_linux-x64_bin.tar.gz Dockerfile文件内容：1234567891011121314151617181920212223242526#建立一个新的镜像文件，配置模板：新建立的镜像是以centos为基础模板#因为jdk必须运行在操作系统之上#每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。#第一条FROM，指定使用哪个镜像源FROM centos:centos7#维护者 作者 邮箱MAINTAINER demon#RUN 指令告诉docker 在镜像内执行命令，安装了什么#创建一个新目录来存储jdk文件RUN mkdir \"/usr/local/jdk\"#将jdk压缩文件复制到镜像中，它将自动解压缩tar文件ADD openjdk-11_linux-x64_bin.tar.gz /usr/local/jdk# 设置时区RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime# 设置环境变量《jdk-11》是解压tat.gz出来的文件名ENV JAVA_HOME /usr/local/jdk/jdk-11ENV PATH $JAVA_HOME/bin:$PATH# VOLUME 指定了临时文件目录为/tmp# 其效果是在主机 /var/lib/docker 目录下创建了一个临时文件，并链接到容器的/tmpVOLUME /tmp build镜像1.在公网构建镜像(后面的 空格+点 不能漏掉)：docker build -t openjdk-11 .2.给镜像打标签：docker tag openjdk-11 10.200.40.39:8080/jdk/openjdk-113.把镜像 push 到本地仓库：docker push 10.200.40.39:8080/jdk/openjdk-114.查看镜像docker images5.验证镜像docker run -id --name checkJdk11 10.200.40.39:8080/jdk/openjdk-11 docker ps docker exec -it checkJdk11 bash java -version exit docker stop checkJdk11 docker rm checkJdk11其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之安装：ingress-nginx-0.30.0","slug":"2024/08/1722583767468/1722583767468","date":"2024-08-02T07:29:27.000Z","updated":"2024-08-15T06:08:58.556Z","comments":false,"path":"2024/08/1722583767468/1722583767468/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722583767468/1722583767468/","excerpt":"k8s","text":"该Nginx是经过改造的，而不是传统的Nginx。由于K8S的版本为1.20.6，故我们下载的版本为：nginx-0.30.0。Ingress-Nginx官网地址：https://kubernetes.github.io/ingress-nginx/Ingress-Nginx GitHub地址：https://github.com/kubernetes/ingress-nginxnginx-0.30.0：https://github.com/kubernetes/ingress-nginx/releases?page=21 镜像下载公网拉取镜像 docker pull registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0 给镜像添加标签 docker tag registry.aliyuncs.com/google_containers/nginx-ingress-controller:0.30.0 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0 把镜像 push 到本地仓库 docker push 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0 节点拉取本地仓库的镜像 docker pull 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0Ingress-Nginx下载下载文件：wget https://github.com/kubernetes/ingress-nginx/archive/nginx-0.30.0.tar.gz 解压文件：tar xf nginx-0.30.0.tar.gz 编辑文件：ingress-nginx-nginx-0.30.0/deploy/static/mandatory.yamlyaml文件修改后的配置(mandatory.yaml)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285apiVersion: v1kind: Namespacemetadata: name: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---kind: ConfigMapapiVersion: v1metadata: name: nginx-configuration namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---kind: ConfigMapapiVersion: v1metadata: name: tcp-services namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---kind: ConfigMapapiVersion: v1metadata: name: udp-services namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---apiVersion: v1kind: ServiceAccountmetadata: name: nginx-ingress-serviceaccount namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRolemetadata: name: nginx-ingress-clusterrole labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxrules: - apiGroups: - \"\" resources: - configmaps - endpoints - nodes - pods - secrets verbs: - list - watch - apiGroups: - \"\" resources: - nodes verbs: - get - apiGroups: - \"\" resources: - services verbs: - get - list - watch - apiGroups: - \"\" resources: - events verbs: - create - patch - apiGroups: - \"extensions\" - \"networking.k8s.io\" resources: - ingresses verbs: - get - list - watch - apiGroups: - \"extensions\" - \"networking.k8s.io\" resources: - ingresses/status verbs: - update---apiVersion: rbac.authorization.k8s.io/v1kind: Rolemetadata: name: nginx-ingress-role namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxrules: - apiGroups: - \"\" resources: - configmaps - pods - secrets - namespaces verbs: - get - apiGroups: - \"\" resources: - configmaps resourceNames: # Defaults to \"&lt;election-id&gt;-&lt;ingress-class&gt;\" # Here: \"&lt;ingress-controller-leader&gt;-&lt;nginx&gt;\" # This has to be adapted if you change either parameter # when launching the nginx-ingress-controller. - \"ingress-controller-leader-nginx\" verbs: - get - update - apiGroups: - \"\" resources: - configmaps verbs: - create - apiGroups: - \"\" resources: - endpoints verbs: - get---apiVersion: rbac.authorization.k8s.io/v1kind: RoleBindingmetadata: name: nginx-ingress-role-nisa-binding namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxroleRef: apiGroup: rbac.authorization.k8s.io kind: Role name: nginx-ingress-rolesubjects: - kind: ServiceAccount name: nginx-ingress-serviceaccount namespace: ingress-nginx---apiVersion: rbac.authorization.k8s.io/v1kind: ClusterRoleBindingmetadata: name: nginx-ingress-clusterrole-nisa-binding labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxroleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: nginx-ingress-clusterrolesubjects: - kind: ServiceAccount name: nginx-ingress-serviceaccount namespace: ingress-nginx---apiVersion: apps/v1kind: DaemonSet # 从Deployment改为DaemonSetmetadata: name: nginx-ingress-controller namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxspec: #replicas: 1 # 注释掉 selector: matchLabels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx template: metadata: labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginx annotations: prometheus.io/port: \"10254\" prometheus.io/scrape: \"true\" spec: # wait up to five minutes for the drain of connections terminationGracePeriodSeconds: 300 serviceAccountName: nginx-ingress-serviceaccount nodeSelector: kubernetes.io/os: linux # 添加 hostNetwork: true,否则无法通过 K8s 节点 IP 地址绑定域名外部访问 # ingress-controller 会直接使用 K8s 物理机的 DNS 来解析域名，而不再使用 K8s 内部的 DNS 来解析域名 hostNetwork: true containers: - name: nginx-ingress-controller image: 10.200.40.39:8080/component/nginx-ingress-controller:0.30.0 args: - /nginx-ingress-controller - --configmap=$(POD_NAMESPACE)/nginx-configuration - --tcp-services-configmap=$(POD_NAMESPACE)/tcp-services - --udp-services-configmap=$(POD_NAMESPACE)/udp-services - --publish-service=$(POD_NAMESPACE)/ingress-nginx - --annotations-prefix=nginx.ingress.kubernetes.io securityContext: allowPrivilegeEscalation: true capabilities: drop: - ALL add: - NET_BIND_SERVICE # www-data -&gt; 101 runAsUser: 101 env: - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace ports: - name: http containerPort: 80 hostPort: 80 # 添加处【可在宿主机通过该端口访问Pod】 protocol: TCP - name: https containerPort: 443 hostPort: 443 # 添加处【可在宿主机通过该端口访问Pod】 protocol: TCP livenessProbe: failureThreshold: 3 httpGet: path: /healthz port: 10254 scheme: HTTP initialDelaySeconds: 10 periodSeconds: 10 successThreshold: 1 timeoutSeconds: 10 readinessProbe: failureThreshold: 3 httpGet: path: /healthz port: 10254 scheme: HTTP periodSeconds: 10 successThreshold: 1 timeoutSeconds: 10 lifecycle: preStop: exec: command: - /wait-shutdown---apiVersion: v1kind: LimitRangemetadata: name: ingress-nginx namespace: ingress-nginx labels: app.kubernetes.io/name: ingress-nginx app.kubernetes.io/part-of: ingress-nginxspec: limits: - min: memory: 90Mi cpu: 100m type: Container ingress-nginx部署应用： kubectl apply -f mandatory.yaml 查看： kubectl get ds -n ingress-nginx -o wide kubectl get pod -n ingress-nginx -o wide 验证： kubectl get pods -n ingress-nginx 确保Ingress Controller的Pod状态为Runningingress-nginx更新先执行 kubectl delete -f mandatory.yaml 清空已安装的pod和configmap， 然后根据实际报错修改 mandatory.yaml 再 kubectl apply -f mandatory.yaml其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"K8S v1.20.6 容器之问题","slug":"2024/08/1722499285345/1722499285345","date":"2024-08-01T08:01:25.000Z","updated":"2024-08-15T06:27:18.359Z","comments":false,"path":"2024/08/1722499285345/1722499285345/","link":"","permalink":"https://www.zhuqiaolun.com/2024/08/1722499285345/1722499285345/","excerpt":"k8s","text":"镜像认证在k8s的master节点上查看镜像认证信息,集群的每个node节点都需要这个文件存在，文件目录均为一致。cat /root/.docker/config.json 1234567{ \"auths\": { \"10.200.40.39:8080\": { \"auth\": \"eWV0OnlldGVjaFNIMTIz\" } }} 私有镜像地址添加镜像地址，集群的每个node节点都需要这个文件存在，文件目录均为一致： \"insecure-registries\": [ \"http://10.200.40.39:8080\" ]完整如下： cat /etc/docker/daemon.json 123456789101112131415{ \"registry-mirrors\": [ \"https://rsbud4vc.mirror.aliyuncs.com\", \"https://registry.docker-cn.com\", \"https://docker.mirrors.ustc.edu.cn\", \"https://dockerhub.azk8s.cn\", \"http://hub-mirror.c.163.com\" ], \"exec-opts\": [ \"native.cgroupdriver=systemd\" ], \"insecure-registries\": [ \"http://10.200.40.39:8080\" ]} 加载：systemctl daemon-reload重启：systemctl restart docker kube-proxy 开启 ipvs修改ConfigMap的kube-system/kube-proxy中的config.conf，把 mode: “” 改为mode: “ipvs” 保存退出即可 123456789101112131415161718192021222324252627282930~]# kubectl edit cm kube-proxy -n kube-system###操作如下图(20240802151240)###删除之前的proxy pod~]# kubectl get pod -n kube-system |grep kube-proxy |awk '{system(\"kubectl delete pod \"$1\" -n kube-system\")}'pod \"kube-proxy-4p8s9\" deletedpod \"kube-proxy-9jr4z\" deletedpod \"kube-proxy-vnfqx\" deleted#查看proxy运行状态~]# kubectl get pod -n kube-system | grep kube-proxykube-proxy-n6brs 1/1 Running 0 96skube-proxy-tlp8h 1/1 Running 0 113skube-proxy-xnmjd 1/1 Running 0 117s#查看日志,如果有 `Using ipvs Proxier.` 说明kube-proxy的ipvs 开启成功!~]# kubectl logs kube-proxy-xnmjd -n kube-systemI0802 07:17:10.085013 1 node.go:172] Successfully retrieved node IP: 10.200.40.41I0802 07:17:10.085172 1 server_others.go:142] kube-proxy node IP is an IPv4 address (10.200.40.41), assume IPv4 operationI0802 07:17:10.934829 1 server_others.go:258] Using ipvs Proxier.E0802 07:17:10.935004 1 proxier.go:389] can't set sysctl net/ipv4/vs/conn_reuse_mode, kernel version must be at least 4.1W0802 07:17:10.935072 1 proxier.go:445] IPVS scheduler not specified, use rr by defaultI0802 07:17:10.935231 1 server.go:650] Version: v1.20.0I0802 07:17:10.939871 1 conntrack.go:52] Setting nf_conntrack_max to 131072I0802 07:17:10.947660 1 config.go:224] Starting endpoint slice config controllerI0802 07:17:10.947701 1 shared_informer.go:240] Waiting for caches to sync for endpoint slice configI0802 07:17:10.949338 1 config.go:315] Starting service config controllerI0802 07:17:10.949349 1 shared_informer.go:240] Waiting for caches to sync for service configI0802 07:17:11.049226 1 shared_informer.go:247] Caches are synced for endpoint slice configI0802 07:17:11.050451 1 shared_informer.go:247] Caches are synced for service config default-http-backend解决 kubectl describe ingresses 内的 Default backend: default-http-backend:80 (&lt;error: endpoints \"default-http-backend\" not found&gt;)安装：kube-backend.yaml 123456789101112apiVersion: v1kind: Servicemetadata: name: default-http-backend namespace: kube-systemspec: selector: app: ingress-nginx-controller ports: - protocol: TCP port: 80 targetPort: 80 应用：kubectl apply -f kube-backend.yaml Pod状态解释1234567891011121314151617181920CrashLoopBackOff 容器退出，kubelet正在将它重启InvalidImageName 无法解析镜像名称ImageInspectError 无法校验镜像ErrImageNeverPul 策略禁止拉取镜像ImagePullBackOff 正在重试拉取RegistryUnavailable 连接不到镜像中心ErrImagePull 通用的拉取镜像出错CreateContainerConfigError 不能创建kubelet使用的容器配置CreateContainerError 创建容器失败m.internalLifecycle.PreStartContainer 执行hook报错RunContainerError 启动容器失败PostStartHookError 执行hook报错ContainersNotInitialized 容器没有初始化完毕ContainersNotReady 容器没有准备完毕ContainerCreating 容器创建中PodInitializing pod 初始化中DockerDaemonNotReady docker还没有完全启动NetworkPluginNotReady 网络插件还没有完全启动Evicted 即驱赶的意思，意思是当节点出现异常时，kubernetes将有相应的机制驱赶该节点上的Pod。 多见于资源不足时导致的驱赶。 命令解释12345678910服务器版本：kubectl version --short查看名称空间：kubectl get ns查看指定名称空间资源：kubectl get all -n default列出所有运行的Pod信息：kubectl get pods列出Pod以及运行Pod节点信息：kubectl get pods -o wide列出所有replication controllers和service信息：kubectl get rc,services 参考Kubernetes中文社区 | 中文文档 其他K8S v1.20.6 容器之问题K8S v1.20.6 容器之安装：ingress-nginx-0.30.0K8S v1.20.6 容器之部署：openjdk-11K8S v1.20.6 容器之部署：SpringBoot（Jar运行）K8S v1.20.6 容器之部署：Nginx1.21.5K8S v1.20.6 容器之部署：Tomcat9.0.56K8S v1.20.6 容器之部署：MySql5.6.51K8S v1.20.6 容器之部署：MySql8.0.27K8S v1.20.6 容器之部署：Redis3.2.10（单机）K8S v1.20.6 容器之部署：RabbitMq3.9.11（单机） document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"}],"tags":[{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"}]},{"title":"OkHttp3 工具类","slug":"2024/06/1718257945709/1718257945709","date":"2024-06-13T05:52:25.000Z","updated":"2024-08-05T06:35:18.236Z","comments":false,"path":"2024/06/1718257945709/1718257945709/","link":"","permalink":"https://www.zhuqiaolun.com/2024/06/1718257945709/1718257945709/","excerpt":"OkHttpClientUtil","text":"对请求的封装：可以进行https请求，重试次数， 依赖12345&lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;3.9.1&lt;/version&gt;&lt;/dependency&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137package com.demon.util;import okhttp3.*;import javax.net.ssl.SSLContext;import javax.net.ssl.SSLSocketFactory;import javax.net.ssl.TrustManager;import javax.net.ssl.X509TrustManager;import java.io.IOException;import java.io.InputStream;import java.security.KeyManagementException;import java.security.NoSuchAlgorithmException;import java.security.SecureRandom;import java.security.cert.X509Certificate;import java.util.concurrent.TimeUnit;/** * author ：demon * date ：2023 2023/3/5 13:28 * desc ： */public class OkHttpClientUtil { public static String post(Headers.Builder headerBuilder, String url, String content) throws Exception { // 执行POST(body)请求 - &gt; 请问完成后 自动关闭连接 try (Response response = getOkHttpClient() .newCall(new Request.Builder() .url(url) .headers(headerBuilder.build()) .post(RequestBody.create(MediaType.parse(\"application/json;charset=utf-8\"), content)) .build()).execute()) { if (response.isSuccessful()) { ResponseBody body = response.body(); System.out.println(\"响应的Code：\" + response.code()); if (body != null) { String bodyString = body.string(); System.out.println(\"响应的内容：\" + bodyString); return bodyString; } throw new Exception(\"返回内容为空\"); } else { throw new Exception(\"请求错误，response code:\" + response.code()); } } catch (IOException e) { throw new IOException(e); } } public static InputStream downloadFile(String url) throws IOException, NoSuchAlgorithmException, KeyManagementException { // 发起请求得到请求结果 Response response = getOkHttpClient().newCall(new Request.Builder().url(url).get().build()).execute(); // 获取请求结果 ResponseBody responseBody = response.body(); if (null != responseBody) { // 获取文件后缀类型 可以使用 responseBody.contentType() 获取 ContentType，我这边知道这个url文件的类型 // 获取请求结果输入流 return responseBody.byteStream(); } response.close(); return null; } private static OkHttpClient getOkHttpClient() throws KeyManagementException, NoSuchAlgorithmException { return new OkHttpClient.Builder() // 设置连接时间10分钟 - &gt;三次握手 + SSL建立耗时 .connectTimeout(60 * 10, TimeUnit.SECONDS) // 设置写入时间60秒 .writeTimeout(60, TimeUnit.SECONDS) // 设置读取时间60秒 .readTimeout(60, TimeUnit.SECONDS) // 添加信任HTTPS请求 .sslSocketFactory(sslSocketFactory(), x509TrustManager()) // 过滤器，设置最大重试次数 .addInterceptor(new OkHttpInterceptor(3)) // 不自动重连 .retryOnConnectionFailure(false).build(); } private static SSLSocketFactory sslSocketFactory() throws NoSuchAlgorithmException, KeyManagementException { // 信任任何链接 SSLContext sslContext = SSLContext.getInstance(\"TLS\"); sslContext.init(null, new TrustManager[]{x509TrustManager()}, new SecureRandom()); return sslContext.getSocketFactory(); } private static X509TrustManager x509TrustManager() { return new X509TrustManager() { @Override public void checkClientTrusted(X509Certificate[] x509Certificates, String s) { } @Override public void checkServerTrusted(X509Certificate[] x509Certificates, String s) { } @Override public X509Certificate[] getAcceptedIssuers() { return new X509Certificate[0]; } }; } private static class OkHttpInterceptor implements Interceptor { // 最大重试次数 private int maxRetry; OkHttpInterceptor(int maxRetry) { this.maxRetry = maxRetry; } @SuppressWarnings(\"NullableProblems\") @Override public Response intercept(Chain chain) { /* 递归 4次下发请求，如果仍然失败 则返回 null ,但是 intercept must not return null. * 返回 null 会报 IllegalStateException 异常 */ return retry(chain, 0); } private Response retry(Chain chain, int retryCount) { Request request = chain.request(); Response response = null; try { System.out.println(\"第\" + (retryCount + 1) + \"次执行HTTP请求···\"); response = chain.proceed(request); } catch (Exception e) { if (maxRetry &gt; retryCount) { return retry(chain, retryCount + 1); } } return response; } }} 测试1234567891011121314@Testpublic void toTest() { JSONObject json = new JSONObject(); json.put(\"jobId\", \"999999999\"); try { String post = OkHttpClientUtil.post( new Headers.Builder().set(\"Content-Type\", \"application-json\").set(\"API-KEY\", \"1234567890\"), \"https://www.baidu.com/\", json.toJSONString()); System.out.println(post); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"OkHttp3","slug":"OkHttp3","permalink":"https://www.zhuqiaolun.com/tags/OkHttp3/"}]},{"title":"zxing开发之二维码","slug":"2023/09/1694141476592/1694141476592","date":"2023-09-08T02:51:16.000Z","updated":"2023-09-11T03:20:46.582Z","comments":false,"path":"2023/09/1694141476592/1694141476592/","link":"","permalink":"https://www.zhuqiaolun.com/2023/09/1694141476592/1694141476592/","excerpt":"二维码生成","text":"ZXing是Google开发的用于Java，Android的条形码扫描库。 依赖12345678910&lt;dependency&gt; &lt;groupId&gt;com.google.zxing&lt;/groupId&gt; &lt;artifactId&gt;javase&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.google.zxing&lt;/groupId&gt; &lt;artifactId&gt;core&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt;&lt;/dependency&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198package com.yetech.hello.util;import com.google.zxing.BarcodeFormat;import com.google.zxing.EncodeHintType;import com.google.zxing.MultiFormatWriter;import com.google.zxing.WriterException;import com.google.zxing.client.j2se.MatrixToImageConfig;import com.google.zxing.common.BitMatrix;import com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;import javax.imageio.ImageIO;import java.awt.*;import java.awt.geom.RoundRectangle2D;import java.awt.image.BufferedImage;import java.io.FileInputStream;import java.io.IOException;import java.io.InputStream;import java.util.LinkedHashMap;import java.util.Map;/** * 参考 https://www.wetools.com/qrcode */public class QrCodeUtil { // 二维码内容 private String content; // 二维码大小-宽 private int qrWidth; // 二维码大小-高 private int qrHeight; // 二维码边框-内边距 private int qrMargin = 0; // 二维码前景色 private Color onColor = new Color(0, 0, 0); // 二维码背景色 private Color offColor = new Color(255, 255, 255); // Logo private InputStream logoPath; // Logo 边框宽度 private int logoBorder = 0; // Logo 边框背景色 private Color logoBorderColor = Color.WHITE; // Logo 圆角大小 private int logoRoundCorner = 0; // 属性 private Map&lt;EncodeHintType, Object&gt; hints; public static QrCodeUtil Builder() { return new QrCodeUtil(); } public QrCodeUtil setHints(Map&lt;EncodeHintType, Object&gt; hints) { this.hints = hints; return this; } public QrCodeUtil setContent(String content) { this.content = content; return this; } public QrCodeUtil setSize(int width, int height) { this.qrWidth = width; this.qrHeight = height; return this; } public QrCodeUtil setColor(Color onColor, Color offColor) { this.onColor = onColor; this.offColor = offColor; return this; } public QrCodeUtil setMargin(int margin) { this.qrMargin = margin; return this; } public QrCodeUtil setLogo(FileInputStream logoPath) { this.logoPath = logoPath; return this; } public QrCodeUtil setLogoBorder(int logoBorder, Color logoBorderColor) { this.logoBorder = logoBorder; this.logoBorderColor = logoBorderColor; return this; } public QrCodeUtil setLogoRoundCorner(int logoRoundCorner) { this.logoRoundCorner = logoRoundCorner; return this; } // 创建二维码 ImageIO.write(bufferedImage, \"png\", outFile); public BufferedImage create() throws WriterException { try { if (this.hints == null) { this.hints = new LinkedHashMap&lt;&gt;(3); //设置容错等级 this.hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H); //定义字符集，我们设置为utf-8 this.hints.put(EncodeHintType.CHARACTER_SET, \"UTF-8\"); //设置边距，二维码边距空白宽度为0 this.hints.put(EncodeHintType.MARGIN, 0); } // 添加 hintType BufferedImage bufferedImage = this.getBufferedImage(this.hints); // 添加 logo this.drawLogo(bufferedImage); // 生成二维码图片 return bufferedImage; } catch (WriterException e) { System.out.println(\"生成二维码异常:\" + e.getMessage()); throw new WriterException(e); } } private void drawLogo(BufferedImage image) { if (this.logoPath != null) { // 读取二维码图片，并构建绘图对象 Graphics2D graphics2D = image.createGraphics(); int imageWidth = image.getWidth(), imageHeight = image.getHeight(); // 设置消除锯齿 graphics2D.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON); graphics2D.setComposite(AlphaComposite.getInstance(AlphaComposite.SRC_ATOP)); try { // 读取logo图片 BufferedImage logo = ImageIO.read(this.logoPath); // 设置logo的大小,设置为二维码图片的20%,因为过大会盖掉二维码 int logoWidth = logo.getWidth(null) &gt; imageWidth * 3 / 10 ? (imageWidth * 3 / 10) : logo.getWidth(null); int logoHeight = logo.getHeight(null) &gt; imageHeight * 3 / 10 ? (imageHeight * 3 / 10) : logo.getWidth(null); // 定义logo位置x,y 放在中心, int x = (imageWidth - logoWidth) / 2, y = (imageHeight - logoHeight) / 2; // 设置logo 有一道边框 宽度（其实就是画一块贴面） graphics2D.setStroke(new BasicStroke(this.logoBorder, BasicStroke.CAP_ROUND, BasicStroke.JOIN_ROUND)); // logo边框颜色 graphics2D.setColor(this.logoBorderColor); // logo边框弧形 graphics2D.draw(new RoundRectangle2D.Float(x, y, logoWidth, logoHeight, this.logoRoundCorner, this.logoRoundCorner)); // 绘制LOGO圆弧矩形 graphics2D.setClip(new RoundRectangle2D.Float(x, y, logoWidth, logoHeight, this.logoRoundCorner, this.logoRoundCorner)); // 开始绘制LOGO到二维码上 graphics2D.drawImage(logo, x, y, logoWidth, logoHeight, null); } catch (IOException e) { e.printStackTrace(); } finally { //释放资源 graphics2D.dispose(); } } } // 绘制二维码图片流 private BufferedImage getBufferedImage(Map&lt;EncodeHintType, Object&gt; hints) throws WriterException { // 生成矩阵 BitMatrix bitMatrix = new MultiFormatWriter().encode(this.content, BarcodeFormat.QR_CODE, this.qrWidth, this.qrHeight, hints); // 更新白边边框 让生成的二维码在图片属性上跟我们设置的图片大小size一致 BitMatrix bitMatrixUpdate = this.updateBitMatrix(bitMatrix, this.qrMargin); // 是否设置二维码背景色/前景色 MatrixToImageConfig matrixToImageConfig = new MatrixToImageConfig(this.onColor.getRGB(), this.offColor.getRGB()); // 生成二维码对象 int matrixUpdateWidth = bitMatrixUpdate.getWidth(), matrixUpdateHeight = bitMatrixUpdate.getHeight(); BufferedImage bufferedImage = new BufferedImage(matrixUpdateWidth, matrixUpdateHeight, BufferedImage.TYPE_INT_ARGB); for (int x = 0; x &lt; matrixUpdateWidth; x++) { for (int y = 0; y &lt; matrixUpdateHeight; y++) { bufferedImage.setRGB(x, y, bitMatrixUpdate.get(x, y) ? matrixToImageConfig.getPixelOnColor() : matrixToImageConfig.getPixelOffColor()); } } // 根据size放大、缩小生成的二维码 BufferedImage newImage = new BufferedImage(this.qrWidth, this.qrHeight, bufferedImage.getType()); Graphics g = newImage.getGraphics(); g.drawImage(bufferedImage, 0, 0, this.qrWidth, this.qrHeight, null); g.dispose(); return newImage; } // 因为二维码边框设置那里不起作用，不管设置多少，都会生成白边，所以需要自定义控制白边宽度， // 该方法生成自定义白边框后的bitMatrix private BitMatrix updateBitMatrix(BitMatrix matrix, int margin) { int tempM = margin * 2; int[] rec = matrix.getEnclosingRectangle(); // 获取二维码图案的属性 int resWidth = rec[2] + tempM; int resHeight = rec[3] + tempM; BitMatrix resMatrix = new BitMatrix(resWidth, resHeight); // 按照自定义边框生成新的BitMatrix resMatrix.clear(); for (int i = margin; i &lt; resWidth - margin; i++) { // 循环，将二维码图案绘制到新的bitMatrix中 for (int j = margin; j &lt; resHeight - margin; j++) { if (matrix.get(i - margin + rec[0], j - margin + rec[1])) { resMatrix.set(i, j); } } } return resMatrix; }} 生成普通二维码12345678Map&lt;EncodeHintType, Object&gt; hints = new LinkedHashMap&lt;&gt;();hints.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.H);//定义字符集，我们设置为utf-8hints.put(EncodeHintType.CHARACTER_SET, \"UTF-8\");ImageIO.write(QrCodeUtil.Builder().setContent(\"普通二维码\") .setSize(300, 300) .setHints(hints) .create(), \"png\", new File(\"E:\\\\qrcode\\\\zxingNormal.png\")); 彩色二维码12345678910// 设置颜色1ImageIO.write(QrCodeUtil.Builder().setContent(\"黑白二维码\") .setSize(300, 300) .setColor(new Color(0, 0, 0), new Color(255, 255, 255)) .create(), \"png\", new File(\"E:\\\\qrcode\\\\zxingNorma2.png\"));// 设置颜色2ImageIO.write(QrCodeUtil.Builder().setContent(\"彩色二维码\") .setSize(300, 300) .setColor(new Color(255, 0, 0), new Color(0, 0, 255)) .create(), \"png\", new File(\"E:\\\\qrcode\\\\zxingNorma3.png\")); LOGO二维码12345ImageIO.write(QrCodeUtil.Builder().setContent(\"LOGO二维码\") .setSize(300, 300).setMargin(0) .setLogo(new FileInputStream(new File(\"E:\\\\qrcode\\\\logo.png\"))) .setLogoBorder(10, Color.RED).setLogoRoundCorner(10) .create(), \"png\", new File(\"E:\\\\qrcode\\\\zxingNorma4.png\")); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"QR","slug":"QR","permalink":"https://www.zhuqiaolun.com/tags/QR/"}]},{"title":"JetBrains的IDE中EvalReset的使用(重置试用期)","slug":"2023/08/1693278562635/1693278562635","date":"2023-08-29T03:09:22.000Z","updated":"2024-08-16T08:23:54.788Z","comments":false,"path":"2023/08/1693278562635/1693278562635/","link":"","permalink":"https://www.zhuqiaolun.com/2023/08/1693278562635/1693278562635/","excerpt":"JetBrains的IDE中EvalReset的使用","text":"激活分 在线激活 和 离线激活 2种方式 在线激活IDE工具左上角 File -&gt; Setting -&gt; plugins -&gt; 点设置并且选择 Manage Plugin Repositories 在出现的弹窗中点“+”并且将 https://plugins.zhile.io 添加，然后点击 OK 在搜索框搜索 IDE Eval Reset，然后点击 Install， 弹出窗点击 Accept download…完成后，出现 Restart IDE， 点击重启 重启后打开在help中就会出现 Eval Reset 选项 操作顺序：1.勾选【Auto reset before per restart】则自动重置，重置是静默无感知的2.按钮【Reload】用来刷新界面上的显示信息3.按钮【Reset】点击会询问是否重置试用信息并重启IDE，选择Yes则执行重置操作并重启IDE生效，此为手动重置方式 离线激活下载激活插件下载地址：https://plugins.zhile.io/files/ide-eval-resetter-2.1.6.zip,下载完成后，建议放到IDE软件安装的同级目录下（不要解压） 安装插件IDE工具左上角 File -&gt; Setting -&gt; plugins -&gt; 点设置并且选择 Install Plugin From Disk… 加载插件在弹出来的窗口中选择之前的zip文件，点击应用OK后，重启 激活操作顺序：1.勾选【Auto reset before per restart】则自动重置，重置是静默无感知的2.按钮【Reload】用来刷新界面上的显示信息3.按钮【Reset】点击会询问是否重置试用信息并重启IDE，选择Yes则执行重置操作并重启IDE生效，此为手动重置方式 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"IDEA","slug":"IDEA","permalink":"https://www.zhuqiaolun.com/categories/IDEA/"}],"tags":[{"name":"IDEA","slug":"IDEA","permalink":"https://www.zhuqiaolun.com/tags/IDEA/"}]},{"title":"绿色版Tomcat注册Windows服务并开机自启","slug":"2023/07/1690268890686/1690268890686","date":"2023-07-25T07:08:10.000Z","updated":"2023-07-25T08:13:16.164Z","comments":false,"path":"2023/07/1690268890686/1690268890686/","link":"","permalink":"https://www.zhuqiaolun.com/2023/07/1690268890686/1690268890686/","excerpt":"在Windows中配置Tomcat服务","text":"下载文件列表目录：https://archive.apache.org/dist/tomcat/下载路径：https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.8/bin/apache-tomcat-9.0.8-windows-x64.zip 下载时需下载Windows版的，下载zip版没有tomcat9w.exe文件 修改TITLE通过 startup.bat 运行可看见TITLE 注册服务假设服务名为：Tomcat_8080 配置环境变量 CATALINA_HOME，并在Path中添加 %CATALINA_HOME%\\bin 修改文件名： tomcat9.exe -&gt; Tomcat_8080.exe tomcat9w.exe -&gt; Tomcat_8080w.exe 修改service.bat文件内容： 将《tomcat9.exe》 统一变成：《Tomcat_8080.exe》 进入tomcat根目录下的bin目录下cmd，输入安装命令service.bat install Tomcat_8080 设置服务启动类型，调整为自动 双击打开 Tomcat_8080w.exe 即可通过界面启动Tomcat_8080.exe是可执行程序，用来启动tomcat服务。Tomcat_8080w.exe是tomcat可视化管理客户端界面，可以设置启动，关闭，开机自启tomcat等。Tomcat_8080w.Tomcat_8080w.exe都需要tomcat的环境变量CATALINA_HOME和向Windows注册tomcat服务的支持Tomcat_8080w.exe界面如下： 删除服务模式：service.bat uninstall tomcat服务名示例：service.bat uninstall Tomcat_8080 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"XML操作之dom4j","slug":"2023/07/1688699772517/1688699772517","date":"2023-07-07T03:16:12.000Z","updated":"2024-11-13T09:08:08.177Z","comments":false,"path":"2023/07/1688699772517/1688699772517/","link":"","permalink":"https://www.zhuqiaolun.com/2023/07/1688699772517/1688699772517/","excerpt":"XML操作","text":"依赖12345678910&lt;dependency&gt; &lt;groupId&gt;dom4j&lt;/groupId&gt; &lt;artifactId&gt;dom4j&lt;/artifactId&gt; &lt;version&gt;1.6.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;jaxen&lt;/groupId&gt; &lt;artifactId&gt;jaxen&lt;/artifactId&gt; &lt;version&gt;1.2.0&lt;/version&gt;&lt;/dependency&gt; dom4j:解析，生成jaxen:查找节点 读取XML样例1234567891011&lt;root&gt; &lt;head&gt; &lt;accessToken&gt;token&lt;/accessToken&gt; &lt;/head&gt; &lt;body&gt; &lt;request&gt; &lt;param id='123' age='18'&gt;张三&lt;/param&gt; &lt;param id='456' age='20'&gt;李四&lt;/param&gt; &lt;/request&gt; &lt;/body&gt;&lt;/root&gt; 读取xml文件12Document document = new SAXReader().read(filePath);Element rootElement = document.getRootElement(); 读取xml字符串12Document document = DocumentHelper.parseText(xmlStr);Element rootElement = document.getRootElement(); 解析解析属性1String attributeKey = rootElement.attributeValue(\"attributeKey\"); 解析下级节点1Element ele = rootElement.element(\"elementName\") 迭代下级节点(多个)12345Iterator&lt;Element&gt; rootIter = root.elementIterator(); while (rootIter.hasNext()) { Element ele = rootIter.next(); System.out.println(ele.getName());} 查找12单节点：String accessToken = rootElement.selectSingleNode(\"/root/head/accessToken\").getStringValue(); 多节点：List param = root.selectNodes(\"/root/body/request/param\"); 生成生成xml文档1234567891011// 创建一个Document实例Document document = DocumentHelper.createDocument();Element rootEle = document.addElement(\"root\");Element headEle = rootEle.addElement(\"head\");headEle.addElement(\"accessToken\").addText(\"token\");Element bodyEle = rootEle.addElement(\"body\");Element requestEle = bodyEle.addElement(\"request\");requestEle.addElement(\"param\").addAttribute(\"id\",\"123\").addAttribute(\"age\",\"18\").addText(\"张三\");requestEle.addElement(\"param\").addAttribute(\"id\",\"124\").addAttribute(\"age\",\"20\").addText(\"李四\"); 输出xml字符串1String str = document.asXML(); 输出xml文件展开格式：OutputFormat format = OutputFormat.createPrettyPrint();压缩格式：OutputFormat format = OutputFormat.createCompactFormat(); 1234567// 自定义xml样式OutputFormat format = new OutputFormat();format.setEncoding(\"UTF-8\");format.setNewLineAfterDeclaration(false); // 放置xml文件中第二行为空白行// 输出xml文件XMLWriter writer = new XMLWriter(new FileOutputStream(filePath), format);writer.write(document); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Xml","slug":"Xml","permalink":"https://www.zhuqiaolun.com/tags/Xml/"}]},{"title":"json数据的转换（Jackson）","slug":"2022/08/1661331439912/1661331439912","date":"2022-08-24T08:57:19.000Z","updated":"2023-09-11T05:17:55.430Z","comments":false,"path":"2022/08/1661331439912/1661331439912/","link":"","permalink":"https://www.zhuqiaolun.com/2022/08/1661331439912/1661331439912/","excerpt":"Json数据的转换","text":"ObjectMapperUtil 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.type.ArrayType;import com.fasterxml.jackson.databind.type.CollectionType;import com.fasterxml.jackson.databind.type.MapType;import java.util.ArrayList;import java.util.List;import java.util.Map;/** * author ：demon * date ：2022 2022/4/5 14:42 * desc ：Json格式的数据转换 */public class JsonDataConvertUtil { /** * 对象转json字符串 * eg：实体对象、Map对象、数组、集合 */ public static String convertJsonStr(Object object) throws RuntimeException { try { return ObjectMapperUtil.getInstance().getObjectMapper().writeValueAsString(object); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } } /** * json字符串转对象 * eg：实体类 */ public static &lt;T&gt; T convertObj(String jsonStr, Class&lt;T&gt; cls) throws RuntimeException { try { ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper(); return objectMapper.readValue(jsonStr, cls); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } } /** * json字符串转Map * eg：key:字符串，value:对象 */ public static Map&lt;String, Object&gt; convertMap(String jsonStr) throws RuntimeException { try { ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper(); MapType mapType = objectMapper.getTypeFactory().constructMapType(Map.class, String.class, Object.class); return objectMapper.readValue(jsonStr, mapType); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } } /** * json字符串转集合对象 */ public static List&lt;String&gt; convertList(String jsonStr) throws RuntimeException { try { ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper(); ArrayType arrayType = objectMapper.getTypeFactory().constructArrayType(String.class); return objectMapper.readValue(jsonStr, arrayType); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } } /** * json字符串转对象数组 * eg：List&lt;object&gt; */ public static &lt;T&gt; List&lt;T&gt; convertListObj(String jsonStr, Class&lt;T&gt; cls) throws RuntimeException { try { ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper(); CollectionType listType = objectMapper.getTypeFactory().constructCollectionType(ArrayList.class, cls); return objectMapper.readValue(jsonStr, listType); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } } /** * json字符串转Map数组 * eg：List&lt;Map&lt;String,Object&gt;&gt; */ public static List&lt;Map&lt;String, Object&gt;&gt; convertListMap(String jsonStr) throws RuntimeException { try { ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper(); CollectionType listType = objectMapper.getTypeFactory().constructCollectionType(ArrayList.class, Map.class); return objectMapper.readValue(jsonStr, listType); } catch (Exception e) { throw new RuntimeException(\"格式化JSON字符串异常\", e); } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Json","slug":"Json","permalink":"https://www.zhuqiaolun.com/tags/Json/"}]},{"title":"Map的链式操作","slug":"2022/08/1661321528152/1661321528152","date":"2022-08-24T06:12:08.000Z","updated":"2022-08-24T08:56:34.650Z","comments":false,"path":"2022/08/1661321528152/1661321528152/","link":"","permalink":"https://www.zhuqiaolun.com/2022/08/1661321528152/1661321528152/","excerpt":"Map的链式操作","text":"创建Map数据：new HashMap&lt;&gt;()，new LinkedHashMap&lt;&gt;(); 示例12345678910Map&lt;String, String&gt; params1 = new MapDataUtil&lt;String, String&gt;().of().get();Map&lt;String, String&gt; params2 = new MapDataUtil&lt;String, String&gt;().of(true).get();Map&lt;Integer, Integer&gt; params3 = new MapDataUtil&lt;Integer, Integer&gt;().of().get();Map&lt;Integer, Integer&gt; params4 = new MapDataUtil&lt;Integer, Integer&gt;().of(true).get();Map&lt;Object, Object&gt; params5 = new MapDataUtil&lt;Object, Object&gt;().of().get();Map&lt;Object, Object&gt; params6 = new MapDataUtil&lt;Object, Object&gt;().of(true).get();Map&lt;Object, Object&gt; objectMap2 = MapDataUtil.builder().get(); 全部代码1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586import java.util.HashMap;import java.util.LinkedHashMap;import java.util.Map;/** * author ：demon * date ：2022 2022/4/5 15:45 * desc ：创建Map数据 * &lt;p&gt; * 使用：order:创建是否排序 * &lt;p&gt; * 1：Map&lt;String, Object&gt; objectMap1 = new MapDataUtil&lt;String, Object&gt;().of().put(\"a\", \"1\").put(\"b\", 1).get(); * &lt;p&gt; * 2：Map&lt;Object, Object&gt; objectMap2 = MapDataUtil.builder().put(\"a\", \"1\").put(\"b\", 1).get(); */public class MapDataUtil&lt;K, V&gt; { /** * 返回指定类型的Map结构 * 无序 */ public static &lt;K, V&gt; Builder&lt;K, V&gt; builder() { return new Builder&lt;&gt;(false); } /** * 返回指定类型的Map结构 * 有序 */ public static &lt;K, V&gt; Builder&lt;K, V&gt; builder(boolean order) { return new Builder&lt;&gt;(order); } /** * 返回指定类型的Map结构 * 无序 */ public Builder&lt;K, V&gt; of() { return new Builder&lt;&gt;(false); } /** * 返回指定类型的Map结构 * 有序 */ public Builder&lt;K, V&gt; of(boolean order) { return new Builder&lt;&gt;(order); } /** * 构建Map结构数据 */ public static final class Builder&lt;K, V&gt; { private Map&lt;K, V&gt; map; private boolean underConstruction; private Builder(boolean order) { if (order) { map = new LinkedHashMap&lt;&gt;(); } else { map = new HashMap&lt;&gt;(); } underConstruction = true; } public Builder&lt;K, V&gt; put(K k, V v) { if (!underConstruction) { throw new IllegalStateException(\"Map已经初始化，不可重复创建！！\"); } map.put(k, v); return this; } public Map&lt;K, V&gt; get() { if (!underConstruction) { throw new IllegalStateException(\"Map已经初始化，不可重复创建！！\"); } underConstruction = false; return map; } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Map","slug":"Map","permalink":"https://www.zhuqiaolun.com/tags/Map/"}]},{"title":"SpringBoot之自定义MyBatis-Plus配置","slug":"2022/03/1648110385163/1648110385163","date":"2022-03-24T08:26:25.000Z","updated":"2022-08-24T09:04:10.462Z","comments":false,"path":"2022/03/1648110385163/1648110385163/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1648110385163/1648110385163/","excerpt":"SpringBoot之自定义MyBatis-Plus配置","text":"修改原生的YML配置，采取自定义模式， 依赖123456789101112131415161718192021222324252627282930313233343536373839&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;skipTests&gt;true&lt;/skipTests&gt; &lt;spring-boot.version&gt;2.4.2&lt;/spring-boot.version&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;!-- 数据库 连接 、事务--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- 数据库 mybatis--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 数据库 mysql--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.25&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 数据库 sqlite --&gt; &lt;dependency&gt; &lt;groupId&gt;org.xerial&lt;/groupId&gt; &lt;artifactId&gt;sqlite-jdbc&lt;/artifactId&gt; &lt;version&gt;3.27.2.1&lt;/version&gt; &lt;/dependency&gt; &lt;!-- 数据库 oracle --&gt; &lt;dependency&gt; &lt;groupId&gt;com.oracle&lt;/groupId&gt; &lt;artifactId&gt;ojdbc6&lt;/artifactId&gt; &lt;version&gt;12.1.0.1-atlassian-hosted&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 配置创建Bean的注入方式，使用 @ConditionalOnMissingClass 注解 进行判断bean是否存在，如不存在则加载当前默认bean，如存在则使用配置bean. MybatisDataConfig 12345678910111213141516171819202122232425262728293031import lombok.Data;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;import org.springframework.stereotype.Component;/** * author ：demon * date ：2022 2022/3/18 15:41 * desc ：自定义bean */@Data@Component(value = \"mybatisDataConfig\")@ConditionalOnMissingClass(value = \"mybatisDataConfig\")public class MybatisDataConfig { private String driverClassName; private String jdbcUrl; private String username; private String password; private String poolName = \"DataSource_HikariCP\"; private long connectionTimeoutMs = 30000; private long idleTimeoutMs = 300000; private long validationTimeoutMs = 5000; private long maxLifetimeMs = 1800000; private int maxPoolSize = 20; private int minIdle = 5; private String typeAliasesPackage = \"**.database.entity\"; private String locationPattern = \"classpath*:/mapper/*Mapper.xml\";} DataSourceConfig 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import com.zaxxer.hikari.HikariConfig;import com.zaxxer.hikari.HikariDataSource;import lombok.extern.slf4j.Slf4j;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Primary;import org.springframework.stereotype.Component;import javax.annotation.Resource;import javax.sql.DataSource;/** * author ：demon * date ：2021 2021/8/27 13:54 * desc ：数据库 */@Slf4j@Componentpublic class DataSourceConfig { @Resource(name = \"mybatisDataConfig\") private MybatisDataConfig mybatisDataConfig; @Bean(name = \"dataSource\") @Primary public DataSource getDataSource() { System.out.println(\"★★★★★配置 dataSource ★★★★★\"); HikariConfig hikariConfig = new HikariConfig(); hikariConfig.setDriverClassName(mybatisDataConfig.getDriverClassName()); hikariConfig.setJdbcUrl(mybatisDataConfig.getJdbcUrl()); hikariConfig.setUsername(mybatisDataConfig.getUsername()); hikariConfig.setPassword(mybatisDataConfig.getPassword()); // 自定义连接池名称 hikariConfig.setPoolName(mybatisDataConfig.getPoolName()); hikariConfig.setReadOnly(false); // 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQLException， 缺省:30秒 hikariConfig.setConnectionTimeout(mybatisDataConfig.getConnectionTimeoutMs()); // 一个连接idle状态的最大时长（毫秒），超时则被释放（retired），缺省:10分钟 hikariConfig.setIdleTimeout(mybatisDataConfig.getIdleTimeoutMs()); // 验证与数据库连接的有效时间 hikariConfig.setValidationTimeout(mybatisDataConfig.getValidationTimeoutMs()); // 建议设置比数据库超时时长少30秒，参考MySQL wait_timeout参数（show variables like '%timeout%';） hikariConfig.setMaxLifetime(mybatisDataConfig.getMaxLifetimeMs()); // 连接池中允许的最大连接数。缺省值：10；推荐的公式：((core_count * 2) + effective_spindle_count) hikariConfig.setMaximumPoolSize(mybatisDataConfig.getMaxPoolSize()); // 连接池中维护的最小空闲连接数 hikariConfig.setMinimumIdle(mybatisDataConfig.getMinIdle()); // 从池返回的连接的默认自动提交行为。默认值为true hikariConfig.setAutoCommit(true); // 如果您的驱动程序支持JDBC4，我们强烈建议您不要设置此属性 hikariConfig.setConnectionTestQuery(\"SELECT 1\"); return new HikariDataSource(hikariConfig); }} MybatisPlusConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108import com.baomidou.mybatisplus.annotation.IdType;import com.baomidou.mybatisplus.autoconfigure.SpringBootVFS;import com.baomidou.mybatisplus.core.MybatisConfiguration;import com.baomidou.mybatisplus.core.MybatisXMLLanguageDriver;import com.baomidou.mybatisplus.core.config.GlobalConfig;import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;import com.baomidou.mybatisplus.extension.plugins.pagination.optimize.JsqlParserCountOptimize;import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;import lombok.extern.slf4j.Slf4j;import org.apache.ibatis.session.AutoMappingBehavior;import org.apache.ibatis.session.ExecutorType;import org.apache.ibatis.type.JdbcType;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Primary;import org.springframework.core.io.support.PathMatchingResourcePatternResolver;import org.springframework.stereotype.Component;import org.springframework.transaction.annotation.EnableTransactionManagement;import javax.annotation.Resource;import javax.sql.DataSource;/** * className MybatisPlusConfig * author demon * createTime 2021/5/21 18:15 * description mybatis-plus 配置 */@Slf4j@Component@EnableTransactionManagementpublic class MybatisPlusConfig { @Resource(name = \"mybatisDataConfig\") private MybatisDataConfig mybatisDataConfig; @Resource private DataSource dataSource; /** * 分页插件 * paginationInterceptor.setLimit(你的最大单页限制数量，默认 500 条，小于 0 如 -1 不受限制); */ @Bean public PaginationInterceptor paginationInterceptor() { PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求 默认false paginationInterceptor.setOverflow(true); // 设置最大单页限制数量，默认 500 条，-1 不受限制 paginationInterceptor.setLimit(-1); // 开启 count 的 join 优化,只针对部分 left join paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true)); return paginationInterceptor; } /** * 将yml配置代码化 */ @Bean @Primary public MybatisSqlSessionFactoryBean mybatisSqlSessionFactoryBean() throws Exception { //一定要使用 MybatisSqlSessionFactoryBean否则Statement not bound错误 System.out.println(\"★★★★★配置 MybatisSqlSessionFactoryBean ★★★★★\"); MybatisSqlSessionFactoryBean mybatisPlus = new MybatisSqlSessionFactoryBean(); //加载数据源 此处配置为关键配置，如果没有将 dataSource 作为数据源则不能实现切换 mybatisPlus.setDataSource(dataSource); mybatisPlus.setVfs(SpringBootVFS.class); // 配置 configuration MybatisConfiguration configuration = new MybatisConfiguration(); configuration.setDefaultScriptingLanguage(MybatisXMLLanguageDriver.class); configuration.setJdbcTypeForNull(JdbcType.NULL); // 映射器缓存 configuration.setCacheEnabled(false); // 查询时，关闭关联对象即时加载以提高性能 configuration.setLazyLoadingEnabled(false); // 不允许使用自定义的主键值(比如由程序生成的UUID 32位编码作为键值), 数据表的PK生成策略将被覆盖 configuration.setUseGeneratedKeys(false); // 对于批量更新操作缓存SQL以提高性能 SIMPLE, REUSE, BATCH configuration.setDefaultExecutorType(ExecutorType.REUSE); // 对于未知的SQL查询，允许返回不同的结果集以达到通用的效果 configuration.setMultipleResultSetsEnabled(true); // 允许使用列标签代替列名 configuration.setUseColumnLabel(true); // 解决mybatis空字段null字段不返回 configuration.setCallSettersOnNulls(true); // 给予被嵌套的resultMap以字段-属性的映射支持 NONE, FULL,PARTIAL configuration.setAutoMappingBehavior(AutoMappingBehavior.PARTIAL); // 日志 configuration.setLogImpl(org.apache.ibatis.logging.stdout.StdOutImpl.class); mybatisPlus.setConfiguration(configuration); // 添加分页功能 mybatisPlus.setPlugins(paginationInterceptor()); //加载 mybatis-plus 全局配置 GlobalConfig globalConfig = new GlobalConfig(); GlobalConfig.DbConfig dbConfig = new GlobalConfig.DbConfig(); // 默认为自增 dbConfig.setIdType(IdType.AUTO); // 全局的表前缀策略配置 globalConfig.setDbConfig(dbConfig); mybatisPlus.setGlobalConfig(globalConfig); //指定 pojo 目录 ，扫描Model mybatisPlus.setTypeAliasesPackage(mybatisDataConfig.getTypeAliasesPackage()); // Mapper包路径， 扫描映射文件 mybatisPlus.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(mybatisDataConfig.getLocationPattern())); return mybatisPlus; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"ElasticSearch-v6.8.1的集群配置","slug":"2022/03/1648106149513/1648106149513","date":"2022-03-24T07:15:49.000Z","updated":"2022-03-24T08:08:04.162Z","comments":false,"path":"2022/03/1648106149513/1648106149513/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1648106149513/1648106149513/","excerpt":"ElasticSearch-v6.8.1的集群配置","text":"单机 配置在配置文件 elasticsearch.yml 中修改以下节点由于只有2个节点的ES集群，故 discovery.zen.minimum_master_nodes 无法配置（nodes / 2 + 1） 123456# 设置节点的名称，取当前主机名node.name: ${HOSTNAME}# 设置集群的名称cluster.name: my-elasticsearch-cluster# 设置集群节点discovery.zen.ping.unicast.hosts: [\"127.0.0.2:9300\", \"127.0.0.3:9300\"] 查询节点状态 http://127.0.0.1:9200/_cluster/state/?pretty document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/tags/ElasticSearch/"}]},{"title":"Redis集群配置 - Cluster（三主三从）","slug":"2022/03/1647423664207/1647423664207","date":"2022-03-16T09:41:04.000Z","updated":"2022-03-17T08:51:18.095Z","comments":false,"path":"2022/03/1647423664207/1647423664207/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1647423664207/1647423664207/","excerpt":"Windows的Redis集群配置 - 三主三从","text":"Redis官方集群文档-中文版 环境 系统环境：Windows10 Ruby版本：Ruby31-x64 软件版本：Redis-x64-3.2.100 示例-传送门 软件均采取绿色版配置执行，由于Redis为3.x版本创建集群需要用Ruby环境，Redis5以后不需要了 准备工作 Ruby 1.下载完成后解压即可，本文采用全路径引用运行,无需配置环境变量 2.安装Redis的驱动，考虑到兼容性，这里下载的是 3.2.2 版本，复制文件到rubyinstaller-3.1.1-1-x64\\bin目录下，在该目录下执行cmd命令：gem install –local redis-3.2.2.gem12345D:\\rubyinstaller-3.1.1-1-x64\\bin&gt;gem install --local redis-3.2.2.gemSuccessfully installed redis-3.2.2Parsing documentation for redis-3.2.2Done installing documentation for redis after 1 seconds1 gem installed Redis 1.下载完成后解压即可， 2.下载Redis集群管理工具 redis-trib.rb，复制到 Redis-x64-3.2.100 同级目录下 配置Redis集群需要至少3个以上节点，低于3个无法创建。将下载到的 Redis-x64-3.2.100.zip 解压即可，为了方便使用，建议放在盘符根目录下，如：D:\\Redis-Cluster\\Redis-x64-3.2.100。通过配置文件来启动6个不同的Redis实例，由于Redis默认端口为6379，所以这里使用了6380、6381、6382、6383、6384、6385来运行6个Redis实例。 1.在Redis安装根目录下创建目录 conf、logs 2.在 conf 目录下创建编码格式为UTF-8的配置文件：redis.6380.conf、redis.6381.conf、redis.6382.conf、redis.6383.conf、redis.6384.conf、redis.6385.conf 配置文件内容均为以下内容（根据端口修改对应内容）参数说明：1234567891011121314port 6380bind 0.0.0.0loglevel noticelogfile \"logs/redis6380.log\"syslog-enabled yessyslog-ident redis6380appendfilename \"appendonly.6380.aof\"appendonly yescluster-enabled yescluster-config-file nodes.6380.confcluster-node-timeout 15000cluster-slave-validity-factor 10cluster-migration-barrier 1cluster-require-full-coverage yes 最终目录： cmd运行 运行Redis建议在 D:/Redis-Cluster/Redis-x64-3.2.100 内执行，这样数据/日志就会写在logs目录下 cd D:/Redis-Cluster/Redis-x64-3.2.100 123456redis-server.exe ./conf/redis.6380.confredis-server.exe ./conf/redis.6381.confredis-server.exe ./conf/redis.6382.confredis-server.exe ./conf/redis.6383.confredis-server.exe ./conf/redis.6384.confredis-server.exe ./conf/redis.6385.conf 创建集群create –replicas 1指定从库数量1，创建顺序三主-三从。即主-主-主-从-从-从，如果redis设置了密码则创建集群时需要添加密码信息 -a 密码 cd D:\\Redis-Cluster 1rubyinstaller-3.1.1-1-x64/bin/ruby.exe redis-trib.rb create --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385 bat运行 RedisServer - 0.集群安装Redis插件12345@echo offset root_home=%~dp0cd %root_home%rubyinstaller-3.1.1-1-x64\\bincall gem install --local redis-3.2.2.gem@pause RedisServer - 1.集群初始化12345678910@echo offtitle redis-standalone-6379set root_home=%~dp0::指定起始文件夹echo %root_home%for /R %root_home%Redis-x64-3.2.100 %%f in (appendonly.*.aof redis.*.log nodes.*.conf) do ( echo %%f del %%f)@pause RedisServer - 2.集群运行12345678910111213141516171819202122232425262728@echo offtitle redis-clusterset root_home=%~dp0cd %root_home%Redis-x64-3.2.100echo redis-cluster-6380choice /t 1 /c YN /d Ystart \"redis-cluster-6380\" redis-server.exe conf/redis.6380.confecho redis-cluster-6381choice /t 1 /c YN /d Ystart \"redis-cluster-6381\" redis-server.exe conf/redis.6381.confecho redis-cluster-6382choice /t 1 /c YN /d Ystart \"redis-cluster-6382\" redis-server.exe conf/redis.6382.confecho redis-cluster-6383choice /t 1 /c YN /d Ystart \"redis-cluster-6383\" redis-server.exe conf/redis.6383.confecho redis-cluster-6384choice /t 1 /c YN /d Ystart \"redis-cluster-6384\" redis-server.exe conf/redis.6384.confecho redis-cluster-6385choice /t 1 /c YN /d Ystart \"redis-cluster-6385\" redis-server.exe conf/redis.6385.conf RedisServer - 3.集群创建 在第一次运行即可，后续的重启无需使用1234@echo offset root_home=%~dp0call %root_home%rubyinstaller-3.1.1-1-x64\\bin\\ruby.exe redis-trib.rb create --replicas 1 127.0.0.1:6380 127.0.0.1:6381 127.0.0.1:6382 127.0.0.1:6383 127.0.0.1:6384 127.0.0.1:6385@pause 服务可将运行程序进行服务化安装 安装服务123456D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6380.conf --service-name redis6380D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6381.conf --service-name redis6381D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6382.conf --service-name redis6382D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6383.conf --service-name redis6383D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6384.conf --service-name redis6384D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-install D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6385.conf --service-name redis6385 卸载服务123456D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6380.conf --service-name redis6380D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6381.conf --service-name redis6381D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6382.conf --service-name redis6382D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6383.conf --service-name redis6383D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6384.conf --service-name redis6384D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-uninstall D:/Redis-Cluster/Redis-x64-3.2.100/conf/redis.6385.conf --service-name redis6385 启动服务123456D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6380D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6381D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6382D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6383D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6384D:/Redis-Cluster/Redis-x64-3.2.100/redis-server.exe --service-start --service-name redis6385 参数说明1234567891011121314151617181920212223242526272829303132333435363738394041424344454647port 6380 端口号 bind 0.0.0.0 IP地址loglevel notice 日志的记录级别，notice是适合生产环境的logfile \"logs/redis6380.log\" 指定log的保持路径,默认是创建在Redis安装目录下，如果有子目录需要手动创建,如此处的logs目录syslog-enabled yes 是否使用系统日志syslog-ident redis6380 在系统日志的标识名appendfilename \"appendonly.6380.aof\" 数据保存文件appendonly: 数据的保存为aof格式 yes表示：存储方式，aof，将写操作记录保存到日志中 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。 yes表示：存储方式，aof，将写操作记录保存到日志中 cluster-enabled yes 是否开启集群 cluster-config-file nodes.6380.conf 保存节点配置,自动创建,自动更新(建议命名时加上端口号) cluster-node-timeout 15000 集群超时时间，节点超过这个时间没反应就断定是宕机 cluster-slave-validity-factor 10 该参数就是用来判断slave节点与master断线的时间是否过长。 在进行故障转移的时候全部slave都会请求申请为master，但是有些slave可能与master断开连接一段时间了导致数据过于陈旧，不应该被提升为master, 判断方法是：比较slave断开连接的时间和(node-timeout * slave-validity-factor)+ repl-ping-slave-period如果节点超时时间为三十秒, 并且slave-validity-factor为10，假设默认的repl-ping-slave-period是10秒，即如果超过310秒slave将不会尝试进行故障转移。 cluster-migration-barrier 1 master的slave数量大于该值，slave才能迁移到其他孤立master上，如这个参数被设为2，那么只有当一个主节点拥有2个可工作的从节点时，它的一个从节点才会尝试迁移。 cluster-require-full-coverage yes 集群全部的slot有节点负责，集群状态才为ok并提供服务。设置为no可以在slot没有全部分配的时候提供服务。 不建议打开该配置，这样会造成分区的时候，小分区的master一直在接受写请求，而造成很长时间数据不一致。 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询)","slug":"2022/03/1646645021846/1646645021846","date":"2022-03-07T09:23:41.000Z","updated":"2022-03-16T10:00:54.398Z","comments":false,"path":"2022/03/1646645021846/1646645021846/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646645021846/1646645021846/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的使用","text":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改) 在 ES 当中提供了 bool 查询，一个 bool 查询可以包含一个或多个查询字句，支持以下四种查询： must：必须匹配，贡献算分 should：选择性匹配，贡献算分 must_not：查询字句，必须不能匹配 filter：必须匹配，不贡献算分 查询ES索引数据_全部1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556@Testvoid 查询ES索引数据_全部() { String index = \"my_index\"; try { BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery(); // 根据_id查询 boolQueryBuilder.must(QueryBuilders.termQuery(\"_id\", \"33\")); // 精确条件(单值查询) boolQueryBuilder.must(QueryBuilders.termQuery(\"account\", \"admin\")); // 精确条件(多值查询) boolQueryBuilder.must(QueryBuilders.termsQuery(\"keyId\", Arrays.asList(\"22\", \"33\"))); // 模糊查询(查询全部) boolQueryBuilder.must(QueryBuilders.matchAllQuery()); // 模糊查询(会将搜索词分词，再与目标查询字段进行匹配，若分词中的任意一个词与目标字段匹配上，则可查询到) boolQueryBuilder.must(QueryBuilders.matchQuery(\"username\", \"临管\")); // 模糊查询(不会将搜索词分词，会精确匹配查询的短语，需要全部单词和顺序要完全一样) boolQueryBuilder.must(QueryBuilders.matchPhraseQuery(\"username\", \"时管理员\")); // 模糊查询(不会将搜索词分词，会精确匹配查询的短语，需要全部单词和顺序要完全一样同时需要前缀匹配，中英有出入) boolQueryBuilder.must(QueryBuilders.matchPhrasePrefixQuery(\"username\", \"临时管理\")); // 模糊查询(匹配搜索多个字段,minimumShouldMatch:设置匹配度， field:提升字段的得分权限,每个结果搜索出来后都会有一个得分) boolQueryBuilder.must(QueryBuilders.multiMatchQuery(\"用户\", Arrays.asList(\"username\", \"address.region\").toArray(new String[0])).minimumShouldMatch(\"50%\")); boolQueryBuilder.must(QueryBuilders.multiMatchQuery(\"浦东新区\", Arrays.asList(\"username\", \"address.location.city\").toArray(new String[0])).minimumShouldMatch(\"50%\")); // 范围值查询 lt小于value的值，小于等于是lte、大于是gt、大于等于是gte boolQueryBuilder.must(QueryBuilders.rangeQuery(\"age\").lt(30)); // 范围时间查询 lt小于value的值，小于等于是lte、大于是gt、大于等于是gte boolQueryBuilder.must(QueryBuilders.rangeQuery(\"createdTime\").lt(\"2122-12-22 12:33:33\")); // 过滤器查询(不分词查询,必须匹配，不贡献算分) boolQueryBuilder.filter(QueryBuilders.termQuery(\"account\", \"admin\")); SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder().query(boolQueryBuilder); // 设置源字段过虑,第一个参数结果集包括哪些字段，第二个参数表示结果集不包括哪些字段 String[] includes = {\"keyId\", \"username\", \"account\", \"createdTime\", \"role\",\"birthday\",\"address\",\"age\"}; String[] excludes = {\"keyId\"}; searchSourceBuilder.fetchSource(includes, excludes); // 排序(对查询后结果进行排序,DESC:倒序-从大到小,ASC:顺序-从小到大,含有优先序列) searchSourceBuilder.sort(\"age\", SortOrder.ASC).sort(\"birthday\",SortOrder.DESC); // 设置高亮(requireFieldMatch:多次段高亮需要设置为false) HighlightBuilder highlightBuilder = new HighlightBuilder(); highlightBuilder.preTags(\"&lt;tag&gt;\").postTags(\"&lt;/tag&gt;\"); highlightBuilder.field(\"account\").field(\"username\"); searchSourceBuilder.highlighter(highlightBuilder.requireFieldMatch(false)); ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index).setSearchRequest(new SearchRequest().source(searchSourceBuilder)); List&lt;Map&lt;String, Object&gt;&gt; mapList = elasticSearchService.searchDataList(elasticSearchDTO); System.out.println(JSON.toJSONString(mapList)); } catch (Exception e) { e.printStackTrace(); }} 查询ES索引数据_分页12345678910111213141516@Testvoid 查询ES索引数据_分页() { String index = \"my_index\"; try { BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery(); // 模糊查询 boolQueryBuilder.must(QueryBuilders.matchPhraseQuery(\"username\", \"管理员\")); SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder().query(boolQueryBuilder); ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO(1, 10).setEsIndex(index).setSearchRequest(new SearchRequest().source(searchSourceBuilder)); ElasticSearchPage elasticSearchPage = elasticSearchService.searchDataListPage(elasticSearchDTO); System.out.println(JSON.toJSONString(ElasticSearchListUtil.getData(elasticSearchPage))); } catch (Exception e) { e.printStackTrace(); }} 查询ES索引数据_统计1234567891011121314@Testvoid 查询ES索引数据_统计() { String index = \"my_index\"; try { BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery(); boolQueryBuilder.must(QueryBuilders.matchPhraseQuery(\"username\", \"管理员\")); ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index); elasticSearchDTO.getCountRequest().source(new SearchSourceBuilder().query(boolQueryBuilder)); System.out.println(elasticSearchService.getIndexCount(elasticSearchDTO)); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)","slug":"2022/03/1646645017427/1646645017427","date":"2022-03-07T09:23:37.000Z","updated":"2022-03-16T10:00:48.420Z","comments":false,"path":"2022/03/1646645017427/1646645017427/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646645017427/1646645017427/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的使用","text":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询) 添加ES索引数据添加ES索引单个数据123456789101112131415161718192021222324252627282930313233343536373839404142@Testvoid 添加ES索引单个数据() { String index = \"my_index\"; try { int keyId = 33; ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON); elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId)); // 数据 Map&lt;String, Object&gt; objectMap = new LinkedHashMap&lt;&gt;(); objectMap.put(\"keyId\", keyId); objectMap.put(\"account\", \"admin\"); objectMap.put(\"username\", \"管理员\"); objectMap.put(\"age\", 33); objectMap.put(\"birthday\", \"2222-12-22\"); // address Map&lt;String, Object&gt; address = new LinkedHashMap&lt;&gt;(); address.put(\"region\", \"中国\"); Map&lt;String, Object&gt; location = new LinkedHashMap&lt;&gt;(); location.put(\"province\", \"湖北省\"); location.put(\"city\", \"黄冈市\"); address.put(\"location\", location); objectMap.put(\"address\", address); // role List&lt;Map&lt;String, Object&gt;&gt; roleList = new ArrayList&lt;&gt;(); Map&lt;String, Object&gt; role_properties_attribute_1 = new LinkedHashMap&lt;&gt;(); role_properties_attribute_1.put(\"roleName\", \"角色一\"); role_properties_attribute_1.put(\"roleCode\", \"role1\"); roleList.add(role_properties_attribute_1); Map&lt;String, Object&gt; role_properties_attribute_2 = new LinkedHashMap&lt;&gt;(); role_properties_attribute_2.put(\"roleName\", \"角色二\"); role_properties_attribute_2.put(\"roleCode\", \"role2\"); roleList.add(role_properties_attribute_2); objectMap.put(\"role\", roleList); // createdTime objectMap.put(\"createdTime\", \"2222-12-22 12:33:33\"); System.out.println(JSON.toJSONString(objectMap)); elasticSearchDTO.setData(objectMap); System.out.println(elasticSearchService.insertIndexData(elasticSearchDTO)); } catch (Exception e) { e.printStackTrace(); }} 添加ES索引多个数据123456789101112131415161718192021222324252627282930313233343536373839404142434445@Testvoid 添加ES索引多个数据() { String index = \"my_index\"; try { ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setEsIndex(index).setXContentType(XContentType.JSON); // 批量数据 List&lt;ElasticSearchDTO&gt; elasticSearchDTOList = new ArrayList&lt;&gt;(); int keyId = 22; // 数据 Map&lt;String, Object&gt; objectMap = new LinkedHashMap&lt;&gt;(); objectMap.put(\"keyId\", keyId); objectMap.put(\"account\", \"user\"); objectMap.put(\"username\", \"普通用户\"); objectMap.put(\"age\", 22); objectMap.put(\"birthday\", \"2022-12-22\"); // address Map&lt;String, Object&gt; address = new LinkedHashMap&lt;&gt;(); address.put(\"region\", \"中国\"); Map&lt;String, Object&gt; location = new LinkedHashMap&lt;&gt;(); location.put(\"province\", \"上海市\"); location.put(\"city\", \"浦东新区\"); address.put(\"location\", location); objectMap.put(\"address\", address); // role List&lt;Map&lt;String, Object&gt;&gt; roleList = new ArrayList&lt;&gt;(); Map&lt;String, Object&gt; role_properties_attribute_1 = new LinkedHashMap&lt;&gt;(); role_properties_attribute_1.put(\"roleName\", \"角色三\"); role_properties_attribute_1.put(\"roleCode\", \"role3\"); roleList.add(role_properties_attribute_1); Map&lt;String, Object&gt; role_properties_attribute_2 = new LinkedHashMap&lt;&gt;(); role_properties_attribute_2.put(\"roleName\", \"角色四\"); role_properties_attribute_2.put(\"roleCode\", \"role4\"); roleList.add(role_properties_attribute_2); objectMap.put(\"role\", roleList); // createdTime objectMap.put(\"createdTime\", \"2022-12-22 12:33:33\"); // 添加单笔数据 elasticSearchDTOList.add(new ElasticSearchDTO().setEsKeyId(String.valueOf(keyId)).setData(objectMap)); // 设置批量数据 elasticSearchDTO.setBatchData(elasticSearchDTOList); System.out.println(elasticSearchService.insertIndexBatchData(elasticSearchDTO)); } catch (Exception e) { e.printStackTrace(); }} 删除ES索引数据根据_id删除ES索引单个数据123456789101112@Testvoid 根据_id删除ES索引数据() { String index = \"my_index\"; try { int keyId = 33; ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON); elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId)); System.out.println(elasticSearchService.deleteIndexDataById(elasticSearchDTO)); } catch (Exception e) { e.printStackTrace(); }} 修改ES索引数据根据_id修改ES索引单个数据12345678910111213141516@Testvoid 根据_id更新ES索引数据() { String index = \"my_index\"; try { int keyId = 33; ElasticSearchDTO elasticSearchDTO = new ElasticSearchDTO().setXContentType(XContentType.JSON); elasticSearchDTO.setEsIndex(index).setEsKeyId(String.valueOf(keyId)); // 修改的内容(可修改指定部分字段内容) Map&lt;String, Object&gt; objectMap = new LinkedHashMap&lt;&gt;(); objectMap.put(\"username\", \"超级管理员\"); elasticSearchDTO.setData(objectMap); System.out.println(elasticSearchService.updateIndexDataById(elasticSearchDTO)); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除","slug":"2022/03/1646642392484/1646642392484","date":"2022-03-07T08:39:52.000Z","updated":"2022-03-16T10:00:43.315Z","comments":false,"path":"2022/03/1646642392484/1646642392484/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646642392484/1646642392484/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的使用","text":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询) 使用Java创建索引不需要mappings下的_doc节点；以下面结构进行操作 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859{ \"settings\": { \"number_of_shards\": 1, \"number_of_replicas\": 0 }, \"mappings\": { \"properties\": { \"keyId\": { \"type\": \"long\" }, \"account\": { \"type\": \"keyword\" }, \"username\": { \"type\": \"text\" }, \"age\": { \"type\": \"short\" }, \"birthday\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd\", \"ignore_malformed\": true }, \"address\": { \"properties\": { \"region\": { \"type\": \"text\", \"index\": \"true\" }, \"location\": { \"properties\": { \"province\": { \"type\": \"text\", \"index\": \"true\" }, \"city\": { \"type\": \"text\", \"index\": \"true\" } } } } }, \"role\": { \"properties\": { \"attribute\": { \"type\": \"nested\" } } }, \"createdTime\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss||epoch_millis\", \"ignore_malformed\": false } } }} 判断ES索引是否存在123456789@Testvoid 判断ES索引是否存在() { String index = \"my_index\"; try { System.out.println(elasticSearchService.checkIndexExists(index)); } catch (Exception e) { e.printStackTrace(); }} 创建索引第一种方式创建索引：通过加载整体的mapping字符进行创建 12345678910@Testvoid 创建ES索引1() { String index = \"my_index\"; try { String source = \"索引mapping内容,即上述的json文本\"; System.out.println(elasticSearchService.createIndex(index, source)); } catch (Exception e) { e.printStackTrace(); }} 第二种方式创建索引：通过标签代码进行组装mapping内容进行创建 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758@Testvoid 创建ES索引2() { String index = \"my_index\"; try { // 设置settings映射 Settings settings = Settings.builder().put(\"number_of_shards\", 1).put(\"number_of_replicas\", 0).build(); // 复合参数 Map&lt;String, Object&gt; region = new LinkedHashMap&lt;&gt;(); region.put(\"type\", \"text\"); region.put(\"index\", \"true\"); Map&lt;String, Object&gt; location = new LinkedHashMap&lt;&gt;(); Map&lt;String, Object&gt; location_properties = new LinkedHashMap&lt;&gt;(); Map&lt;String, Object&gt; province = new LinkedHashMap&lt;&gt;(); province.put(\"type\", \"text\"); province.put(\"index\", \"true\"); Map&lt;String, Object&gt; city = new LinkedHashMap&lt;&gt;(); city.put(\"type\", \"text\"); city.put(\"index\", \"true\"); location_properties.put(\"province\", province); location_properties.put(\"city\", city); location.put(\"properties\", location_properties); // 设置mapping映射 XContentBuilder mapping = XContentFactory.jsonBuilder() .startObject() .startObject(\"properties\") // keyId .startObject(\"keyId\").field(\"type\", \"long\").endObject() // account .startObject(\"account\").field(\"type\", \"keyword\").endObject() // username .startObject(\"username\").field(\"type\", \"text\").endObject() // age .startObject(\"age\").field(\"type\", \"short\").endObject() // birthday .startObject(\"birthday\") .field(\"type\", \"date\") .field(\"format\", \"yyyy-MM-dd\") .field(\"ignore_malformed\", true).endObject() // address .startObject(\"address\").startObject(\"properties\") .field(\"region\", region) .field(\"location\", location) .endObject().endObject() // role .startObject(\"role\").startObject(\"properties\") .startObject(\"attribute\").field(\"type\", \"nested\").endObject() .endObject().endObject() // createdTime .startObject(\"createdTime\") .field(\"type\", \"date\") .field(\"format\", \"yyyy-MM-dd HH:mm:ss||epoch_millis\") .field(\"ignore_malformed\", true).endObject() .endObject().endObject(); System.out.println(elasticSearchService.createIndex(index, settings, mapping)); } catch (Exception e) { e.printStackTrace(); }} 删除索引删除索引的同时会删除索引内的全部数据 123456789@Testvoid 删除ES索引() { String index = \"my_index\"; try { System.out.println(elasticSearchService.deleteIndex(index)); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类","slug":"2022/03/1646640937853/1646640937853","date":"2022-03-07T08:15:37.000Z","updated":"2022-03-16T10:00:37.266Z","comments":false,"path":"2022/03/1646640937853/1646640937853/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646640937853/1646640937853/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的封装","text":"本文的内容都是对接口类的一些参数进行抽象的封装使用 SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询) 实体类参数1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192import lombok.Data;import lombok.experimental.Accessors;import org.elasticsearch.action.search.SearchRequest;import org.elasticsearch.client.core.CountRequest;import org.elasticsearch.common.xcontent.XContentType;import java.io.Serializable;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021/9/12 22:15 * desc ：ES 实体类 */@Data@Accessors(chain = true)public class ElasticSearchDTO implements Serializable { /** * 索引 */ private String esIndex; /** * 主键 */ private String esKeyId; /** * 单笔数据 */ private Map&lt;String, Object&gt; data; /** * 数据类型 */ private XContentType xContentType = XContentType.JSON; /** * 多笔数据 */ private List&lt;ElasticSearchDTO&gt; batchData; /** * 查询构造器：全部数据，分页数据 */ private SearchRequest searchRequest = new SearchRequest(); /** * 统计构造器 */ private CountRequest countRequest = new CountRequest(); /** * 每页显示条数，默认 10 */ private int size = 10; /** * 当前页码数，默认 1 */ private int current = 1; public ElasticSearchDTO() { } /** * 分页构造函数(单页最多10000条数据) * * @param current 当前页 * @param size 每页显示条数 */ public ElasticSearchDTO(int current, int size) { if (current &gt; 1) { this.current = current; } if (size &lt;= 10000 &amp;&amp; size &gt; 0) { this.size = size; } } public int getForm() { if (this.getCurrent() == 1) { return 0; } else { return ((this.getCurrent() - 1) * this.getSize()); } }} 分页参数123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596import java.io.Serializable;import java.util.Collections;import java.util.List;import java.util.Map;/** * author ：demon * date ：2022/2/28 15:43 * desc ：ES 分页 */public class ElasticSearchPage implements Serializable { /** * 查询数据列表 */ private List&lt;Map&lt;String, Object&gt;&gt; records = Collections.emptyList(); /** * 总数 */ private long total = 0; /** * 每页显示条数，默认 10 */ private long size = 10; /** * 当前页 */ private long current = 1; /** * 是否存在上一页 * * @return true / false */ public boolean hasPrevious() { return this.current &gt; 1; } /** * 是否存在下一页 * * @return true / false */ public boolean hasNext() { return this.current &lt; this.getPages(); } /** * 当前分页总页数 */ long getPages() { if (this.getSize() == 0) { return 0L; } long pages = getTotal() / getSize(); if (this.getTotal() % getSize() != 0) { pages++; } return pages; } public List&lt;Map&lt;String, Object&gt;&gt; getRecords() { return this.records; } public void setRecords(List&lt;Map&lt;String, Object&gt;&gt; records) { this.records = records; } long getTotal() { return this.total; } public void setTotal(long total) { this.total = total; } long getSize() { return this.size; } public void setSize(long size) { this.size = size; } long getCurrent() { return this.current; } public void setCurrent(long current) { this.current = current; }} 返回数据1234567891011121314151617181920212223import java.util.LinkedHashMap;import java.util.Map;/** * className ElasticSearchListUtil * author demon * createTime 2022/3/1 13:25 * description ES 列表数据 */public class ElasticSearchListUtil { public static Map&lt;String,Object&gt; getData(ElasticSearchPage listPage) { Map&lt;String,Object&gt; objectMap = new LinkedHashMap&lt;&gt;(); objectMap.put(\"hasPrevious\", listPage.hasPrevious()); objectMap.put(\"hasNext\", listPage.hasNext()); objectMap.put(\"total\", listPage.getTotal()); objectMap.put(\"page\", listPage.getPages()); objectMap.put(\"current\", listPage.getCurrent()); objectMap.put(\"size\", listPage.getSize()); objectMap.put(\"records\", listPage.getRecords()); return objectMap; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类","slug":"2022/03/1646640931232/1646640931232","date":"2022-03-07T08:15:31.000Z","updated":"2022-03-16T10:00:29.967Z","comments":false,"path":"2022/03/1646640931232/1646640931232/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646640931232/1646640931232/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的封装","text":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询) 接口123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104import org.elasticsearch.common.settings.Settings;import org.elasticsearch.common.xcontent.XContentBuilder;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021 2021/9/12 15:01 * desc ： */public interface ElasticSearchService { /** * 判断ES索引是否存在 * * @param index 索引名称 * @return 返回。true:不存在；false:已存在 * @throws ElasticSearchException 异常 */ boolean checkIndexExists(String index) throws ElasticSearchException; /** * 创建ES索引 * * @param index 索引名称 * @return 返回。true:创建成功；false:创建失败 * @throws ElasticSearchException 异常 */ boolean createIndex(String index, String source) throws ElasticSearchException; boolean createIndex(String index, Settings settings, XContentBuilder mapping) throws ElasticSearchException; /** * 删除索引 会删除数据 * * @param index 索引 * @return 返回 * @throws ElasticSearchException 异常 */ boolean deleteIndex(String index) throws ElasticSearchException; /** * 插入单笔数据 * * @param elasticSearchDTO 参数 * @return 返回 * @throws ElasticSearchException 异常 */ boolean insertIndexData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 插入多笔数据 * * @param elasticSearchDTO 参数 * @return 返回 * @throws ElasticSearchException 异常 */ boolean insertIndexBatchData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 根据_Id 删除单笔数据 * * @return 返回 * @throws ElasticSearchException 异常 */ boolean deleteIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 根据_Id 更新单笔数据 * * @return 返回 * @throws ElasticSearchException 异常 */ boolean updateIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 查询索引数据（分页） * * @param elasticSearchDTO 参数 * @throws ElasticSearchException 异常 */ ElasticSearchPage searchDataListPage(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 查询索引数据（全部） * * @param elasticSearchDTO 参数 * @return 返回 * @throws ElasticSearchException 异常 */ List&lt;Map&lt;String, Object&gt;&gt; searchDataList(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException; /** * 获取多条件查询的总数 * * @param elasticSearchDTO 参数 * @return 返回 * @throws ElasticSearchException 异常 */ long getIndexCount(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException;} 接口实现123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295import lombok.extern.slf4j.Slf4j;import org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;import org.elasticsearch.action.bulk.BulkRequest;import org.elasticsearch.action.bulk.BulkResponse;import org.elasticsearch.action.index.IndexRequest;import org.elasticsearch.action.index.IndexResponse;import org.elasticsearch.action.search.ClearScrollRequest;import org.elasticsearch.action.search.SearchRequest;import org.elasticsearch.action.search.SearchResponse;import org.elasticsearch.action.search.SearchScrollRequest;import org.elasticsearch.action.support.IndicesOptions;import org.elasticsearch.action.support.master.AcknowledgedResponse;import org.elasticsearch.action.update.UpdateRequest;import org.elasticsearch.action.update.UpdateResponse;import org.elasticsearch.client.RequestOptions;import org.elasticsearch.client.RestHighLevelClient;import org.elasticsearch.client.core.CountRequest;import org.elasticsearch.client.core.CountResponse;import org.elasticsearch.client.indices.CreateIndexRequest;import org.elasticsearch.client.indices.CreateIndexResponse;import org.elasticsearch.client.indices.GetIndexRequest;import org.elasticsearch.common.settings.Settings;import org.elasticsearch.common.unit.TimeValue;import org.elasticsearch.common.xcontent.XContentBuilder;import org.elasticsearch.common.xcontent.XContentType;import org.elasticsearch.rest.RestStatus;import org.elasticsearch.search.Scroll;import org.elasticsearch.search.SearchHit;import org.springframework.stereotype.Service;import javax.annotation.Resource;import java.util.ArrayList;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021 2021/9/12 15:02 * desc ：ES 实现类 * queryById:根据id查询 * termQuery:精确匹配字段查询 * likeQuery:多词模糊查询 * rangeQuery:当前字段值范围查询 * queryNot:匹配非当前值的查询 * others:其他类型查询 */@Slf4j@Servicepublic class ElasticSearchServiceImpl implements ElasticSearchService { @Resource private RestHighLevelClient restHighLevelClient; @Override public boolean checkIndexExists(String index) throws ElasticSearchException { log.info(\"验证索引是否存在：\"); try { GetIndexRequest getIndexRequest = new GetIndexRequest(index).local(false).humanReadable(true); if (restHighLevelClient.indices().exists(getIndexRequest, RequestOptions.DEFAULT)) { log.info(\"ES索引[\" + index + \"]已存在\"); return true; } else { log.error(\"ES索引[\" + index + \"]不存在\"); return false; } } catch (Exception e) { throw new ElasticSearchException(\"判断ES索引[\" + index + \"]存在异常\", e); } } @Override public boolean createIndex(String index, Settings settings, XContentBuilder mapping) throws ElasticSearchException { return getCreateIndexResponse(new CreateIndexRequest(index).settings(settings).mapping(mapping)); } @Override public boolean createIndex(String index, String source) throws ElasticSearchException { return getCreateIndexResponse(new CreateIndexRequest(index).source(source, XContentType.JSON)); } private boolean getCreateIndexResponse(CreateIndexRequest createIndexRequest) throws ElasticSearchException { String index = createIndexRequest.index(); log.info(\"创建索引：{}\", index); try { // 超时时间设置为 1m createIndexRequest.setTimeout(TimeValue.timeValueMinutes(1)); CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(createIndexRequest, RequestOptions.DEFAULT); if (createIndexResponse.isAcknowledged()) { log.info(\"创建ES索引[\" + index + \"]成功\"); return true; } else { log.error(\"创建ES索引[\" + index + \"]失败\"); return false; } } catch (Exception e) { throw new ElasticSearchException(\"创建ES索引[\" + index + \"]异常\", e); } } @Override public boolean deleteIndex(String index) throws ElasticSearchException { log.info(\"删除索引：{}\", index); try { DeleteIndexRequest deleteIndexRequest = new DeleteIndexRequest(index); deleteIndexRequest.indicesOptions(IndicesOptions.LENIENT_EXPAND_OPEN); AcknowledgedResponse acknowledgedResponse = restHighLevelClient.indices().delete(deleteIndexRequest, RequestOptions.DEFAULT); if (acknowledgedResponse.isAcknowledged()) { log.info(\"删除ES索引[\" + index + \"]成功\"); return true; } else { log.error(\"删除ES索引[\" + index + \"]失败\"); return false; } } catch (Exception e) { throw new ElasticSearchException(\"删除ES索引[\" + index + \"]异常\", e); } } @Override public boolean insertIndexData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { String index = elasticSearchDTO.getEsIndex(); log.info(\"新增索引{}数据\", index); try { IndexRequest indexRequest = new IndexRequest(index, \"_doc\", elasticSearchDTO.getEsKeyId()); indexRequest.source(elasticSearchDTO.getData(), elasticSearchDTO.getXContentType()); IndexResponse indexResponse = restHighLevelClient.index(indexRequest, RequestOptions.DEFAULT); int status = indexResponse.status().getStatus(); if (status == RestStatus.CREATED.getStatus() || status == RestStatus.OK.getStatus()) { log.info(\"插入ES索引[\" + indexResponse.getIndex() + \"]数据成功:\" + status + \"；_id：\" + indexResponse.getId()); return true; } else { log.error(\"插入ES索引[\" + indexResponse.getIndex() + \"]数据失败:\" + status + \"；_id：\" + indexResponse.getId()); return false; } } catch (Exception e) { throw new ElasticSearchException(\"插入ES索引[\" + index + \"]数据异常\", e); } } @Override public boolean insertIndexBatchData(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { String index = elasticSearchDTO.getEsIndex(); List&lt;ElasticSearchDTO&gt; elasticSearchDTOList = elasticSearchDTO.getBatchData(); log.info(\"批量新增索引{}数据:{}\", index, elasticSearchDTOList.size()); try { BulkRequest bulkRequest = new BulkRequest(); for (ElasticSearchDTO searchDTO : elasticSearchDTOList) { bulkRequest.add(new IndexRequest(index, \"_doc\", searchDTO.getEsKeyId()).source(searchDTO.getData(), elasticSearchDTO.getXContentType())); } BulkResponse bulkResponse = restHighLevelClient.bulk(bulkRequest, RequestOptions.DEFAULT); int status = bulkResponse.status().getStatus(); if (status == RestStatus.OK.getStatus()) { log.info(\"批量插入ES索引[\" + index + \"]数据成功;\" + status + \";\"); return true; } else { log.error(\"批量插入ES索引[\" + index + \"]数据失败;\" + status + \";\"); return false; } } catch (Exception e) { throw new ElasticSearchException(\"批量插入ES索引[\" + index + \"]数据异常\", e); } } @Override public boolean deleteIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { String index = elasticSearchDTO.getEsIndex(); log.info(\"删除索引{}数据\", index); try { DeleteRequest deleteRequest = new DeleteRequest(index, \"_doc\", elasticSearchDTO.getEsKeyId()); DeleteResponse deleteResponse = restHighLevelClient.delete(deleteRequest, RequestOptions.DEFAULT); int status = deleteResponse.status().getStatus(); if (status == RestStatus.OK.getStatus()) { log.info(\"删除ES索引[\" + deleteResponse.getIndex() + \"]数据成功:\" + status + \"；_id：\" + deleteResponse.getId()); return true; } else { log.error(\"删除ES索引[\" + deleteResponse.getIndex() + \"]数据失败:\" + status + \"；_id：\" + deleteResponse.getId()); return false; } } catch (Exception e) { throw new ElasticSearchException(\"删除ES索引[\" + index + \"]数据异常\", e); } } @Override public boolean updateIndexDataById(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { String index = elasticSearchDTO.getEsIndex(); log.info(\"更新索引{}数据\", index); try { UpdateRequest updateRequest = new UpdateRequest(index, \"_doc\", elasticSearchDTO.getEsKeyId()); updateRequest.doc(elasticSearchDTO.getData()); UpdateResponse updateResponse = restHighLevelClient.update(updateRequest, RequestOptions.DEFAULT); int status = updateResponse.status().getStatus(); if (status == RestStatus.OK.getStatus()) { log.info(\"更新ES索引[\" + updateResponse.getIndex() + \"]数据成功:\" + status + \"；_id：\" + updateResponse.getId()); return true; } else { log.error(\"更新ES索引[\" + updateResponse.getIndex() + \"]数据失败:\" + status + \"；_id：\" + updateResponse.getId()); return false; } } catch (Exception e) { throw new ElasticSearchException(\"更新ES索引[\" + index + \"]数据异常\", e); } } @Override public ElasticSearchPage searchDataListPage(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { ElasticSearchPage elasticSearchPage = new ElasticSearchPage(); String index = elasticSearchDTO.getEsIndex(); try { List&lt;Map&lt;String, Object&gt;&gt; resultSearchHit = new ArrayList&lt;&gt;(); SearchRequest searchRequest = elasticSearchDTO.getSearchRequest(); SearchSourceBuilder searchSourceBuilder = searchRequest.indices(index).source(); // from是数据从下标0开始 searchSourceBuilder.from(elasticSearchDTO.getForm()).size(elasticSearchDTO.getSize()).timeout(TimeValue.timeValueSeconds(60)).explain(true); SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT); if (searchResponse.getHits().getHits().length != 0) { for (SearchHit hit : searchResponse.getHits().getHits()) { resultSearchHit.add(hit.getSourceAsMap()); } } elasticSearchPage.setRecords(resultSearchHit); elasticSearchPage.setTotal(searchResponse.getHits().getTotalHits()); elasticSearchPage.setCurrent(elasticSearchDTO.getCurrent()); elasticSearchPage.setSize(elasticSearchDTO.getSize()); } catch (Exception e) { throw new ElasticSearchException(\"查询ES索引[\" + index + \"]数据异常\", e); } return elasticSearchPage; } @Override public List&lt;Map&lt;String, Object&gt;&gt; searchDataList(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { List&lt;Map&lt;String, Object&gt;&gt; resultSearchHit = new ArrayList&lt;&gt;(); String index = elasticSearchDTO.getEsIndex(); // 设定滚动时间间隔,60秒,不是处理查询结果的所有文档的所需时间 // 游标查询的过期时间会在每次做查询的时候刷新，所以这个时间只需要足够处理当前批的结果就可以了 final Scroll scroll = new Scroll(TimeValue.timeValueSeconds(60)); // 查询条件 SearchRequest searchRequest = elasticSearchDTO.getSearchRequest().scroll(scroll); searchRequest.indices(index).source().size(10000).timeout(TimeValue.timeValueSeconds(60)).explain(true); log.info(searchRequest.source().toString()); // ES滚屏快照 ClearScrollRequest clearScrollRequest = new ClearScrollRequest(); try { SearchResponse searchResponse = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT); //每次循环完后取得scrollId,用于记录下次将从这个游标开始取数 String scrollId = searchResponse.getScrollId(); do { for (SearchHit hit : searchResponse.getHits().getHits()) { resultSearchHit.add(hit.getSourceAsMap()); } SearchScrollRequest scrollRequest = new SearchScrollRequest(scrollId).scroll(scroll); //进行下次查询 searchResponse = restHighLevelClient.scroll(scrollRequest, RequestOptions.DEFAULT); } while (searchResponse.getHits().getHits().length != 0); // 也可以选择setScrollIds()将多个scrollId一起使用 clearScrollRequest.addScrollId(scrollId); } catch (Exception e) { throw new ElasticSearchException(\"查询ES索引[\" + index + \"]数据异常\", e); } finally { if (clearScrollRequest.getScrollIds().size() &gt; 0) { try { // 清除滚屏(及时清除es快照，释放资源) restHighLevelClient.clearScroll(clearScrollRequest, RequestOptions.DEFAULT); } catch (Exception e) { log.error(\"清除es快照，释放资源出错：\", e); } } } return resultSearchHit; } @Override public long getIndexCount(ElasticSearchDTO elasticSearchDTO) throws ElasticSearchException { String index = elasticSearchDTO.getEsIndex(); log.info(\"查询ES索引条数：{}\", index); try { CountRequest countRequest = elasticSearchDTO.getCountRequest().indices(index); CountResponse countResponse = restHighLevelClient.count(countRequest, RequestOptions.DEFAULT); if (countResponse.status().getStatus() == RestStatus.OK.getStatus()) { log.info(\"查询ES索引条数[\" + index + \"]成功\"); return countResponse.getCount(); } else { log.error(\"查询ES索引条数[\" + index + \"]失败\"); return -1; } } catch (Exception e) { throw new ElasticSearchException(\"查询ES索引条数[\" + index + \"]异常\", e); } }} 自定义异常123456789101112/** * author ：demon * date ：2022 2022/3/7 14:21 * desc ：自定义异常 */public class ElasticSearchException extends RuntimeException { //用指定的详细信息和原因构造一个新的异常 public ElasticSearchException(String message, Throwable cause){ super(message,cause); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"SpringBoot整合ElasticSearch-v6.8.1的封装 - 1.配置类","slug":"2022/03/1646386352631/1646386352631","date":"2022-03-04T09:32:32.000Z","updated":"2022-03-24T07:14:25.210Z","comments":false,"path":"2022/03/1646386352631/1646386352631/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646386352631/1646386352631/","excerpt":"SpringBoot整合ElasticSearch-v6.8.1的封装","text":"本文是基于SpringBoot2.4.2的版本对ElasticSearch6.8.1的版本进行封装使用 SpringBoot整合ElasticSearch-v6.8.1的封装 - 2.接口类SpringBoot整合ElasticSearch-v6.8.1的封装 - 3.支持类SpringBoot整合ElasticSearch-v6.8.1的使用 - 4.索引的创建与删除SpringBoot整合ElasticSearch-v6.8.1的使用 - 5.索引的数据(增删改)SpringBoot整合ElasticSearch-v6.8.1的使用 - 6.索引的数据(查询) 依赖123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;skipTests&gt;true&lt;/skipTests&gt; &lt;spring-boot.version&gt;2.4.2&lt;/spring-boot.version&gt; &lt;elasticsearch-client.version&gt;6.8.1&lt;/elasticsearch-client.version&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt; &lt;version&gt;${elasticsearch-client.version}&lt;/version&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt; &lt;version&gt;${elasticsearch-client.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-client&lt;/artifactId&gt; &lt;version&gt;${elasticsearch-client.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt; &lt;artifactId&gt;elasticsearch-rest-client-sniffer&lt;/artifactId&gt; &lt;version&gt;${elasticsearch-client.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;version&gt;4.5.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpcore&lt;/artifactId&gt; &lt;version&gt;4.4.14&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt; &lt;version&gt;3.11&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 配置 ElasticSearchDataConfig 12345678910111213141516171819202122232425262728293031323334353637import lombok.Data;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;import org.springframework.stereotype.Component;import java.util.Collections;import java.util.List;/** * author ：demon * date ：2022 2022/3/18 15:44 * desc ：ES的bean */@Data@Component(value = \"elasticSearchDataConfig\")@ConditionalOnMissingClass(value = \"elasticSearchDataConfig\")public class ElasticSearchDataConfig { // 服务器地址 private List&lt;String&gt; httpHost = Collections.singletonList(\"http://127.0.0.1:9200\"); // ES用户名 private String username; // ES密码 private String password; // 设置连接超时时间，单位毫秒。指的是连接一个url的连接等待时间,单位毫秒。 private Integer connectTimeout = 5000; // 请求获取数据的超时时间，单位毫秒。 如果访问一个接口，多少时间内无法返回数据，就直接放弃此次调用,单位毫秒。 private Integer socketTimeout = 60000; // 设置从connect Manager获取Connection 超时时间，单位毫秒。 private Integer connectionRequestTimeout = 60000; // httpclient最大连接数 private Integer maxConnTotal = 30; // httpclient最大路由连接数 private Integer maxConnPerRoute = 10; // httpclient保活策略 private Integer keepAliveMinutes = 10;} ElasticSearchConfig 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788import lombok.extern.slf4j.Slf4j;import org.apache.http.HttpHost;import org.apache.http.auth.AuthScope;import org.apache.http.auth.UsernamePasswordCredentials;import org.apache.http.client.CredentialsProvider;import org.apache.http.impl.client.BasicCredentialsProvider;import org.elasticsearch.client.RestClient;import org.elasticsearch.client.RestClientBuilder;import org.elasticsearch.client.RestHighLevelClient;import org.springframework.context.annotation.Bean;import org.springframework.stereotype.Component;import javax.annotation.Resource;import java.util.Collections;import java.util.List;/** * author ：demon * date ：2021 2021/7/20 18:33 * desc ：ES 配置项 * https://www.elastic.co/guide/en/elasticsearch/client/java-rest/6.8/java-rest-high-document-index.html#java-rest-high-document-index */@Slf4j@Configurationpublic class ElasticSearchConfig { @Resource(name = \"elasticSearchDataConfig\") private ElasticSearchDataConfig elasticSearchDataConfig; @Bean(destroyMethod = \"close\", name = \"restHighLevelClient\") public RestHighLevelClient restHighLevelClient() { // 创建链接 RestClientBuilder builder; List&lt;String&gt; httpHostList = elasticSearchDataConfig.getHttpHost(); if (httpHostList.size() &gt; 1) { HttpHost[] httpHosts = new HttpHost[httpHostList.size()]; for (int i = 0; i &lt; httpHostList.size(); i++) { httpHosts[i] = HttpHost.create(httpHostList.get(i)); } log.info(\"ES模式：集群（{}）\", Collections.singletonList(httpHostList).toArray()); // 集群创建 builder = RestClient.builder(httpHosts); } else { String host = httpHostList.get(0); log.info(\"ES模式：单机（{}）\", Collections.singletonList(host).toArray()); // 单机创建 builder = RestClient.builder(HttpHost.create(host)); } // 该方法接收一个RequestConfig.Builder对象，对该对象进行修改后然后返回。 builder.setRequestConfigCallback(requestConfigBuilder -&gt; requestConfigBuilder // 设置连接超时时间，单位毫秒。指的是连接一个url的连接等待时间 .setConnectTimeout(elasticSearchDataConfig.getConnectTimeout()) // 请求获取数据的超时时间，单位毫秒。 如果访问一个接口，多少时间内无法返回数据，就直接放弃此次调用。 .setSocketTimeout(elasticSearchDataConfig.getSocketTimeout()) // 设置从connect Manager获取Connection 超时时间，单位毫秒。 .setConnectionRequestTimeout(elasticSearchDataConfig.getConnectionRequestTimeout()) ) // 使用异步httpclient时设置并发连接数 .setHttpClientConfigCallback(httpClientBuilder -&gt; { // httpclient连接数配置 httpClientBuilder // 最大连接数 .setMaxConnTotal(elasticSearchDataConfig.getMaxConnTotal()) // 最大路由连接数 .setMaxConnPerRoute(elasticSearchDataConfig.getMaxConnPerRoute()) // httpclient保活策略 .setKeepAliveStrategy(CustomConnectionKeepAliveStrategy.getInstance(elasticSearchDataConfig.getKeepAliveMinutes())) // 没有密码可以不用这一个set .disableAuthCaching().setDefaultCredentialsProvider(getCredentialsProvider()) ; return httpClientBuilder; }); return new RestHighLevelClient(builder); } private CredentialsProvider getCredentialsProvider() { final CredentialsProvider credentialsProvider = new BasicCredentialsProvider(); //如果没配置密码就可以不用下面这行 String username = elasticSearchDataConfig.getUsername(); String password = elasticSearchDataConfig.getPassword(); if (username != null &amp;&amp; password != null) { System.out.println(\"★★★★★ restHighLevelClient 用户验证★★★★★\"); credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(username, password)); } return credentialsProvider; }} 连接策略1234567891011121314151617181920212223242526272829303132333435363738394041424344import org.apache.http.HttpResponse;import org.apache.http.impl.client.DefaultConnectionKeepAliveStrategy;import org.apache.http.protocol.HttpContext;import java.util.concurrent.TimeUnit;/** * author ：demon * date ：2021 2021/9/12 23:40 * desc ：连接策略 */public class CustomConnectionKeepAliveStrategy extends DefaultConnectionKeepAliveStrategy { private static CustomConnectionKeepAliveStrategy INSTANCE; private static long maxKeepAliveMinutes; // 带参数构造器 private CustomConnectionKeepAliveStrategy(long maxKeepAliveMinutes) { super(); CustomConnectionKeepAliveStrategy.maxKeepAliveMinutes = maxKeepAliveMinutes; } // 为了传参数进来写了个单例 public static CustomConnectionKeepAliveStrategy getInstance(long maxKeepAliveMinutes) { if (INSTANCE == null) { synchronized (CustomConnectionKeepAliveStrategy.class) { if (INSTANCE == null) { INSTANCE = new CustomConnectionKeepAliveStrategy(maxKeepAliveMinutes); } } } return INSTANCE; } /** * 最大keep alive的时间（分钟） * 这里默认为10分钟，可以根据实际情况设置。 * 可以观察客户端机器状态为TIME_WAIT的TCP连接数，如果太多，可以增大此值。 * 小于0为无限期keepalive，将无限期替换成一个默认的时间 */ @Override public long getKeepAliveDuration(HttpResponse response, HttpContext context) { long keepAliveDuration = super.getKeepAliveDuration(response, context); if (keepAliveDuration &lt; 0) { return TimeUnit.MINUTES.toMillis(maxKeepAliveMinutes); } else { return keepAliveDuration; } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"ElasticSearch的数据类型","slug":"2022/03/1646285204846/1646285204846","date":"2022-03-03T05:26:44.000Z","updated":"2022-03-04T08:22:18.040Z","comments":false,"path":"2022/03/1646285204846/1646285204846/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646285204846/1646285204846/","excerpt":"ElasticSearch的数据类型 (text、keyword、date、object、geo等)","text":"说明ElasticSearch中每个field都要精确对应一个数据类型.本文都是基于ElasticSearch 6.8.1进行的, 不同的版本可能存在不支持的情况, 还请注意.mappingmapping-types 核心基本类型 1.text类型 2.keyword类型 3.数字类型 4.日期类型 5.布尔类型 6.二进制类型 7.范围类型 8.数组类型 9.对象类型10.嵌套类型11.IP类型12.Token count类型13.Geo类型 字符串类型（text、keyword）示例ElasticSearch 5.X之后的字段类型不再支持string，由 text 或 keyword 取代。 如果仍使用string，会报错。 文本类型（text） 说明：text的内容会被分词, 可以设置是否需要存储: “index”: “true|false”.text类型的字段不能用于排序, 也很少用于聚合.注意：当一个字段需要用于全文搜索(会被分词), 比如商品名称、商品描述等信息, 就应该使用text类型. 关键字类型（keyword） 说明：keyword的内容不会被分词, 可以设置是否需要存储: “index”: “true|false”.keyword类型的字段可用于过滤、排序、聚合等.注意：当一个字段需要按照精确值进行操作时, 就应该使用keyword类型. 数字数据类型示例数字类型有如下分类: 12345678byte： 有符号的8位整数, 范围: [-128 ~ 127]short 有符号的16位整数, 范围: [-32768 ~ 32767]integer 有符号的32位整数, 范围: [-2^31 ~ 2^31-1]long 有符号的64位整数, 范围: [-2^63 ~ 2^63-1]float 32位单精度浮点数double 64位双精度浮点数half_float 16位半精度IEEE 754浮点类型scaled_float 缩放类型的的浮点数, 比如price字段只需精确到分, 57.34缩放因子为100, 存储结果为5734 说明：字段的长度越短, 索引和搜索的效率越高尽可能选择范围小的数据类型, 优先考虑使用带缩放因子的浮点类型 日期类型（date）示例在ES中, 日期默认格式: strict_date_optional_time||epoch_millis包含格式化日期的字符串, “2018-10-01”, 或”2022-03-03 15:47:47”，可代表时间毫秒数的长整型数字，也可代表时间秒数的整数 说明：如果时区未指定, 日期将被转换为UTC格式, 但存储的却是长整型的毫秒值.多个格式使用双竖线||分隔, 每个格式都会被依次尝试, 直到找到匹配的.第一个格式用于将时间毫秒值转换为对应格式的字符串.可自定义日期格式：yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis 布尔类型（boolean） 说明：可以接受表示真、假的字符串或数字真值: true, “true”, “on”, “yes”, “1”…假值: false, “false”, “off”, “no”, “0”, “”(空字符串), 0.0, 0 二进制类型（binary）二进制类型是Base64编码字符串的二进制值, 不以默认的方式存储, 且不能被搜索 说明：有2个设置项：doc_values、store① doc_values: 该字段是否需要存储到磁盘上, 方便以后用来排序、聚合或脚本查询. 接受true和false，默认为false;① store: 该字段的值是否要和_source分开存储、检索, 意思是除了_source中, 是否要单独再存储一份. 接受true或false，默认为false;.注意:Base64编码的二进制值不能嵌入换行符\\n, 逗号(0x2c)等符号. 范围类型（range）示例range类型支持以下几种： 123456integer_range -2^31 ~ 2^31-1long_range -2^63 ~ 2^63-1float_range 32位单精度浮点型double_range 64位双精度浮点型date_range 64位整数, 毫秒计时ip_range IP值的范围, 支持IPV4和IPV6, 或者这两种同时存在 说明：小于是lt，小于等于是lte、大于是gt、大于等于是gte 复杂数据类型对象类型（object）示例文档是分层的: 文档可以包含内部对象, 内部对象也可以包含内部对象； 嵌套类型（nested）示例嵌套类型是对象数据类型的一个特例, 可以让array类型的对象被独立索引和搜索，用nested类型解决object类型的不足 说明：如果需要对以最对象进行索引, 且保留数组中每个对象的独立性, 就应该使用嵌套数据类型.嵌套对象实质是将每个对象分离出来, 作为隐藏文档进行索引. 专门数据类型IP类型（IPv4、IPv6）IP类型的字段用于存储IPv4或IPv6的地址, 本质上是一个长整型字段. 1234567891011{ \"mappings\": { \"customer\": { \"properties\": { \"ip_addr\": { \"type\": \"ip\" } } } }} 更多类型更多TYPE类型查询详见官方文档 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/tags/ElasticSearch/"}]},{"title":"ElasticSearch下的Kibana的使用 - 别名(视图)","slug":"2022/03/1646205817389/1646205817389","date":"2022-03-02T07:23:37.000Z","updated":"2022-03-04T10:39:27.449Z","comments":false,"path":"2022/03/1646205817389/1646205817389/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646205817389/1646205817389/","excerpt":"ElasticSearch下的Kibana的使用","text":"作用能非常优雅的解决两个索引无缝切换的问题； 创建(add)、删除(remove)1234567891011121314151617POST /_aliases{ \"actions\": [ { \"add\": { \"index\": \"my_index\", \"alias\": \"my_index_v1\" } }, { \"remove\": { \"index\": \"my_index\", \"alias\": \"my_index_v1\" } } ]} 读写当索引别名指向多个索引时，进行写操作，其中的一个索引必须被指定为写索引，并且只能指定一个，否则则无法写入。is_write_index：默认为false；需要有且仅设置一个为true； 12345678910111213141516171819POST /_aliases{ \"actions\": [ { \"add\": { \"index\": \"my_index_1\", \"alias\": \"my_index_v2\", \"is_write_index\" : true } }, { \"add\": { \"index\": \"my_index_2\", \"alias\": \"my_index_v2\", \"is_write_index\" : false } } ]} 复制将索引【my_index_1】的数据复制到【my_index_2】的索引上；会根据数据的大小，消耗的时间不等；注意：假如【my_index_2】本身已有数据，“_index”，“_type”，“_id”等值的不同，都是会造成有重复数据存在的因素； 123456789POST /_reindex{ \"source\": { \"index\": \"my_index_1\" }, \"dest\": { \"index\": \"my_index_2\" }} 示例创建结构一样索引： my_index_1，my_index_2； 123456789101112PUT /my_index{ \"mappings\": { \"_doc\": { \"properties\": { \"user_id\": { \"type\": \"integer\" } } } }} 按照 is_write_index=true 的设置，当POST数据的时候，会写到索引为 my_index_1 内容，根据索引查询结果： 更改 is_write_index=true 的设置，当POST数据的时候，会写到索引为 my_index_2 内容，根据索引查询结果： document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"Kibana","slug":"Kibana","permalink":"https://www.zhuqiaolun.com/tags/Kibana/"}]},{"title":"ElasticSearch下的Kibana的使用 - 增删改查","slug":"2022/03/1646201026514/1646201026514","date":"2022-03-02T06:03:46.000Z","updated":"2022-03-04T07:54:37.512Z","comments":false,"path":"2022/03/1646201026514/1646201026514/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646201026514/1646201026514/","excerpt":"ElasticSearch下的Kibana的使用 - 增删改查","text":"由于安装的ES版本为6.8.1，故以下操作都是基于此版本下的格式写法 创建索引索引名称：my_index索引设置：settings索引映射：mappings；在ES版本6.8.1中需要添加“_doc”声明type类型；-7.x中的type已经过时，默认设置为_doc 属性：number_of_shards：主分片number_of_replicas：副分片ignore_malformed：忽略传值 null 的情况；默认为:falsetype：字段类型 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162PUT /my_index{ \"settings\": { \"number_of_shards\": 1, \"number_of_replicas\": 0 }, \"mappings\": { \"_doc\": { \"properties\": { \"keyId\": { \"type\": \"long\" }, \"account\": { \"type\": \"keyword\" }, \"username\": { \"type\": \"text\" }, \"age\": { \"type\": \"short\" }, \"birthday\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd\", \"ignore_malformed\": true }, \"address\": { \"properties\": { \"region\": { \"type\": \"keyword\", \"index\": \"true\" }, \"location\": { \"properties\": { \"province\": { \"type\": \"keyword\", \"index\": \"true\" }, \"city\": { \"type\": \"keyword\", \"index\": \"true\" } } } } }, \"role\": { \"properties\": { \"attribute\": { \"type\": \"nested\" } } }, \"createdTime\": { \"type\": \"date\", \"format\": \"yyyy-MM-dd HH:mm:ss||epoch_millis\", \"ignore_malformed\": false } } } }} 添加索引数据POST方法：_doc后面没有指定_id，系统会默认分配_id；如果_id存在，就更新；如果_id不存在，就插入；“_doc”：为在6.8.1的版本需要添加；“1”：为_id的设置； 1234567891011121314151617181920212223POST /my_index/_doc/1{ \"keyId\": 1, \"account\": \"admin\", \"username\": \"管理员\", \"age\": 33, \"birthday\": \"2222-12-22\", \"address\": { \"region\": \"中国\", \"location\": { \"province\": \"湖北省\", \"city\": \"黄冈市\" } }, \"role\": { \"attribute\": [ { \"first\": \"张三\", \"last\": \"李四\" } ] }} 删除索引数据1.根据_id删除索引数据 1DELETE /my_index/_doc/1 2.根据条件删除索引数据 12345678POST /my_index/_delete_by_query?pretty{ \"query\": { \"term\": { \"keyId\": 1 } }} 3.根据条件批量删除索引数据 12345678POST /my_index/_delete_by_query?pretty{ \"query\": { \"terms\": { \"keyId\": [1, 2] } }} 4.删除索引是所有数据 123456POST /my_index/_delete_by_query?pretty{ \"query\": { \"match_all\": {} }} 修改索引数据PUT方法：必须指定_id，否则就会报错；PUT修改时，其他属性值丢失，不是建议使用这种方式；1.根据_id更新索引当条数据的全部数据；不写则其他属性值会丢失 123456789101112131415161718192021222324252627PUT /my_index/_doc/1{ \"keyId\": 1, \"account\": \"admin\", \"username\": \"超级管理员\", \"age\": 33, \"birthday\": \"2222-12-22\", \"address\": { \"region\": \"中国\", \"location\": { \"province\": \"湖北省\", \"city\": \"黄冈市\" } }, \"role\": { \"attribute\": [ { \"first\": \"赵\", \"last\": \"钱\" }, { \"first\": \"孙\", \"last\": \"李\" } ] }} 2.根据_id更新索引当条数据的局部数据 1234567891011121314POST /my_index/_doc/1/_update{ \"doc\": { \"username\": \"超级管理员\", \"age\": 33, \"birthday\": \"2022-12-22\", \"address\": { \"location\": { \"province\": \"上海市\", \"city\": \"浦东新区\" } } }} 3.根据条件批量更新索引数据 123456789101112131415POST /my_index/_doc/_update_by_query{ \"query\": { \"terms\": { \"keyId\": [1, 2] } }, \"script\": { \"source\": \"ctx._source['username'] = params['username'];ctx._source['age'] = params['age']\", \"params\": { \"username\": \"管理员\", \"age\": 22 } }} 查询索引数据1.查询索引映射： GET /my_index/_mapping2.查询索引设置：GET /my_index/settings3.查询全部 123456GET /my_index/_search{ \"query\": { \"match_all\": {} }} 4.条件查询4.1.单个值的条件查询 12345678910GET /my_index/_doc/_search{ \"query\": { \"term\": { \"keyId\": { \"value\": 1 } } }} 4.2.多个值的条件查询 123456GET /my_index/_search{ \"query\": { \"terms\" : { \"keyId\" : [1, 2]} }} 4.3.区域范围的条件查询 123456789101112GET /my_index/_doc/_search{ \"query\": { \"range\": { \"birthday\": { \"gte\": \"2222-12-21\", \"lte\": \"2222-12-22\", \"relation\": \"within\" } } }} 5.嵌套对象(nested)查询path：根节点路径 123456789101112131415161718192021222324GET /my_index/_search{ \"query\": { \"nested\": { \"path\": \"role.attribute\", \"query\": { \"bool\": { \"must\": [ { \"match\": { \"role.attribute.first\": \"张三\" } }, { \"match\": { \"role.attribute.last\": \"李四\" } } ] } } } }} 更多查询查全部 match_all123456GET /index名/_search?pretty{ \"query\": { \"match_all\": {} }} 单条件模糊查询 match类似Sql的分页查询指定查询条数/字段from：下标值（分页，第一条数据的下标）size：条数（分页，每页显示的条数）_source：返回指定的字段值；为[]则返回全部 1234567891011GET /index名/_search?pretty{ \"from\": 0, \"size\": 2, \"_source\": [\"字段\"], \"query\": { \"match\": { \"字段\": \"条件内容\" } }} 单条件精确查询 term12345678GET /index名/_search?pretty{ \"query\": { \"term\": { \"字段\": \"条件内容\" } }} 过滤 filter类似Sql的范围查询range：lt小于value的值，小于等于是lte、大于是gt、大于等于是gtebool：must 必须；should 或者；must_not 不等于；filter：排除 123456789101112131415GET /index名/_search?pretty{ \"query\": { \"bool\": { \"filter\": { \"range\": { \"过滤的字段\": { \"gte\": 10, \"lte\": 20 } } } } }} 聚合查询 aggregations类似Sql的统计;terms 对某一字段进行聚合，可进行递归定义aggregations 12345678910111213141516171819GET /index名/_search?pretty{ \"size\": 2, \"query\": { \"match_all\": {} }, \"aggregations\": { \"聚合后返回的关键字1_count\": { \"terms\": { \"field\": \"聚合字段1\" } }, \"聚合后返回的关键字2_count\": { \"terms\": { \"field\": \"聚合字段2\" } } }} 掌握Aggregations需要明白的两个主要概念：桶（Buckets）：满足特定条件的文档的集合，类似于SQL中的group by。指标（Metrics）：对桶内的文档进行统计计算，类似于SQL中的count()、sum()、max()等聚合函数。每个聚合都是由一个或者多个桶和零个或者多个指标的组合而成。 Metric Aggregations常用的有min、max、avg、sum、cardinality等，Bucket Aggregations常用的有terms、range、histogram等。更多的聚合查询详见官方文档： document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"Kibana","slug":"Kibana","permalink":"https://www.zhuqiaolun.com/tags/Kibana/"}]},{"title":"Kibana的安装","slug":"2022/03/1646201017125/1646201017125","date":"2022-03-02T06:03:37.000Z","updated":"2022-03-02T07:24:37.588Z","comments":false,"path":"2022/03/1646201017125/1646201017125/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646201017125/1646201017125/","excerpt":"Kibana的安装","text":"介绍Kibana是一个针对Elasticsearch的开源分析及可视化平台，用来搜索、查看交互存储在Elasticsearch索引中的数据；使用Kibana，可以通过各种图表进行高级数据分析及展示，让海量数据更容易理解；Kibana操作简单，基于浏览器的用户界面可以快速创建仪表板（dashboard）实时显示Elasticsearch查询动态；设置Kibana非常简单。无需编码或者额外的基础架构，几分钟内就可以完成Kibana安装并启动Elasticsearch索引监测； 安装Kibana下载解压安装包，一定要装与ES相同的版本；由于本地ElasticSearch安装的版本为6.8.1；所以下载相同版本：kibana-6.8.1下载地址：https://www.elastic.co/cn/downloads/past-releases#kibana 配置解压文件并进入 \\kibana-6.8.1-windows-x86_64\\config目录下，打开 kibana.yml 进行配置；修改内容如下： 12345678910# 服务端口号server.port: 5601# 允许访问的IP,如果允许任何IP访问此处输入0.0.0.0server.host: \"0.0.0.0\"# 服务名称server.name: \"kibana\"# ES服务地址elasticsearch.hosts: [\"http://localhost:9200\"]# 设置kibana为中文i18n.locale: \"zh-CN\" 修改后的完整配置 启动1.启动ES2.启用kibana cmd 进入目录：\\kibana-6.8.1-windows-x86_64\\bin 下双击运行：kibana.bat 即可 访问主界面：http://localhost:5601/ 状态界面：http://localhost:5601/status开发工具：http://localhost:5601/app/kibana#/dev_tools/console?_g=()索引管理：http://localhost:5601/app/kibana#/management/elasticsearch/index_management/indices?_g=() 修改后的完整配置123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125# Kibana is served by a back end server. This setting specifies the port to use.#server.port: 5601# 服务端口号server.port: 5601# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.# The default is 'localhost', which usually means remote machines will not be able to connect.# To allow connections from remote users, set this parameter to a non-loopback address.#server.host: \"localhost\"# 允许访问的IP,如果允许任何IP访问此处输入0.0.0.0server.host: \"0.0.0.0\"# Enables you to specify a path to mount Kibana at if you are running behind a proxy.# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath# from requests it receives, and to prevent a deprecation warning at startup.# This setting cannot end in a slash.#server.basePath: \"\"# Specifies whether Kibana should rewrite requests that are prefixed with# `server.basePath` or require that they are rewritten by your reverse proxy.# This setting was effectively always `false` before Kibana 6.3 and will# default to `true` starting in Kibana 7.0.#server.rewriteBasePath: false# The maximum payload size in bytes for incoming server requests.#server.maxPayloadBytes: 1048576# The Kibana server's name. This is used for display purposes.#server.name: \"your-hostname\"# 服务名称server.name: \"kibana\"# The URLs of the Elasticsearch instances to use for all your queries.#elasticsearch.hosts: [\"http://localhost:9200\"]# ES服务地址elasticsearch.hosts: [\"http://localhost:9200\"]# When this setting's value is true Kibana uses the hostname specified in the server.host# setting. When the value of this setting is false, Kibana uses the hostname of the host# that connects to this Kibana instance.#elasticsearch.preserveHost: true# Kibana uses an index in Elasticsearch to store saved searches, visualizations and# dashboards. Kibana creates a new index if the index doesn't already exist.# 创建的索引#kibana.index: \".kibana\"# The default application to load.#kibana.defaultAppId: \"home\"# If your Elasticsearch is protected with basic authentication, these settings provide# the username and password that the Kibana server uses to perform maintenance on the Kibana# index at startup. Your Kibana users still need to authenticate with Elasticsearch, which# is proxied through the Kibana server.# 登录ES使用的用户名和密码#elasticsearch.username: \"user\"#elasticsearch.password: \"pass\"# Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.# These settings enable SSL for outgoing requests from the Kibana server to the browser.#server.ssl.enabled: false#server.ssl.certificate: /path/to/your/server.crt#server.ssl.key: /path/to/your/server.key# Optional settings that provide the paths to the PEM-format SSL certificate and key files.# These files validate that your Elasticsearch backend uses the same key files.#elasticsearch.ssl.certificate: /path/to/your/client.crt#elasticsearch.ssl.key: /path/to/your/client.key# Optional setting that enables you to specify a path to the PEM file for the certificate# authority for your Elasticsearch instance.#elasticsearch.ssl.certificateAuthorities: [ \"/path/to/your/CA.pem\" ]# To disregard the validity of SSL certificates, change this setting's value to 'none'.#elasticsearch.ssl.verificationMode: full# Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of# the elasticsearch.requestTimeout setting.#elasticsearch.pingTimeout: 1500# Time in milliseconds to wait for responses from the back end or Elasticsearch. This value# must be a positive integer.#elasticsearch.requestTimeout: 30000# List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side# headers, set this value to [] (an empty list).#elasticsearch.requestHeadersWhitelist: [ authorization ]# Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten# by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.#elasticsearch.customHeaders: {}# Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.#elasticsearch.shardTimeout: 30000# Time in milliseconds to wait for Elasticsearch at Kibana startup before retrying.#elasticsearch.startupTimeout: 5000# Logs queries sent to Elasticsearch. Requires logging.verbose set to true.#elasticsearch.logQueries: false# Specifies the path where Kibana creates the process ID file.#pid.file: /var/run/kibana.pid# Enables you specify a file where Kibana stores log output.#logging.dest: stdout# Set the value of this setting to true to suppress all logging output.#logging.silent: false# Set the value of this setting to true to suppress all logging output other than error messages.#logging.quiet: false# Set the value of this setting to true to log all events, including system usage information# and all requests.#logging.verbose: false# Set the interval in milliseconds to sample system and process performance# metrics. Minimum is 100ms. Defaults to 5000.#ops.interval: 5000# Specifies locale to be used for all localizable strings, dates and number formats.#i18n.locale: \"en\"# 设置kibana为中文i18n.locale: \"zh-CN\" document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"Kibana","slug":"Kibana","permalink":"https://www.zhuqiaolun.com/tags/Kibana/"}]},{"title":"Maven项目的插件使用","slug":"2022/03/1646127631469/1646127631469","date":"2022-03-01T09:40:31.000Z","updated":"2024-12-20T06:56:25.797Z","comments":false,"path":"2022/03/1646127631469/1646127631469/","link":"","permalink":"https://www.zhuqiaolun.com/2022/03/1646127631469/1646127631469/","excerpt":"Maven项目的插件使用","text":"编译插件JDK版本 1234567891011&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt; &lt;!-- 可能需要版本号 --&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;configuration&gt; &lt;source&gt;1.8&lt;/source&gt; &lt;target&gt;1.8&lt;/target&gt; &lt;encoding&gt;UTF-8&lt;/encoding&gt; &lt;/configuration&gt;&lt;/plugin&gt; 源码打包12345678910111213&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt; &lt;version&gt;2.1.2&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;attach-sources&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;jar&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 依赖插件将子模块的class文件以及配置文件复制到根级目录下 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt; &lt;version&gt;2.8&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;copy-dependencies&lt;/id&gt; &lt;phase&gt;prepare-package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;copy-dependencies&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;!-- 将依赖包统一放到某个目录 --&gt; &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt; &lt;excludeScope&gt;provided&lt;/excludeScope&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;copy-resources&lt;/id&gt; &lt;phase&gt;prepare-package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;unpack&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;!--指定的依赖包--&gt; &lt;artifactItems&gt; &lt;artifactItem&gt; &lt;groupId&gt;com.demon&lt;/groupId&gt; &lt;artifactId&gt;demon-service-config&lt;/artifactId&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;type&gt;jar&lt;/type&gt; &lt;!-- 排除 --&gt; &lt;excludes&gt;code.properties,system-config-prod.yaml&lt;/excludes&gt; &lt;!-- 包含（需放在排序之后） --&gt; &lt;includes&gt;**/*&lt;/includes&gt; &lt;!-- 用来指定拷出后Libraries的存放地 --&gt; &lt;outputDirectory&gt;${project.build.directory}/classes&lt;/outputDirectory&gt; &lt;overWrite&gt;false&lt;/overWrite&gt; &lt;/artifactItem&gt; &lt;/artifactItems&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 依赖打包打出无/有依赖的jar,jar-with-dependencies结尾的表示含有jar的文件打包命令：clean assembly:assembly 1234567891011121314151617181920212223242526&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;appendAssemblyId&gt;false&lt;/appendAssemblyId&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;/descriptorRefs&gt; &lt;!-- 这部分可有可无,加上的话则直接生成可运行jar包 --&gt; &lt;archive&gt; &lt;manifest&gt; &lt;!-- 主函数 --&gt; &lt;mainClass&gt;com.demon.App&lt;/mainClass&gt; &lt;/manifest&gt; &lt;/archive&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assembly&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;assembly&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 安装第三方依赖包在src的同级目录下新增lib包，将xxx-0.0.1.jar放置在lib包下 123456789101112131415161718192021222324 &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt; &lt;version&gt;2.5.2&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;install-external&lt;/id&gt; &lt;phase&gt;clean&lt;/phase&gt; &lt;configuration&gt; &lt;file&gt;${basedir}/src/lib/demon-0.0.1.jar&lt;/file&gt; &lt;repositoryLayout&gt;default&lt;/repositoryLayout&gt; &lt;!-- 安装jar的属性 --&gt; &lt;groupId&gt;com.demon&lt;/groupId&gt; &lt;artifactId&gt;demon&lt;/artifactId&gt; &lt;version&gt;0.0.1&lt;/version&gt; &lt;packaging&gt;jar&lt;/packaging&gt; &lt;generatePom&gt;true&lt;/generatePom&gt; &lt;/configuration&gt; &lt;goals&gt; &lt;goal&gt;install-file&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 复制文件到指定目录把打包生成jar包复制到指定的位置 123456789101112131415161718192021222324&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt; &lt;version&gt;1.8&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;copy&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;run&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;target&gt; &lt;!--todir指定要复制到哪个位置，这里我设置为空则表示复制到当前项目下 eg：D:/jar--&gt; &lt;copy todir=\"${basedir}/packaging\"&gt; &lt;fileset dir=\"${project.build.directory}\"&gt; &lt;include name=\"${project.build.finalName}.${project.packaging}\"/&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;/target&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 复制资源文件到指定目录把打包需要生成的资源文件复制到指定的位置 12345678910111213141516171819202122232425&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;copy-resources&lt;/id&gt; &lt;phase&gt;process-resources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;copy-resources&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;outputDirectory&gt;${basedir}/packaging&lt;/outputDirectory&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;conf/**&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt;&lt;/plugin&gt; 打包资源文件排除打包不需要生成的资源文件 1234567891011&lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;!-- 资源根目录排除各环境的配置，防止在生成目录中多余其它目录 --&gt; &lt;excludes&gt; &lt;exclude&gt;font/*&lt;/exclude&gt; &lt;exclude&gt;conf/*&lt;/exclude&gt; &lt;exclude&gt;images/bg.png&lt;/exclude&gt; &lt;/excludes&gt; &lt;/resource&gt;&lt;/resources&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"}],"tags":[{"name":"pom","slug":"pom","permalink":"https://www.zhuqiaolun.com/tags/pom/"}]},{"title":"Yaml的配置文件读取","slug":"2022/02/1644832599629/1644832599629","date":"2022-02-14T09:56:39.000Z","updated":"2022-03-01T09:35:39.079Z","comments":false,"path":"2022/02/1644832599629/1644832599629/","link":"","permalink":"https://www.zhuqiaolun.com/2022/02/1644832599629/1644832599629/","excerpt":"Yaml的配置文件读取","text":"引入依赖1234567891011&lt;dependency&gt; &lt;groupId&gt;org.yaml&lt;/groupId&gt; &lt;artifactId&gt;snakeyaml&lt;/artifactId&gt; &lt;version&gt;1.29&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.20&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; 配置文件在项目resources下存在文件：config.yaml内容如下： 12345code: 000message: \"成功\"stringList: - \"hello\" - \"world\" 只要定义同等名称及类型即可赋值获取 类YamlUtils采用 @Data 注解 省略set/get 方法 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import lombok.Data;import org.yaml.snakeyaml.Yaml;import java.io.InputStream;import java.lang.reflect.Field;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021 2021/8/15 14:51 * desc ：读取yaml文件，并获取值 */@Datapublic class YamlUtils { private static YamlUtils yamlUtils; public static YamlUtils getInstance() { if (yamlUtils == null) { yamlUtils = new YamlUtils(); } return yamlUtils; } static { try { Yaml yaml = new Yaml(); InputStream inputStream = YamlUtils.class.getResourceAsStream(\"/config.yaml\"); // 可以将值转换为Map，通过map我们取值就可以了. Map&lt;String, Object&gt; ymlMap = yaml.load(inputStream); // 动态赋值 yamlUtils = YamlUtils.class.newInstance(); for (Field field : yamlUtils.getClass().getDeclaredFields()) { if (ymlMap.containsKey(field.getName())) { boolean flag = field.isAccessible(); field.setAccessible(true); Object object = ymlMap.get(field.getName()); if (object != null &amp;&amp; field.getType().isAssignableFrom(object.getClass())) { field.set(yamlUtils, object); } field.setAccessible(flag); } } } catch (Exception e) { e.printStackTrace(); } } private Integer code; private String message; private List&lt;String&gt; stringList;} 测试123456@Testpublic void Test1(){ System.out.println(YamlUtils.getInstance().getCode()); System.out.println(YamlUtils.getInstance().getMessage()); System.out.println(YamlUtils.getInstance().getStringList());} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Yaml","slug":"Yaml","permalink":"https://www.zhuqiaolun.com/tags/Yaml/"}]},{"title":"Maven多模块指定模块工程打包","slug":"2022/02/1644831407066/1644831407066","date":"2022-02-14T09:36:47.000Z","updated":"2022-02-14T09:53:24.539Z","comments":false,"path":"2022/02/1644831407066/1644831407066/","link":"","permalink":"https://www.zhuqiaolun.com/2022/02/1644831407066/1644831407066/","excerpt":"Maven多模块工程打包","text":"打包说明12345678Maven多模块工程打包指定模块工程执行如下命令：mvn clean package -pl 指定模块工程名 -am参数说明：-am --also-make 同时构建所列模块的依赖模块；-amd -also-make-dependents 同时构建依赖于所列模块的模块；-pl --projects &lt;arg&gt; 构建制定的模块，模块间用逗号分隔；-rf -resume-from &lt;arg&gt; 从指定的模块恢复反应堆。 项目结构123456789101112Parent - common 公共模块 - deploy 部署模块 - service1 部署服务1 -&gt; 引入 服务1 - service2 部署服务2 -&gt; 引入 服务2 - service3 部署服务3 -&gt; 引入 服务3 - forward 第三方模块 -&gt; 引入 公共模块 - framework Spring模块 -&gt; 引入 公共模块 - service 服务模块 - service1 服务1 -&gt; 引入 Spring模块 - service2 服务2 -&gt; 引入 Spring模块 - service3 服务3 -&gt; 引入 Spring模块 打包命令在根目录Parent下进行打包 打包部署service1模块 : mvn clean package -pl deploy/service1 -am 打包部署service2模块 : mvn clean package -pl deploy/service2 -am 打包部署service3模块 : mvn clean package -pl deploy/service3 -am document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"}],"tags":[{"name":"pom","slug":"pom","permalink":"https://www.zhuqiaolun.com/tags/pom/"}]},{"title":"日志之 logback 配置（SpringBoot）","slug":"2022/02/1644829623396/1644829623396","date":"2022-02-14T09:07:03.000Z","updated":"2026-01-20T08:22:35.765Z","comments":false,"path":"2022/02/1644829623396/1644829623396/","link":"","permalink":"https://www.zhuqiaolun.com/2022/02/1644829623396/1644829623396/","excerpt":"SpringBoot日志之logback","text":"根据不同的环境选择不同的日志配置：Jar部署 、War部署 依赖12345678910111213141516171819&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt; &lt;scope&gt;compile&lt;/scope&gt; &lt;/dependency&gt;&lt;/dependencies&gt; Jar使用自定义日志根路径：LogHomeConfig1234567891011121314import ch.qos.logback.core.PropertyDefinerBase;/** * logback日志路径配置 * 在logback-spring.xml使用：例如： * &lt;define name=\"LOG_HOME\" class=\"com.xxx.config.LogHomeConfig\" /&gt; */public class LogHomeConfig extends PropertyDefinerBase { @Override public String getPropertyValue() { String logHome = System.getProperty(\"user.home\") + File.separator + \"project-name\"; System.out.println(\"自定义日志路径:\" + logHome); return logHome; }} 引入文件 logback-spring.xml内容如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;&lt;!--status log4j2自身日志输出等级monitorInterval 自动检测间隔 30s--&gt;&lt;configuration scan=\"true\" scanPeriod=\"30 seconds\" debug=\"false\"&gt; &lt;!-- 日志格式和颜色渲染 --&gt; &lt;!-- 彩色日志依赖的渲染类 --&gt; &lt;conversionRule conversionWord=\"clr\" converterClass=\"org.springframework.boot.logging.logback.ColorConverter\"/&gt; &lt;conversionRule conversionWord=\"wex\" converterClass=\"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter\"/&gt; &lt;conversionRule conversionWord=\"wEx\" converterClass=\"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter\"/&gt; &lt;!-- 取配置类的值 --&gt; &lt;define name=\"LOG_HOME\" class=\"com.xxx.config.LogHomeConfig\"/&gt; &lt;!-- 设置上下文名称 --&gt; &lt;contextName value=\"ProjectName\"/&gt; &lt;!-- 定义参数 --&gt; &lt;property name=\"logback.dirPath\" value=\"${LOG_HOME}\"/&gt; &lt;property name=\"logback.contextName\" value=\"logs\"/&gt; &lt;property name=\"logback.lever\" value=\"DEBUG\"/&gt; &lt;property name=\"logback.pattern\" value=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;property name=\"logback.MaxFileSize\" value=\"1MB\"/&gt; &lt;property name=\"logback.maxHistory\" value=\"7\"/&gt; &lt;!-- 日志格式 --&gt; &lt;property name=\"CONSOLE_LOG_PATTERN\" value=\"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}\"/&gt; &lt;!--子节点一: 输出到控制台 --&gt; &lt;appender name=\"CONSOLE_APPENDER\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt; &lt;filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\"&gt; &lt;level&gt;debug&lt;/level&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;Pattern&gt;${CONSOLE_LOG_PATTERN}&lt;/Pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- 输出到文件 --&gt; &lt;!-- 按照每天生成日志文件 --&gt; &lt;!-- TRACE --&gt; &lt;appender name=\"TRACE_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/trace.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;!--日志文件输出的文件名--&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/trace.logs-%i.log &lt;/fileNamePattern&gt; &lt;!--日志文件最大的大小--&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;!--日志文件保留天数--&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- DEBUG --&gt; &lt;appender name=\"DEBUG_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/debug.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/debug.logs-%i.log &lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- INFO --&gt; &lt;appender name=\"INFO_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/info.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/info.logs-%i.log&lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- WARN --&gt; &lt;appender name=\"WARN_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/warn.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/warn.logs-%i.log&lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- ERROR --&gt; &lt;appender name=\"ERROR_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/error.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/error.logs-%i.log &lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!--第三方日志配置--&gt; &lt;logger name=\"com.yetech.platform.assistant\" level=\"DEBUG\"/&gt; &lt;logger name=\"org.elasticsearch.client.RestClient\" level=\"DEBUG\"/&gt; &lt;logger name=\"org.apache.axis\" level=\"info\"/&gt; &lt;logger name=\"org.apache.http\" level=\"info\"/&gt; &lt;logger name=\"com.baomidou.mybatisplus.core.MybatisConfiguration\" level=\"info\"/&gt; &lt;logger name=\"com.zaxxer.hikari\" level=\"info\"/&gt; &lt;logger name=\"org.springframework\" level=\"info\"/&gt; &lt;logger name=\"org.springframework.web.servlet.DispatcherServlet\" level=\"${logback.lever}\"/&gt; &lt;!-- 日志输出级别 --&gt; &lt;root level=\"${logback.lever}\"&gt; &lt;appender-ref ref=\"CONSOLE_APPENDER\"/&gt; &lt;appender-ref ref=\"TRACE_APPENDER\" /&gt; &lt;appender-ref ref=\"DEBUG_APPENDER\"/&gt; &lt;appender-ref ref=\"INFO_APPENDER\"/&gt; &lt;appender-ref ref=\"WARN_APPENDER\"/&gt; &lt;appender-ref ref=\"ERROR_APPENDER\"/&gt; &lt;/root&gt;&lt;/configuration&gt; War使用引入文件 logback-spring.xml内容如下： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;&lt;!--status log4j2自身日志输出等级monitorInterval 自动检测间隔 30s--&gt;&lt;configuration scan=\"true\" scanPeriod=\"30 seconds\" debug=\"false\"&gt; &lt;!-- 日志格式和颜色渲染 --&gt; &lt;!-- 彩色日志依赖的渲染类 --&gt; &lt;conversionRule conversionWord=\"clr\" converterClass=\"org.springframework.boot.logging.logback.ColorConverter\"/&gt; &lt;conversionRule conversionWord=\"wex\" converterClass=\"org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter\"/&gt; &lt;conversionRule conversionWord=\"wEx\" converterClass=\"org.springframework.boot.logging.logback.ExtendedWhitespaceThrowableProxyConverter\"/&gt; &lt;!-- 设置上下文名称 --&gt; &lt;contextName value=\"ProjectName\"/&gt; &lt;!-- 定义参数 --&gt; &lt;property name=\"logback.dirPath\" value=\"${catalina.base}/logs\"/&gt; &lt;property name=\"logback.contextName\" value=\"ProjectName\"/&gt; &lt;property name=\"logback.lever\" value=\"info\"/&gt; &lt;property name=\"logback.pattern\" value=\"%d{yyyy-MM-dd HH:mm:ss.SSS}[%p][%t] %c[%L] - %m %n\"/&gt; &lt;property name=\"logback.MaxFileSize\" value=\"5MB\"/&gt; &lt;property name=\"logback.maxHistory\" value=\"30\"/&gt; &lt;!-- 日志格式 --&gt; &lt;property name=\"CONSOLE_LOG_PATTERN\" value=\"${CONSOLE_LOG_PATTERN:-%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(${LOG_LEVEL_PATTERN:-%5p}) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:-%wEx}}\"/&gt; &lt;!--子节点一: 输出到控制台 --&gt; &lt;appender name=\"CONSOLE_APPENDER\" class=\"ch.qos.logback.core.ConsoleAppender\"&gt; &lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt; &lt;filter class=\"ch.qos.logback.classic.filter.ThresholdFilter\"&gt; &lt;level&gt;debug&lt;/level&gt; &lt;/filter&gt; &lt;encoder&gt; &lt;Pattern&gt;${CONSOLE_LOG_PATTERN}&lt;/Pattern&gt; &lt;/encoder&gt; &lt;/appender&gt; &lt;!-- 输出到文件 --&gt; &lt;!-- 按照每天生成日志文件 --&gt; &lt;!-- TRACE --&gt; &lt;appender name=\"TRACE_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/trace.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;!--日志文件输出的文件名--&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/trace.logs-%i.log &lt;/fileNamePattern&gt; &lt;!--日志文件最大的大小--&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;!--日志文件保留天数--&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;TRACE&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- DEBUG --&gt; &lt;appender name=\"DEBUG_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/debug.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/debug.logs-%i.log &lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;DEBUG&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- INFO --&gt; &lt;appender name=\"INFO_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/info.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/info.logs-%i.log&lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;INFO&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- WARN --&gt; &lt;appender name=\"WARN_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/warn.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/warn.logs-%i.log&lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;WARN&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!-- ERROR --&gt; &lt;appender name=\"ERROR_APPENDER\" class=\"ch.qos.logback.core.rolling.RollingFileAppender\"&gt; &lt;file&gt;${logback.dirPath}/${logback.contextName}/error.log&lt;/file&gt; &lt;append&gt;true&lt;/append&gt; &lt;rollingPolicy class=\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"&gt; &lt;fileNamePattern&gt;${logback.dirPath}/${logback.contextName}/%d{yyyy-MM-dd}/error.logs-%i.log &lt;/fileNamePattern&gt; &lt;MaxFileSize&gt;${logback.MaxFileSize}&lt;/MaxFileSize&gt; &lt;MaxHistory&gt;${logback.maxHistory}&lt;/MaxHistory&gt; &lt;/rollingPolicy&gt; &lt;encoder&gt; &lt;pattern&gt;${logback.pattern}&lt;/pattern&gt; &lt;charset&gt;UTF-8&lt;/charset&gt; &lt;/encoder&gt; &lt;filter class=\"ch.qos.logback.classic.filter.LevelFilter\"&gt; &lt;level&gt;ERROR&lt;/level&gt; &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt; &lt;onMismatch&gt;DENY&lt;/onMismatch&gt; &lt;/filter&gt; &lt;/appender&gt; &lt;!--第三方日志配置--&gt; &lt;logger name=\"com.demo\" level=\"DEBUG\"/&gt; &lt;logger name=\"org.apache.axis\" level=\"info\"/&gt; &lt;logger name=\"org.apache.http\" level=\"info\"/&gt; &lt;logger name=\"com.baomidou.mybatisplus.core.MybatisConfiguration\" level=\"info\"/&gt; &lt;logger name=\"com.zaxxer.hikari\" level=\"info\"/&gt; &lt;logger name=\"org.springframework\" level=\"info\"/&gt; &lt;logger name=\"org.springframework.web\" level=\"${logback.lever}\"/&gt; &lt;!-- 日志输出级别 --&gt; &lt;root level=\"${logback.lever}\"&gt; &lt;appender-ref ref=\"CONSOLE_APPENDER\"/&gt; &lt;appender-ref ref=\"TRACE_APPENDER\"/&gt; &lt;appender-ref ref=\"DEBUG_APPENDER\"/&gt; &lt;appender-ref ref=\"INFO_APPENDER\"/&gt; &lt;appender-ref ref=\"WARN_APPENDER\"/&gt; &lt;appender-ref ref=\"ERROR_APPENDER\"/&gt; &lt;/root&gt;&lt;/configuration&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"}],"tags":[{"name":"logback","slug":"logback","permalink":"https://www.zhuqiaolun.com/tags/logback/"}]},{"title":"分布式自增ID算法---雪花算法","slug":"2022/02/1644472320483/1644472320483","date":"2022-02-10T05:52:00.000Z","updated":"2022-02-14T09:01:27.810Z","comments":false,"path":"2022/02/1644472320483/1644472320483/","link":"","permalink":"https://www.zhuqiaolun.com/2022/02/1644472320483/1644472320483/","excerpt":"分布式自增ID算法---雪花算法","text":"规则SnowFlake的结构如下(每部分用-分开):0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 0000000000001位标识，由于long基本类型在Java中是带符号的，最高位是符号位，正数是0，负数是1，所以id一般是正数，最高位是041位时间截(毫秒级)，注意，41位时间截不是存储当前时间的时间截，而是存储时间截的差值（当前时间截 - 开始时间截)得到的值），这里的的开始时间截，一般是我们的id生成器开始使用的时间，由我们程序来指定的（如下下面程序IdWorker类的startTime属性）。41位的时间截，可以使用69年，年T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 6910位的数据机器位，可以部署在1024个节点，包括5位datacenterId和5位workerId12位序列，毫秒内的计数，12位的计数顺序号支持每个节点每毫秒(同一机器，同一时间截)产生4096个ID序号加起来刚好64位，为一个Long型。 SnowFlake的优点是，整体上按照时间自增排序，并且整个分布式系统内不会产生ID碰撞(由数据中心ID和机器ID作区分)，并且效率较高，经测试，SnowFlake每秒能够产生26万ID左右。 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121public class SnowflakeIdWorker { /** 开始时间截 (2015-01-01) */ private final long twepoch = 1489111610226L; /** 机器id所占的位数 */ private final long workerIdBits = 5L; /** 数据标识id所占的位数 */ private final long dataCenterIdBits = 5L; /** 支持的最大机器id，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数) */ private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); /** 支持的最大数据标识id，结果是31 */ private final long maxDataCenterId = -1L ^ (-1L &lt;&lt; dataCenterIdBits); /** 序列在id中占的位数 */ private final long sequenceBits = 12L; /** 机器ID向左移12位 */ private final long workerIdShift = sequenceBits; /** 数据标识id向左移17位(12+5) */ private final long dataCenterIdShift = sequenceBits + workerIdBits; /** 时间截向左移22位(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + dataCenterIdBits; /** 生成序列的掩码，这里为4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); /** 工作机器ID(0~31) */ private long workerId; /** 数据中心ID(0~31) */ private long dataCenterId; /** 毫秒内序列(0~4095) */ private long sequence = 0L; /** 上次生成ID的时间截 */ private long lastTimestamp = -1L; //==============================Constructors===================================== /** * 构造函数 * @param workerId 工作ID (0~31) * @param dataCenterId 数据中心ID (0~31) */ public SnowflakeIdWorker(long workerId, long dataCenterId) { if (workerId &gt; maxWorkerId || workerId &lt; 0) { throw new IllegalArgumentException(String.format(\"workerId can't be greater than %d or less than 0\", maxWorkerId)); } if (dataCenterId &gt; maxDataCenterId || dataCenterId &lt; 0) { throw new IllegalArgumentException(String.format(\"dataCenterId can't be greater than %d or less than 0\", maxDataCenterId)); } this.workerId = workerId; this.dataCenterId = dataCenterId; } // ==============================Methods========================================== /** * 获得下一个ID (该方法是线程安全的) * @return SnowflakeId */ public synchronized long nextId() { long timestamp = timeGen(); //如果当前时间小于上一次ID生成的时间戳，说明系统时钟回退过这个时候应当抛出异常 if (timestamp &lt; lastTimestamp) { throw new RuntimeException( String.format(\"Clock moved backwards. Refusing to generate id for %d milliseconds\", lastTimestamp - timestamp)); } //如果是同一时间生成的，则进行毫秒内序列 if (lastTimestamp == timestamp) { sequence = (sequence + 1) &amp; sequenceMask; //毫秒内序列溢出 if (sequence == 0) { //阻塞到下一个毫秒,获得新的时间戳 timestamp = tilNextMillis(lastTimestamp); } } //时间戳改变，毫秒内序列重置 else { sequence = 0L; } //上次生成ID的时间截 lastTimestamp = timestamp; //移位并通过或运算拼到一起组成64位的ID return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) // | (dataCenterId &lt;&lt; dataCenterIdShift) // | (workerId &lt;&lt; workerIdShift) // | sequence; } /** * 阻塞到下一个毫秒，直到获得新的时间戳 * @param lastTimestamp 上次生成ID的时间截 * @return 当前时间戳 */ protected long tilNextMillis(long lastTimestamp) { long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) { timestamp = timeGen(); } return timestamp; } /** * 返回以毫秒为单位的当前时间 * @return 当前时间(毫秒) */ protected long timeGen() { return System.currentTimeMillis(); }} 测试12345678910public static void main(String[] args) { System.out.println(System.currentTimeMillis()); SnowflakeIdWorker idWorker = new SnowflakeIdWorker(1, 1); long startTime = System.nanoTime(); for (int i = 0; i &lt; 50000; i++) { long id = idWorker.nextId(); System.out.println(id); } System.out.println((System.nanoTime()-startTime)/1000000+\"ms\");} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Snowflake","slug":"Snowflake","permalink":"https://www.zhuqiaolun.com/tags/Snowflake/"}]},{"title":"Go-FastDfs 使用","slug":"2021/11/1636190973137/1636190973137","date":"2021-11-06T09:29:33.000Z","updated":"2024-08-16T08:35:25.478Z","comments":false,"path":"2021/11/1636190973137/1636190973137/","link":"","permalink":"https://www.zhuqiaolun.com/2021/11/1636190973137/1636190973137/","excerpt":"Go-FastDfs","text":"安装 依赖12345678910&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.76&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;3.9.1&lt;/version&gt;&lt;/dependency&gt; 上传1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import okhttp3.*;/** * author ：demon * date ：2021 2021/5/26 11:36 * desc ：GoFast工具类 */public class GoFastFileService { public GoFastFileResult upload(String url, String scene, String fileName, byte[] bytes) throws Exception { MultipartBody multipartBody = new MultipartBody.Builder(). setType(MultipartBody.FORM) .addFormDataPart(\"file\", fileName, RequestBody.create(MediaType.parse(\"multipart/form-data;charset=utf-8\"), bytes)) .addFormDataPart(\"output\", \"json\") .addFormDataPart(\"scene\", scene) .build(); try { GoFastFileResult goFastFileResult = new GoFastFileResult(); Request request = new Request.Builder().url(url).post(multipartBody).build(); Response response = new OkHttpClient().newCall(request).execute(); if (response.isSuccessful()) { ResponseBody body = response.body(); if (body != null) { String result = body.string(); System.out.println(result); JSONObject jsonObject = JSON.parseObject(result); if(String.valueOf(jsonObject.get(\"status\")).equals(\"fail\")){ throw new Exception(\"上传文件异常:\"+ jsonObject.get(\"message\")); } else { goFastFileResult.setUrl(String.valueOf(jsonObject.get(\"url\"))); goFastFileResult.setMd5(String.valueOf(jsonObject.get(\"md5\"))); goFastFileResult.setPath(String.valueOf(jsonObject.get(\"path\"))); goFastFileResult.setDomain(String.valueOf(jsonObject.get(\"domain\"))); goFastFileResult.setScene(String.valueOf(jsonObject.get(\"scene\"))); goFastFileResult.setSize(Long.parseLong(String.valueOf(jsonObject.get(\"size\")))); goFastFileResult.setMtime(Long.parseLong(String.valueOf(jsonObject.get(\"mtime\")))); goFastFileResult.setScenes(String.valueOf(jsonObject.get(\"scenes\"))); goFastFileResult.setRetmsg(String.valueOf(jsonObject.get(\"retmsg\"))); goFastFileResult.setRetcode(String.valueOf(jsonObject.get(\"retcode\")).equals(\"0\")); goFastFileResult.setSrc(String.valueOf(jsonObject.get(\"src\"))); } } } return goFastFileResult; } catch (Exception e) { log.error(\"上传文件到影像服务器异常\", e); throw new Exception(\"上传文件异常\",e); } }} 返回值的实体类 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108/** * author ：demon * date ：2021 2021/5/26 13:23 * desc ：GoFastFile 结果返回映射 */public class GoFastFileResult implements Serializable { private String url; private String md5; private String path; private String domain; private String scene; private long size; private long mtime; private String scenes; private String retmsg; private Boolean retcode; private String src; public String getUrl() { return url; } public void setUrl(String url) { this.url = url; } public String getMd5() { return md5; } public void setMd5(String md5) { this.md5 = md5; } public String getPath() { return path; } public void setPath(String path) { this.path = path; } public String getDomain() { return domain; } public void setDomain(String domain) { this.domain = domain; } public String getScene() { return scene; } public void setScene(String scene) { this.scene = scene; } public long getSize() { return size; } public void setSize(long size) { this.size = size; } public long getMtime() { return mtime; } public void setMtime(long mtime) { this.mtime = mtime; } public String getScenes() { return scenes; } public void setScenes(String scenes) { this.scenes = scenes; } public String getRetmsg() { return retmsg; } public void setRetmsg(String retmsg) { this.retmsg = retmsg; } public Boolean getRetcode() { return retcode; } public void setRetcode(Boolean retcode) { this.retcode = retcode; } public String getSrc() { return src; } public void setSrc(String src) { this.src = src; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/categories/Go-FastDfs/"}],"tags":[{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/tags/Go-FastDfs/"}]},{"title":"ElasticSearch的浏览插件 - elasticsearch-head","slug":"2021/07/1626760500688/1626760500688","date":"2021-07-20T05:55:00.000Z","updated":"2022-03-02T06:36:05.024Z","comments":false,"path":"2021/07/1626760500688/1626760500688/","link":"","permalink":"https://www.zhuqiaolun.com/2021/07/1626760500688/1626760500688/","excerpt":"ElasticSearch的浏览插件 - elasticsearch-head","text":"ElasticSearch-head页面介绍在登陆和访问head插件地址和ElasticSearch前需要事先在服务器上安装和配置好ElasticSearch以及head插件。安装完后，默认head插件的web端口为9100，ElasticSearch服务的端口为9200，使用浏览器访问head地址，如 http://localhost:9100/，推荐使用Chrome浏览器，head插件对Chrome浏览器兼容更佳。进入head页面后将ElasticSearch连接输入框中填写正确的ElasticSearch服务地址，如 http://localhost:9200/。 下载网址 https://github.com/mobz/elasticsearch-head下载 https://github.com/mobz/elasticsearch-head/archive/refs/heads/master.zip 解压 进入head文件夹下，执行命令：npm install (此处是为安装进行安装pathomjs) 启动安装完成之后 npm run start 启动head插件 访问：http://localhost:9100/ 修改es配置修改es使用的参数.编辑目录下的config\\elasticsearch.yml文件, 123# 增加新的参数，这样head插件可以访问eshttp.cors.enabled: true http.cors.allow-origin: \"*\" 修改完配置将es重启,浏览器访问 http://localhost:9100 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/tags/ElasticSearch/"}]},{"title":"ElasticSearch-v6.8.1的安装","slug":"2021/07/1626758495025/1626758495025","date":"2021-07-20T05:21:35.000Z","updated":"2022-03-02T06:24:37.286Z","comments":false,"path":"2021/07/1626758495025/1626758495025/","link":"","permalink":"https://www.zhuqiaolun.com/2021/07/1626758495025/1626758495025/","excerpt":"ElasticSearch，Windows，Linux 的安装","text":"前置ElasticSearch是基于lucence开发的，也就是运行需要java jdk支持，所以要先安装JAVA环境。由于ElasticSearch 5.x 往后依赖于JDK 1.8的，所以现在我们下载JDK 1.8或者更高版本。下载JDK1.8,下载完成后安装 如若不安装JDK，可使用ElasticSearch的自带的JDK 使用自带的JDK 下载官网elasticsearch-6-8-1 解压 运行进入bin目录下,双击执行elasticsearch.bat 浏览器访问：http://localhost:9200 配置远程访问修改es使用的参数.编辑目录下的config\\elasticsearch.yml文件, 1234network.host: 0.0.0.0 http.port: 9200cluster.initial_master_nodes: [\"node-1\"] 使用自带的JDK在bin目录下找到elasticsearch-env.bat并打开，加入你es7本身自带的jdk路径：rem 配置es自己的jdkset ES_JAVA_HOME=D:\\services\\elasticsearch-7.13.3\\jdk ElasticSearch安装为Windows服务bin目录下有一个文件 elasticsearch-service.bat 执行: elasticsearch-service.bat install 即可安装为服务 安装ElasticSearch服务： elasticsearch-service.bat install 删除已安装的ElasticSearch服务（如果启动则停止服务） elasticsearch-service.bat remove 启动ElasticSearch服务（如果已安装） elasticsearch-service.bat start 停止ElasticSearch服务（如果已安装） elasticsearch-service.bat stop 启动GUI来管理已安装的服务 elasticsearch-service.bat manager document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"}],"tags":[{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/tags/ElasticSearch/"}]},{"title":"Freemarker 封装工具类","slug":"2021/07/1625196322877/1625196322877","date":"2021-07-02T03:25:22.000Z","updated":"2025-06-05T09:52:17.142Z","comments":false,"path":"2021/07/1625196322877/1625196322877/","link":"","permalink":"https://www.zhuqiaolun.com/2021/07/1625196322877/1625196322877/","excerpt":"Freemarker 封装工具类","text":"配置 FreemarkerService： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859import java.io.File;import java.util.Map;/** * className FreemarkerService * author demon * createTime 2021/5/20 17:40 * description 生成静态页面service */public interface FreemarkerService { /** * 生成静态页面 * * @param ftlName 模板名称 * @param params 数据模型 * @param outFile 输出文件 * @return 返回 */ boolean createStaticHtml(String ftlName, Map&lt;Object, Object&gt; params, File outFile); /** * 生成静态数据 * * @param ftlName 模板名称 * @param params 数据模型 * @return 返回 * @throws Exception 异常 */ String createStaticData(String ftlName, Map&lt;Object, Object&gt; params) throws Exception; /** * 渲染静态数据 * * @param ftlName 模板名称 - 自定义(随便一个值都行) * @param ftlStr 模板字符串 - 内容 * @param params 数据模型 * @return 返回 * @throws Exception 异常 */ String createStaticData(String ftlName,String ftlStr, Map&lt;Object, Object&gt; params) throws Exception; /** * 渲染静态数据 * * @param ftlName 模板名称 - 自定义(随便一个值都行) * @param inputStream 模板字符串 - 内容 （文件流） * resources目录下的文件 如： * InputStream inputStream = xxx.class.getResourceAsStream(\"/ftl/example.ftl\"); * @param params 数据模型 * @return 返回 * @throws Exception 异常 */ String createStaticData(String ftlName, InputStream inputStream, Map&lt;Object, Object&gt; params) throws Exception;} 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106import freemarker.template.Configuration;import freemarker.template.Template;import freemarker.template.TemplateException;import org.apache.commons.io.FileUtils;import org.apache.commons.io.IOUtils;import org.springframework.stereotype.Service;import org.springframework.ui.freemarker.FreeMarkerTemplateUtils;import javax.annotation.Resource;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.InputStream;import java.util.Map;/** * className FreemarkerServiceImpl * author demon * createTime 2021/5/20 17:40 */@Servicepublic class FreemarkerServiceImpl implements FreemarkerService { @Resource private Configuration configuration; @Override public boolean createStaticHtml(String ftlName, Map&lt;Object, Object&gt; params, File outFile) { InputStream inputStream = null; FileOutputStream fileOutputStream = null; try { //获取模板 Template template = configuration.getTemplate(ftlName); // 静态化页面内容 String content = FreeMarkerTemplateUtils.processTemplateIntoString(template, params); inputStream = IOUtils.toInputStream(content, \"UTF-8\"); // 输出文件 FileUtils.forceMkdirParent(outFile); fileOutputStream = new FileOutputStream(outFile); IOUtils.copy(inputStream, fileOutputStream); return true; } catch (IOException | TemplateException e) { e.printStackTrace(); return false; } finally { // 关闭流 if (inputStream != null) { try { inputStream.close(); } catch (IOException e) { e.printStackTrace(); } finally { if (fileOutputStream != null) { try { fileOutputStream.close(); } catch (IOException e) { e.printStackTrace(); } } } } } } @Override public String createStaticData(String ftlName, Map&lt;Object, Object&gt; params) throws Exception { try { //获取模板 Template template = configuration.getTemplate(ftlName); // 静态化数据内容 return FreeMarkerTemplateUtils.processTemplateIntoString(template, params); } catch (IOException | TemplateException e) { e.printStackTrace(); throw new Exception(e); } } @Override public String createStaticData(String ftlName, String templateStr, Map&lt;Object, Object&gt; params) throws Exception { try { //创建模板 Template template = new Template(ftlName, templateStr, configuration); // 渲染静态数据内容 return FreeMarkerTemplateUtils.processTemplateIntoString(template, params); } catch (IOException | TemplateException e) { e.printStackTrace(); throw new Exception(e); } } @Override public String createStaticData(String ftlName, InputStream inputStream, Map&lt;Object, Object&gt; params) throws Exception { try { String ftlStr = IOUtils.toString(inputStream, \"utf-8\"); //创建模板 Template template = new Template(ftlName, ftlStr, configuration); // 渲染静态数据内容 return FreeMarkerTemplateUtils.processTemplateIntoString(template, params); } catch (IOException | TemplateException e) { e.printStackTrace(); throw new Exception(e); } }} 模板：example.ftl： 123{ \"username\": \"${username}\"} 示例1： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051@Testvoid 测试模板_静态页面() { String ftlName = \"example.ftl\"; Map&lt;Object, Object&gt; params = new HashMap&lt;&gt;(); params.put(\"username\", \"测试888\"); System.out.println(JSONObject.toJSONString(params)); File outFile = new File(\"d:/test/page/test.html\"); System.out.println(freemarkerService.createStaticHtml(ftlName, params, outFile));} @Testvoid 测试模板_渲染数据1() { String ftlName = \"example.ftl\"; String templateValue = \"hello,${username}\"; Map&lt;Object, Object&gt; params = new HashMap&lt;&gt;(); params.put(\"username\",\"测试888\"); try { System.out.println(freemarkerService.createStaticData(ftlName,params)); } catch (Exception e) { e.printStackTrace(); }}@Testvoid 测试模板_渲染数据2() { String ftlName = \"example.ftl\"; String templateStr = \"hello,${username}\"; Map&lt;Object, Object&gt; params = new HashMap&lt;&gt;(); params.put(\"username\",\"测试888\"); try { System.out.println(freemarkerService.createStaticData(ftlName,templateStr,params)); } catch (Exception e) { e.printStackTrace(); }}@Testvoid 测试模板_渲染数据3() { String ftlName = \"example.ftl\"; String templateValue = \"hello,${username}\"; Map&lt;Object, Object&gt; params = new HashMap&lt;&gt;(); params.put(\"username\", \"测试888\"); System.out.println(JSONObject.toJSONString(params)); try { InputStream inputStream = xxx.class.getResourceAsStream(\"/ftl/example.ftl\"); System.out.println(freemarkerService.createStaticData(ftlName, inputStream, params)); } catch (Exception e) { e.printStackTrace(); }} 运行结果： 1234hello,测试888{ \"username\": \"测试888\"} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"freemarker","slug":"freemarker","permalink":"https://www.zhuqiaolun.com/tags/freemarker/"}]},{"title":"RedisTemplate 封装工具类","slug":"2021/07/1625194461536/1625194461536","date":"2021-07-02T02:54:21.000Z","updated":"2021-07-02T05:13:56.012Z","comments":false,"path":"2021/07/1625194461536/1625194461536/","link":"","permalink":"https://www.zhuqiaolun.com/2021/07/1625194461536/1625194461536/","excerpt":"RedisTemplate 封装工具类","text":"配置 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Component;import org.springframework.util.CollectionUtils;import javax.annotation.Resource;import java.util.List;import java.util.Map;import java.util.Set;import java.util.concurrent.TimeUnit;/** * @author: Demon * @date 2019/8/19 14:34 * @description: 封装redisUtil类 */@SuppressWarnings(\"ConstantConditions\")@Slf4j@Componentpublic class RedisTemplateUtil { @Resource private RedisTemplate&lt;String, Object&gt; redisTemplate; /** * 指定缓存失效时间 * @param key 键 * @param time 时间(秒) */ public boolean expire(String key, long time) { try { if (time &gt; 0) { redisTemplate.expire(key, time, TimeUnit.SECONDS); } log.info(\"指定缓存失效时间成功，key:{}, time:{}\", key, time); return true; } catch (Exception e) { log.info(\"指定缓存失效时间错误，key:{}, time:{}\", key, time); return false; } } /** * 根据key 获取过期时间 * @param key 键 不能为null * @return 时间(秒) 返回0代表为永久有效 */ @SuppressWarnings(\"ConstantConditions\") public long getExpire(String key) { log.info(\"获取过期时间，key:{}\", key); return redisTemplate.getExpire(key, TimeUnit.SECONDS); } /** * 判断key是否存在 * @param key 键 * @return true 存在 false不存在 */ public boolean hasKey(String key) { try { log.info(\"判断key是否存在，key:{}\", key); return redisTemplate.hasKey(key); } catch (Exception e) { log.info(\"判断key是否存在error，key:{}\", key); return false; } } /** * 删除缓存 * @param key 可以传一个值 或多个 */ public void del(String... key) { if (key != null &amp;&amp; key.length &gt; 0) { if (key.length == 1) { redisTemplate.delete(key[0]); } else { redisTemplate.delete(CollectionUtils.arrayToList(key)); } } } /** * 普通缓存获取 * @param key 键 * @return 值 */ public Object get(String key) { redisTemplate.getConnectionFactory().getConnection(); log.info(\"获取缓存, key:{}\", key); return key == null ? null : redisTemplate.opsForValue().get(key); } /** * 普通缓存放入 * @param key 键 * @param value 值 * @return true成功 false失败 */ public boolean set(String key, Object value) { try { System.out.println(redisTemplate.getConnectionFactory().getConnection()); redisTemplate.opsForValue().set(key, value); log.info(\"保存缓存, key:{}, value:{}\", key, value); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 普通缓存放入并设置时间 * @param key 键 * @param value 值 * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期 * @return true成功 false 失败 */ public boolean set(String key, Object value, long time) { try { if (time &gt; 0) { redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS); } else { set(key, value); } log.info(\"保存缓存并设置时间, key:{}, value:{}, time:{}\", key, value, time); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 递增 * @param key 键 * @param delta 要增加几(大于0) */ public long incr(String key, long delta) { if (delta &lt; 0) { throw new RuntimeException(\"递增因子必须大于0\"); } return redisTemplate.opsForValue().increment(key, delta); } /** * 递减 * @param key 键 * @param delta 要减少几(小于0) * @return 值 */ public long decr(String key, long delta) { if (delta &lt; 0) { throw new RuntimeException(\"递减因子必须大于0\"); } return redisTemplate.opsForValue().increment(key, -delta); } /** * HashGet * @param key 键 不能为null * @param item 项 不能为null * @return 值 */ public Object hget(String key, String item) { return redisTemplate.opsForHash().get(key, item); } /** * 获取hashKey对应的所有键值 * @param key 键 * @return 对应的多个键值 */ public Map&lt;Object, Object&gt; hmget(String key) { return redisTemplate.opsForHash().entries(key); } /** * HashSet * @param key 键 * @param map 对应多个键值 * @return true 成功 false 失败 */ public boolean hmset(String key, Map&lt;String, Object&gt; map) { try { redisTemplate.opsForHash().putAll(key, map); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * HashSet 并设置时间 * @param key 键 * @param map 对应多个键值 * @param time 时间(秒) * @return true成功 false失败 */ public boolean hmset(String key, Map&lt;String, Object&gt; map, long time) { try { redisTemplate.opsForHash().putAll(key, map); if (time &gt; 0) { expire(key, time); } return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 向一张hash表中放入数据,如果不存在将创建 * @param key 键 * @param item 项 * @param value 值 * @return true 成功 false失败 */ public boolean hset(String key, String item, Object value) { try { redisTemplate.opsForHash().put(key, item, value); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 向一张hash表中放入数据,如果不存在将创建 * @param key 键 * @param item 项 * @param value 值 * @param time 时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间 * @return true 成功 false失败 */ public boolean hset(String key, String item, Object value, long time) { try { redisTemplate.opsForHash().put(key, item, value); if (time &gt; 0) { expire(key, time); } return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 删除hash表中的值 * @param key 键 不能为null * @param item 项 可以使多个 不能为null */ public void hdel(String key, Object... item) { redisTemplate.opsForHash().delete(key, item); } /** * 判断hash表中是否有该项的值 * @param key 键 不能为null * @param item 项 不能为null * @return true 存在 false不存在 */ public boolean hHasKey(String key, String item) { return redisTemplate.opsForHash().hasKey(key, item); } /** * hash递增 如果不存在,就会创建一个 并把新增后的值返回 * @param key 键 * @param item 项 * @param by 要增加几(大于0) */ public double hincr(String key, String item, double by) { return redisTemplate.opsForHash().increment(key, item, by); } /** * hash递减 * @param key 键 * @param item 项 * @param by 要减少记(小于0) */ public double hdecr(String key, String item, double by) { return redisTemplate.opsForHash().increment(key, item, -by); } /** * 根据key获取Set中的所有值 * @param key 键 */ public Set&lt;Object&gt; sGet(String key) { try { return redisTemplate.opsForSet().members(key); } catch (Exception e) { e.printStackTrace(); return null; } } /** * 根据value从一个set中查询,是否存在 * @param key 键 * @param value 值 * @return true 存在 false不存在 */ public boolean sHasKey(String key, Object value) { try { return redisTemplate.opsForSet().isMember(key, value); } catch (Exception e) { e.printStackTrace(); return false; } } /** * 将数据放入set缓存 * @param key 键 * @param values 值 可以是多个 */ public long sSet(String key, Object... values) { try { return redisTemplate.opsForSet().add(key, values); } catch (Exception e) { e.printStackTrace(); return 0; } } /** * 将set数据放入缓存 * @param key 键 * @param time 时间(秒) * @param values 值 可以是多个 */ public long sSetAndTime(String key, long time, Object... values) { try { Long count = redisTemplate.opsForSet().add(key, values); if (time &gt; 0){ expire(key, time); } return count; } catch (Exception e) { e.printStackTrace(); return 0; } } /** * 获取set缓存的长度 * @param key 键 * @return 值 */ @SuppressWarnings(\"ConstantConditions\") public long sGetSetSize(String key) { try { return redisTemplate.opsForSet().size(key); } catch (Exception e) { e.printStackTrace(); return 0; } } /** * 移除值为value的 * @param key 键 * @param values 值 可以是多个 * @return 移除的个数 */ public long setRemove(String key, Object... values) { try { return redisTemplate.opsForSet().remove(key, values); } catch (Exception e) { e.printStackTrace(); return 0; } } /** * 获取list缓存的内容 * @param key 键 * @param start 开始 * @param end 结束 0 到 -1代表所有值 */ public List&lt;Object&gt; lGet(String key, long start, long end) { try { return redisTemplate.opsForList().range(key, start, end); } catch (Exception e) { e.printStackTrace(); return null; } } /** * 获取list缓存的长度 * @param key 键 */ public long lGetListSize(String key) { try { return redisTemplate.opsForList().size(key); } catch (Exception e) { e.printStackTrace(); return 0; } } /** * 通过索引 获取list中的值 * @param key 键 * @param index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推 */ public Object lGetIndex(String key, long index) { try { return redisTemplate.opsForList().index(key, index); } catch (Exception e) { e.printStackTrace(); return null; } } /** * 将list放入缓存 * @param key 键 * @param value 值 */ public boolean lSet(String key, Object value) { try { redisTemplate.opsForList().rightPush(key, value); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 将list放入缓存 * @param key 键 * @param value 值 * @param time 时间(秒) */ public boolean lSet(String key, Object value, long time) { try { redisTemplate.opsForList().rightPush(key, value); if (time &gt; 0){ expire(key, time); } return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 将list放入缓存 * @param key 键 * @param value 值 */ public boolean lSet(String key, List&lt;Object&gt; value) { try { redisTemplate.opsForList().rightPushAll(key, value); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 将list放入缓存 * * @param key 键 * @param value 值 * @param time 时间(秒) */ public boolean lSet(String key, List&lt;Object&gt; value, long time) { try { redisTemplate.opsForList().rightPushAll(key, value); if (time &gt; 0){ expire(key, time); } return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 根据索引修改list中的某条数据 * @param key 键 * @param index 索引 * @param value 值 */ public boolean lUpdateIndex(String key, long index, Object value) { try { redisTemplate.opsForList().set(key, index, value); return true; } catch (Exception e) { e.printStackTrace(); return false; } } /** * 移除N个值为value * @param key 键 * @param count 移除多少个 * @param value 值 */ public long lRemove(String key, long count, Object value) { try { return redisTemplate.opsForList().remove(key, count, value); } catch (Exception e) { e.printStackTrace(); return 0; } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"RedisTemplate","slug":"RedisTemplate","permalink":"https://www.zhuqiaolun.com/tags/RedisTemplate/"}]},{"title":"RestTemplate 封装工具类","slug":"2021/07/1625194440104/1625194440104","date":"2021-07-02T02:54:00.000Z","updated":"2021-07-23T05:15:52.045Z","comments":false,"path":"2021/07/1625194440104/1625194440104/","link":"","permalink":"https://www.zhuqiaolun.com/2021/07/1625194440104/1625194440104/","excerpt":"RestTemplate 封装工具类","text":"配置ApplicationContextHelper RestTemplate配置 说明 简单的 Get、Post 请求 自定义请求头的 Get、Post 请求 带参数的 Get(Query) 请求 带参数的 Post(Query/Body) 请求 可上传单个、多个文件的 Post 请求 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200import org.springframework.http.HttpEntity;import org.springframework.http.HttpHeaders;import org.springframework.http.HttpMethod;import org.springframework.http.ResponseEntity;import org.springframework.util.LinkedMultiValueMap;import org.springframework.util.MultiValueMap;import org.springframework.web.client.RestTemplate;import org.springframework.web.util.UriComponentsBuilder;import java.io.File;import java.util.ArrayList;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021 2021/6/29 18:20 * desc ：RestTemplate 工具 */public class RestTemplateUtil { /** * 自定义请求头 * 简单的 Get请求 * * @param headers 参数 * @param url 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; simpleGet(HttpHeaders headers, String url) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url); //将请求头部和参数合成一个请求 HttpEntity&lt;?&gt; httpEntity = new HttpEntity&lt;&gt;(headers); return restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String.class); } /** * 表单 - Query * 带参数 Get请求 * * @param headers 参数 * @param url 参数 * @param params 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executeGetParam(HttpHeaders headers, String url, Map&lt;String, String&gt; params) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); headers.set(\"Content-Type\", \"application/x-www-form-urlencoded\"); UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url); if (params != null &amp;&amp; params.size() &gt; 0) { for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { builder.queryParam(entry.getKey(), entry.getValue()); } } //将请求头部和参数合成一个请求 HttpEntity&lt;?&gt; httpEntity = new HttpEntity&lt;&gt;(headers); return restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String.class); } /** * 自定义请求头 * - Query * - Body * 简单的 Post 请求 * * @param headers 参数 * @param url 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; simplePost(HttpHeaders headers, String url) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); //将请求头部和参数合成一个请求 HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(null, headers); return restTemplate.postForEntity(url, httpEntity, String.class); } /** * 表单 - Query * 带参数的 Post 请求 * * @param headers 参数 * @param url 参数 * @param params 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostFromParam(HttpHeaders headers, String url, Map&lt;String, String&gt; params) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); return restTemplate.postForEntity(url, getMultiValueMap(headers, null, params), String.class); } /** * 表单 - Query * 上传单个文件的 Post 请求 * * @param headers 参数 * @param url 参数 * @param file 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostFromFile(HttpHeaders headers, String url, File file) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); List&lt;File&gt; files = new ArrayList&lt;&gt;(); files.add(file); return restTemplate.postForEntity(url, getMultiValueMap(headers, files, null), String.class); } /** * 表单 - Query * 上传多个文件的 Post 请求 * * @param headers 参数 * @param url 参数 * @param files 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostFromFile(HttpHeaders headers, String url, List&lt;File&gt; files) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); return restTemplate.postForEntity(url, getMultiValueMap(headers, files, null), String.class); } /** * 表单 - Query * 上传单个文件且带参数的 Post 请求 * * @param headers 参数 * @param url 参数 * @param file 参数 * @param params 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostFromFileParam(HttpHeaders headers, String url, File file, Map&lt;String, String&gt; params) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); List&lt;File&gt; files = new ArrayList&lt;&gt;(); files.add(file); return restTemplate.postForEntity(url, getMultiValueMap(headers, files, params), String.class); } /** * 表单 - Query * 上传多个文件且带参数的 Post 请求 * * @param headers 参数 * @param url 参数 * @param files 参数 * @param params 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostFromFileParam(HttpHeaders headers, String url, List&lt;File&gt; files, Map&lt;String, String&gt; params) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); return restTemplate.postForEntity(url, getMultiValueMap(headers, files, params), String.class); } private static HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; getMultiValueMap(HttpHeaders headers, List&lt;File&gt; files, Map&lt;String, String&gt; params) { MultiValueMap&lt;String, Object&gt; multiValueMap = new LinkedMultiValueMap&lt;&gt;(); if (files != null &amp;&amp; files.size() &gt; 0) { headers.set(\"Content-Type\", \"multipart/form-data\"); for (File file : files) { multiValueMap.add(\"file\", new org.springframework.core.io.FileSystemResource(file)); } } else { headers.set(\"Content-Type\", \"application/x-www-form-urlencoded\"); } if (params != null &amp;&amp; params.size() &gt; 0) { for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { multiValueMap.add(entry.getKey(), entry.getValue()); } } return new HttpEntity&lt;&gt;(multiValueMap, headers); } /** * Body请求 - Body * @param headers 参数 * @param url 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostBody(HttpHeaders headers, String url) { return executePostBodyParam(headers,url,null); } /** * Body请求 - Body * @param headers 参数 * @param url 参数 * @param str 参数 * @return 返回 */ public static ResponseEntity&lt;String&gt; executePostBodyParam(HttpHeaders headers, String url,String str) { RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); headers.set(\"Content-Type\", \"application/json;charset=UTF-8\"); HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(str, headers); return restTemplate.postForEntity(url, httpEntity, String.class); } } document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"RestTemplate","slug":"RestTemplate","permalink":"https://www.zhuqiaolun.com/tags/RestTemplate/"}]},{"title":"CentOS7防火墙操作命令","slug":"2021/06/1624517875141/1624517875141","date":"2021-06-24T06:57:55.000Z","updated":"2021-06-24T07:13:36.816Z","comments":false,"path":"2021/06/1624517875141/1624517875141/","link":"","permalink":"https://www.zhuqiaolun.com/2021/06/1624517875141/1624517875141/","excerpt":"CentOS7防火墙操作命令","text":"查看服务是否开机启动systemctl is-enabled firewalld.service 查看已启动的服务列表systemctl list-unit-files|grep enabled 查看启动失败的服务列表systemctl –failed firewalld的基本使用 查看状态：systemctl status firewalld 启动：systemctl start firewalld 停止：systemctl stop firewalld 禁止开机启动：systemctl disable firewalld 启用开机启动：systemctl enable firewalld 配置firewall-cmd 查看版本：firewall-cmd –version 查看帮助：firewall-cmd –help 显示状态：firewall-cmd –state 查看所有打开的端口：firewall-cmd –zone=public –list-ports 更新防火墙规则：firewall-cmd –reload 更新防火墙规则，重启服务：firewall-cmd –completely-reload 查看已激活的Zone信息:firewall-cmd –get-active-zones 查看指定接口所属区域：firewall-cmd –get-zone-of-interface=eth0 拒绝所有包：firewall-cmd –panic-on 取消拒绝状态：firewall-cmd –panic-off 查看是否拒绝：firewall-cmd –query-panic firewall开启和关闭端口-permanent永久生效，没有此参数重启后失效 添加：firewall-cmd –zone=public –add-port=80/tcp –permanent 重新载入：firewall-cmd –reload 查看：firewall-cmd –zone=public –query-port=80/tcp 删除：firewall-cmd –zone=public –remove-port=80/tcp –permanent 示例：开通3306端口firewall-cmd –zone=public –add-port=3306/tcp –permanentfirewall-cmd –reload document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Linux","slug":"Linux","permalink":"https://www.zhuqiaolun.com/categories/Linux/"}],"tags":[{"name":"firewall","slug":"firewall","permalink":"https://www.zhuqiaolun.com/tags/firewall/"}]},{"title":"CentOS7服务器安装MySQL 8.0.25","slug":"2021/06/1624440649011/1624440649011","date":"2021-06-23T09:30:49.000Z","updated":"2023-09-11T05:21:48.746Z","comments":false,"path":"2021/06/1624440649011/1624440649011/","link":"","permalink":"https://www.zhuqiaolun.com/2021/06/1624440649011/1624440649011/","excerpt":"CentOS7服务器安装MySQL 8.0.25","text":"安装依赖1yum -y install wget lrzsz xz vim* libaio-devel.x86_64 numactl MySQL地址https://dev.mysql.com/downloads/mysql/ 鼠标右键复制链接地址 下载安装包通过wget方式获取安装包 123mkdir /usr/local/mysqlcd /usr/local/mysqlwget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.25-linux-glibc2.12-x86_64.tar.xz 解压安装包123cd /usr/local/mysqlxz -d mysql-8.0.25-linux-glibc2.12-x86_64.tar.xztar -xf mysql-8.0.25-linux-glibc2.12-x86_64.tar 重命名1mv mysql-8.0.25-linux-glibc2.12-x86_64 mysql-8.0.25 创建data目录1mkdir /usr/local/mysql/mysql-8.0.25/data 创建用户组以及用户和密码以及授权123groupadd mysqluseradd -g mysql mysqlchown -R mysql.mysql /usr/local/mysql 初始化基础信息12cd /usr/local/mysql/mysql-8.0.25/bin/./mysqld --user=mysql --basedir=/usr/local/mysql/mysql-8.0.25 --datadir=/usr/local/mysql/mysql-8.0.25/data/ --initialize 得到临时密码 编辑my.cnf文件1vim /etc/my.cnf 内容： 123456789101112131415161718192021[client]default-character-set=utf8[mysqld]port=3306basedir=/usr/local/mysql/mysql-8.0.25datadir=/usr/local/mysql/mysql-8.0.25/datasocket=/tmp/mysql.sockcharacter-set-server=utf8symbolic-links=0#bind-address = 127.0.0.1bind-address = 0.0.0.0[mysqld_safe]#log-error=/var/log/mariadb/mariadb.log#pid-file=/var/run/mariadb/mariadb.pid## include all files from the config directory#!includedir /etc/my.cnf.d 添加mysql服务到系统1cp -a /usr/local/mysql/mysql-8.0.25/support-files/mysql.server /etc/init.d/mysql 授权以及添加服务12chmod +x /etc/init.d/mysqlchkconfig --add mysql 查看启动状态1service mysql status 显示： SUCCESS! MySQL running (16356) 启动mysql1service mysql start 显示： Starting MySQL…. SUCCESS! 停止mysql1service mysql stop 将mysql命令添加到服务1ln -s /usr/local/mysql/mysql-8.0.25/bin/mysql /usr/bin 重启mysql1service mysql restart 登录mysql1mysql -uroot -p 修改root密码123456是新的密码 12345ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';eg:ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root';flush privileges; 修改远程连接并生效123use mysql;update user set host='%' where user='root';flush privileges; 开通3306端口12firewall-cmd --zone=public --add-port=3306/tcp --permanentfirewall-cmd --reload 客户端连接 防火墙 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/categories/MySql/"}],"tags":[{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/tags/MySql/"}]},{"title":"CentOS7服务器指令","slug":"2021/06/1624439801367/1624439801367","date":"2021-06-23T09:16:41.000Z","updated":"2021-06-24T07:38:30.901Z","comments":false,"path":"2021/06/1624439801367/1624439801367/","link":"","permalink":"https://www.zhuqiaolun.com/2021/06/1624439801367/1624439801367/","excerpt":"CentOS7服务器指令","text":"查看当前Linux系统版本1lsb_release -a 更新yum源1curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo 更新所有软件 列出所有可更新的软件清单命令yum check-update 更新所有软件命令yum update 清除缓存命令 清除缓存目录下的软件包yum clean packages 清除缓存目录下的 headersyum clean headers 清除缓存目录下旧的 headersyum clean oldheaders 清除缓存目录下的软件包及旧的headersyum cleanyum clean all 下载文件：wget1234yum -y install wgeteg:下载Tomcat：wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/apache-tomcat-9.0.27.tar.gz 文件传输：lrzsz12345yum -y install lrzszeg:从服务端发送文件到客户端：sz filename从客户端上传文件到服务端：rz 解压文件：xz1234567yum -y install xz eg：将xz文件解压为tar文件：xz -d example.tar.xz将tar文件解压：tar xf example.tar如果无法安装xz命令，先安装epel源：yum -y install epel-release 编辑器：vim1yum -y install vim* 查看网络信息：netstat1yum -y install net-tools 防火墙 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Linux","slug":"Linux","permalink":"https://www.zhuqiaolun.com/categories/Linux/"}],"tags":[{"name":"command","slug":"command","permalink":"https://www.zhuqiaolun.com/tags/command/"}]},{"title":"Nginx部署Vue项目，添加前缀访问","slug":"2021/05/1620908327003/1620908327003","date":"2021-05-13T12:18:46.000Z","updated":"2021-05-13T12:32:59.899Z","comments":false,"path":"2021/05/1620908327003/1620908327003/","link":"","permalink":"https://www.zhuqiaolun.com/2021/05/1620908327003/1620908327003/","excerpt":"Nginx部署Vue项目，添加前缀访问","text":"首先准备1个vue项目 hello/dist/ - index.html 配置根据路径访问123456789101112location / { root html; try_files $uri $uri/ /index.html; index index.html index.htm;}location /hello { # vue项目的打包后的dist alias D:/demon/hello/dist/; try_files $uri $uri/ /hello/index.html; index index.html index.htm;} 访问 http://127.0.0.1/hello document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"}],"tags":[{"name":"Vue","slug":"Vue","permalink":"https://www.zhuqiaolun.com/tags/Vue/"}]},{"title":"Go-FastDfs 安装配置","slug":"2021/05/1620815885110/1620815885110","date":"2021-05-12T10:38:05.000Z","updated":"2021-11-27T18:04:09.649Z","comments":false,"path":"2021/05/1620815885110/1620815885110/","link":"","permalink":"https://www.zhuqiaolun.com/2021/05/1620815885110/1620815885110/","excerpt":"Go-FastDfs","text":"简介项目地址：https://github.com/sjqzhang/go-fastdfs 编译版本下载地址：https://github.com/sjqzhang/go-fastdfs/releases 中文Wiki地址：https://github.com/sjqzhang/go-fastdfs/blob/master/README.md gitee：https://gitee.com/sjqzhang/go-fastdfs 文档：https://sjqzhang.github.io/go-fastdfs/install.html linuxmkdir fastdfs &amp;&amp; cd fastdfs wget --no-check-certificate https://github.com/sjqzhang/go-fastdfs/releases/download/v1.4.1/fileserver chmod +x fileserver ./fileserverwindow下载时要注意链接的版本号，windows下直接运行 fileserver.exe运行完成后生成以下目录文件 12345conf -- 配置data -- 数据files -- 文件log -- 日志static -- 静态页面 访问：localhost:8080 出现以下界面则运行成功 配置配置文件在运行时自动生成，IP自动获取，端口默认8080；后面可根据需要自行修改端口配置；配置文件去重算法为sha1，防止上传同一个文件导致为覆盖操作；配置默认下载为false时，则可在返回的参数path后添加?download=0时在浏览器预览，path?download=1时在浏览器下载； json12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576{ \"绑定端号\": \"端口\", \"addr\": \":18080\", \"是否开启https\": \"默认不开启，如需启开启，请在conf目录中增加证书文件 server.crt 私钥 文件 server.key\", \"enable_https\": false, \"PeerID\": \"集群内唯一,请使用0-9的单字符，默认自动生成\", \"peer_id\": \"5\", \"本主机地址\": \"本机http地址,默认自动生成(注意端口必须与addr中的端口一致），必段为内网，自动生成不为内网请自行修改，下同\", \"host\": \"http://127.0.0.1:18080\", \"集群\": \"集群列表,注意为了高可用，IP必须不能是同一个,同一不会自动备份，且不能为127.0.0.1,且必须为内网IP，默认自动生成\", \"peers\": [\"http://127.0.0.1:18080\"], \"组号\": \"用于区别不同的集群(上传或下载)与support_group_manage配合使用,带在下载路径中\", \"group\": \"group1\", \"是否支持按组（集群）管理,主要用途是Nginx支持多集群\": \"默认支持,不支持时路径为http://10.1.5.4:8080/action,支持时为http://10.1.5.4:8080/group(配置中的group参数)/action,action为动作名，如status,delete,sync等\", \"support_group_manage\": true, \"是否合并小文件\": \"默认不合并,合并可以解决inode不够用的情况（当前对于小于1M文件）进行合并\", \"enable_merge_small_file\": false, \"允许后缀名\": \"允许可以上传的文件后缀名，如jpg,jpeg,png等。留空允许所有。\", \"extensions\": [], \"重试同步失败文件的时间\": \"单位秒\", \"refresh_interval\": 1800, \"是否自动重命名\": \"默认不自动重命名,使用原文件名\", \"rename_file\": false, \"是否支持web上传,方便调试\": \"默认支持web上传\", \"enable_web_upload\": true, \"是否支持非日期路径\": \"默认支持非日期路径,也即支持自定义路径,需要上传文件时指定path\", \"enable_custom_path\": true, \"下载域名\": \"用于外网下载文件的域名,不包含http://\", \"download_domain\": \"\", \"场景列表\": \"当设定后，用户指的场景必项在列表中，默认不做限制(注意：如果想开启场景认功能，格式如下：'场景名:googleauth_secret' 如 default:N7IET373HB2C5M6D \", \"scenes\": [], \"默认场景\": \"默认default\", \"default_scene\": \"default\", \"是否显示目录\": \"默认显示,方便调试用,上线时请关闭\", \"show_dir\": true, \"邮件配置\": \"\", \"mail\": { \"user\": \"abc@163.com\", \"password\": \"abc\", \"host\": \"smtp.163.com:25\" }, \"告警接收邮件列表\": \"接收人数组\", \"alarm_receivers\": [], \"告警接收URL\": \"方法post,参数:subject,message\", \"alarm_url\": \"\", \"下载是否需带token\": \"真假\", \"download_use_token\": false, \"下载token过期时间\": \"单位秒\", \"download_token_expire\": 600, \"是否自动修复\": \"在超过1亿文件时出现性能问题，取消此选项，请手动按天同步，请查看FAQ\", \"auto_repair\": true, \"文件去重算法md5可能存在冲突，默认md5\": \"sha1|md5\", \"file_sum_arithmetic\": \"sha1\", \"管理ip列表\": \"用于管理集的ip白名单,\", \"admin_ips\": [\"127.0.0.1\"], \"是否启用迁移\": \"默认不启用\", \"enable_migrate\": false, \"文件是否去重\": \"默认去重\", \"enable_distinct_file\": true, \"是否开启跨站访问\": \"默认开启\", \"enable_cross_origin\": true, \"是否开启Google认证，实现安全的上传、下载\": \"默认不开启\", \"enable_google_auth\": false, \"认证url\": \"当url不为空时生效,注意:普通上传中使用http参数 auth_token 作为认证参数, 在断点续传中通过HTTP头Upload-Metadata中的auth_token作为认证参数,认证流程参考认证架构图\", \"auth_url\": \"\", \"下载是否认证\": \"默认不认证(注意此选项是在auth_url不为空的情况下生效)\", \"enable_download_auth\": false, \"默认是否下载\": \"默认下载\", \"default_download\": false, \"本机是否只读\": \"默认可读可写\", \"read_only\": false, \"是否开启断点续传\": \"默认开启\", \"enable_tus\": true, \"同步单一文件超时时间（单位秒）\": \"默认为0,程序自动计算，在特殊情况下，自已设定\", \"sync_timeout\": 0} 传送门 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/categories/Go-FastDfs/"}],"tags":[{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/tags/Go-FastDfs/"}]},{"title":"使用NSSM把exe可执行文件注册为Windows服务,开机启动&后台运行","slug":"2021/05/1620813081711/1620813081711","date":"2021-05-12T09:51:21.000Z","updated":"2024-08-16T08:25:10.964Z","comments":false,"path":"2021/05/1620813081711/1620813081711/","link":"","permalink":"https://www.zhuqiaolun.com/2021/05/1620813081711/1620813081711/","excerpt":"使用NSSM把exe可执行文件注册为Windows服务,开机启动&amp;后台运行","text":"简介NSSM是一款可将exe注册为Windows系统服务的工具。当你的exe程序需要部署在Windows Server上时，NSSM是一个不错的选择。注册为服务后，启动、停止、重启皆由windows来管理，所以不必担心exe因意外的停止，而Windows的服务管理即可处理这些问题。 使用官网下载页面; 版本：2.24 根据自己的平台，将32/64位nssm.exe文件解压至任意文件夹 以管理员身份运行CMD定位至nssm.exe所在目录 输入 nssm install {服务名称}，即注册服务的名称。注册服务弹出如下NSSM界面 以安装Redis为例 查询服务状态 E:\\nssm-2.24-101\\win64&gt;nssm.exe status Redis SERVICE_STOPPEDnssm常用命令： 创建服务：nssm install servername 启动服务：nssm start servername 暂停服务：nssm stop servername 重启服务：nssm restart servername 删除服务：nssm remove servername 更多命令查看 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Windows","slug":"Windows","permalink":"https://www.zhuqiaolun.com/categories/Windows/"}],"tags":[{"name":"nssm","slug":"nssm","permalink":"https://www.zhuqiaolun.com/tags/nssm/"}]},{"title":"MyBatis-Plus的集成配置","slug":"2021/04/1617878968965/1617878968965","date":"2021-04-08T10:49:28.000Z","updated":"2022-03-24T08:44:20.111Z","comments":false,"path":"2021/04/1617878968965/1617878968965/","link":"","permalink":"https://www.zhuqiaolun.com/2021/04/1617878968965/1617878968965/","excerpt":"MyBatis-Plus的yml配置","text":"自定义代码配置 依赖添加依赖 1234567891011121314151617181920&lt;!-- 连接数据库 start --&gt;&lt;!-- 数据库 连接 、事务--&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;version&gt;2.4.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 数据库 mybatis--&gt;&lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.2&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 数据库 mysql--&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.25&lt;/version&gt;&lt;/dependency&gt;&lt;!-- 连接数据库 end --&gt; 配置配置bean使用插件 123456789101112131415161718192021222324252627282930313233343536373839404142import com.baomidou.mybatisplus.annotation.DbType;import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.transaction.annotation.EnableTransactionManagement;/** * @className: MybatisPlusConfig.java * @description: MyBatis-Plus的插件配置 * @author: Demon * @date 2020/8/25 11:24 */@Configuration@EnableTransactionManagementpublic class MybatisPlusConfig { /** * 分页插件 * paginationInterceptor.setLimit(你的最大单页限制数量，默认 500 条，小于 0 如 -1 不受限制); */ @Bean public PaginationInterceptor paginationInterceptor() { PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求 默认false paginationInterceptor.setOverflow(false); // 设置最大单页限制数量，默认 500 条，-1 不受限制 paginationInterceptor.setLimit(-1); // 设置数据库需要根据mp版本使用set方法,以下为3.3.2 paginationInterceptor.setDbType(DbType.MYSQL); // 设置数据库需要根据mp版本使用set方法,以下为3.2.0 paginationInterceptor.setDialectType(DbType.MYSQL.getDb()); return paginationInterceptor; } } 添加事务在实现类的 增删改方法内添加 1@Transactional(propagation = Propagation.NESTED, rollbackFor = Exception.class) PROPAGATION_NESTED： 如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则进行与PROPAGATION_REQUIRED类似的操作。 PROPAGATION_REQUIRED： 支持当前事务，如果当前没有事务，就新建一个事务。 yml配置123456789101112131415161718192021222324252627282930313233343536373839404142434445464748spring: # 数据库连接 datasource: driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://127.0.0.1:3306/demo?useUnicode=true&amp;characterEncoding=utf8&amp;characterSetResults=utf8&amp;allowMultiQueries=true&amp;autoReconnect=true&amp;useSSL=false&amp;serverTimezone=UTC&amp;zeroDateTimeBehavior=convertToNull username: root password: root # Spring Boot 2.0及以上版本 默认选择，不需要配置 type: com.zaxxer.hikari.HikariDataSource hikari: # 客户端等待连接池连接的最大毫秒数 connection-timeout: 20000 # 连接池中维护的最小空闲连接数 minimum-idle: 5 # 配置最大池大小 maximum-pool-size: 12 # 允许连接在连接池中空闲的最长时间（以毫秒为单位） idle-timeout: 300000 # 池中连接关闭后的最长生命周期（以毫秒为单位） max-lifetime: 1200000 # 从池返回的连接的默认自动提交行为。默认值为true。 auto-commit: true# mybatis-plus配置mybatis-plus: # MyBatis 配置文件 configuration: # 映射器启用缓存 cache-enabled: false # 查询时，关闭关联对象即时加载以提高性能 lazy-loading-enabled: false # 不允许使用自定义的主键值(比如由程序生成的UUID 32位编码作为键值), 数据表的PK生成策略将被覆盖 use-generated-keys: false # 对于批量更新操作缓存SQL以提高性能 SIMPLE, REUSE, BATCH default-executor-type: reuse # 对于未知的SQL查询，允许返回不同的结果集以达到通用的效果 multiple-result-sets-enabled: true # 允许使用列标签代替列名 use-column-label: true # 解决mybatis空字段null字段不返回 call-setters-on-nulls: true # 给予被嵌套的resultMap以字段-属性的映射支持 NONE, FULL,PARTIAL auto-mapping-behavior: partial log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 启动时是否检查 MyBatis XML 文件的存在，默认不检查。 check-config-location: false # mapper.xml所在位置 mapper-locations: classpath*:/mapper/*Mapper.xml document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"WebService服务端开发 - SpringBoot","slug":"2021/03/1617086122645/1617086122645","date":"2021-03-30T06:35:22.000Z","updated":"2021-05-13T05:43:49.863Z","comments":false,"path":"2021/03/1617086122645/1617086122645/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1617086122645/1617086122645/","excerpt":"WebService服务端开发 - SpringBoot","text":"依赖12345&lt;dependency&gt; &lt;groupId&gt;org.apache.cxf&lt;/groupId&gt; &lt;artifactId&gt;cxf-spring-boot-starter-jaxws&lt;/artifactId&gt; &lt;version&gt;3.2.4&lt;/version&gt;&lt;/dependency&gt; yml配置1234567891011server: port: 8069 servlet: context-path: /spring-boot-webservice-servicespring: application: name: spring-boot-webservice-service# 发布服务名称：http://localhost:8069/spring-boot-webservice-service/wscxf: path: /ws 创建接口在创建接口时请将实现类与之放在同一级目录下，这样在endpointInterface时容易找到 ExampleService： 123456789101112131415161718192021222324252627import javax.jws.WebMethod;import javax.jws.WebParam;import javax.jws.WebResult;import javax.jws.WebService;/** * @ClassName: exampleService * @Description: ExampleService接口 * @Author: Demon */@WebService(name = \"ExampleService\")public interface ExampleService { @WebMethod @WebResult String getTime(); /** * sayHello * @param userName 用户名 * @return 返回 */ @WebMethod @WebResult String sayHello(@WebParam(name = \"userName\") String userName);} ExampleServiceImpl： 1234567891011121314151617181920212223242526272829303132333435import org.dom4j.Document;import org.dom4j.DocumentHelper;import org.dom4j.Element;import org.springframework.stereotype.Component;import javax.jws.WebService;/** * @ClassName: ExampleController * @Description: * @Author: Demon * serviceName:【对外发布的服务名 】：需要见名知意 * targetNamespace:【名称空间】：【实现类包名的反缀】 * endpointInterface :【服务接口全路径】 【接口的包名】 */@Component@WebService( serviceName = \"ExampleService\", targetNamespace=\"http://example.webservice.springbootwebservice.demon.com/\", endpointInterface = \"com.demon.springbootwebservice.webservice.example.ExampleService\")public class ExampleServiceImpl implements ExampleService { @Override public String getTime() { return String.valueOf(System.currentTimeMillis()); } @Override public String sayHello(String userName) { System.out.println(\"=======================&gt;\"+userName); return userName; }} WebServiceConfig配置类12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import org.apache.cxf.Bus;import org.apache.cxf.bus.spring.SpringBus;import org.apache.cxf.jaxws.EndpointImpl;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import javax.xml.ws.Endpoint;/** * @ClassName: WebServiceConfig * @Description: 配置类 * @Author: Demon */@Configurationpublic class WebServiceConfig { @Bean(name = Bus.DEFAULT_BUS_ID) public SpringBus springBus() { return new SpringBus(); } /** * ExampleService --- sayHello * @return 返回 */ @Bean public Endpoint exampleServiceBean() { // 绑定要发布的服务实现类 EndpointImpl endpoint = new EndpointImpl(springBus(), new ExampleServiceImpl()); // 接口访问地址 endpoint.publish(\"/exampleService\"); return endpoint; } /** * TestService --- getTest * @return 返回 */ @Bean public Endpoint testServiceBean() { // 绑定要发布的服务实现类 EndpointImpl endpoint = new EndpointImpl(springBus(), new TestServiceImpl()); // 接口访问地址 endpoint.publish(\"/testService\"); return endpoint; }} 访问结果访问路径：http://localhost:8069/spring-boot-webservice-service/ws 客户端请求 axis客户端请求 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"WebService","slug":"WebService","permalink":"https://www.zhuqiaolun.com/categories/WebService/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"WebService客户端请求","slug":"2021/03/1617084469964/1617084469964","date":"2021-03-30T06:07:49.000Z","updated":"2021-05-13T05:44:31.204Z","comments":false,"path":"2021/03/1617084469964/1617084469964/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1617084469964/1617084469964/","excerpt":"WebService客户端请求","text":"本文采用 axis的调用方式 官网 依赖12345678910111213141516171819202122232425262728293031323334353637&lt;!-- axis webService client start --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.axis&lt;/groupId&gt; &lt;artifactId&gt;axis&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.axis&lt;/groupId&gt; &lt;artifactId&gt;axis-jaxrpc&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.axis&lt;/groupId&gt; &lt;artifactId&gt;axis-saaj&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;wsdl4j&lt;/groupId&gt; &lt;artifactId&gt;wsdl4j&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;commons-discovery&lt;/groupId&gt; &lt;artifactId&gt;commons-discovery&lt;/artifactId&gt; &lt;version&gt;0.5&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.activation&lt;/groupId&gt; &lt;artifactId&gt;activation&lt;/artifactId&gt; &lt;version&gt;1.1.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.mail&lt;/groupId&gt; &lt;artifactId&gt;mail&lt;/artifactId&gt; &lt;version&gt;1.4&lt;/version&gt;&lt;/dependency&gt;&lt;!-- axis webService client end --&gt; 客户端12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970import org.apache.axis.client.Call;import org.apache.axis.client.Service;import org.apache.axis.encoding.XMLType;import javax.xml.namespace.QName;import javax.xml.rpc.ParameterMode;import javax.xml.rpc.ServiceException;import java.net.MalformedURLException;import java.net.URL;import java.rmi.RemoteException;import java.util.ArrayList;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;/** * @ClassName: WebServiceClient * @Description: 客户端封装 * @Author: Demon */public class WebServiceClient { /** * 无参数请求 * @param wsdlUrl wsdl * @param targetNamespace 命名空间 * @param methodName 方法名 * @return 返回值 * @throws ServiceException 异常 * @throws MalformedURLException 异常 * @throws RemoteException 异常 */ public static String execute(String wsdlUrl, String targetNamespace, String methodName) throws ServiceException, MalformedURLException, RemoteException { Map&lt;String, String&gt; params = new LinkedHashMap&lt;&gt;(0); return execute(wsdlUrl, targetNamespace, methodName, params); } /** * 有参数请求 * @param wsdlUrl wsdl * @param targetNamespace 命名空间 * @param methodName 方法名 * @param params 参数 key-参数名，value-参数值 * @return 返回 * @throws ServiceException 异常 * @throws MalformedURLException 异常 * @throws RemoteException 异常 */ public static String execute(String wsdlUrl, String targetNamespace, String methodName, Map&lt;String, String&gt; params) throws ServiceException, MalformedURLException, RemoteException { Service service = new Service(); Call call = (Call) service.createCall(); call.setUseSOAPAction(true); //设置返回值 call.setReturnType(XMLType.SOAP_STRING); // wsdl路径 call.setTargetEndpointAddress(new URL(wsdlUrl)); //第一个参数： targetNamespace，第二个参数 方法名 call.setOperationName(new QName(targetNamespace, methodName)); //参数，多个则多次add List&lt;String&gt; values = new ArrayList&lt;&gt;(params.size()); for (Map.Entry&lt;String, String&gt; entry : params.entrySet()) { call.addParameter(entry.getKey(), XMLType.SOAP_STRING, ParameterMode.IN); values.add(entry.getValue()); } //传入参数并执行 return String.valueOf(call.invoke(values.toArray())); }} 使用12345678910111213141516171819202122232425262728293031323334353637import org.junit.jupiter.api.Test;import java.util.LinkedHashMap;import java.util.Map;class WebServiceClientTests { @Test void getTime() { try { String wsdlUrl = \"http://localhost:8090/spring-boot-webservice-service/cxf/exampleService?wsdl\"; String targetNamespace = \"http://example.webservice.springbootwebservice.demon.com/\"; String methodName = \"getTime\"; String result = WebServiceClient.execute(wsdlUrl, targetNamespace, methodName); System.out.println(result); } catch (Exception e) { e.printStackTrace(); } } @Test void sayHello() { try { String wsdlUrl = \"http://localhost:8090/spring-boot-webservice-service/cxf/exampleService?wsdl\"; String targetNamespace = \"http://example.webservice.sms.demon.com/\"; String methodName = \"sayHello\"; Map&lt;String, String&gt; paramNames = new LinkedHashMap&lt;&gt;(); paramNames.put(\"userName\", \"demon\"); String result = WebServiceClient.execute(wsdlUrl, targetNamespace, methodName, paramNames); System.out.println(result); } catch (Exception e) { e.printStackTrace(); } }} 服务端开发服务端开发 - SpringBoot document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"WebService","slug":"WebService","permalink":"https://www.zhuqiaolun.com/categories/WebService/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"集合操作 - List，Set，Map","slug":"2021/03/1617003286483/1617003286483","date":"2021-03-29T07:34:46.000Z","updated":"2022-02-14T07:32:28.601Z","comments":false,"path":"2021/03/1617003286483/1617003286483/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1617003286483/1617003286483/","excerpt":"集合之间的操作","text":"集合概述Java中的集合类：是一种工具类，就像是容器，储存任意数量的具有共同属性的对象。 集合框架被设计成要满足以下几个目标： 该框架必须是高性能的。基本集合（动态数组，链表，树，哈希表）的实现也必须是高效的。 该框架允许不同类型的集合，以类似的方式工作，具有高度的互操作性。 对一个集合的扩展和适应必须是简单的。 为此，整个集合框架就围绕一组标准接口而设计。可以直接使用这些接口的标准实现，诸如： LinkedList, HashSet, 和 TreeSet 等,除此之外你也可以通过这些接口实现自己的集合。 集合结构图 集合使用 List &amp; SetList接口继承了Collection接口，并对父接口进行了简单的扩充。常用的实现类有：ArrayList、LinkedList和Vector。Set接口一个不包括重复元素（包括可变对象）的Collection，是一种无序的集合。常用的实现类有：HashSet、TreeSet等。 12345678910111213List&lt;String&gt; list=new ArrayList&lt;String&gt;(); list.add(\"Hello\"); list.add(\"World\"); //推荐的通用方法for (String str : list) { System.out.println(str); } //多线程并行执行list.parallelStream().forEach(System.out::println);Set 同理 MapMap是一个键值对的集合。一个映射不能包含重复的键，每个键最多映射到一个值。常用的实现类有：HashMap、TreeMap、Properties。 1234567891011121314151617181920212223242526272829Map&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put(\"hello\",\"Hello\");map.put(\"world\",\"World\");System.out.println(map.size());// 第一种：map.keySet()返回的是所有key的值System.out.println(\"第一种：通过Map.keySet遍历key和value：\");for (String in : map.keySet()) { String str = map.get(in);//得到每个key多对用value的值 System.out.println(in + \" \" + str);}// 第二种：System.out.println(\"第二种：通过Map.entrySet使用iterator遍历key和value：\");for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) { System.out.println(\"key= \" + entry.getKey() + \" and value= \" + entry.getValue());}// 第三种：推荐，尤其是容量大时System.out.println(\"第三种：通过Map.entrySet遍历key和value\");for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) { System.out.println(\"key= \" + entry.getKey() + \" and value= \"+ entry.getValue());}// 第四种：System.out.println(\"第四种：通过Map.values()遍历所有的value，但不能遍历key\");for (String v : map.values()) { System.out.println(\"value= \" + v);} 集合转化 数组转List需要注意的是， Arrays.asList() 返回一个受指定数组决定的固定大小的列表。所以不能做 add 、 remove 等操作，否则会报错。 123String[] strArr = new String[]{\"Hello\", \"World\", \"Java\"};List strList = Arrays.asList(strArr);System.out.println(strList); //[Hello, World, Java] 数组转Set 12Set&lt;String&gt; strSet = new HashSet&lt;&gt;(Arrays.asList(strArr));System.out.println(strSet); //[Hello, World, Java] List转数组 12Object[] strArr = strList.toArray();System.out.println(Arrays.toString(strArr)); //[Hello, World, Java] List转Set 1234Set&lt;String&gt; strSet = new HashSet&lt;String&gt;(strList);System.out.println(strSet);结果：[Java, Hello, World] 扩展java8的stream（流）：排序，统计，过滤，映射，分组，拼接，分区，总和，平均值，最小值 使用Arrays 中的 stream() 方法，将数组转成流 12Integer[] nums = new Integer[10];Stream&lt;Integer&gt; stream = Arrays.stream(nums); 使用 BufferedReader.lines() 方法，将每行内容转成流 123BufferedReader reader = new BufferedReader(new FileReader(\"d:\\\\test.txt\"));Stream&lt;String&gt; lineStream = reader.lines();lineStream.forEach(System.out::println); 使用 Pattern.splitAsStream() 方法，将字符串分隔成流 123Pattern pattern = Pattern.compile(\",\");Stream&lt;String&gt; stringStream = pattern.splitAsStream(\"a,b,c,d,e\");stringStream.forEach(System.out::println); 以下为第三方工具使用 12345&lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;30.0-jre&lt;/version&gt;&lt;/dependency&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"MyBatis返回多个结果集","slug":"2021/03/1615802317183/1615802317183","date":"2021-03-15T09:58:37.000Z","updated":"2022-03-24T08:33:43.503Z","comments":false,"path":"2021/03/1615802317183/1615802317183/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615802317183/1615802317183/","excerpt":"MyBatis返回多个结果集","text":"MyBatis在查询时可以将单一的结果集并列查询组成多结果集；如：多重List&lt;Map&lt;String,Object&gt;&gt;格式，Object可再次为 List&lt;Map&lt;String,Object&gt;&gt;结构 12345678910111213141516[ { \"userName\": \"张三\", \"userCode\": \"RBXLWCzGcqDncROd90Jd\", \"userRole\": [ { \"roleCode\": \"test1\", \"userCode\": \"RBXLWCzGcqDncROd90Jd\" }, { \"roleCode\": \"test2\", \"userCode\": \"RBXLWCzGcqDncROd90Jd\" } ] }] 使用xxMapper.xml：xml中以userCode为连接，collection的property属性值为二级key 1234567891011121314151617181920212223242526272829303132333435&lt;resultMap id=\"testResultMap\" type=\"java.util.Map\"&gt; &lt;id property=\"userCode\" column=\"user_Code\" /&gt; &lt;result property=\"userName\" column=\"user_Name\" /&gt; &lt;result property=\"userRemark\" column=\"user_Remark\" /&gt; &lt;collection property=\"userRole\" javaType=\"list\" ofType=\"map\"&gt; &lt;id property=\"roleCode\" column=\"role_Code\" /&gt; &lt;result property=\"userCode\" column=\"user_Code\" /&gt; &lt;result property=\"roleName\" column=\"role_Name\" /&gt; &lt;result property=\"roleRemark\" column=\"role_Remark\" /&gt; &lt;/collection&gt;&lt;/resultMap&gt;&lt;select id=\"selectTestListResultMap\" parameterType=\"map\" resultMap=\"testResultMap\"&gt; SELECT test_user.user_Code, test_user.user_Name, test_user.user_Remark, test_role.role_Code, test_role.role_Name, test_role.role_Remark, test_role.user_Code FROM test_user LEFT JOIN test_role ON test_role.user_Code = test_user.user_Code WHERE test_user.user_Code IN ( SELECT test_role.user_Code FROM test_role WHERE test_role.user_Code = test_user.user_Code GROUP BY test_role.user_Code )&lt;/select&gt; xxMapper.java： 123456/** * 查询列表信息 * @param params 参数 * @return 返回 */List&lt;Map&lt;String, Object&gt;&gt; selectTestListResultMap(@Param(\"params\") Map&lt;String, Object&gt; params); 结果集： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465[ { \"userRemark\": \"备注用户\", \"userName\": \"张三\", \"userRole\": [ { \"roleRemark\": \"备注权限\", \"roleCode\": \"test1\", \"roleName\": \"a\", \"userCode\": \"RBXLWCzGcqDncROd90Jd\" }, { \"roleRemark\": \"备注权限\", \"roleCode\": \"test2\", \"roleName\": \"b\", \"userCode\": \"RBXLWCzGcqDncROd90Jd\" } ], \"userCode\": \"RBXLWCzGcqDncROd90Jd\" }, { \"userRemark\": \"备注用户\", \"userName\": \"李四\", \"userRole\": [ { \"roleRemark\": \"备注权限\", \"roleCode\": \"test3\", \"roleName\": \"c\", \"userCode\": \"TALKA0I56vYUp2cVaczZ\" }, { \"roleRemark\": \"备注权限\", \"roleCode\": \"test4\", \"roleName\": \"d\", \"userCode\": \"TALKA0I56vYUp2cVaczZ\" }, { \"roleRemark\": \"备注权限\", \"roleCode\": \"test5\", \"roleName\": \"e\", \"userCode\": \"TALKA0I56vYUp2cVaczZ\" } ], \"userCode\": \"TALKA0I56vYUp2cVaczZ\" }, { \"userRemark\": \"备注用户\", \"userName\": \"王五\", \"userRole\": [ { \"roleRemark\": \"备注权限\", \"roleCode\": \"test6\", \"roleName\": \"f\", \"userCode\": \"EMbvTsuedRjItaD0aZzq\" }, { \"roleRemark\": \"备注权限\", \"roleCode\": \"test7\", \"roleName\": \"g\", \"userCode\": \"EMbvTsuedRjItaD0aZzq\" } ], \"userCode\": \"EMbvTsuedRjItaD0aZzq\" }] 表： 12345678910111213141516171819202122232425262728293031323334353637383940414243-- ------------------------------ Table structure for test_role-- ----------------------------DROP TABLE IF EXISTS `test_role`;CREATE TABLE `test_role` ( `tr_PKeyId` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键ID', `role_Code` varchar(32) DEFAULT NULL COMMENT '角色代码', `role_Name` varchar(32) DEFAULT NULL COMMENT '角色名称', `user_Code` varchar(32) DEFAULT NULL COMMENT '用户代码', `role_Remark` varchar(100) DEFAULT NULL COMMENT '备注', PRIMARY KEY (`tr_PKeyId`)) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8 COMMENT='角色表';-- ------------------------------ Records of test_role-- ----------------------------INSERT INTO `test_role` VALUES ('16', 'test1', 'a', 'RBXLWCzGcqDncROd90Jd', '备注权限');INSERT INTO `test_role` VALUES ('19', 'test2', 'b', 'RBXLWCzGcqDncROd90Jd', '备注权限');INSERT INTO `test_role` VALUES ('20', 'test3', 'c', 'TALKA0I56vYUp2cVaczZ', '备注权限');INSERT INTO `test_role` VALUES ('21', 'test4', 'd', 'TALKA0I56vYUp2cVaczZ', '备注权限');INSERT INTO `test_role` VALUES ('22', 'test5', 'e', 'TALKA0I56vYUp2cVaczZ', '备注权限');INSERT INTO `test_role` VALUES ('23', 'test6', 'f', 'EMbvTsuedRjItaD0aZzq', '备注权限');INSERT INTO `test_role` VALUES ('24', 'test7', 'g', 'EMbvTsuedRjItaD0aZzq', '备注权限');-- ------------------------------ Table structure for test_user-- ----------------------------DROP TABLE IF EXISTS `test_user`;CREATE TABLE `test_user` ( `tu_PKeyId` int(11) NOT NULL AUTO_INCREMENT COMMENT '主键ID', `user_Name` varchar(32) DEFAULT NULL COMMENT '用户名称', `user_Code` varchar(32) DEFAULT NULL COMMENT '用户代码', `user_Remark` varchar(100) DEFAULT NULL COMMENT '备注', PRIMARY KEY (`tu_PKeyId`)) ENGINE=InnoDB AUTO_INCREMENT=14 DEFAULT CHARSET=utf8 COMMENT='用户表';-- ------------------------------ Records of test_user-- ----------------------------INSERT INTO `test_user` VALUES ('10', '张三', 'RBXLWCzGcqDncROd90Jd', '备注用户');INSERT INTO `test_user` VALUES ('11', '李四', 'TALKA0I56vYUp2cVaczZ', '备注用户');INSERT INTO `test_user` VALUES ('12', '王五', 'EMbvTsuedRjItaD0aZzq', '备注用户');INSERT INTO `test_user` VALUES ('13', '赵六', 'GosZVJuSCA70TmeRnBJO', '备注用户'); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/tags/MyBatis/"}]},{"title":"hexo博客的一些内置写法","slug":"2021/03/1615800535123/1615800535123","date":"2021-03-15T09:28:55.000Z","updated":"2023-07-24T07:37:25.178Z","comments":false,"path":"2021/03/1615800535123/1615800535123/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615800535123/1615800535123/","excerpt":"hello","text":"跳转到本文锚点一跳转到本文锚点二 在hexo中发表文章时需要相互引用，以下为一些内置写法，有些需要先安装modiles 1.引用内部图片 123456789在根目录下执行如下命令 npm install hexo-asset-image 此时再执行命令 hexo new article_name 创建新的文章，在 source/_posts 中会生成文章 post_name.md 和同名文件夹 post_name,我们将文章中所使用到的将图片资源均放在 post_name 中，这时就可以在文章中使用相对路径引用图片资源了![img_name](img_name.jpg) #文章中的图片资源路径格式如：![20210315171503](1615799438937/20210315171503.png) 2.引用内部链接 12[标题]({% post_path %}/访问路径)如：[标题]({% post_path %}/2021/03/1615800535123/1615800535123/) 3.描点 1234567891011121314151617hexo markdown 文章里面如果使用 ## 文章二级标题 生成标题，标题会自动生成 id=\"文章二级标题\"。如果标题中间有 半角空格 或者 全角空格 ，空格都会变成连字符。如：一个半角空格 ## hello world 或 多个半角 ## hello world 或 多个全角空格 ## hello world 。其生成的 id 会变成 id=\"hello-world\"，多个空格会合并成一个连字符。当前文章锚点跳转:使用 markdown 内置的链接方式即可，其中如果有空格，需要把空格换成连字符 - ，如下：[跳转到本文锚点](#hexo-标题与-id-关系)例如：[跳转到本文锚点一](#描点-一)[跳转到本文锚点二](#描点-二)## 描点 一### 描点 二 4.折叠与收起 123456789101112131415details：折叠语法标签summary：折叠语法展示的摘要pre：以原有格式显示元素内的文字是已经格式化的文本code：指定代码范例blockcode：表示程序的代码块&lt;details&gt; &lt;summary&gt;点击时的区域标题1&lt;/summary&gt; &lt;pre&gt;&lt;code&gt; System.out.println( \"Hello, World!\" );&lt;/code&gt;&lt;/pre&gt;&lt;/details&gt;&lt;details&gt; &lt;summary&gt;点击时的区域标题2&lt;/summary&gt; 写```html也可&lt;/details&gt; 点击时的区域标题1 System.out.println( \"Hello, World!\" ); 点击时的区域标题2 1System.out.println( \"Hello, World!\" ); 描点 一描点 二博客迁移当在git base 内输入hexo 出现 bash: hexo: command not found，需要在环境变量PATH内配置：xxx\\node_modules.bin；比如：D:\\workspace-demon\\myblog\\node_modules.bin document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.zhuqiaolun.com/categories/Blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://www.zhuqiaolun.com/tags/hexo/"}]},{"title":"对MyBatis-Plus3.x的分页插件配置使用","slug":"2021/03/1615799438937/1615799438937","date":"2021-03-15T09:10:38.000Z","updated":"2022-03-24T08:33:40.157Z","comments":false,"path":"2021/03/1615799438937/1615799438937/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615799438937/1615799438937/","excerpt":"MyBatis-Plus的插件配置使用","text":"配置使用前的 配置 MyBatis-Plus 是自带分页插件的Page，可用查询SQL并列使用 使用xxMapper.xml： 123&lt;select id=\"getList\" parameterType=\"map\" resultType=\"map\" &gt; SELECT * FROM system_user&lt;/select&gt; xxMapper.java： 1234567891011121314/** * 查询列表信息(分页) * @param page 分页标志 * @param params 参数 * @return 返回 */Page&lt;Map&lt;String, Object&gt;&gt; getList(IPage&lt;Map&lt;String, Object&gt;&gt; page, @Param(\"params\") Map&lt;String, Object&gt; params);/** * 查询列表信息 * @param params 参数 * @return 返回 */List&lt;Map&lt;String,Object&gt;&gt; getList(@Param(\"params\") Map&lt;String,Object&gt; params); xxService.java: 123456789101112131415/** * 查询列表信息(分页) * @param current 每页数 * @param size 当前页 * @param map 参数 * @return 返回 */Page&lt;Map&lt;String, Object&gt;&gt; getListPage(long current, long size, Map&lt;String, Object&gt; map);/** * 查询列表信息 * @param map 参数 * @return 返回 */List&lt;Map&lt;String,Object&gt;&gt; getList(Map&lt;String, Object&gt; map); xxServiceImpl.java: 12345678910@Overridepublic Page&lt;Map&lt;String, Object&gt;&gt; getListPage(long current, long size, Map&lt;String, Object&gt; map) { IPage&lt;Map&lt;String, Object&gt;&gt; page = new Page&lt;&gt;(current, size); return this.baseMapper.getList(page, map);}@Overridepublic List&lt;Map&lt;String,Object&gt;&gt; getList(Map&lt;String,Object&gt; map) { return this.baseMapper.getList(map);} xxController.java: 已分页查询123456long current = Long.parseLong(jsonParam.getString(\"current\"));long size = Long.parseLong(jsonParam.getString(\"size\"));Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;();Page&lt;Map&lt;String, Object&gt;&gt; serviceListPage = systemService.getListPage(current,size,map);JSONObject jsonObject = ListUtil.getData(serviceListPage);System.out.println(jsonObject); 不分页查询123Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;();List&lt;Map&lt;String, Object&gt;&gt; serviceList = systemService.getJobList(map);System.out.println(serviceList); ListUtil： 12345678910111213141516171819202122232425262728import com.alibaba.fastjson.JSONObject;import com.baomidou.mybatisplus.extension.plugins.pagination.Page;import java.util.Map;/** * @author: Demon * @description: 分页列表数据 */public class ListUtil { public static JSONObject getData(Page&lt;Map&lt;String, Object&gt;&gt; listPage) { JSONObject responseBean = new JSONObject(true); //当前页码 responseBean.put(\"current\", listPage.getCurrent()); //当前页条数 responseBean.put(\"size\", listPage.getSize()); //总共条数 responseBean.put(\"total\", listPage.getTotal()); //总共页数 responseBean.put(\"page\", listPage.getPages()); //当前页数据 responseBean.put(\"data\", listPage.getRecords()); //是否有上一页 responseBean.put(\"hasPrevious\", listPage.hasPrevious()); //是否有下一页 responseBean.put(\"hasNext\", listPage.hasNext()); return responseBean; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/tags/MyBatis/"}]},{"title":"Java自定义异常 - EmptyException","slug":"2021/03/1615440974493/1615440974493","date":"2021-03-11T05:36:14.000Z","updated":"2021-11-06T09:25:06.513Z","comments":false,"path":"2021/03/1615440974493/1615440974493/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615440974493/1615440974493/","excerpt":"Java自定义异常","text":"作用：定义异常来生声明异常，保证程序可以准确捕获异常。 自定义异常继承类有3中：RuntimeException、Exception、Throwable一般会选择继承Exception和RuntimeException，如果调用者一定要处理抛出的异常且没有要求，就继承RuntimeException。 定义异常 12345678910111213141516171819202122/** * @author: Demon * @date 2021/3/5 14:44 * @description: 空异常 */public class EmptyException extends RuntimeException { private String code; public EmptyException(String code, String message) { super(message); this.code = code; } public String getCode() { return code; } public void setCode(String code) { this.code = code; }} 使用异常 1throw new EmptyException(\"40004\", \"参数不能为空\"); 捕获异常 12345678910try { System.out.println(\"业务处理···\");}catch (EmptyException e){ System.out.println(\"捕获自定义异常···\"); e.getCode(); e.getMessage();}catch (Exception e){ e.printStackTrace(); System.out.println(\"捕获抛出的异常···\");} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"删除没用的本地Jar - maven的错误引入","slug":"2021/03/1615374410736/1615374410736","date":"2021-03-10T11:06:50.000Z","updated":"2021-11-06T09:44:33.766Z","comments":false,"path":"2021/03/1615374410736/1615374410736/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615374410736/1615374410736/","excerpt":"删除没用的本地Jar","text":"有时候maven下载的jar不完整或者是错误，则此时需要删除多余的jar 引入依赖 12345&lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.6&lt;/version&gt;&lt;/dependency&gt; 完整代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455import java.io.File;import java.io.IOException;import java.util.Collection;import org.apache.commons.io.FileUtils;import org.apache.commons.io.filefilter.DirectoryFileFilter;import org.apache.commons.io.filefilter.RegexFileFilter;import org.apache.commons.io.filefilter.TrueFileFilter;public class 删除没用的Jar { public static void main(String[] args) { System.out.println(\"执行开始···\"); String filePath = \"D:\\\\apache\\\\Repositories\\\\Maven\"; deleteFile(filePath,true); System.out.println(); deleteDir(filePath,true); System.out.println(\"执行完成！！！\"); } private static void deleteFile(String filePath,boolean flag){ RegexFileFilter regexFileFilter = new RegexFileFilter(\".*(lastUpdated).*\"); Collection&lt;File&gt; listFiles1 = FileUtils.listFiles(new File(filePath),regexFileFilter, DirectoryFileFilter.INSTANCE); for (File file : listFiles1) { try { System.out.println(file.getCanonicalPath()); if(flag){ FileUtils.forceDelete(file); } } catch (IOException e) { e.printStackTrace(); } } } private static void deleteDir(String filePath,boolean flag){ Collection&lt;File&gt; listFiles1 = FileUtils.listFilesAndDirs(new File(filePath), TrueFileFilter.INSTANCE,DirectoryFileFilter.DIRECTORY); for (File file : listFiles1) { try { if(file.isDirectory()){ if(file.getName().startsWith(\"$\") || file.getName().startsWith(\"unknown\") || file.getName().startsWith(\"error\")){ System.out.println(file.getCanonicalPath()); if(flag){ FileUtils.forceDelete(file); } } } } catch (IOException e) { e.printStackTrace(); } } }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/tags/Maven/"}]},{"title":"Chrome谷歌浏览器：下载，插件安装","slug":"2021/03/1615363585427/1615363585427","date":"2021-03-10T08:06:25.000Z","updated":"2024-08-16T08:25:40.726Z","comments":false,"path":"2021/03/1615363585427/1615363585427/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615363585427/1615363585427/","excerpt":"谷歌浏览器，下载，插件安装","text":"下载谷歌浏览器在线安装谷歌离线浏览器离线安装 离线版插件极简插件 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Windows","slug":"Windows","permalink":"https://www.zhuqiaolun.com/categories/Windows/"}],"tags":[{"name":"chrome","slug":"chrome","permalink":"https://www.zhuqiaolun.com/tags/chrome/"}]},{"title":"查看Jar包的JDK版本","slug":"2021/03/1615358998628/1615358998628","date":"2021-03-10T06:49:58.000Z","updated":"2021-11-30T13:35:47.110Z","comments":false,"path":"2021/03/1615358998628/1615358998628/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1615358998628/1615358998628/","excerpt":"查看jar包的JDK版本","text":"通过版本通常在使用Java程序时，需要对JDK版本进行核对，JDK构建版本不等于执行的运行版本，需要通过执行类来辨别 通过反编译工具jd-gui查看清单文件(此处版本为maven打包的版本) 通过编译的class文件来查看文件信息(此处版本为class文件的版本) 通过十六进制 Notepad++在 Notepad++ 中添加插件：HEX-Editor，点击安装后自动重启需要以十六进制显示时，点击菜单的：【插件】－【Hex-Editor】－【View in Hex】即可只看第一行数据，前面8个字节 CA FE BA BE 是固定的，后4个字节 00 00 是次版本号，次版本号后面的4个字节 00 33 是jdk的版本号，如这里 00 34 则表示jdk的版本是1.8 版本查看以下为各个JDK版本对应的数值 12345678J2SE 8.0 = 52(0x34 hex)J2SE 7.0 = 51(0x33 hex)J2SE 6.0 = 50 (0x32 hex)J2SE 5.0 = 49 (0x31 hex)JDK 1.4 = 48 (0x30 hex)JDK 1.3 = 47 (0x2F hex)JDK 1.2 = 46 (0x2E hex)JDK 1.1 = 45 (0x2D hex) document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"解决SpringBoot2.x的跨域请求问题,开启跨域","slug":"2021/03/1614825070134/1614825070134","date":"2021-03-04T02:31:10.000Z","updated":"2021-03-08T08:07:39.751Z","comments":false,"path":"2021/03/1614825070134/1614825070134/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614825070134/1614825070134/","excerpt":"解决SpringBoot的跨域请求问题","text":"请求错误描述： 123When allowCredentials is true, allowedOrigins cannot contain the special value \"*“since that cannot be set on the “Access-Control-Allow-Origin” response header. To allow credentials to a set of origins, list them explicitly or consider using\"allowedOriginPatterns” instead. SpringBoot2.3.x 123456789101112131415161718@Configurationpublic class WebMvcConfig implements WebMvcConfigurer { @Override public void addCorsMappings(CorsRegistry registry) { registry // 设置允许跨域的路由 .addMapping(\"/**\") // 设置允许跨域请求的域名 .allowedOrigins(\"*\") // 是否允许证书（cookies） .allowCredentials(true) // 设置允许的方法 .allowedMethods(\"GET\", \"POST\", \"DELETE\", \"PUT\") // 跨域允许时间 .maxAge(3600); }} SpringBoot2.4.x 123456789101112131415161718@Configurationpublic class WebMvcConfig implements WebMvcConfigurer { @Override public void addCorsMappings(CorsRegistry registry) { registry // 设置允许跨域的路由 .addMapping(\"/**\") // 设置允许跨域请求的域名 .allowedOriginPatterns(\"*\") // 是否允许证书（cookies） .allowCredentials(true) // 设置允许的方法 .allowedMethods(\"GET\", \"POST\", \"DELETE\", \"PUT\") // 跨域允许时间 .maxAge(3600); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"使用 MultipartFile[] 做多文件上传的功能","slug":"2021/03/1614764345833/1614764345833","date":"2021-03-03T09:39:05.000Z","updated":"2021-07-23T02:54:21.681Z","comments":false,"path":"2021/03/1614764345833/1614764345833/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614764345833/1614764345833/","excerpt":"使用 MultipartFile[] 做多文件上传的功能","text":"配置yml配置上传文件的限制 123456789spring: servlet: # 上传文件设置 multipart: enabled: true # 默认为 1MB max-file-size: 100MB # 默认为 10MB max-request-size: 500MB 控制器文件属性名： name = file参数非必传：required = false 12345678910111213141516171819202122@PostMapping(value = \"/upload\",consumes=\"multipart/form-data\")public String fileUpload(@RequestParam(value = \"file\",required = false) MultipartFile[] multipartFiles, @RequestParam(value = \"username\",required = false)String username, @RequestParam(value = \"password\",required = false)String password) throws IOException{ List&lt;Map&lt;String,Object&gt;&gt; fileList = new ArrayList&lt;&gt;(); for (MultipartFile multipartFile : multipartFiles) { String fileName = multipartFile.getOriginalFilename(); assert fileName != null; byte[] bytes = multipartFile.getBytes(); String fileExt = FilenameUtils.getExtension(fileName); Map&lt;String,Object&gt; map = new LinkedHashMap&lt;&gt;(); map.put(\"fileName\",fileName); map.put(\"fileExt\",fileExt); map.put(\"fileSize\",bytes.length); map.put(\"username\",username); map.put(\"password\",password); //转存，不需要进行IO流关闭处理 multipartFile.transferTo(new File(\"D:/dest.txt\")); fileList.add(map); } return JSON.toJSONString(fileList);} 请求示例 Java模拟请求 1234567891011121314151617@Testpublic void 多文件上传() { File file1 = new File(\"D:\\\\test\\\\1234.xlsx\"); File file2 = new File(\"D:\\\\test\\\\5678.xlsx\"); String url = \"https://www.zhuqiaolun.com/weixinz/api/test/upload\"; HttpHeaders headers = new HttpHeaders(); headers.set(\"Content-Type\", \"multipart/form-data\"); MultiValueMap&lt;String, Object&gt; params = new LinkedMultiValueMap&lt;&gt;(); params.add(\"file\", new FileSystemResource(file1)); params.add(\"file\", new FileSystemResource(file2)); params.add(\"username\",\"admin\"); params.add(\"password\",\"123456\"); HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers); ResponseEntity&lt;String&gt; responseEntity = restTemplate.postForEntity(url, httpEntity, String.class); System.out.println(responseEntity.getStatusCodeValue()); System.out.println(responseEntity.getBody());} Form表单提交 12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;多文件上传&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;form action=\"https://www.zhuqiaolun.com/weixinz/api/test/upload\" method=\"post\" enctype=\"multipart/form-data\"&gt; &lt;div id=\"moreFile\"&gt; &lt;input type=\"file\" name=\"file\"&gt; &lt;input type=\"file\" name=\"file\"&gt; &lt;input placeholder=\"用户名\" type=\"text\" name=\"username\" value=\"admin\"&gt; &lt;input placeholder=\"密码\" type=\"text\" name=\"password\" value=\"123456\"&gt; &lt;/div&gt; &lt;button type=\"submit\"&gt;上传&lt;/button&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; Ajax表单提交 1234567891011121314151617181920212223242526272829303132333435363738&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;多文件上传&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;form id=\"moreFileForm\" &gt; &lt;input type=\"file\" name=\"file\"&gt; &lt;input type=\"file\" name=\"file\"&gt; &lt;input placeholder=\"用户名\" type=\"text\" name=\"username\" value=\"admin\"&gt; &lt;input placeholder=\"密码\" type=\"text\" name=\"password\" value=\"123456\"&gt; &lt;/form&gt; &lt;button type=\"button\" class=\"btn btn-primary\" onclick=\"moreFileSub()\"&gt;ajax上传&lt;/button&gt; &lt;p id=\"result\"&gt;&lt;/p&gt;&lt;script src=\"https://libs.baidu.com/jquery/2.1.1/jquery.min.js\"&gt;&lt;/script&gt;&lt;script type=\"text/javascript\"&gt;function moreFileSub(){ const formData = new FormData($(\"#moreFileForm\")[0]); $.ajax({ url : \"https://www.zhuqiaolun.com/weixinz/api/test/upload\", type : 'POST', data : formData, // 告诉jQuery不要去处理发送的数据 processData : false, // 告诉jQuery不要去设置Content-Type请求头 contentType : false, async : false, dataType : \"json\", success : function(result) { console.log(result); $(\"#result\").text(JSON.stringify(result)) } });}&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"SpringBoot的RestTemplate的使用","slug":"2021/03/1614741214844/1614741214844","date":"2021-03-03T03:13:34.000Z","updated":"2021-07-02T03:24:12.885Z","comments":false,"path":"2021/03/1614741214844/1614741214844/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614741214844/1614741214844/","excerpt":"SpringBoot的RestTemplate的使用","text":"RestTemplate配置 Headers 设置1234567HttpHeaders headers = new HttpHeaders();// Textheaders.set(\"Content-Type\", \"application/json;charset=UTF-8\");// Fileheaders.set(\"Content-Type\", \"multipart/form-data\");// Formheaders.set(\"Content-Type\", \"application/x-www-form-urlencoded\"); Get queryeg：https://www.zhuqiaolun.com/weixinz/api/test/get?username=demon&amp;password=1234561234567//将请求头部和参数合成一个请求UriComponentsBuilder builder = UriComponentsBuilder.fromHttpUrl(url);builder.queryParam(\"username\",username);builder.queryParam(\"password\",password);//将请求头部和参数合成一个请求HttpEntity&lt;?&gt; httpEntity = new HttpEntity&lt;&gt;(headers);restTemplate.exchange(builder.build().encode().toUri(), HttpMethod.GET, httpEntity, String.class); Posteg：https://www.zhuqiaolun.com/weixinz/api/test/post?username=demon&amp;password=123456body：{“username”:”demon”} application/json 12345678910JsonNodeFactory jsonNodeFactory = JsonNodeFactory.instance;ObjectNode params = jsonNodeFactory.objectNode();{ params.put(\"username\", username); params.put(\"password\", password);}//将请求头部和参数合成一个请求System.out.println(params.toString());HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(params.toString(), headers);restTemplate.postForEntity(url, httpEntity, String.class); application/x-www-form-urlencoded 12345MultiValueMap&lt;String, Object&gt; params = new LinkedMultiValueMap&lt;&gt;();params.add(\"username\", username);params.add(\"password\", password);HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers);return restTemplate.postForEntity(url, httpEntity, String.class); multipart/form-data 1234MultiValueMap&lt;String, Object&gt; params = new LinkedMultiValueMap&lt;&gt;();params.add(\"file\", new org.springframework.core.io.FileSystemResource(new java.io.File(\"AAA\")));HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(params, headers);restTemplate.postForEntity(url, httpEntity, String.class); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"RestTemplate","slug":"RestTemplate","permalink":"https://www.zhuqiaolun.com/tags/RestTemplate/"}]},{"title":"JavaFx之CheckBox变成单选模式","slug":"2021/03/1614740320445/1614740320445","date":"2021-03-03T02:58:40.000Z","updated":"2021-03-03T03:12:06.700Z","comments":false,"path":"2021/03/1614740320445/1614740320445/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614740320445/1614740320445/","excerpt":"JavaFx之CheckBox变成单选模式","text":"CheckBox：复选框模式 123456789CheckBox checkBox = new CheckBox();checkBox.setId(\"checkBox\");checkBox.setUserData(\"1234\");checkBox.setMaxWidth(30);checkBox.setOnAction(event -&gt; { if (checkBox.isSelected()) { checkBox.setSelected(true); }}); CheckBox：单选框模式，将其他选中的情况变成false 12345678910111213141516CheckBox checkBox = new CheckBox();checkBox.setId(\"checkBox\");checkBox.setUserData(\"1234\");checkBox.setMaxWidth(30);checkBox.setOnAction(event -&gt; { if (checkBox.isSelected()) { ObservableList&lt;Node&gt; contentChildren = content.getChildren(); if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) { for (Node node : contentChildren) { CheckBox checkBox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); checkBox.setSelected(false); } } checkBox.setSelected(true); }}); 示例应用 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"CheckBox","slug":"CheckBox","permalink":"https://www.zhuqiaolun.com/tags/CheckBox/"}]},{"title":"JavaFx之动态添加组件","slug":"2021/03/1614738290477/1614738290477","date":"2021-03-03T02:24:50.000Z","updated":"2021-03-03T03:10:12.719Z","comments":false,"path":"2021/03/1614738290477/1614738290477/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614738290477/1614738290477/","excerpt":"JavaFx之动态添加组件","text":"本例主要是构建动态模板，采用VBox模式，效果如下：按钮操作 - 添加栏位按钮操作 - 上移按钮操作 - 下移 按钮添加鼠标事件setOnMouseClicked 123456Button addBtn = new Button(\"添加栏位\");addBtn.setOnMouseClicked(addBtnMouseClicked());Button upBtn = new Button(\"上移\");upBtn.setOnMouseClicked(upBtnMouseClicked());Button downBtn = new Button(\"下移\");downBtn.setOnMouseClicked(downBtnMouseClicked()); 将内容面板content添加到滚动面板 1234ScrollPane scrollPane = new ScrollPane(content);scrollPane.setPannable(true);scrollPane.setStyle(\"-fx-background-color: #FFF;\");BorderPane.setAlignment(scrollPane,Pos.CENTER); 寻找面板上的组件，只有类型对应，强转也无报错 1234567ObservableList&lt;Node&gt; templateAttrChildren = content.getChildren();if (templateAttrChildren != null &amp;&amp; templateAttrChildren.size() &gt; 0) { for (Node node : templateAttrChildren) { CheckBox attrFieldCheckbox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); System.out.println(attrFieldCheckbox.getUserData()); }} 移动操作：先获取当前组件对象，通过原始位置index进行remove，在进行位置add 1234567891011121314上移：当移到最上层时index=1HBox hBox = (HBox) content.lookup(\"#\" + checkBox.getParent().getId());int index = content.getChildren().indexOf(hBox);if (index &gt; 0) { content.getChildren().remove(index); content.getChildren().add(index - 1, hBox);}下移：当移到最下层时index=最大值HBox hBox = (HBox) content.lookup(\"#\" + checkBox.getParent().getId());int index = content.getChildren().indexOf(hBox);if (index &lt; content.getChildren().size() - 1) { content.getChildren().remove(index); content.getChildren().add(index + 1, hBox);} 事件EventHandler 12345private EventHandler&lt;MouseEvent&gt; btnMouseClicked(){ return event -&gt; { System.out.println(\"事件执行\"); };} 完整代码 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312package sample;import javafx.application.Application;import javafx.collections.FXCollections;import javafx.collections.ObservableList;import javafx.event.EventHandler;import javafx.geometry.Insets;import javafx.geometry.Pos;import javafx.scene.Node;import javafx.scene.Scene;import javafx.scene.control.*;import javafx.scene.input.MouseEvent;import javafx.scene.layout.BorderPane;import javafx.scene.layout.HBox;import javafx.scene.layout.StackPane;import javafx.scene.layout.VBox;import javafx.stage.Stage;import java.util.ArrayList;import java.util.List;import java.util.UUID;/** * @ClassName: VBox动态添加组件 * @Description: * @Author: Demon * @Date: 2021/3/2 16:16 */public class 动态添加组件 extends Application { private static VBox content = new VBox(); private static String[] attrType = new String[]{\"常量\", \"变量\"}; public static void main(String[] args) { launch(args); } @Override public void start(Stage primaryStage) { // Center - 动态内容 content.setAlignment(Pos.TOP_CENTER); content.setSpacing(3); // 加载初始数据 getContentHbox(new AttributeVo().setAttrId(\"123456\").setAttrName(\"测试1\").setAttrType(0).setAttrValue(\"123\")); getContentHbox(new AttributeVo().setAttrId(\"345678\").setAttrName(\"测试2\").setAttrType(1).setAttrValue(\"321\")); // 初始化 BorderPane borderPane = new BorderPane(); borderPane.setPadding(new Insets(15,8,15,8)); // Top VBox topVbox = new VBox(); Label title = new Label(\"栏位列表\"); topVbox.getChildren().add(title); borderPane.setTop(topVbox); // Center borderPane.setCenter(getCenterPane()); // Bottom HBox bottomHbox = new HBox(); bottomHbox.setAlignment(Pos.CENTER); Button saveBtn = new Button(\"保存\"); saveBtn.setOnMouseClicked(saveBtnMouseClicked()); bottomHbox.getChildren().add(saveBtn); borderPane.setBottom(bottomHbox); // 将内容添加到主面板 StackPane root = new StackPane(); root.getChildren().add(borderPane); primaryStage.setScene(new Scene(root, 800, 600)); primaryStage.setResizable(false); primaryStage.show(); } private BorderPane getCenterPane(){ BorderPane borderPane = new BorderPane(); // Top - 按钮 HBox topBox = new HBox(); topBox.setAlignment(Pos.CENTER_RIGHT); topBox.setPadding(new Insets(0,5,5,0)); topBox.setSpacing(10); Button addBtn = new Button(\"添加栏位\"); addBtn.setOnMouseClicked(addBtnMouseClicked()); Button upBtn = new Button(\"上移\"); upBtn.setOnMouseClicked(upBtnMouseClicked()); Button downBtn = new Button(\"下移\"); downBtn.setOnMouseClicked(downBtnMouseClicked()); topBox.getChildren().addAll(addBtn,upBtn,downBtn); borderPane.setTop(topBox); // Center - 表格内容 borderPane.setCenter(getContent()); return borderPane; } private BorderPane getContent(){ System.out.println(\"添加初始化内容\"); BorderPane borderPane = new BorderPane(); // Top - 栏位列表 HBox hBox = new HBox(); hBox.setAlignment(Pos.CENTER_LEFT); hBox.setPrefHeight(30.0); hBox.setSpacing(5); Label label1 = new Label(\"栏位名称\"); label1.setPrefWidth(220); label1.setAlignment(Pos.CENTER); Label label2 = new Label(\"栏位类型\"); label2.setPrefWidth(100); label2.setAlignment(Pos.CENTER); Label label3 = new Label(\"栏位数值\"); label3.setPrefWidth(350); label3.setAlignment(Pos.CENTER); hBox.getChildren().addAll(label1,label2,label3); borderPane.setTop(hBox); // 将内容添加到滚动面板 ScrollPane scrollPane = new ScrollPane(content); scrollPane.setPannable(true); scrollPane.setStyle(\"-fx-background-color: #FFF;\"); BorderPane.setAlignment(scrollPane,Pos.CENTER); borderPane.setCenter(scrollPane); return borderPane; } /** * 按钮事件 - 添加栏位 */ private EventHandler&lt;MouseEvent&gt; addBtnMouseClicked(){ return event -&gt; { //添加栏位 getContentHbox(new AttributeVo().setAttrId(UUID.randomUUID().toString()).setAttrType(0)); }; } /** * 动态区域操作 * @param attributeVo 参数 */ private void getContentHbox(AttributeVo attributeVo){ System.out.println(\"添加ID:\"+attributeVo.getAttrId()); HBox hBox = new HBox(5); hBox.setId(UUID.randomUUID().toString()); hBox.setAlignment(Pos.CENTER_LEFT); //栏位选取 CheckBox attrFieldCheckbox = new CheckBox(); attrFieldCheckbox.setId(\"attrFieldCheckbox\"); attrFieldCheckbox.setUserData(attributeVo.getAttrId()); attrFieldCheckbox.setMaxWidth(30); attrFieldCheckbox.setOnAction(event -&gt; { if (attrFieldCheckbox.isSelected()) { ObservableList&lt;Node&gt; contentChildren = content.getChildren(); if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) { for (Node node : contentChildren) { CheckBox checkBox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); checkBox.setSelected(false); } } attrFieldCheckbox.setSelected(true); } }); //栏位名称 TextField attrName = new TextField(attributeVo.getAttrName()); attrName.setId(\"attrName\"); attrName.setPrefWidth(200); //栏位类型 ComboBox attrTypeComboBox = new ComboBox(); attrTypeComboBox.setId(\"attrTypeComboBox\"); attrTypeComboBox.setPrefWidth(100); attrTypeComboBox.setItems(FXCollections.observableArrayList(attrType)); attrTypeComboBox.getSelectionModel().select(attributeVo.getAttrType()); //栏位数组 TextField attrValue = new TextField(attributeVo.getAttrValue()); attrValue.setId(\"attrValue\"); attrValue.setPrefWidth(350); //操作按钮 Button delBtn = new Button(\"删除\"); delBtn.setMaxWidth(50); delBtn.setOnMouseClicked(event1 -&gt; content.getChildren().removeAll(hBox)); // 添加组件到hBox hBox.getChildren().addAll(attrFieldCheckbox,attrName,attrTypeComboBox,attrValue,delBtn); // 将hBox添加到内容面板 content.getChildren().add(content.getChildren().size(), hBox); } /** * 按钮事件 - 上移栏位 */ private EventHandler&lt;MouseEvent&gt; upBtnMouseClicked(){ return event -&gt; { ObservableList&lt;Node&gt; contentChildren = content.getChildren(); if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) { for (Node node : contentChildren) { CheckBox checkBox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); if (checkBox.isSelected()) { HBox hBox = (HBox) content.lookup(\"#\" + checkBox.getParent().getId()); int index = content.getChildren().indexOf(hBox); if (index &gt; 0) { content.getChildren().remove(index); content.getChildren().add(index - 1, hBox); } break; } } } }; } /** * 按钮事件 - 下移栏位 */ private EventHandler&lt;MouseEvent&gt; downBtnMouseClicked(){ return event -&gt; { ObservableList&lt;Node&gt; contentChildren = content.getChildren(); if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) { for (Node node : contentChildren) { CheckBox checkBox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); if (checkBox.isSelected()) { HBox hBox = (HBox) content.lookup(\"#\" + checkBox.getParent().getId()); int index = content.getChildren().indexOf(hBox); if (index &lt; content.getChildren().size() - 1) { content.getChildren().remove(index); content.getChildren().add(index + 1, hBox); } break; } } } }; } /** * 按钮事件 - 保存栏位 */ private EventHandler&lt;MouseEvent&gt; saveBtnMouseClicked(){ return event -&gt; { List&lt;AttributeVo&gt; attributeVoList = new ArrayList&lt;&gt;(); //模板栏位 ObservableList&lt;Node&gt; contentChildren = content.getChildren(); if (contentChildren != null &amp;&amp; contentChildren.size() &gt; 0) { for (Node node : contentChildren) { // 获取值 CheckBox attrFieldCheckbox = (CheckBox) node.lookup(\"#attrFieldCheckbox\"); TextField attrName = (TextField) node.lookup(\"#attrName\"); ComboBox attrTypeComboBox = (ComboBox) node.lookup(\"#attrTypeComboBox\"); TextField attrValue = (TextField) node.lookup(\"#attrValue\"); // 赋值 AttributeVo attributeVo = new AttributeVo(); attributeVo.setAttrId(String.valueOf(attrFieldCheckbox.getUserData())); attributeVo.setAttrName(attrName.getText()); attributeVo.setAttrType(attrTypeComboBox.getSelectionModel().getSelectedIndex()); attributeVo.setAttrValue(attrValue.getText()); attributeVoList.add(attributeVo); } } System.out.println(attributeVoList); }; }}/** * 虚拟实体类 */class AttributeVo { private String attrId; private String attrName; private int attrType; private String attrValue; public String getAttrId() { return attrId; } public AttributeVo setAttrId(String attrId) { this.attrId = attrId; return this; } public String getAttrName() { return attrName; } public AttributeVo setAttrName(String attrName) { this.attrName = attrName; return this; } public int getAttrType() { return attrType; } public AttributeVo setAttrType(int attrType) { this.attrType = attrType; return this; } public String getAttrValue() { return attrValue; } public AttributeVo setAttrValue(String attrValue) { this.attrValue = attrValue; return this; } @Override public String toString() { return \"AttributeVo{\" + \"attrId='\" + attrId + '\\'' + \", attrName='\" + attrName + '\\'' + \", attrType=\" + attrType + \", attrValue='\" + attrValue + '\\'' + '}'; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"VBox","slug":"VBox","permalink":"https://www.zhuqiaolun.com/tags/VBox/"}]},{"title":"JavaFx之TreeView的事件","slug":"2021/03/1614672011404/1614672011404","date":"2021-03-02T08:00:11.000Z","updated":"2021-03-15T09:20:46.106Z","comments":false,"path":"2021/03/1614672011404/1614672011404/","link":"","permalink":"https://www.zhuqiaolun.com/2021/03/1614672011404/1614672011404/","excerpt":"JavaFx之TreeView鼠标事件","text":"判断TreeView是否点击到节点上 123456Node node = event.getPickResult().getIntersectedNode();boolean flag = node instanceof TreeCell &amp;&amp; ((TreeCell) node).getText() != null;if (node instanceof Text || flag) { String name = (String) ((TreeItem)tree.getSelectionModel().getSelectedItem()).getValue(); System.out.println(\"Node click: \" + name);} 给TreeView 添加 鼠标点击事件MouseButton.NONE 无判断左键：event.getButton().compareTo(MouseButton.PRIMARY) == 1滚轮：event.getButton().compareTo(MouseButton.MIDDLE) == 1右键：event.getButton().compareTo(MouseButton.SECONDARY) == 1 123456789101112131415tree.addEventFilter(MouseEvent.MOUSE_CLICKED, event -&gt; { switch (event.getButton().compareTo(MouseButton.NONE)){ case 1: System.out.println(\"【左键】Node click: \" + name); break; case 2: System.out.println(\"【滚轮】Node click: \" + name); break; case 3: System.out.println(\"【右键】Node click: \" + name); break; default: break; }}); 完成代码如下： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package sample;import javafx.application.Application;import javafx.scene.Node;import javafx.scene.Scene;import javafx.scene.control.TreeCell;import javafx.scene.control.TreeItem;import javafx.scene.control.TreeView;import javafx.scene.input.MouseButton;import javafx.scene.input.MouseEvent;import javafx.scene.layout.StackPane;import javafx.scene.text.Text;import javafx.stage.Stage;/** * @ClassName: TreeViewMouseEvent * @Description: * @Author: Demon * @Date: 2021/3/1 11:16 */public class TreeViewMouseEvent extends Application { public static void main(String[] args) { launch(args); } @Override public void start(Stage primaryStage) { TreeItem&lt;String&gt; rootItem = new TreeItem&lt;&gt;(\"Root\"); rootItem.setExpanded(true); TreeItem&lt;String&gt; itemA = new TreeItem&lt;&gt;(\"A\"); TreeItem&lt;String&gt; itemB = new TreeItem&lt;&gt;(\"B\"); rootItem.getChildren().add(itemA); rootItem.getChildren().add(itemB); TreeView&lt;String&gt; tree = new TreeView&lt;&gt;(rootItem); // 给TreeView 添加 鼠标点击事件 tree.addEventFilter(MouseEvent.MOUSE_CLICKED, event -&gt; { Node node = event.getPickResult().getIntersectedNode(); boolean flag = node instanceof TreeCell &amp;&amp; ((TreeCell) node).getText() != null; if (node instanceof Text || flag) { String name = (String) ((TreeItem)tree.getSelectionModel().getSelectedItem()).getValue(); switch (event.getButton().compareTo(MouseButton.NONE)){ case 1: System.out.println(\"【左键】Node click: \" + name); break; case 2: System.out.println(\"【滚轮】Node click: \" + name); break; case 3: System.out.println(\"【右键】Node click: \" + name); break; default: break; } } }); StackPane root = new StackPane(); root.getChildren().add(tree); primaryStage.setScene(new Scene(root, 600, 400)); primaryStage.show(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"}],"tags":[{"name":"TreeView","slug":"TreeView","permalink":"https://www.zhuqiaolun.com/tags/TreeView/"}]},{"title":"一款现代化的博客 - Halo","slug":"2021/02/1614323515573/1614323515573","date":"2021-02-26T07:11:55.000Z","updated":"2021-03-10T02:41:31.509Z","comments":false,"path":"2021/02/1614323515573/1614323515573/","link":"","permalink":"https://www.zhuqiaolun.com/2021/02/1614323515573/1614323515573/","excerpt":"一款","text":"基本信息Halo：https://halo.run/下载资源：https://dl.halo.run/说明：从 1.4.3 起，版本要求为 11 以上的版本。1.4.3 以下需要 1.8 以上的版本。所以下载 1.4.2 版本即可：Windows 点击下载 , Linux wget下载 运行Windows： 1java -jar halo-1.4.2.jar Linux： 123456789java -jar halo-1.4.2.jar或nohup java -jar halo-1.4.2.jar &amp;或nohup java -jar halo-1.4.2.jar --server.port=8083 &amp;关闭：lsof -i:8090 或 lsof -i:8083kill -9 PID 访问访问路径：/默认端口：8090 1234Halo： http://127.0.0.1:8090Halo admin： http://127.0.0.1:8090/admin 开始第一次访问会进行初始化信息信息存在在系统当前用户目录下产生一个 .halo 的文件夹，绝对路径为 ~/.halo、/root/.halo/填写内容，一路下一步即可，直至到登录页面。 我的Halo博客 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.zhuqiaolun.com/categories/Blog/"}],"tags":[{"name":"halo","slug":"halo","permalink":"https://www.zhuqiaolun.com/tags/halo/"}]},{"title":"Java原生URL模拟工具","slug":"2021/02/1612419197069/1612419197069","date":"2021-02-04T06:13:17.000Z","updated":"2021-11-06T09:27:07.220Z","comments":false,"path":"2021/02/1612419197069/1612419197069/","link":"","permalink":"https://www.zhuqiaolun.com/2021/02/1612419197069/1612419197069/","excerpt":"Java原生URL模拟请求","text":"采用原始URL进行模拟请求 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119import java.io.*;import java.net.HttpURLConnection;import java.net.URL;import java.nio.charset.StandardCharsets;/** * @ClassName: HttpClientUtil * @Description: Java原生URL模拟请求 * @Author: Demon * @Date: 2021/2/4 10:45 */public class HttpClientUtil { public static String doGet(String httpUrl) { HttpURLConnection connection; try { // 创建远程url连接对象 URL url = new URL(httpUrl); // 通过远程url连接对象打开一个连接，强转成httpURLConnection类 connection = (HttpURLConnection) url.openConnection(); // 设置连接方式：get connection.setRequestMethod(\"GET\"); // 设置连接主机服务器的超时时间：15000毫秒 connection.setConnectTimeout(15000); // 设置读取远程返回的数据时间：60000毫秒 connection.setReadTimeout(60000); // 发送请求 connection.connect(); return getResult(null,connection); } catch (IOException e) { e.printStackTrace(); return null; } } public static String doPost(String httpUrl, String param) { HttpURLConnection connection; OutputStream os; try { URL url = new URL(httpUrl); // 通过远程url连接对象打开连接 connection = (HttpURLConnection) url.openConnection(); // 设置连接请求方式 connection.setRequestMethod(\"POST\"); // 设置连接主机服务器超时时间：15000毫秒 connection.setConnectTimeout(15000); // 设置读取主机服务器返回数据超时时间：60000毫秒 connection.setReadTimeout(60000); // 默认值为：false，当向远程服务器传送数据/写数据时，需要设置为true connection.setDoOutput(true); // 默认值为：true，当前向远程服务读取数据时，设置为true，该参数可有可无 connection.setDoInput(true); // 设置传入参数的格式:请求参数应该是 name1=value1&amp;name2=value2 的形式。 connection.setRequestProperty(\"Content-Type\", \"application/x-www-form-urlencoded\"); // 通过连接对象获取一个输出流 os = connection.getOutputStream(); // 通过输出流对象将参数写出去/传输出去,它是通过字节数组写出的 os.write(param.getBytes()); return getResult(os,connection); } catch (IOException e) { e.printStackTrace(); return null; } } private static String getResult(OutputStream os,HttpURLConnection connection){ int responseCode = 200; InputStream is = null; BufferedReader br = null; try { String result = null; if (connection.getResponseCode() == responseCode) { is = connection.getInputStream(); br = new BufferedReader(new InputStreamReader(is, StandardCharsets.UTF_8)); StringBuilder stringBuilder = new StringBuilder(); String temp; while ((temp = br.readLine()) != null) { stringBuilder.append(temp); } result = stringBuilder.toString(); } return result; } catch (Exception e){ e.printStackTrace(); return null; } finally { getClose(br,os,is,connection); } } private static void getClose(BufferedReader br,OutputStream os, InputStream is,HttpURLConnection connection ){ // 关闭资源 if (null != br) { try { br.close(); } catch (IOException e) { e.printStackTrace(); } } if (null != os) { try { os.close(); } catch (IOException e) { e.printStackTrace(); } } if (null != is) { try { is.close(); } catch (IOException e) { e.printStackTrace(); } } if(connection != null){ connection.disconnect(); } }} 示例12String doGet = HttpClientUtil.doGet(\"https://www.baidu.com/\");System.out.println(doGet); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"Java发送邮件","slug":"2021/01/1611916009068/1611916009068","date":"2021-01-29T10:26:49.000Z","updated":"2021-11-06T09:44:37.591Z","comments":false,"path":"2021/01/1611916009068/1611916009068/","link":"","permalink":"https://www.zhuqiaolun.com/2021/01/1611916009068/1611916009068/","excerpt":"Java 发送邮件 - 新浪，网易，QQ","text":"本文以 Java 发送邮件功能，采用commons-email模式执行 依赖123456&lt;!-- 发送邮件 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-email&lt;/artifactId&gt; &lt;version&gt;1.5&lt;/version&gt;&lt;/dependency&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105import org.apache.commons.mail.EmailException;import org.apache.commons.mail.HtmlEmail;import java.util.List;/** * @className: MailUtil.java * @description: 邮件工具类 * @author: Demon * @date 2020/10/27 17:09 */public class MailUtil { /** * 构建器 */ public static class EmailInfo { /** * SMTP 服务器 端口 */ private String mailServer; private Integer mailPort; /** * 发件人 账号 */ private String mailNick; /** * 发件人 账号 */ private String mailUsername; /** * 发件人 密码 */ private String mailPassword; /** * 邮件标题 */ private String title; /** * 邮件内容 */ private String content; /** * 收件人 */ private List&lt;String&gt; receivers; boolean ssl; public EmailInfo(String mailServer,Integer mailPort,String mailNick,String mailUsername, String mailPassword,String title,String content,List&lt;String&gt; receivers,boolean ssl) { this.mailServer = mailServer; this.mailPort = mailPort; this.mailNick = mailNick; this.mailUsername = mailUsername; this.mailPassword = mailPassword; this.title = title; this.content = content; this.receivers = receivers; this.ssl = ssl; } public MailUtil send() throws Exception { return new MailUtil(this); } } private MailUtil(EmailInfo emailInfo) throws Exception { HtmlEmail email = new HtmlEmail(); // 通过Server 发送邮件 email.setHostName(emailInfo.mailServer); email.setSmtpPort(emailInfo.mailPort); //设定smtp服务器的认证资料信息 email.setAuthentication(emailInfo.mailUsername, emailInfo.mailPassword); email.setStartTLSEnabled(false); email.setSSLOnConnect(emailInfo.ssl); try { // 设定发件人 email.setFrom(emailInfo.mailUsername,emailInfo.mailNick); // 设定收件人 （多人） int size = emailInfo.receivers.size(); email.addTo(emailInfo.receivers.toArray(new String[size])); // 设定内容的语言集 email.setCharset(\"UTF-8\"); email.setDebug(false); // 设定主题 email.setSubject(emailInfo.title); // 设定邮件内容 email.setHtmlMsg(emailInfo.content); // 发送邮件 email.send(); System.out.println(\"邮件发送成功！\"); } catch (EmailException e) { System.out.println(\"邮件发送失败！\"); throw new Exception(e); } }} 设置新浪String mailServer = smtp.sinanet.comInteger mailPort = 25boolean ssl = false 网易如若开启了授权密码，请以授权密码当做用户密码使用String mailServer = smtp.163.comInteger mailPort = 25boolean ssl = false QQ如若开启了授权密码，请以授权密码当做用户密码使用String mailServer = smtp.qq.comInteger mailPort = 465boolean ssl = true 测试123456789101112131415161718192021@Testpublic void 测试邮件() { try { String content = \"&lt;!doctypehtml&gt;&lt;html lang=en&gt;&lt;meta charset=UTF-8&gt;&lt;title&gt;Title&lt;/title&gt;&lt;h1&gt;测试&lt;/h1&gt;\"; // 发送邮件信息 String mailServer = \"smtp.sinanet.com\"; Integer mailPort = 25; String mailNick = \"demon\"; String mailUsername = \"demon@xxxxxxxxx\"; String mailPassword = \"123456789\"; String title = \"本地测试\"; List&lt;String&gt; receivers = new ArrayList&lt;&gt;(); receivers.add(\"1097305826@qq.com\"); MailUtil.EmailInfo emailInfo = new MailUtil.EmailInfo(mailServer,mailPort, mailNick,mailUsername,mailPassword,title, content,receivers,false); // 发送邮件 emailInfo.send(); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Email","slug":"Email","permalink":"https://www.zhuqiaolun.com/tags/Email/"}]},{"title":"Zip4j - 压缩/解压（可设置密码）","slug":"2020/11/1605683417659/1605683417659","date":"2020-11-18T07:10:17.000Z","updated":"2021-11-06T09:45:22.524Z","comments":false,"path":"2020/11/1605683417659/1605683417659/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605683417659/1605683417659/","excerpt":"Java工具类 - Zip4j - 压缩/解压（可设置密码）","text":"依赖12345&lt;dependency&gt; &lt;groupId&gt;net.lingala.zip4j&lt;/groupId&gt; &lt;artifactId&gt;zip4j&lt;/artifactId&gt; &lt;version&gt;2.6.0&lt;/version&gt;&lt;/dependency&gt; 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176import net.lingala.zip4j.ZipFile;import net.lingala.zip4j.exception.ZipException;import net.lingala.zip4j.model.FileHeader;import net.lingala.zip4j.model.ZipParameters;import net.lingala.zip4j.model.enums.CompressionLevel;import net.lingala.zip4j.model.enums.CompressionMethod;import net.lingala.zip4j.model.enums.EncryptionMethod;import java.io.File;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.List;/** * @ClassName: Zip4jUtil * @Description: zip 工具 * @Author: Demon */public class Zip4jUtil { /** * 根据给定密码压缩文件(s)到指定目录 * * @param destFileName 压缩文件存放绝对路径 e.g.:D:/upload/zip/demo.zip * @param password 密码(可为null) * @param files 单个文件或文件数组 * @return 最终的压缩文件存放的绝对路径,如果为false则说明压缩失败. */ public static boolean compress(String destFileName, String password, File... files) throws ZipException { try { ZipParameters parameters = new ZipParameters(); // 压缩方式 8 parameters.setCompressionMethod(CompressionMethod.DEFLATE); // 压缩级别 5 parameters.setCompressionLevel(CompressionLevel.NORMAL); if (!(password == null || \"\".equals(password))) { parameters.setEncryptFiles(true); // 加密方式 0 parameters.setEncryptionMethod(EncryptionMethod.ZIP_STANDARD); } ZipFile zipFile = new ZipFile(destFileName); if (!(password == null || \"\".equals(password))) { zipFile.setPassword(password.toCharArray()); } for (File file : files) { zipFile.addFile(file, parameters); } return true; } catch (ZipException e) { e.printStackTrace(); throw new ZipException(e); } } /** * 根据给定密码压缩文件(s)到指定位置 * * @param destFileName 压缩文件存放绝对路径 e.g.:D:/upload/zip/demo.zip * @param password 密码(可为null) * @param filePaths 单个文件路径或文件路径数组 * @return 最终的压缩文件存放的绝对路径,如果为false则说明压缩失败. */ public static boolean compress(String destFileName, String password, String... filePaths) throws ZipException { int size = filePaths.length; File[] files = new File[size]; for (int i = 0; i &lt; size; i++) { files[i] = new File(filePaths[i]); } return compress(destFileName, password, files); } /** * 根据给定密码压缩文件(s)到指定位置 * * @param destFileName 压缩文件存放绝对路径 e.g.:D:/upload/zip/demo.zip * @param password 密码(可为null) * @param folder 文件夹路径 * @return 最终的压缩文件存放的绝对路径,如果为false则说明压缩失败. */ public static boolean compressFolder(String destFileName, String password, String folder) throws ZipException { File folderParam = new File(folder); if (folderParam.isDirectory()) { File[] files = folderParam.listFiles(); return compress(destFileName, password, files); } return false; } /** * 根据所给密码解压zip压缩包到指定目录 * &lt;p&gt; * 如果指定目录不存在,可以自动创建,不合法的路径将导致异常被抛出 * * @param zipFile zip压缩包绝对路径 * @param dest 指定解压文件夹位置 * @param password 密码(可为null) * @return 解压后的文件数组 * @throws ZipException 异常 */ public static File[] deCompress(File zipFile, String dest, String password) throws ZipException { //1.判断指定目录是否存在 File destDir = new File(dest); if (destDir.isDirectory() &amp;&amp; !destDir.exists()) { boolean mkdir = destDir.mkdir(); System.out.println(mkdir); } //2.初始化zip工具 ZipFile zFile = new ZipFile(zipFile); zFile.setCharset(Charset.forName(\"UTF-8\")); if (!zFile.isValidZipFile()) { throw new ZipException(\"压缩文件不合法,可能被损坏.\"); } //3.判断是否已加密 if (zFile.isEncrypted()) { zFile.setPassword(password.toCharArray()); } //4.解压所有文件 zFile.extractAll(dest); List headerList = zFile.getFileHeaders(); List&lt;File&gt; extractedFileList = new ArrayList&lt;&gt;(); for(Object object : headerList) { FileHeader fileHeader = (FileHeader)object; if (!fileHeader.isDirectory()) { extractedFileList.add(new File(destDir,fileHeader.getFileName())); } } File [] extractedFiles = new File[extractedFileList.size()]; extractedFileList.toArray(extractedFiles); return extractedFiles; } /** * 解压无密码的zip压缩包到指定目录 * @param zipFile zip压缩包 * @param dest 指定解压文件夹位置 * @return 解压后的文件数组 */ public static File[] deCompress(File zipFile, String dest) throws ZipException { try { return deCompress(zipFile, dest, null); } catch (ZipException e) { e.printStackTrace(); throw new ZipException(e); } } /** * 根据所给密码解压zip压缩包到指定目录 * @param zipFilePath zip压缩包绝对路径 * @param dest 指定解压文件夹位置 * @param password 压缩包密码 * @return 解压后的所有文件数组 */ public static File[] deCompress(String zipFilePath, String dest, String password) throws ZipException { try { return deCompress(new File(zipFilePath), dest, password); } catch (ZipException e) { e.printStackTrace(); throw new ZipException(e); } } /** * 无密码解压压缩包到指定目录 * @param zipFilePath zip压缩包绝对路径 * @param dest 指定解压文件夹位置 * @return 解压后的所有文件数组 */ public static File[] deCompress(String zipFilePath, String dest) throws ZipException { try { return deCompress(new File(zipFilePath), dest, null); } catch (ZipException e) { e.printStackTrace(); throw new ZipException(e); } }} 使用压缩无密码： 1234567891011121314@Testvoid 压缩无密码() { String file1 = \"D:\\\\test\\\\unzip\\\\333\\\\123.txt\"; String file2 = \"D:\\\\test\\\\unzip\\\\333\\\\456.txt\"; String file3 = \"D:\\\\test\\\\unzip\\\\333\\\\789.txt\"; String file4 = \"D:\\\\test\\\\unzip\\\\333\\\\789 - 副本.txt\"; //压缩后的zip文件路径 String zipFilePath1 = \"D:\\\\test\\\\unzip\\\\5555.zip\"; try { System.out.println(Zip4jUtil.compress(zipFilePath1,null,file1,file2,file3,file4)); } catch (ZipException e) { e.printStackTrace(); }} 压缩有密码： 12345678910111213@Testvoid 压缩有密码() { String file1 = \"D:\\\\test\\\\unzip\\\\333\\\\123.txt\"; String file2 = \"D:\\\\test\\\\unzip\\\\333\\\\456.txt\"; String file3 = \"D:\\\\test\\\\unzip\\\\333\\\\789.txt\"; //压缩后的zip文件路径 String zipFilePath2 = \"D:\\\\test\\\\unzip\\\\6666.zip\"; try { System.out.println(Zip4jUtil.compress(zipFilePath2,\"123\",file1,file2,file3)); } catch (ZipException e) { e.printStackTrace(); }} 解压无密码： 12345678910111213@Testvoid 解压无密码() { String zipFilePath1 = \"D:\\\\test\\\\unzip\\\\5555.zip\"; File[] files = new File[0]; try { files = Zip4jUtil.deCompress(zipFilePath1, \"D:\\\\test\\\\unzip\\\\5555\"); } catch (ZipException e) { e.printStackTrace(); } if(files != null){ System.out.println(files.length); }} 解压有密码： 12345678910111213@Testvoid 解压有密码() { String zipFilePath1 = \"D:\\\\test\\\\unzip\\\\6666.zip\"; File[] files = new File[0]; try { files = Zip4jUtil.deCompress(zipFilePath1, \"D:\\\\test\\\\unzip\\\\6666\", \"123\"); } catch (ZipException e) { e.printStackTrace(); } if(files != null){ System.out.println(files.length); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Zip","slug":"Zip","permalink":"https://www.zhuqiaolun.com/tags/Zip/"}]},{"title":"SpringBoot之自定义Redis配置","slug":"2020/11/1605606341401/1605606341401","date":"2020-11-17T09:45:41.000Z","updated":"2022-03-24T08:36:30.048Z","comments":false,"path":"2020/11/1605606341401/1605606341401/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605606341401/1605606341401/","excerpt":"自定义Redis配置,修改原生的yml配置，采取自定义模式","text":"修改原生的yml配置，采取自定义模式， 依赖123456789101112131415161718192021222324252627&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;skipTests&gt;true&lt;/skipTests&gt; &lt;spring-boot.version&gt;2.4.2&lt;/spring-boot.version&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.lettuce&lt;/groupId&gt; &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 配置创建Bean的注入方式，使用 @ConditionalOnMissingClass 注解 进行判断bean是否存在，如不存在则加载当前默认bean，如存在则使用配置bean. 123456789101112131415161718192021222324252627282930313233343536373839404142@Data@Component(value = \"redisDataConfig\")@ConditionalOnMissingClass(value = \"redisDataConfig\")public class RedisDataConfig { // 服务器地址 private List&lt;String&gt; hostname = Collections.singletonList(\"127.0.0.1:6379\"); // 数据库索引（默认为0） private Integer database = 0; // 服务器连接密码（默认为空） private String password; /* 哨兵 */ // 哨兵监听的 master名称（mymaster） private String master; /* 集群 */ private Integer maxRedirects = 3; private Integer refreshTime = 60; /* 其他 */ // 服务器连接名称（默认为空） private String username; // 连接超时时间（毫秒）默认是2000ms private Long timeout = 10000L; // 连接池最大连接数（使用负值表示没有限制） private Integer maxTotal = 200; // 连接池中的最大空闲连接 private Integer maxIdle = 20; // 连接池中的最小空闲连接 private Integer minIdle = 0; // 连接池最大阻塞等待时间（使用负值表示没有限制） private Long maxWaitMillis = 10000L; // 调用validated方法进行校验,若校验失败，连接会从连接池中移除并销毁，同时会尝试重新借一个新的连接对象。 private Boolean testOnBorrow = true; // 归还连接时，会进行检查，检查不通过，销毁。 private Boolean testOnReturn = true; // 检测本次获取redis链接是否可用，若不可用，则取到可用链接为止 private Boolean testWhileIdle = true;} 代码123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.JsonTypeInfo;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.jsontype.impl.LaissezFaireSubTypeValidator;import io.lettuce.core.ReadFrom;import io.lettuce.core.cluster.ClusterClientOptions;import io.lettuce.core.cluster.ClusterTopologyRefreshOptions;import lombok.extern.slf4j.Slf4j;import org.apache.commons.pool2.impl.GenericObjectPoolConfig;import org.springframework.cache.CacheManager;import org.springframework.cache.annotation.EnableCaching;import org.springframework.context.annotation.Bean;import org.springframework.data.redis.cache.RedisCacheConfiguration;import org.springframework.data.redis.cache.RedisCacheManager;import org.springframework.data.redis.cache.RedisCacheWriter;import org.springframework.data.redis.connection.*;import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;import org.springframework.data.redis.connection.lettuce.LettucePoolingClientConfiguration;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.RedisSerializationContext;import org.springframework.data.redis.serializer.RedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;import org.springframework.stereotype.Component;import javax.annotation.Resource;import java.time.Duration;import java.util.Collections;import java.util.List;/** * @className: RedisConfig.java * @description: Redis配置 * @author: Demon */@Slf4j@Component@EnableCachingpublic class RedisConfig { @Resource(name = \"redisDataConfig\") private RedisDataConfig redisDataConfig; @Bean public RedisConnectionFactory lettuceConnectionFactory() { GenericObjectPoolConfig genericObjectPoolConfig = new GenericObjectPoolConfig(); genericObjectPoolConfig.setMaxTotal(redisDataConfig.getMaxTotal()); genericObjectPoolConfig.setMaxWaitMillis(redisDataConfig.getMaxWaitMillis()); genericObjectPoolConfig.setMaxIdle(redisDataConfig.getMaxIdle()); genericObjectPoolConfig.setMinIdle(redisDataConfig.getMinIdle()); genericObjectPoolConfig.setTestOnBorrow(redisDataConfig.getTestOnBorrow()); genericObjectPoolConfig.setTestOnReturn(redisDataConfig.getTestOnReturn()); genericObjectPoolConfig.setTestWhileIdle(redisDataConfig.getTestWhileIdle()); LettucePoolingClientConfiguration.LettucePoolingClientConfigurationBuilder lettucePoolingClientConfigurationBuilder = LettucePoolingClientConfiguration.builder() .poolConfig(genericObjectPoolConfig).commandTimeout(Duration.ofMillis(redisDataConfig.getTimeout())).shutdownTimeout(Duration.ZERO); List&lt;String&gt; hostname = redisDataConfig.getHostname(); if (hostname.size() &gt; 1) { String master = redisDataConfig.getMaster(); if (master != null &amp;&amp; master.length() &gt; 0) { // 哨兵模式 log.info(\"Redis模式：哨兵（{}）\", Collections.singletonList(hostname).toArray()); RedisSentinelConfiguration redisSentinelConfiguration = new RedisSentinelConfiguration(); redisSentinelConfiguration.setMaster(master); redisSentinelConfiguration.setDatabase(redisDataConfig.getDatabase()); redisSentinelConfiguration.setUsername(redisDataConfig.getUsername()); if (redisDataConfig.getPassword() != null &amp;&amp; !\"\".equals(redisDataConfig.getPassword())) { redisSentinelConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword())); } for (String sentinelNode : hostname) { String[] split = sentinelNode.split(\":\"); redisSentinelConfiguration.addSentinel(new RedisNode(split[0], Integer.parseInt(split[1]))); } return new LettuceConnectionFactory(redisSentinelConfiguration, lettucePoolingClientConfigurationBuilder.build()); } else { // 集群模式 log.info(\"Redis模式：集群（{}）\", Collections.singletonList(hostname).toArray()); RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration(); redisClusterConfiguration.setUsername(redisDataConfig.getUsername()); redisClusterConfiguration.setMaxRedirects(redisDataConfig.getMaxRedirects()); if (redisDataConfig.getPassword() != null &amp;&amp; !\"\".equals(redisDataConfig.getPassword())) { redisClusterConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword())); } for (String clusterNode : hostname) { String[] split = clusterNode.split(\":\"); redisClusterConfiguration.addClusterNode(new RedisNode(split[0], Integer.parseInt(split[1]))); } //支持自适应集群拓扑刷新和静态刷新源 ClusterTopologyRefreshOptions clusterTopologyRefreshOptions = ClusterTopologyRefreshOptions.builder() .enablePeriodicRefresh().enableAllAdaptiveRefreshTriggers().refreshPeriod(Duration.ofSeconds(redisDataConfig.getRefreshTime())) .build(); ClusterClientOptions clusterClientOptions = ClusterClientOptions.builder().topologyRefreshOptions(clusterTopologyRefreshOptions).build(); //从优先，读写分离，读从可能存在不一致，最终一致性CP lettucePoolingClientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED).clientOptions(clusterClientOptions).build(); LettucePoolingClientConfiguration clientConfig = lettucePoolingClientConfigurationBuilder.build(); return new LettuceConnectionFactory(redisClusterConfiguration, clientConfig); } } else { // 单机模式 String redisStandaloneHostname = hostname.get(0); log.info(\"Redis模式：单机（{}）\", Collections.singletonList(redisStandaloneHostname).toArray()); String[] split = redisStandaloneHostname.split(\":\"); RedisStandaloneConfiguration redisStandaloneConfiguration = new RedisStandaloneConfiguration(split[0], Integer.parseInt(split[1])); redisStandaloneConfiguration.setDatabase(redisDataConfig.getDatabase()); if (redisDataConfig.getPassword() != null &amp;&amp; !\"\".equals(redisDataConfig.getPassword())) { redisStandaloneConfiguration.setPassword(RedisPassword.of(redisDataConfig.getPassword())); } redisStandaloneConfiguration.setUsername(redisDataConfig.getUsername()); return new LettuceConnectionFactory(redisStandaloneConfiguration, lettucePoolingClientConfigurationBuilder.build()); } } /** * 配置自定义redisTemplate */ @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) { System.out.println(\"★★★★★加载 bean - RedisTemplate&lt;String, Object&gt; ★★★★★\"); RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); //使用Jackson2JsonRedisSerializer来序列化和反序列化redis的value值 替换默认序列化 Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.WRAPPER_ARRAY); jackson2JsonRedisSerializer.setObjectMapper(objectMapper); //使用StringRedisSerializer来序列化和反序列化redis的key值 redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setHashKeySerializer(jackson2JsonRedisSerializer); redisTemplate.setValueSerializer(jackson2JsonRedisSerializer); redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer); redisTemplate.afterPropertiesSet(); //事务支持 redisTemplate.setEnableTransactionSupport(true); return redisTemplate; } /** * 缓存配置管理器 */ @Bean public CacheManager cacheManager(RedisConnectionFactory redisConnectionFactory) { System.out.println(\"★★★★★加载 bean - cacheManager ★★★★★\"); RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer(); Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer&lt;&gt;(Object.class); //以锁写入的方式创建RedisCacheWriter对象 RedisCacheWriter writer = RedisCacheWriter.lockingRedisCacheWriter(redisConnectionFactory); //创建缓存配置对象 RedisCacheConfiguration redisCacheConfiguration = RedisCacheConfiguration.defaultCacheConfig().serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer)) .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer)); return RedisCacheManager.builder(redisConnectionFactory).cacheDefaults(redisCacheConfiguration).cacheWriter(writer).build(); }} 使用123456@Resourceprivate RedisTemplate&lt;String,Object&gt; redisTemplate;ValueOperations&lt;String,Object&gt; valueOperations = redisTemplate.opsForValue();valueOperations.set(\"admin\",\"\"); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"}]},{"title":"MyBatis遍历map","slug":"2020/11/1605605257925/1605605257925","date":"2020-11-17T09:27:37.000Z","updated":"2022-03-24T08:33:18.252Z","comments":false,"path":"2020/11/1605605257925/1605605257925/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605605257925/1605605257925/","excerpt":"MyBatis遍历map","text":"MyBatis是可以遍历map的， Dao注意：要加@Param注解，否则不行 Map&lt;String,Object&gt; map = new LinkedHashMap&lt;&gt;();map.put(“USER_NAME”,”张三”);map.put(“USER_STATUS”,”0”);map.put(“UPDATE_TIME”,new Date()); 1int insertData(@Param(\"params\") Map&lt;String, Object&gt; map); Map&lt;String,Object&gt; map = new LinkedHashMap&lt;&gt;();map.put(“1”,”张三”);map.put(“2”,”李四”); 1int deleteBatch(@Param(\"params\") Map&lt;String, Object&gt; map); Mapper注意：collection=”params.entrySet()” 或者 collection=”params” 都行 12345678910&lt;insert id=\"insertData\" parameterType=\"java.util.Map\"&gt; insert into user_table &lt;foreach collection=\"params.entrySet()\" index=\"key\" separator=\",\" item=\"value\" open=\"(\" close=\")\"&gt; #{key} &lt;/foreach&gt; values &lt;foreach collection=\"params.entrySet()\" index=\"key\" separator=\",\" item=\"value\" open=\"(\" close=\")\"&gt; #{value} &lt;/foreach&gt;&lt;/insert&gt; 123456&lt;update id=\"deleteBatch\" parameterType=\"java.util.Map\"&gt; delete from user_table where USER_ID in &lt;foreach collection=\"params.entrySet()\" index=\"key\" separator=\",\" item=\"value\" open=\"(\" close=\")\"&gt; #{key} &lt;/foreach&gt;&lt;/update&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/tags/MyBatis/"}]},{"title":"MyBatis的几种批量操作 - MySql","slug":"2020/11/1605601494695/1605601494695","date":"2020-11-17T08:24:54.000Z","updated":"2022-08-16T08:12:41.352Z","comments":false,"path":"2020/11/1605601494695/1605601494695/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605601494695/1605601494695/","excerpt":"MyBatis的几种批量操作 - 新增/删除/更新","text":"说明此处针对MySql的数据库操作,datasource.url：jdbc:mysql://127.0.0.1:3306/data?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true 批量新增dao12345678List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();/** * 批量新增 * @param params 参数1 * @param list 参数2 */void saveBatchData(@Param(\"params\")Map&lt;String, Object&gt; map, @Param(\"list\")List&lt;Map&lt;String, Object&gt;&gt; list); Mapper此处的 “list” 为 dao里面的 @Param(“list”) 的 list 1234567&lt;insert id=\"saveBatchData\" parameterType=\"java.util.List\" &gt; insert into user_table ( USER_NAME,USER_STATUS,CREATE_TIME,UPDATE_TIME ) values &lt;foreach collection=\"list\" item=\"item\" separator=\",\"&gt; ( #{item.userName},#{item.userStatus},#{item.createDate},#{item.updateDate} ) &lt;/foreach&gt;&lt;/insert&gt; 批量删除dao数组: 123456789List&lt;String&gt; list = new ArrayList&lt;&gt;();list.add(\"1\");String[] stringArray = new String[list.size()];/** * 批量删除 * @param stringArray 参数 */void deleteBatchDataByArray(String[] stringArray); 集合: 1234567List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();/** * 批量删除 * @param list 参数 */void deleteBatchDataByList(@Param(\"list\")List&lt;Map&lt;String, Object&gt;&gt; list); Mapper数组: 123456&lt;delete id=\"deleteBatchDataByArray\"&gt; delete from user_table where USER_ID in &lt;foreach item=\"item\" index=\"index\" collection=\"array\" open=\"(\" separator=\",\" close=\")\"&gt; #{item} &lt;/foreach&gt;&lt;/delete&gt; 集合: 123456&lt;delete id=\"deleteBatchDataByList\" parameterType=\"java.util.List\"&gt; delete from user_table where &lt;foreach collection=\"list\" item=\"item\" index=\"index\" separator=\"or\"&gt; ( USER_ID = #{item.userId} ) &lt;/foreach&gt;&lt;/delete&gt; 批量更新dao12345678List&lt;Map&lt;String, Object&gt;&gt; listData = new ArrayList&lt;&gt;();/** * 批量更新 * @param params 参数1 * @param list 参数2 */void updateBatchData(@Param(\"params\")Map&lt;String, Object&gt; params, @Param(\"list\")List&lt;Map&lt;String, Object&gt;&gt; list); Mapper123456789101112&lt;update id=\"updateBatchData\" parameterType=\"java.util.List\" &gt; &lt;foreach collection=\"list\" item=\"item\" separator=\";\"&gt; update user_table &lt;set&gt; USER_NAME = #{item.userName}, USER_STATUS = #{item.userStatus}, UPDATE_TIME = #{item.updateDate} &lt;/set&gt; where USER_ID = #{item.userId} &lt;/foreach&gt;&lt;/update&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"}],"tags":[{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/tags/MyBatis/"}]},{"title":"POI(3.17)生成Excel2007 - 可计算公式数据","slug":"2020/11/1605601181571/1605601181571","date":"2020-11-17T08:19:41.000Z","updated":"2022-02-14T08:32:10.844Z","comments":false,"path":"2020/11/1605601181571/1605601181571/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605601181571/1605601181571/","excerpt":"POI生成Excel文件","text":"依赖123456789101112131415&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt; 生成 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345import org.apache.poi.ss.usermodel.*;import org.apache.poi.xssf.streaming.SXSSFWorkbook;import org.apache.poi.xssf.usermodel.XSSFWorkbook;import java.io.*;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;/** * author ：demon * date ：2021 2021/10/1 12:18 * desc ：Excel 导出工具 * &lt;p&gt; * InputStream inputStream = xxx.class.getResourceAsStream(\"/example.xlsx\"); */public class ExcelUtil2 { private boolean isNew = false; private int sheetIndex = 0; private String sheetName = \"Sheet1\"; private String[] removeSheet = {}; private XSSFWorkbook workbook; private OutputStream outputStream; public ExcelUtil2() { this.isNew = true; this.workbook = new XSSFWorkbook(); } public ExcelUtil2(InputStream inputFile) throws IOException { this.workbook = new XSSFWorkbook(inputFile); } public ExcelUtil2(int sheetIndex, InputStream inputFile) throws IOException { this.workbook = new XSSFWorkbook(inputFile); this.sheetIndex = sheetIndex; this.sheetName = this.workbook.getSheetName(sheetIndex); } public ExcelUtil2(String sheetName, InputStream inputFile) throws IOException { this.workbook = new XSSFWorkbook(inputFile); this.sheetIndex = this.workbook.getSheetIndex(sheetName); this.sheetName = sheetName; } public XSSFWorkbook getWorkbook() { return workbook; } public int getSheetIndex() { return this.sheetIndex; } public String getSheetName() { return this.sheetName; } /* 修改指定Sheet的名称 */ public void setSheetName(int sheetIndex, String sheetName) { if (sheetName != null) { this.workbook.setSheetName(sheetIndex, sheetName); } else { this.workbook.setSheetName(sheetIndex, \"Sheet1\"); } } /* 删除Sheet */ public void removeSheet(String[] sheetName) { this.removeSheet = sheetName; } /** * 添加行信息 * * @param cellRow 行计数 * @param columnList 列数据 * @return 返回 */ public Map&lt;String, Object&gt; addRowData(int cellRow, List&lt;Map&lt;String, Object&gt;&gt; columnList) { Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(); map.put(\"cellRow\", cellRow); map.put(\"cellData\", columnList); return map; } /** * 添加列 * * @param cellColumn 列计数 * @param cellTitle 列标题 * @param cellValue 列值 * @param cellType 列类型 * @return 返回 */ public Map&lt;String, Object&gt; addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType) { Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(); map.put(\"cellColumn\", cellColumn); map.put(\"cellTitle\", cellTitle); map.put(\"cellValue\", cellValue); map.put(\"cellType\", cellType); return map; } /** * 添加列 * * @param cellColumn 列计数 * @param cellTitle 列标题 * @param cellValue 列值 * @param cellType 列类型 * @param cellStyle 列格式 * @return 返回 */ public Map&lt;String, Object&gt; addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, String cellStyle) { Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(this.addColumnData(cellColumn, cellTitle, cellValue, cellType)); map.put(\"cellStyle\", cellStyle); return map; } /** * 添加列 指定宽度 * * @param cellColumn 列计数 * @param cellTitle 列标题 * @param cellValue 列值 * @param cellType 列类型 * @param cellColumnWidth 列长度 * @return 返回 */ public Map&lt;String, Object&gt; addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, int cellColumnWidth) { Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(this.addColumnData(cellColumn, cellTitle, cellValue, cellType)); map.put(\"cellColumnWidth\", cellColumnWidth); return map; } public Map&lt;String, Object&gt; addColumnData(int cellColumn, String cellTitle, Object cellValue, String cellType, String cellStyle, int cellColumnWidth) { Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(this.addColumnData(cellColumn, cellTitle, cellValue, cellType)); map.put(\"cellStyle\", cellStyle); map.put(\"cellColumnWidth\", cellColumnWidth); return map; } /** * 生成文件 - 写入绝对路径 * * @param dataList 数据 * @param outFilePath 保存文件 * @throws Exception 异常 */ public void createWorkbook(List&lt;Map&lt;String, Object&gt;&gt; dataList, File outFilePath) throws Exception { try (SXSSFWorkbook sxssfWorkbook = new SXSSFWorkbook(workbook, dataList.size())) { if (this.isNew) { try { Sheet sheet = sxssfWorkbook.createSheet(this.sheetName != null ? this.sheetName : \"Sheet1\"); this.setRowData(sheet, 0, dataList); outputStream = new FileOutputStream(outFilePath.getAbsolutePath()); //强制让改Sheet执行公式 sheet.setForceFormulaRecalculation(true); sxssfWorkbook.write(outputStream); } catch (Exception e) { e.printStackTrace(); throw new Exception(\"导出新创建的Excel文件异常\", e); } } else { try { Sheet sheet = sxssfWorkbook.getSheetAt(this.sheetIndex); this.setRowData(sheet, sheetIndex, dataList); outputStream = new FileOutputStream(outFilePath.getAbsolutePath()); //强制让改Sheet执行公式 sheet.setForceFormulaRecalculation(true); sxssfWorkbook.write(outputStream); } catch (Exception e) { e.printStackTrace(); throw new Exception(\"导出带模板的Excel文件异常\", e); } } } catch (Exception e) { throw new Exception(e); } finally { if (workbook != null) { workbook.close(); } if (outputStream != null) { outputStream.flush(); outputStream.close(); } } } /** * 生成文件 - 返回流 * * @param dataList 数据 * @throws Exception 异常 */ public byte[] createWorkbook(List&lt;Map&lt;String, Object&gt;&gt; dataList) throws Exception { ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); try (SXSSFWorkbook sxssfWorkbook = new SXSSFWorkbook(this.workbook, dataList.size())) { if (this.isNew) { try { Sheet sheet = sxssfWorkbook.createSheet(this.sheetName != null ? this.sheetName : \"Sheet1\"); this.setRowData(sheet, 0, dataList); //强制让改Sheet执行公式 sheet.setForceFormulaRecalculation(true); sxssfWorkbook.write(byteArrayOutputStream); } catch (Exception e) { e.printStackTrace(); throw new Exception(\"导出新创建的Excel文件异常\", e); } } else { try { Sheet sheet = sxssfWorkbook.getSheetAt(this.sheetIndex); this.setRowData(sheet, sheetIndex, dataList); //强制让改Sheet执行公式 sheet.setForceFormulaRecalculation(true); sxssfWorkbook.write(byteArrayOutputStream); } catch (Exception e) { e.printStackTrace(); throw new Exception(\"导出带模板的Excel文件异常\", e); } } return byteArrayOutputStream.toByteArray(); } catch (Exception e) { throw new Exception(e); } finally { byteArrayOutputStream.flush(); byteArrayOutputStream.close(); } } private void setRowData(Sheet sheet, int sheetIndex, List&lt;Map&lt;String, Object&gt;&gt; dataList) throws Exception { try { if (dataList != null) { // 赋值内容 for (Map&lt;String, Object&gt; rowMap : dataList) { Row row = sheet.createRow(Integer.parseInt(String.valueOf(rowMap.get(\"cellRow\")))); List&lt;Map&lt;String, Object&gt;&gt; cellDataList = (List&lt;Map&lt;String, Object&gt;&gt;) rowMap.get(\"cellData\"); this.executeCellValue(sheetIndex, row, cellDataList); } } if (this.removeSheet.length &gt; 0) { // 删除页 for (String s : this.removeSheet) { this.workbook.removeSheetAt(this.workbook.getSheetIndex(s)); } } } catch (Exception e) { throw new Exception(e); } } private void executeCellValue(int sheetIndex, Row row, List&lt;Map&lt;String, Object&gt;&gt; cellDataList) { for (Map&lt;String, Object&gt; rowCellData : cellDataList) { Cell cell = row.createCell(Integer.parseInt(String.valueOf(rowCellData.get(\"cellColumn\")))); Object cellValue = rowCellData.get(\"cellValue\"); switch (String.valueOf(rowCellData.get(\"cellType\"))) { case \"-1\": //未知类型，不填值 cell.setCellType(CellType._NONE); break; case \"0\": // 数字- 整数：如：0 cell.setCellType(CellType.NUMERIC); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellValue(String.valueOf(cellValue)); } break; case \"1\": // 数字- 小数：如：0.01 cell.setCellType(CellType.NUMERIC); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellValue(Double.parseDouble(String.valueOf(cellValue))); } break; case \"2\": // 数字- 日期：如：2021-09-03 cell.setCellType(CellType.NUMERIC); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellValue(String.valueOf(cellValue)); } break; case \"3\": // 字符串类型 cell.setCellType(CellType.STRING); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellValue(String.valueOf(cellValue)); } break; case \"4\": // 计算公式 cell.setCellType(CellType.FORMULA); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellFormula(String.valueOf(cellValue)); } break; case \"5\": // 布尔类型 cell.setCellType(CellType.BOOLEAN); if (cellValue != null &amp;&amp; String.valueOf(cellValue).length() &gt; 0) { cell.setCellValue(Boolean.parseBoolean(String.valueOf(cellValue))); } break; case \"6\": // 空 cell.setCellType(CellType.BLANK); break; case \"7\": // 错误 cell.setCellType(CellType.ERROR); cell.setCellErrorValue(new Byte(String.valueOf(cellValue))); break; default: //其他一律string类型，在赋值 cell.setCellType(CellType.STRING); cell.setCellValue(String.valueOf(cellValue)); break; } // 设置列格式 if (rowCellData.containsKey(\"cellStyle\")) { switch (String.valueOf(rowCellData.get(\"cellStyle\"))) { case \"1\": // 常规 break; case \"8\": // 百分比 CellStyle style = this.workbook.createCellStyle(); style.setDataFormat(this.workbook.createDataFormat().getFormat(\"0.000%\")); cell.setCellStyle(style); break; default: break; } } // 设置自定义的宽度 if (rowCellData.containsKey(\"cellColumnWidth\")) { int cellColumn = Integer.parseInt(String.valueOf(rowCellData.get(\"cellColumn\"))); int cellColumnWidth = Integer.parseInt(String.valueOf(rowCellData.get(\"cellColumnWidth\"))); this.workbook.getSheetAt(sheetIndex).setColumnWidth(cellColumn, cellColumnWidth); } } }} 使用1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283@Testpublic void 测试Excel导出_创建新文件() { try { ExcelUtil2 excelUtil2 = new ExcelUtil2(); List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;(); List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;(); columnList.add(excelUtil2.addColumnData(0,\"编号\",\"编号\", \"3\",1000)); columnList.add(excelUtil2.addColumnData(1,\"代码\",\"代码\", \"3\")); columnList.add(excelUtil2.addColumnData(2,\"名称\",\"代码\", \"3\")); dataList.add(excelUtil2.addRowData(0, columnList)); excelUtil2.createWorkbook(dataList, new File(\"D:\\\\test\\\\334.xlsx\")); } catch (Exception e) { e.printStackTrace(); }}@Testpublic void 测试Excel导出_模板文件续写() { try { FileInputStream fileInputStream = FileUtils.openInputStream(new File(\"D:\\\\test\\\\334.xlsx\")); ExcelUtil2 excelUtil2 = new ExcelUtil2(0, fileInputStream); List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;(); List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;(); columnList.add(excelUtil2.addColumnData(0,\"编号\",\"0\", \"1\")); columnList.add(excelUtil2.addColumnData(1,\"代码\",\"CC\", \"3\")); columnList.add(excelUtil2.addColumnData(2,\"名称\",\"123\", \"0\")); dataList.add(excelUtil2.addRowData(1, columnList)); excelUtil2.createWorkbook(dataList, new File(\"D:\\\\test\\\\334.xlsx\")); } catch (Exception e) { e.printStackTrace(); }}@Testpublic void 获取Excel模板文件的公式() { try { FileInputStream fileInputStream = FileUtils.openInputStream(new File(\"D:\\\\test\\\\334.xlsx\")); Workbook workbook = new XSSFWorkbook(fileInputStream); Sheet sheetAt = workbook.getSheetAt(0); Cell cell1 = sheetAt.getRow(0).getCell(12); System.out.println(cell1.getStringCellValue()); } catch (IOException e) { e.printStackTrace(); }}@Testpublic void 测试Excel模板导出2_指定页导出() { try { List&lt;Map&lt;String, Object&gt;&gt; sourceDataList = new ArrayList&lt;&gt;(); Map&lt;String, Object&gt; map1 = new LinkedHashMap&lt;&gt;(); map1.put(\"key0\", \"0\"); map1.put(\"key1\", \"CC\"); map1.put(\"key2\", \"123\"); map1.put(\"key3\", \"456\"); map1.put(\"key4\", \"789.88\"); sourceDataList.add(map1); // 获取指定页 ExcelUtil2 excelUtil2 = new ExcelUtil2(\"Sheet2\", new FileInputStream(new File(\"D:\\\\test\\\\334.xlsx\"))); // 删除多余页 excelUtil2.removeSheet(new String[]{\"Sheet1\"}); List&lt;Map&lt;String, Object&gt;&gt; dataList = new ArrayList&lt;&gt;(); // 开始行 int startNum = 1; for (int i = 0; i &lt; sourceDataList.size(); i++) { List&lt;Map&lt;String, Object&gt;&gt; columnList = new LinkedList&lt;&gt;(); int cellRow = startNum + i; Map&lt;String, Object&gt; objectMap = sourceDataList.get(i); columnList.add(excelUtil2.addColumnData(0, \"编号1\", objectMap.get(\"key0\"), \"1\")); columnList.add(excelUtil2.addColumnData(1, \"代码2\", objectMap.get(\"key1\"), \"3\")); columnList.add(excelUtil2.addColumnData(2, \"名称3\", objectMap.get(\"key2\"), \"1\")); columnList.add(excelUtil2.addColumnData(3, \"名称4\", objectMap.get(\"key3\"), \"1\")); columnList.add(excelUtil2.addColumnData(4, \"名称5\", objectMap.get(\"key4\"), \"1\")); columnList.add(excelUtil2.addColumnData(5, \"公式列\", \"=C\" + (cellRow + 1) + \"/D\" + (cellRow + 1), \"4\", \"8\")); // 写入 dataList.add(excelUtil2.addRowData(cellRow, columnList)); } excelUtil2.setSheetName(excelUtil2.getSheetIndex(), \"自定义\" + excelUtil2.getSheetName()); excelUtil2.createWorkbook(dataList, new File(\"D:\\\\test\\\\3344.xlsx\")); } catch (Exception e) { e.printStackTrace(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Excel","slug":"Excel","permalink":"https://www.zhuqiaolun.com/tags/Excel/"}]},{"title":"POI(3.17)解析Excel2007 - 可解析公式数据","slug":"2020/11/1605159781717/1605159781717","date":"2020-11-12T05:43:01.000Z","updated":"2022-09-27T03:08:06.665Z","comments":false,"path":"2020/11/1605159781717/1605159781717/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605159781717/1605159781717/","excerpt":"POI解析Excel文件","text":"依赖12345678910111213141516171819&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml-schemas&lt;/artifactId&gt; &lt;version&gt;3.17&lt;/version&gt;&lt;/dependency&gt; 解析123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179import org.apache.commons.lang3.StringUtils;import org.apache.poi.hssf.usermodel.HSSFWorkbook;import org.apache.poi.ss.usermodel.Cell;import org.apache.poi.ss.usermodel.FormulaEvaluator;import org.apache.poi.ss.usermodel.Sheet;import org.apache.poi.ss.usermodel.Workbook;import org.apache.poi.xssf.usermodel.XSSFWorkbook;import java.io.FileInputStream;import java.io.IOException;import java.text.NumberFormat;import java.util.ArrayList;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;/** * className ExcelUtil * author demon * createTime 2021/6/25 11:32 */public class ExcelUtil { private static NumberFormat numberFormat = NumberFormat.getNumberInstance(); static { numberFormat.setGroupingUsed(false); // 最大小数保留位数 numberFormat.setMaximumFractionDigits(9); } /** * 根据读取，文件流解析Excel文件 * * @param fileName 文件名 * @param sheetIndex sheet页码 * @param input 文件流 * @return 返回 * @throws IOException 异常 */ public static List&lt;Map&lt;String, String&gt;&gt; getDataToInput(String fileName, int sheetIndex, FileInputStream input) throws IOException { return getData(fileName, sheetIndex, input); } /** * 根据文件绝对路径，解析Excel文件 * * @param fileName 文件名 * @param sheetIndex sheet页码 * @param filePath 文件路径 * @return 返回 * @throws IOException 异常 */ public static List&lt;Map&lt;String, String&gt;&gt; getDataToFilePath(String fileName, int sheetIndex, String filePath) throws IOException { return getData(fileName, sheetIndex, new FileInputStream(filePath)); } /** * 解析数据 */ private static List&lt;Map&lt;String, String&gt;&gt; getData(String fileName, int sheetIndex, FileInputStream input) throws IOException { List&lt;Map&lt;String, String&gt;&gt; mapList = new ArrayList&lt;&gt;(); if (ExcelUtil.isExcel2003(fileName)) { Workbook workbook = new HSSFWorkbook(input); // 拿到计算公式 getDataToExcel(workbook, sheetIndex, input, mapList); } else if (ExcelUtil.isExcel2007(fileName)) { Workbook workbook = new XSSFWorkbook(input); getDataToExcel(workbook, sheetIndex, input, mapList); } else { System.err.println(\"未知文件\"); } System.out.println(mapList); return mapList; } private static void getDataToExcel(Workbook workbook, int sheetIndex, FileInputStream input, List&lt;Map&lt;String, String&gt;&gt; mapList) throws IOException { try { FormulaEvaluator formulaEvaluator = workbook.getCreationHelper().createFormulaEvaluator(); // 获得第一个表单 Sheet sheet = workbook.getSheetAt(sheetIndex); // 获得第一行表头，计算列数 int columnNum = sheet.getRow(0).getPhysicalNumberOfCells(); // 遍历数据 行 sheet.rowIterator().forEachRemaining(row -&gt; { Map&lt;String, String&gt; jsonMap = new LinkedHashMap&lt;&gt;(); // 遍历列 for (int i = 0; i &lt; columnNum; i++) { Cell cell = row.getCell(i); if (cell != null) { // 读取值 jsonMap.put(String.valueOf(i), getCellFormatValue(formulaEvaluator, cell)); } else { jsonMap.put(String.valueOf(i), \"\"); } } mapList.add(jsonMap); }); } catch (Exception e) { System.out.println(\"解析xlsx文件错误\"); throw new IOException(e); } finally { if (input != null) { try { input.close(); } catch (Exception e) { e.printStackTrace(); } } if (workbook != null) { try { workbook.close(); } catch (Exception e) { e.printStackTrace(); } } } } /** * 判断是否为老版本的excel * * @param filePath *.xls * @return 返回 */ private static boolean isExcel2003(String filePath) { return StringUtils.isNotEmpty(filePath) &amp;&amp; filePath.matches(\"^.+\\\\.(?i)(xls)$\"); } /** * 判断是否为新版本的excel * * @param filePath *.xlsx * @return 返回 */ private static boolean isExcel2007(String filePath) { return StringUtils.isNotEmpty(filePath) &amp;&amp; filePath.matches(\"^.+\\\\.(?i)(xlsx)$\"); } private static String getCellFormatValue(FormulaEvaluator formulaEvaluator, Cell cell) { String val; // 根据cell中的类型来输出数据 switch (cell.getCellTypeEnum()) { case NUMERIC: // 数字 if (org.apache.poi.ss.usermodel.DateUtil.isCellDateFormatted(cell)) { // 时间类型 val = Long.toString(cell.getDateCellValue().getTime()); } else { // 数字类型 - 普通数字33 val = numberFormat.format(cell.getNumericCellValue()); } break; case STRING: // 字符串类型 val = cell.getStringCellValue(); break; case BOOLEAN: // 布尔类型 val = Boolean.toString(cell.getBooleanCellValue()); break; case FORMULA: // 计算公式 val = formulaEvaluator.evaluate(cell).formatAsString(); break; case BLANK: // 空 val = cell.getStringCellValue(); break; default: //如果是不知道的类型， 首先强制设置成string类型，再取值 val = cell.getStringCellValue(); break; } return val; }} 使用第一种： 12345678try { String fileName = \"test.xlsx\"; String filePath = \"D:\\\\test\\\\test.xlsx\"; List&lt;Map&lt;String,String&gt;&gt; mapList = ExcelUtil.getDataToInput(fileName,0,new FileInputStream(new File(filePath))); System.out.println(mapList.size());} catch (IOException e) { e.printStackTrace();} 第二种： 12345678try { String fileName = \"test.xlsx\"; String filePath = \"D:\\\\test\\\\test.xlsx\"; List&lt;Map&lt;String,String&gt;&gt; mapList = ExcelUtil.getDataToFilePath(fileName,0,filePath); System.out.println(mapList.size());} catch (IOException e) { e.printStackTrace();} 12345678910111213141516171819202122232425262728293031String fileName = \"test.xlsx\";String filePath = \"D:\\\\test\\\\test.xlsx\";try { List&lt;Map&lt;String, String&gt;&gt; dataToInput = ExcelUtil.getDataToFilePath(fileName, 0, filePath); List&lt;Map&lt;String, String&gt;&gt; dataList = dataToInput.subList(1, dataToInput.size()); Set&lt;String&gt; 编号Set = new LinkedHashSet&lt;&gt;(); for (Map&lt;String, String&gt; stringMap : dataList) { String documentNo = stringMap.get(\"0\"); if (StringUtils.isNotBlank(documentNo)) { // 转化公式值 String[] replaceStr = {\"3\",\"4\",\"6\",\"7\",\"11\",\"13\",\"19\",\"22\"}; for (String s : replaceStr) { String replaceStrVal = stringMap.get(s).replace(\"\\\"\", \"\"); stringMap.put(s, replaceStrVal); } // 转化数字值 String[] doubleStr = {\"0\",\"9\"}; for (String s : doubleStr) { String doubleStrVal = new DecimalFormat(\"0\").format(new Double(stringMap.get(s))); stringMap.put(s, doubleStrVal); } } else { continue; } 编号Set.add(stringMap.get(\"0\")); } System.out.println(JSON.toJSONString(编号Set)); System.out.println(JSON.toJSONString(dataList));} catch (IOException e) { e.printStackTrace();} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Excel","slug":"Excel","permalink":"https://www.zhuqiaolun.com/tags/Excel/"}]},{"title":"对响应值Response的封装使用(可格式化Json格式数据)","slug":"2020/11/1605079334142/1605079334142","date":"2020-11-11T07:22:14.000Z","updated":"2021-03-10T02:54:54.067Z","comments":false,"path":"2020/11/1605079334142/1605079334142/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605079334142/1605079334142/","excerpt":"对响应值Response的封装使用","text":"配置返回的json中忽略null属性值，不传递pom引入: 1234567891011&lt;!-- lombok --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt;&lt;/dependency&gt;&lt;!-- jackson --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;&lt;/dependency&gt; 第一种，在yml中写入（全局）： 123spring: jackson: default-property-inclusion: non_null 第二种，在应用类上写入（局部）： 1@JsonInclude(JsonInclude.Include.NON_NULL) 类ResponseBean： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import com.fasterxml.jackson.annotation.JsonIgnore;import com.fasterxml.jackson.annotation.JsonInclude;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import lombok.experimental.Accessors;import java.io.Serializable;/** * @author: Demon * @date 2021/3/8 13:27 * @description: 返回的JSON数据结构标准 */@Data@Accessors(chain = true)public class ResponseBean implements Serializable { private boolean success = false; private Object data; private String msg; private String errCode; private String errMsg; @JsonIgnore private boolean dataFormat = false; @SneakyThrows @Override public String toString() { ObjectMapper objectMapper = new ObjectMapper(); objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL); ResponseBeanVo responseBeanVo = new ResponseBeanVo() .setSuccess(this.isSuccess()).setData(this.getData()).setMsg(this.getMsg()) .setErrCode(this.getErrCode()).setErrMsg(this.getErrMsg()); if (this.isDataFormat()) { return objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(responseBeanVo); } else { return objectMapper.writer().writeValueAsString(responseBeanVo); } }}@Data@Accessors(chain = true)class ResponseBeanVo implements Serializable { private boolean success; private Object data; private String msg; private String errCode; private String errMsg;} BaseController12345678910111213141516171819202122232425262728/** * @className: BaseController.java * @description: 基本 * @author: Demon */public abstract class BaseController { /** * 使用response输出JSON * @param response response * @param str 响应对应 */ protected void out(HttpServletResponse response, Object str) { PrintWriter out = null; try { response.setCharacterEncoding(\"UTF-8\"); response.setContentType(\"application/json\"); out = response.getWriter(); out.print(str); } catch (Exception e) { log.error(\"输出JSON出错\",e.getMessage()); } finally { if (out != null) { out.flush(); out.close(); } } }} 使用123456789101112131415161718192021import org.springframework.web.bind.annotation.*;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;/** * @ClassName: IndexController * @Description: 控制层测试 * @Author: Demon */@RestControllerpublic class TestController extends BaseController { @RequestMapping(method = {RequestMethod.GET,RequestMethod.POST}) public @ResponseBody void getIndex(HttpServletResponse response) { ResponseBean responseBean = new ResponseBean(); responseBean.setSuccess(true); responseBean.setDataFormat(true); this.out(response,responseBean); }} 结果： 123{ \"success\" : true} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"Java的普通类获取注册的bean","slug":"2020/11/1605079105126/1605079105126","date":"2020-11-11T07:18:25.000Z","updated":"2021-03-01T06:46:25.859Z","comments":false,"path":"2020/11/1605079105126/1605079105126/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605079105126/1605079105126/","excerpt":"SpringBoot的ApplicationContext","text":"配置12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import org.springframework.beans.BeansException;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import org.springframework.stereotype.Component;/** * @className: ApplicationContextHelper.java * @description: 获取 ApplicationContext * @author: Demon */@Componentpublic class ApplicationContextHelper implements ApplicationContextAware { private static ApplicationContext appCtx; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException { System.out.println(\"初始化applicationContext：\"+applicationContext.getBeanDefinitionNames().length); appCtx = applicationContext; } /** * 通过name获取 Bean. * @param name bean名 * @return 返回 */ public static Object getBean(String name) { return appCtx.getBean(name); } /** * 通过class获取Bean. * @param clazz bean类 * @return 返回 */ public static &lt;T&gt; T getBean(Class&lt;T&gt; clazz) { return appCtx.getBean(clazz); } /** * 通过name,以及Clazz返回指定的Bean * @param name bean名 * @param clazz bean类 * @return 返回 */ public static &lt;T&gt; T getBean(String name, Class&lt;T&gt; clazz) { return appCtx.getBean(name, clazz); }} 使用获取 RestTemplate 的 bean 1RestTemplate restTemplate = ApplicationContextHelper.getBean(RestTemplate.class); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"MD5加密工具","slug":"2020/11/1605078934677/1605078934677","date":"2020-11-11T07:15:34.000Z","updated":"2021-03-01T06:46:25.211Z","comments":false,"path":"2020/11/1605078934677/1605078934677/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605078934677/1605078934677/","excerpt":"Java工具类 - MD5加密工具","text":"1234567891011121314151617181920212223242526272829303132333435import java.security.MessageDigest;/** * @ClassName: MD5Util * @Description: MD5加密工具 * @Author: Demon */public class MD5Util { private static final String SALT = \"demon\"; public static String encode(String password) { password = password + SALT; MessageDigest md5; try { md5 = MessageDigest.getInstance(\"MD5\"); } catch (Exception e) { throw new RuntimeException(e); } char[] charArray = password.toCharArray(); byte[] byteArray = new byte[charArray.length]; for (int i = 0; i &lt; charArray.length; i++) { byteArray[i] = (byte) charArray[i]; } byte[] md5Bytes = md5.digest(byteArray); StringBuilder hexValue = new StringBuilder(); for (byte md5Byte : md5Bytes) { int val = ((int) md5Byte) &amp; 0xff; if (val &lt; 16) { hexValue.append(\"0\"); } hexValue.append(Integer.toHexString(val)); } return hexValue.toString(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"获取当前登录用户IP(web)","slug":"2020/11/1605078705487/1605078705487","date":"2020-11-11T07:11:45.000Z","updated":"2021-05-13T05:50:30.758Z","comments":false,"path":"2020/11/1605078705487/1605078705487/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605078705487/1605078705487/","excerpt":"Java工具类 - 获取当前登录用户IP","text":"此方法采用的 HttpServletRequest 获取，故使用web项目，说明，当存在使用 虚拟机 的情况，会导致获取的IP为 以太网适配器 的IP 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475import javax.servlet.http.HttpServletRequest;import java.net.InetAddress;import java.net.UnknownHostException;import java.util.Arrays;/** * @ClassName: IpUtil * @Description: 获取当前登录用户IP * @Author: Demon */public class IpUtil { private static final String[] LOCAL_IP = {\"127.0.0.1\",\"localhost\",\"0:0:0:0:0:0:0:1\"}; private static final String UNKNOWN = \"unknown\"; public static String getIpAddr(HttpServletRequest request) { String ipAddress; try { ipAddress = request.getHeader(\"x-forwarded-for\"); if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) { ipAddress = request.getHeader(\"Proxy-Client-IP\"); } if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) { ipAddress = request.getHeader(\"WL-Proxy-Client-IP\"); } if (ipAddress == null || ipAddress.length() == 0 || UNKNOWN.equalsIgnoreCase(ipAddress)) { ipAddress = request.getRemoteAddr(); if (Arrays.asList(LOCAL_IP).contains(ipAddress)) { // 根据网卡取本机配置的IP InetAddress inet = null; try { inet = InetAddress.getLocalHost(); } catch (UnknownHostException e) { e.printStackTrace(); } assert inet != null; ipAddress = inet.getHostAddress(); } } // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割 // \"***.***.***.***\".length() if (ipAddress != null &amp;&amp; ipAddress.length() &gt; 15) { // = 15 if (ipAddress.indexOf(\",\") &gt; 0) { ipAddress = ipAddress.substring(0, ipAddress.indexOf(\",\")); } } } catch (Exception e) { ipAddress = \"\"; } return ipAddress; } /** * 判断IP地址的合法性，这里采用了正则表达式的方法来判断 * return true，合法 * */ public static boolean ipCheck(String text) { if (text != null &amp;&amp; !text.isEmpty()) { // 定义正则表达式 String regex = \"^(1\\\\d{2}|2[0-4]\\\\d|25[0-5]|[1-9]\\\\d|[1-9])\\\\.\"+ \"(1\\\\d{2}|2[0-4]\\\\d|25[0-5]|[1-9]\\\\d|\\\\d)\\\\.\"+ \"(1\\\\d{2}|2[0-4]\\\\d|25[0-5]|[1-9]\\\\d|\\\\d)\\\\.\"+ \"(1\\\\d{2}|2[0-4]\\\\d|25[0-5]|[1-9]\\\\d|\\\\d)$\"; // 判断ip地址是否与正则表达式匹配 // 返回判断信息 // 返回判断信息 return text.matches(regex); } return false; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"实体对象与Map之间的转换工具类","slug":"2020/11/1605077732135/1605077732135","date":"2020-11-11T06:55:32.000Z","updated":"2021-03-01T06:46:25.989Z","comments":false,"path":"2020/11/1605077732135/1605077732135/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605077732135/1605077732135/","excerpt":"Java工具类 - 实体对象与Map之间的转换工具类","text":"1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465import java.lang.reflect.Field;import java.util.LinkedHashMap;import java.util.Map;/** * @ClassName: EntityUtil * @Description: 实体对象与Map之间的转换工具类 * @Author: Demon */public class EntityUtil { /** * 实体类转Map * @param object 对象 * @return 返回 */ public static Map&lt;String, Object&gt; entityToMap(Object object) { if (object == null) { return null; } Map&lt;String, Object&gt; map = new LinkedHashMap&lt;&gt;(); for (Field field : object.getClass().getDeclaredFields()){ try { boolean flag = field.isAccessible(); field.setAccessible(true); Object o = field.get(object); map.put(field.getName(), o); field.setAccessible(flag); } catch (Exception e) { e.printStackTrace(); } } return map; } /** * Map转实体类 * @param map 需要初始化的数据，key字段必须与实体类的成员名字一样，否则赋值为空 * @param entity 需要转化成的实体类 * @return 返回 */ public static &lt;T&gt; T mapToEntity(Map&lt;String, Object&gt; map, Class&lt;T&gt; entity) { T t = null; try { t = entity.newInstance(); for(Field field : entity.getDeclaredFields()) { if (map.containsKey(field.getName())) { boolean flag = field.isAccessible(); field.setAccessible(true); Object object = map.get(field.getName()); if (object!= null &amp;&amp; field.getType().isAssignableFrom(object.getClass())) { field.set(t, object); } field.setAccessible(flag); } } return t; } catch (InstantiationException | IllegalAccessException e) { e.printStackTrace(); } return t; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"SpringBoot 静态资源处理","slug":"2020/11/1605076979058/1605076979058","date":"2020-11-11T06:42:59.000Z","updated":"2021-03-01T06:46:25.882Z","comments":false,"path":"2020/11/1605076979058/1605076979058/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605076979058/1605076979058/","excerpt":"配置SpringBoot的资源路径","text":"配置123456789101112131415161718192021import org.springframework.context.annotation.Configuration;import org.springframework.util.ResourceUtils;import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;/** * @className: WebMvcConfig.java * @description: WebMvc配置 * @author: Demon */@Configurationpublic class WebMvcConfig implements WebMvcConfigurer { @Override public void addResourceHandlers(ResourceHandlerRegistry registry) { // 配置模板资源路径 registry.addResourceHandler(\"/templates/**\").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+\"/templates/\"); registry.addResourceHandler(\"/static/**\").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+\"/static/\"); registry.addResourceHandler(\"/public/**\").addResourceLocations(ResourceUtils.CLASSPATH_URL_PREFIX+\"/public/\"); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"解决IE浏览器  @ResponseBody 返回json的时候提示下载问题","slug":"2020/11/1605076219103/1605076219103","date":"2020-11-11T06:30:19.000Z","updated":"2021-03-01T06:46:25.600Z","comments":false,"path":"2020/11/1605076219103/1605076219103/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1605076219103/1605076219103/","excerpt":"解决IE浏览器 @ResponseBody 返回json的时候提示下载问题","text":"配置12345678910111213141516171819202122232425262728import org.springframework.context.annotation.Configuration;import org.springframework.http.MediaType;import org.springframework.http.converter.HttpMessageConverter;import org.springframework.http.converter.json.MappingJackson2HttpMessageConverter;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;import java.nio.charset.Charset;import java.util.ArrayList;import java.util.List;/** * @className: WebMvcConfig.java * @description: WebMvc配置 * @author: Demon */@Configurationpublic class WebMvcConfig implements WebMvcConfigurer { @Override public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) { MappingJackson2HttpMessageConverter jsonConverter = new MappingJackson2HttpMessageConverter(); List&lt;MediaType&gt; supportedMediaTypes = new ArrayList&lt;&gt;(); MediaType media = new MediaType(MediaType.TEXT_HTML, Charset.forName(\"UTF-8\")); supportedMediaTypes.add(media); jsonConverter.setSupportedMediaTypes(supportedMediaTypes); converters.add(jsonConverter); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"发布Java程序为Windows服务 - Windows Service Wrapper 四","slug":"2020/11/1604299054941/1604299054941","date":"2020-11-02T06:37:34.000Z","updated":"2025-02-07T09:55:24.798Z","comments":false,"path":"2020/11/1604299054941/1604299054941/","link":"","permalink":"https://www.zhuqiaolun.com/2020/11/1604299054941/1604299054941/","excerpt":"Windows Service Wrapper","text":"Windows Service WrapperWindows Service Wrapper 可以将 Java 的 jar 包注册为 windows 服务。项目：https://github.com/winsw/winsw地址：https://github.com/winsw/winsw/releases 下载官方 GitHub下载 WinSW.NET4.exe 和 sample-minimal.xml选择 WinSW v2.10.3 版本下载WinSW.NET4.exe ：https://github.com/winsw/winsw/releases/download/v2.10.3/WinSW.NET4.exesample-minimal.xml ：https://github.com/winsw/winsw/releases/download/v2.10.3/sample-minimal.xml 配置新建目录，例如： MyApp 文件内容： 1234567891011bin: 属于服务的命名以及配置 - MyApp.exe - MyApp.xmlconf：一些需要的文件配置 jre：属于Java的运行环境lib：属于程序的执行包log：输出日志文件夹 MyApp.xml配置过程中注意目录情况，%BASE% 是以exe所在的目录为根目录 1234567891011121314151617181920212223&lt;service&gt; &lt;!-- 服务名称 --&gt; &lt;id&gt;MyApp&lt;/id&gt; &lt;!-- 服务显示名称 --&gt; &lt;name&gt;My App Service&lt;/name&gt; &lt;!-- 服务描述 --&gt; &lt;description&gt;通过wapper注册成Windows服务&lt;/description&gt; &lt;!-- java环境变量 --&gt; &lt;!--当前电脑配置了java环境变量，直接写成“java”就行；你也可以写成类似这样：C:\\jdk1.8\\jre\\bin\\java--&gt; &lt;executable&gt;%BASE%\\..\\jre\\bin\\java&lt;/executable&gt; &lt;!--启动参数--&gt; &lt;arguments&gt;-jar %BASE%\\..\\lib\\MyApp.jar\"&lt;/arguments&gt; &lt;!-- 开机启动 --&gt; &lt;startmode&gt;Automatic&lt;/startmode&gt; &lt;!-- 日志配置 &lt;logmode&gt;rotate&lt;/logmode&gt; --&gt; &lt;logpath&gt;%BASE%\\..\\log&lt;/logpath&gt; &lt;log mode=\"roll-by-time\"&gt; &lt;pattern&gt;yyyyMMdd&lt;/pattern&gt; &lt;/log&gt;&lt;/service&gt; 运行以管理员身份运行 bat文件，进行 windows 服务操作 bat注册服务 service install.bat 12@echo offstart bin\\MyApp.exe install 卸载服务 service uninstall.bat 12@echo offstart bin\\MyApp.exe uninstall 启动服务 service start.bat 12@echo offstart bin\\MyApp.exe start 停止服务 service stop.bat 12@echo offstart bin\\MyApp.exe stop 重启服务 service restart.bat 12@echo offstart bin\\MyApp.exe restart 服务状态 service status.bat 12@echo offstart bin\\MyApp.exe status 链接发布Java程序为Windows服务 （含有Java环境）一发布Java程序为Windows服务 （不含有Java环境）二发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"winsw","slug":"winsw","permalink":"https://www.zhuqiaolun.com/tags/winsw/"}]},{"title":"Nginx一个server配置多个location","slug":"2020/10/1602671313615/1602671313615","date":"2020-10-14T10:28:33.000Z","updated":"2021-03-10T06:05:11.573Z","comments":false,"path":"2020/10/1602671313615/1602671313615/","link":"","permalink":"https://www.zhuqiaolun.com/2020/10/1602671313615/1602671313615/","excerpt":"Nginx一个server配置多个location（alias与root的区别）","text":"nginx作为代理服务器，可以配置多个location，通过访问不同路径来访问不同目录。 配置123456789101112131415161718192021222324252627server { listen 80; #端口号 server_name localhost; location /video { #alias末尾必须要用/结束 alias html/video/; index index.html index.htm; } location /music { #alias末尾必须要用/结束 alias html/music/; index index.html index.htm; } location / { #root末尾可以不用/结束 root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; }} 内容在music内放置文件 111.mp3在video内放置文件 222.mp4 访问http://localhost/http://localhost/music/111.mp3http://localhost/video/222.mp4 区别alias与root的区别：alias与root指定的url意义不同 root和alias都可以定义在location模块中，都是用来指定请求资源的真实路径，比如： location /music/ { root /data/file; } 请求 http://localhost/music/111.mp3 时，那么在服务器里面对应的真正的资源是：/opt/data/file/music/111.mp3，注意：root真实路径是root指定的值加上location指定的值。 而 alias 正如其名，alias指定的路径是location的别名，不管location的值怎么写，资源的真实路径都是 alias 指定的路径，比如： location /music/ { alias /data/file/; } 请求 http://localhost/music/111.mp3 时，那么在服务器里面对应的真正的资源是：/opt/data/file/111.mp3，注意：alias真实路径是alias指定的值，不包含location指定的值了。 扩展在一个location中，alias可以存在多个，但是root只能有一个，alias只能存在与location中，但是root可以用在server、http和location中，alias后面必须要“/”结束，否则会找不到文件，而root的“/”可有可无， document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.zhuqiaolun.com/tags/nginx/"}]},{"title":"Redis配置 之  设置密码","slug":"2020/09/1601271269577/1601271269577","date":"2020-09-28T05:34:29.000Z","updated":"2021-03-01T06:46:25.377Z","comments":false,"path":"2020/09/1601271269577/1601271269577/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1601271269577/1601271269577/","excerpt":"Redis配置 之 修改密码","text":"默认安装后的redis是没有密码的，这明显有很大的安全隐患，所以需要设置密码。这里提供2中方式 修改密码注：使用第二种，不知道怎么回滚为空密码 1.第一种方式（推荐）：修改配置文件“redis.windows-service.conf”，大约在 443 行：添加一下内容： requirepass 123456然后重启Redis服务，即可生效。如若去掉此行代码即属于设置密码为空。 2.第二种方式：使用命令方式进入链接后，输入 config set requirepass “你的密码”，本例为 123456，进行回车； 当显示为OK后，需要进行auth认证，当输入 auth后会出现 auth password，不用管password的出现，敲一下空格再输入密码(123456)回车即可； 更换密码输入命令：config set requirepass “” ；当密码为空时不用auth认证；且密码任意输入都可连接； 查看密码输入命令：config get requirepass document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"}]},{"title":"Window10安装 Redis - 绿色版","slug":"2020/09/1601194986992/1601194986992","date":"2020-09-27T08:23:06.000Z","updated":"2021-05-13T02:53:39.490Z","comments":false,"path":"2020/09/1601194986992/1601194986992/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1601194986992/1601194986992/","excerpt":"Window10安装 Redis","text":"下载Redis下载地址：https://github.com/microsoftarchive/redis/releases传送门：https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.zip 对文件进行一个说明：Redis-x64-3.2.100.msi ：图形化安装文件Redis-x64-3.2.100.zip ：压缩文件安装包，需要解压安装Redis-x64-3.2.100.zip ：.zip压缩格式源码Redis-x64-3.2.100.tar.gz ：.gz压缩格式源码 安装点击下载后，需要先进行解压，解压文件如下： 运行双击运行目录下的 redis-server.exe，会加载自身存在的 conf 文件配置，采取默认的配置运行；出现以下画面即成功： 配置修改为加载目录下的 redis.windows.conf 文件配置，由于我修改了配置文件端口为 6377，故执行：Win+R –&gt; 运行cmd –&gt; 进入Redis的根目录下： D:\\Redis-x64-3.2.100&gt;redis-server.exe redis.windows.conf bat启动创建快捷启动，在根目录下，新建txt文件，填写以下内容，保存后修改txt的文件后缀为bat，双击即可启动； @echo off redis-server.exe redis.windows.conf @pause服务启动创建服务启动，可保存跟随系统启动自运行；执行：Win+R –&gt; 运行cmd –&gt; 进入Redis的根目录下： redis-server.exe --service-install redis.windows.conf出现 #Redis successfully installed as a service.即完成；可在服务列表中查看名称为【Rides】的服务； 扩展常用的redis服务命令，需在进入Redis的根目录下执行；安装服务：redis-server.exe –service-install redis.windows.conf开启服务：redis-server –service-start停止服务：redis-server –service-stop卸载服务：redis-server –service-uninstall document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"}]},{"title":"Window10安装 Redis - 安装版","slug":"2020/09/1601194890597/1601194890597","date":"2020-09-27T08:21:30.000Z","updated":"2021-05-13T02:53:55.065Z","comments":false,"path":"2020/09/1601194890597/1601194890597/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1601194890597/1601194890597/","excerpt":"Window10安装 Redis","text":"Redis中文官方网站：http://www.redis.cn/ 下载Redis下载地址：https://github.com/microsoftarchive/redis/releases传送门：https://github.com/microsoftarchive/redis/releases/download/win-3.2.100/Redis-x64-3.2.100.msi 对文件进行一个说明：Redis-x64-3.2.100.msi ：图形化安装文件Redis-x64-3.2.100.zip ：压缩文件安装包，需要解压安装Redis-x64-3.2.100.zip ：.zip压缩格式源码Redis-x64-3.2.100.tar.gz ：.gz压缩格式源码 安装运行下载的msi文件，点击next; 1.勾选 I accept the terms in the License Agreement，点击next; 2.更换安装目录，以及添加到环境变量path,以便开机启动，命名执行 3.redis默认是 6379 端口，如果你不想用 6379 或者 6379 已经被其他程序占用，可以修改成其他端口。添加到windows防火墙的选项保持默认就好。 4.设置redis最大内存限制。默认100MB内存，但是可能是不够用的，所以改大一点，我这里修改成了1024MB。可以根据自己的实际情况来更改设置。 5.点击install即可 至此安装结束。 验证打开任务管理器，点击服务，查看服务列表中是否有一个名字叫做Redis的服务正在运行，如果有，说明安装并启动成功， 进入安装目录下，执行 redis-cli命令： 如果没有或者未成功启动，请删除服务之后对照如上步骤重新安装。删除redis服务命令为 sc delete 服务名 ，需要注意删除服务需要使用管理员身份打开命令行窗口执行命令。 sc delete Redis扩展使用的时候提示连不上，可以关闭保护模式：在redis安装目录找到“redis.windows-service.conf”：查找protected-mode yes 改为 protected-mode no document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"}]},{"title":"Jackson 的 使用","slug":"2020/09/1601024145664/1601024145664","date":"2020-09-25T08:55:45.000Z","updated":"2022-08-24T09:56:44.802Z","comments":false,"path":"2020/09/1601024145664/1601024145664/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1601024145664/1601024145664/","excerpt":"Jackson 是当前用的比较广泛的，用来序列化和反序列化 json 的 Java 的开源框架","text":"依赖123456&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.11.0&lt;/version&gt;&lt;/dependency&gt; jackson-databind 依赖 jackson-core 和 jackson-annotations，当添加 jackson-databind 之后， jackson-core 和 jackson-annotations 也随之添加到 Java 项目工程中。在添加相关依赖包之后，就可以使用 Jackson。 配置信息//在反序列化时忽略在 json 中存在但 Java 对象不存在的属性 mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false); //在序列化时日期格式默认为 yyyy-MM-dd'T'HH:mm:ss.SSSZ mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS,false) //在序列化时忽略值为 null 的属性 mapper.setSerializationInclusion(Include.NON_NULL); //忽略值为默认值的属性 mapper.setDefaultPropertyInclusion(Include.NON_DEFAULT);更多配置信息可以查看 Jackson 的 DeserializationFeature，SerializationFeature 和 Include。 注解Jackson 根据它的默认方式序列化和反序列化 java 对象，若根据实际需要，灵活的调整它的默认方式，可以使用 Jackson 的注解。常用的注解及用法如下： @JsonProperty：用于属性，把属性的名称序列化时转换为另外一个名称。 @JsonProperty(\"birth_date\") private Date birthDate;@JsonFormat：用于属性或者方法，把属性的格式序列化时转换成指定的格式。 @JsonFormat(timezone = \"GMT+8\", pattern = \"yyyy-MM-dd HH:mm:ss\") public Date birthDate;@JsonPropertyOrder：用于类，指定属性在序列化时 json 中的顺序。 @JsonPropertyOrder({ \"birth_date\", \"name\" }) public class Person{}说明Jackson 最常用的 API 就是基于”对象绑定” 的 ObjectMapper。writeValue：将 java 对 象序列化 为 json，并 将 json 存 储成不同的格式，String（writeValueAsString），Byte Array（writeValueAsString），Writer， File，OutStream 和 DataOutput。readValue：将不同的数据源像 String ， Byte Array， Reader，File，URL， InputStream 将 json 反序列化为 java 对象。 封装12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import com.fasterxml.jackson.annotation.JsonInclude;import com.fasterxml.jackson.core.JsonGenerator;import com.fasterxml.jackson.core.JsonParser;import com.fasterxml.jackson.databind.*;import java.io.IOException;/** * author ：demon * date ：2021 2021/11/2 11:18 * desc ： */public class ObjectMapperUtil { private static ObjectMapperUtil objectMapperUtil; private ObjectMapper objectMapper; private ObjectMapperUtil() { System.out.println(\"初始化-ObjectMapper-\"); objectMapper = new ObjectMapper(); // json不进行换行缩进等操作 默认就是不进行操作，写了这行和没写的效果一样 objectMapper.disable(SerializationFeature.INDENT_OUTPUT); // 属性为Null的不进行序列化，只对pojo起作用，对map和list不起作用 objectMapper.setSerializationInclusion(JsonInclude.Include.ALWAYS); // json是否允许属性名没有引号 ，默认是false objectMapper.configure(JsonParser.Feature.ALLOW_UNQUOTED_FIELD_NAMES, true); // json是否允许属性名为单引号 ，默认是false objectMapper.configure(JsonParser.Feature.ALLOW_SINGLE_QUOTES, true); // 反序列化的时候如果多了其他属性,不抛出异常 objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false); // 如果是空对象的时候,不抛异常 objectMapper.configure(SerializationFeature.FAIL_ON_EMPTY_BEANS, false); //属性为null的转换 objectMapper.getSerializerProvider().setNullValueSerializer(new JsonSerializer&lt;Object&gt;() { @Override public void serialize(Object arg0, JsonGenerator arg1, SerializerProvider arg2) throws IOException { arg1.writeString(\"\"); } }); // 取消时间的转化格式,默认是时间戳,可以取消,同时需要设置要表现的时间格式 // objectMapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false); // objectMapper.setDateFormat(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\")); } public static ObjectMapperUtil getInstance() { if (objectMapperUtil == null) { objectMapperUtil = ObjectMapperUtilLoader.instance; } return objectMapperUtil; } public ObjectMapper getObjectMapper() { return objectMapper; } private static class ObjectMapperUtilLoader { private static final ObjectMapperUtil instance = new ObjectMapperUtil(); }} 使用实体对象转化字符串12345try { String jsonString = ObjectMapperUtil.getInstance().getObjectMapper().writerWithDefaultPrettyPrinter().writeValueAsString(new 实体对象());} catch (JsonProcessingException e) { e.printStackTrace();} 字符串转化键值对象12345try { Map&lt;String, Object&gt; jsonMap = ObjectMapperUtil.getInstance().getObjectMapper().readValue(jsonString, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});} catch (JsonProcessingException e) { e.printStackTrace();} 创建对象123456789101112ObjectMapper objectMapper = ObjectMapperUtil.getInstance().getObjectMapper();ObjectNode objectNode = objectMapper.createObjectNode();objectNode.put(\"name\", \"张三\");objectNode.put(\"age\", 30);ArrayNode arrayNode = objectMapper.createArrayNode();arrayNode.add(\"Java\");arrayNode.add(\"Python\");objectNode.set(\"job\", arrayNode);System.out.println(objectNode.toString()); // {\"name\":\"张三\",\"age\":30,\"job\":[\"Java\",\"Python\"]} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Jackson","slug":"Jackson","permalink":"https://www.zhuqiaolun.com/tags/Jackson/"}]},{"title":"Maven项目的Pom配置","slug":"2020/09/1600933059831/1600933059831","date":"2020-09-24T07:37:39.000Z","updated":"2022-03-01T10:28:17.535Z","comments":false,"path":"2020/09/1600933059831/1600933059831/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1600933059831/1600933059831/","excerpt":"Maven项目的Pom配置","text":"属性配置1234567&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;!-- 过滤测试 --&gt; &lt;skipTests&gt;true&lt;/skipTests&gt;&lt;/properties&gt; 依赖引入12345678&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.13.1&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; 打包配置123456&lt;build&gt; &lt;finalName&gt;项目名称&lt;/finalName&gt; &lt;plugins&gt; &lt;!-- 插件 --&gt; &lt;/plugins&gt;&lt;/build&gt; 插件 代理仓库配置开启项目本身的代理仓库配置 123456789101112131415161718192021222324252627&lt;project&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spring&lt;/id&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;spring&lt;/id&gt; &lt;url&gt;https://maven.aliyun.com/repository/spring&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; &lt;/project&gt; 但有时，跟着上面的设置方法并不奏效，仍然还是从之前的镜像站中去下载。此时，我们需要去检查下 Maven 安装目录下的settings.xml： 123456&lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;&lt;/mirror&gt; 可以看到，在设置镜像时，mirrorOf设置为了“*”，意味所有的依赖都是从这个镜像上下载。完全不给Spring Snapshots机会了。 解决方法也简单，改为下面的方式： 123456&lt;mirror&gt; &lt;id&gt;nexus-aliyun&lt;/id&gt; &lt;mirrorOf&gt;*,!spring-snapshots&lt;/mirrorOf&gt; &lt;name&gt;Nexus aliyun&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;&lt;/mirror&gt; mirrorOf设置为了“*,!spring-snapshots”，表示除了Spring Snapshots外，所有的依赖都将从这个镜像上下载。 mirrorOf的配置支持如下场景： 1234*：所有依赖；external:*：所有不再本地和不是基于文件的依赖；repo,repo1：所有来自repo或者repo1仓库的依赖；*,!repo1：除了repo1外的所有依赖。即上面示例中的场景。 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"}],"tags":[{"name":"pom","slug":"pom","permalink":"https://www.zhuqiaolun.com/tags/pom/"}]},{"title":"Maven项目的结构定义","slug":"2020/09/1600931110662/1600931110662","date":"2020-09-24T07:05:10.000Z","updated":"2022-03-01T10:09:31.525Z","comments":false,"path":"2020/09/1600931110662/1600931110662/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1600931110662/1600931110662/","excerpt":"Maven的项目结构","text":"描述pom文件定于了一个maven项目的maven配置，一般pom文件的放在项目或者模块的根目录下。 maven的遵循约定大于配置，约定了如下的目录结构： ${basedir}：存放pom.xml和所有的子目录 ${basedir}/src/main/java：项目的java源代码 ${basedir}/src/main/resources：项目的资源文件，比如说properties文件、xml文件、application.yml等 ${basedir}/src/test/java：项目的测试类，比如说Junit代码 ${basedir}/src/test/resources：测试用的资源 ${basedir}/src/main/webapp/WEB-INF：web应用文件目录，web项目的信息，比如存放web.xml、本地图片、jsp视图页面，在springboot中无此目录 ${basedir}/target：打包输出目录，在IDEA中需要设置 ${basedir}/target/classes：编译输出目录 ${basedir}/target/test-classes：测试编译输出目录以下的内容属于根元素和必要配置 &lt;!-- 模型版本 --&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!-- 公司或者组织的唯一标志，也是打包成jar包路径的依据 --&gt; &lt;!-- 例如com.demon.project，maven打包jar包的路径：/com/demon/project --&gt; &lt;groupId&gt;com.demon.project&lt;/groupId&gt; &lt;!-- 项目的唯一ID，一个groupId下面可能多个项目，就是靠artifactId来区分的 --&gt; &lt;artifactId&gt;demo&lt;/artifactId&gt; &lt;!-- 项目当前版本，格式为:主版本.次版本.增量版本-限定版本号 --&gt; &lt;version&gt;1.0.0&lt;/version&gt; &lt;!--项目产生的构件类型，包括jar、war、pom等 --&gt; &lt;packaging&gt;jar&lt;/packaging&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"}],"tags":[{"name":"pom","slug":"pom","permalink":"https://www.zhuqiaolun.com/tags/pom/"}]},{"title":"在Windows下安装Maven环境","slug":"2020/09/1600927625377/1600927625377","date":"2020-09-24T06:07:05.000Z","updated":"2021-05-13T02:54:07.912Z","comments":false,"path":"2020/09/1600927625377/1600927625377/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1600927625377/1600927625377/","excerpt":"在Windows下安装Maven环境","text":"下载Mavenmaven 官网下载地址：https://maven.apache.org/download.cgimaven 文件下载地址：https://archive.apache.org/dist/maven/maven-3/下载 Binary 版本，点击箭头所指的链接进行下载传送门：https://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.zip 解压文件 配置Maven环境变量打开环境变量界面： 新建系统变量：MAVEN_HOME，值为maven的根目录 修改系统变量：path,点击新建添加 %MAVEN_HOME%\\bin 验证Maven环境变量然后win+R 运行cmd 输入 mvn -version，如图所示则配置成功 修改本地仓库地址在maven根目录下打开conf目录可以找到settings文件，找到第53行，这里是maven默认的仓库，默认的仓库地址为当前用户的 .m文件夹下的repository目录内，在settings文件中有一个 localRepository 标签复制第53行，将它拿到注释外并将中间的内容改成你需要的路径，如图 &lt;localRepository&gt;D:\\apache\\Repositories\\Maven&lt;/localRepository&gt;表示本地仓库地址为D盘的xxxx目录下 配置Maven镜像在maven根目录下打开conf目录可以找到settings文件，找到第147行，Maven自身默认镜像 &lt;mirror&gt; &lt;id&gt;mirrorId&lt;/id&gt; &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt; &lt;/mirror&gt;由于默认镜像属于国外，下载jar很慢；所以需要配置国内的镜像 阿里云仓库（推荐）： &lt;mirror&gt; &lt;id&gt;aliyunmaven&lt;/id&gt; &lt;mirrorOf&gt;*&lt;/mirrorOf&gt; &lt;name&gt;阿里云公共仓库&lt;/name&gt; &lt;url&gt;https://maven.aliyun.com/repository/public&lt;/url&gt; &lt;/mirror&gt;spring.io仓库: &lt;mirror&gt; &lt;id&gt;sprintio&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;https://repo.spring.io/libs-snapshot/&lt;/url&gt; &lt;/mirror&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"}],"tags":[{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/tags/Maven/"}]},{"title":"Nginx 根据 不同Tomcat项目 配置访问路径","slug":"2020/09/1600763525872/1600763525872","date":"2020-09-22T08:32:05.000Z","updated":"2022-07-14T09:15:27.360Z","comments":false,"path":"2020/09/1600763525872/1600763525872/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1600763525872/1600763525872/","excerpt":"Nginx 根据 不同项目 配置访问路径","text":"说明在Nginx 中 配置 upstream 代理服务器，由于 $scheme = http （return 301 ）会导致http的请求链接跳转https请求，故在http中不用配置。 在配置路径中使用根据URL请求不通的访问，需要保持顺序问题 第一访问tomcat里面的项目名《a》 location ~* .*tomcat-a.* { proxy_pass http://tomcat; proxy_set_header Host $http_host; }第二访问tomcat里面的项目名《b》 location ~* .*tomcat-b.* { proxy_pass http://tomcat; proxy_set_header Host $http_host; }第三访问nginx里面html文件夹的内容 location / { root html; index index.html index.htm; }在https中进行代理访问需要添加 proxy_set_header Host $http_host; 配置user root; worker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # 开启gzip压缩 gzip on; gzip_comp_level 5; gzip_min_length 1024; gzip_types text/plain application/x-javascript text/css application/xml text/javascript image/jpeg image/gif image/png; # 隐藏nginx版本信息 server_tokens off; upstream tomcat{ server www.zhuqiaolun.com:8080; } server { listen 80; server_name www.zhuqiaolun.com; if ($scheme = http ) { return 301 https://www.zhuqiaolun.com$request_uri; } #charset koi8-r; #access_log logs/host.access.log main; location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } # HTTPS server # server { listen 443 ssl; server_name www.zhuqiaolun.com; #网站主页路径。此路径仅供参考，具体请您按照实际目录操作。 root html; index index.html index.htm; ssl_certificate 1_www.zhuqiaolun.com_bundle.crt; ssl_certificate_key 2_www.zhuqiaolun.com.key; ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_prefer_server_ciphers on; location ~* .*tomcat-a.* { proxy_pass http://tomcat; expires 24h; add_header Cache-Control no-store; #Proxy Settings proxy_redirect off; proxy_set_header Host $http_host; proxy_set_header Cookie $http_cookie; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; proxy_max_temp_file_size 0; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; # 上传文件限制大小 client_max_body_size 100M; client_body_buffer_size 128k; } location ~* .*tomcat-b.* { proxy_pass http://tomcat; expires 24h; add_header Cache-Control no-store; #Proxy Settings proxy_redirect off; proxy_set_header Host $http_host; proxy_set_header Cookie $http_cookie; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; proxy_max_temp_file_size 0; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; # 上传文件限制大小 client_max_body_size 100M; client_body_buffer_size 128k; } location / { root html; index index.html index.htm; expires 24h; add_header Cache-Control no-store; #Proxy Settings proxy_redirect off; proxy_set_header Host $http_host; proxy_set_header Cookie $http_cookie; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504; proxy_max_temp_file_size 0; proxy_connect_timeout 90; proxy_send_timeout 90; proxy_read_timeout 90; proxy_buffer_size 4k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; # 上传文件限制大小 client_max_body_size 100M; client_body_buffer_size 128k; } } } document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.zhuqiaolun.com/tags/nginx/"}]},{"title":"tomcat配置https访问","slug":"2020/09/1599632929241/1599632929241","date":"2020-09-09T06:28:49.000Z","updated":"2021-03-10T06:06:38.150Z","comments":false,"path":"2020/09/1599632929241/1599632929241/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599632929241/1599632929241/","excerpt":"tomcat配置https访问","text":"生成安全证书因为SUN公司提供了制作证书的工具keytool。在JDK 1.4以后的版本中都包含了这一工具，它的位置为\\bin\\keytool.exe。 创建证书的命令keytool -genkeypair -alias \"tomcat\" -keyalg \"RSA\" -keystore \"e:\\tomcat.keystore\" 这里密码我输的是123456，名字与姓氏为域名，其它的根据具体情况输入以上命令将生产一对非对称密钥和自我签名的证书 e:\\tomcat.keystore.将证书保存到\\conf 的目录下，注意：“名字与姓氏”应该是域名，输成了姓名，和真正运行的时候域名不符，会出问题 配置tomcat找到conf下的server.xml文件，添加以下内容， &lt;Connector port=\"8451\" protocol=\"HTTP/1.1\" SSLEnabled=\"true\" maxThreads=\"150\" scheme=\"https\" secure=\"true\" clientAuth=\"false\" sslProtocol=\"TLS\" keystoreFile=\"conf/tomcat.keystore\" keystorePass=\"123456\" /&gt; 端口port可自定义，keystorePass为密匙库密码 启动tomcat如换成apr模式 将protocol=”HTTP/1.1”替换为protocol=”org.apache.coyote.http11.Http11Protocol”即可 访问结果http访问 - 8080 ：http://localhost:8088/ https访问 - 8451 ：https://localhost:8451/ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"tomcat开启APR运行模式，优化并发性能 - Windows","slug":"2020/09/1599628352134/1599628352134","date":"2020-09-09T05:12:32.000Z","updated":"2023-07-25T08:23:07.825Z","comments":false,"path":"2020/09/1599628352134/1599628352134/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599628352134/1599628352134/","excerpt":"Windows环境中的tomcat开启APR运行模式","text":"Tomcat的APR运行2种模式，结合下载的版本进行配置，以 Tomcat 9 为例，建立选择第二种版本 第一个版本下载tcnative-1.dll文件官网地址：https://tomcat.apache.org/download-native.cgi软件下载地址：点击下载 文件解压后，将 x64/tcnative-1.dll 文件复制到C:\\Windows\\System32目录下 配置找到下面代码 &lt;Connector connectionTimeout=\"20000\" port=\"8086\" protocol=\"HTTP/1.1\" redirectPort=\"8443\"/&gt;修改为 &lt;Connector connectionTimeout=\"20000\" port=\"8086\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" redirectPort=\"8443\"/&gt;结果 第二个版本下载的此版本，无需复制tcnative-1.dll文件到C:\\Windows\\System32目录下，仅需配置即可；找到代码 protocol=”HTTP/1.1” -&gt; protocol=”org.apache.coyote.http11.Http11AprProtocol” document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"tomcat开启APR运行模式，优化并发性能 - Linux","slug":"2020/09/1599545396773/1599545396773","date":"2020-09-08T06:09:56.000Z","updated":"2021-03-10T06:07:26.422Z","comments":false,"path":"2020/09/1599545396773/1599545396773/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599545396773/1599545396773/","excerpt":"Linux环境中的tomcat开启APR运行模式","text":"描述Tomcat支持三种接收请求的处理方式：BIO、NIO、APR BIO模式：阻塞式I/O操作，表示Tomcat使用的是传统Java I/O操作(即java.io包及其子包)。Tomcat7以下版本默认情况下是以bio模式运行的，由于每个请求都要创建一个线程来处理，线程开销较大，不能处理高并发的场景，在三种模式中性能也最低。 NIO模式：是Java SE 1.4及后续版本提供的一种新的I/O操作方式(即java.nio包及其子包)。是一个基于缓冲区、并能提供非阻塞I/O操作的Java API，它拥有比传统I/O操作(bio)更好的并发运行性能。Tomcat8以上版本，默认使用的就是NIO模式，不需要额外修改。 APR模式：简单理解，就是从操作系统级别解决异步IO问题，大幅度的提高服务器的处理和响应性能， 也是Tomcat运行高并发应用的首选模式。 安装依赖yum install -y apr-devel openssl-devel gcc make expat-devel libtool下载软件所需软件的下载地址：https://mirrors.cnnic.cn/apache/apr/https://tomcat.apache.org/download-native.cgi 点击下载：https://mirrors.cnnic.cn/apache/apr/apr-1.7.0.tar.gzhttps://mirrors.cnnic.cn/apache/apr/apr-iconv-1.2.2.tar.gzhttps://mirrors.cnnic.cn/apache/apr/apr-util-1.6.1.tar.gzhttps://mirrors.bfsu.edu.cn/apache/tomcat/tomcat-connectors/native/1.2.25/source/tomcat-native-1.2.25-src.tar.gz 安装软件 apr cd /usr/local/tomcat/src/apr-1.7.0 ./configure --prefix=/usr/local/tomcat/src/apr make &amp;&amp; make installapr-iconv cd /usr/local/tomcat/src/apr-iconv-1.2.2 ./configure --with-apr=/usr/local/tomcat/src/apr --prefix=/usr/local/tomcat/src/apr-iconv make &amp;&amp; make installapr-util cd apr-util-1.6.1/ ./configure --with-apr=/usr/local/tomcat/src/apr --with-apr-iconv=/usr/local/tomcat/src/apr-iconv/bin/apriconv --prefix=/usr/local/tomcat/src/apr-util make &amp;&amp; make installtomcat-native cd /usr/local/tomcat/src/tomcat-native-1.2.25-src/native ./configure --with-apr=/usr/local/tomcat/src/apr --with-java-home=/usr/local/java/jdk1.8.0_231 make &amp;&amp; make installprofile echo -e 'export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/tomcat/src/apr/lib\\nexport LD_RUN_PATH=$LD_RUN_PATH:/usr/local/tomcat/src/apr/lib' &gt;&gt; /etc/profile source /etc/profile配置APR打开 server.xml vim /usr/local/tomcat/apache-tomcat-9.0.27/conf/server.xml修改内容如下： &lt;Executor name=\"tomcatThreadPool\" namePrefix=\"catalina-exec-\" maxThreads=\"300\" minSpareThreads=\"30\"/&gt; ​ &lt;Connector executor=\"tomcatThreadPool\" port=\"8080\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" connectionTimeout=\"20000\" redirectPort=\"8443\" acceptCount=\"900\" disableUploadTimeout=\"true\" URIEncoding=\"UTF-8\" enableLookups=\"false\" compression=\"on\" compressionMinSize=\"1024\" /&gt; ​ &lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt; ##注释掉下面那行，如果不用apache &lt;!-- &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt; --&gt;结果：注：如果非root用户启动失败，把apr环境变量在当前用户的.bash_profile中写一份 配置说明Executor参数说明 name：共享线程池的名字。这是Connector为了共享线程池要引用的名字，该名字必须唯一。默认值：None； namePrefix:在JVM上，每个运行线程都可以有一个name 字符串。这一属性为线程池中每个线程的name字符串设置了一个前缀， Tomcat将把线程号追加到这一前缀的后面。默认值：catalina-exec-； maxThreads：该线程池可以容纳的最大线程数。默认值：150； maxIdleTime：在Tomcat关闭一个空闲线程之前，允许空闲线程持续的时间(以毫秒为单位)。 只有当前活跃的线程数大于minSpareThread的值，才会关闭空闲线程。默认值：60000(一分钟)。 minSpareThreads：Tomcat应该始终打开的最小不活跃线程数。默认值：4。 threadPriority：线程的等级。默认是Thread.NORM_PRIORITYConnector参数说明 maxThreads :Tomcat 使用线程来处理接收的每个请求，这个值表示 Tomcat 可创建的最大的线程数，默认值是 200 minSpareThreads：最小空闲线程数，Tomcat 启动时的初始化的线程数，表示即使没有人使用也开这么多空线程等待，默认值是 10。 maxSpareThreads：最大备用线程数，一旦创建的线程超过这个值，Tomcat 就会关闭不再需要的 socket 线程。 ​ 上边配置的参数，最大线程 500（一般服务器足以），要根据自己的实际情况合理设置，设置越大会耗费内存和 CPU， 因为 CPU 疲于线程上下文切换，没有精力提供请求服务了，最小空闲线程数 20，线程最大空闲时间 60 秒， 当然允许的最大线程连接数还受制于操作系统的内核参数设置，设置多大要根据自己的需求与环境。 当然线程可以配置在“tomcatThreadPool”中，也可以直接配置在“Connector”中，但不可以重复配置。 ​ URIEncoding：指定 Tomcat 容器的 URL 编码格式，语言编码格式这块倒不如其它 WEB 服务器软件配置方便，需要分别指定。 connnectionTimeout： 网络连接超时，单位：毫秒，设置为 0 表示永不超时，这样设置有隐患的。通常可设置为 30000 毫秒，可根据检测实际情况，适当修改。 enableLookups： 是否反查域名，以返回远程主机的主机名，取值为：true 或 false，如果设置为false，则直接返回IP地址，为了提高处理能力，应设置为 false。 disableUploadTimeout：上传时是否使用超时机制。 connectionUploadTimeout：上传超时时间，毕竟文件上传可能需要消耗更多的时间，这个根据你自己的业务需要自己调， 以使Servlet有较长的时间来完成它的执行，需要与上一个参数一起配合使用才会生效。 acceptCount：指定当所有可以使用的处理请求的线程数都被使用时，可传入连接请求的最大队列长度，超过这个数的请求将不予处理，默认为100个。 keepAliveTimeout：长连接最大保持时间（毫秒），表示在下次请求过来之前，Tomcat 保持该连接多久，默认是使用 connectionTimeout 时间，-1 为不限制超时。 maxKeepAliveRequests：表示在服务器关闭之前，该连接最大支持的请求数。 超过该请求数的连接也将被关闭，1表示禁用，-1表示不限制个数，默认100个，一般设置在100~200之间。 compression：是否对响应的数据进行 GZIP 压缩，off：表示禁止压缩；on：表示允许压缩（文本将被压缩）、force：表示所有情况下都进行压缩，默认值为off， 压缩数据后可以有效的减少页面的大小，一般可以减小1/3左右，节省带宽。 compressionMinSize：表示压缩响应的最小值，只有当响应报文大小大于这个值的时候才会对报文进行压缩，如果开启了压缩功能，默认值就是2048。 compressableMimeType：压缩类型，指定对哪些类型的文件进行数据压缩。 noCompressionUserAgents=\"gozilla, traviata\"： 对于以下的浏览器，不启用压缩。 如果已经对代码进行了动静分离，静态页面和图片等数据就不需要 Tomcat 处理了，那么也就不需要配置在 Tomcat 中配置压缩了。 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"配置tomcat下的conf目录下的文件","slug":"2020/09/1599535661189/1599535661189","date":"2020-09-08T03:27:41.000Z","updated":"2021-03-10T06:07:42.766Z","comments":false,"path":"2020/09/1599535661189/1599535661189/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599535661189/1599535661189/","excerpt":"配置tomcat的文件","text":"启用manager1.打开conf目录下的文件 tomcat-users.xml，在尾部添加一下内容: &lt;role rolename=\"tomcat\"/&gt; &lt;role rolename=\"role1\"/&gt; &lt;role rolename=\"manager-script\"/&gt; &lt;role rolename=\"manager-gui\"/&gt; &lt;role rolename=\"manager-status\"/&gt; &lt;role rolename=\"admin-gui\"/&gt; &lt;role rolename=\"admin-script\"/&gt; &lt;user username=\"tomcat\" password=\"tomcat\" roles=\"manager-gui,manager-script,tomcat,admin-gui,admin-script\"/&gt;2.修改webapps文件夹manager和host-mananger两个项目下META-INF中的context.xml文件： vim /usr/local/tomcat/apache-tomcat-9.0.27/webapps/host-manager/META-INF vim /usr/local/tomcat/apache-tomcat-9.0.27/webapps/manager/META-INF/context.xml修改为（或者注释掉）： &lt;Valve className=\"org.apache.catalina.valves.RemoteAddrValve\" allow=\"^.*$\" /&gt;无须重启tomcat即可生效 配置日志打印打开conf目录下的文件 logging.properties；修改以下内容 1catalina.org.apache.juli.AsyncFileHandler.level = FINE 1catalina.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs 1catalina.org.apache.juli.AsyncFileHandler.prefix = catalina. 1catalina.org.apache.juli.AsyncFileHandler.maxDays = 7 1catalina.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter 2localhost.org.apache.juli.AsyncFileHandler.level = FINE 2localhost.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs 2localhost.org.apache.juli.AsyncFileHandler.prefix = localhost. 2localhost.org.apache.juli.AsyncFileHandler.maxDays = 7 2localhost.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter 3manager.org.apache.juli.AsyncFileHandler.level = FINE 3manager.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs 3manager.org.apache.juli.AsyncFileHandler.prefix = manager. 3manager.org.apache.juli.AsyncFileHandler.maxDays = 7 3manager.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter 4host-manager.org.apache.juli.AsyncFileHandler.level = FINE 4host-manager.org.apache.juli.AsyncFileHandler.directory = ${catalina.base}/logs 4host-manager.org.apache.juli.AsyncFileHandler.prefix = host-manager. 4host-manager.org.apache.juli.AsyncFileHandler.maxDays = 7 4host-manager.org.apache.juli.AsyncFileHandler.formatter = java.util.logging.SimpleFormatter java.util.logging.ConsoleHandler.level = FINE java.util.logging.ConsoleHandler.formatter = org.apache.juli.OneLineFormatter java.util.logging.SimpleFormatter.format = %1$tY-%1$tm-%1$td %1$tH:%1$tM:%1$tS.%1$tL [%4$s] [%3$s] %2$s %5$s %6$s%n配置日志存储&lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Valve className=\"org.apache.catalina.authenticator.SingleSignOn\" /&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs/localhost_access_log\" prefix=\"localhost_access_log\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;/Host&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"在Linux中安装Tomcat环境","slug":"2020/09/1599532777229/1599532777229","date":"2020-09-08T02:39:37.000Z","updated":"2023-07-25T07:04:46.667Z","comments":false,"path":"2020/09/1599532777229/1599532777229/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599532777229/1599532777229/","excerpt":"在Linux中安装Tomcat环境","text":"下载tomcat 官网地址：http://tomcat.apache.org/tomcat 官网版本文件地址：https://archive.apache.org/dist/tomcat/tomcat 指定版本下载地址：https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/Linux在线下载： wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.27/bin/apache-tomcat-9.0.27.tar.gz 下载离线版本：点击红框区域,即可下载文件（免安装版本） 安装创建安装目录，并进入安装目录 mkdir /usr/local/tomcat cd /usr/local/tomcat/ rz apache-tomcat-9.0.27.tar.gz # 上传文件（如采用在线下载，则无需此步骤） tar -zxvf apache-tomcat-9.0.27.tar.gz # 解压文件 cd /usr/local/tomcat/apache-tomcat-9.0.27 # 进入目录命令启动： /usr/local/tomcat/apache-tomcat-9.0.27/bin/startup.sh停止： /usr/local/tomcat/apache-tomcat-9.0.27/bin/shutdown.sh实时日志 cd /usr/local/tomcat/apache-tomcat-9.0.27/logs tail -f catalina.out访问curl -I http://127.0.0.1:8080返回以下内容则表示启动成功 HTTP/1.1 200 Content-Type: text/html;charset=UTF-8 Transfer-Encoding: chunked Date: Tue, 08 Sep 2020 03:22:06 GMT上传项目cd /usr/local/tomcat/apache-tomcat-9.0.27/webapps document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"}],"tags":[{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"}]},{"title":"Nginx 服务器证书SSL安装","slug":"2020/09/1599456487885/1599456487885","date":"2020-09-07T05:28:07.000Z","updated":"2022-07-14T09:37:44.517Z","comments":false,"path":"2020/09/1599456487885/1599456487885/","link":"","permalink":"https://www.zhuqiaolun.com/2020/09/1599456487885/1599456487885/","excerpt":"Nginx 服务器证书SSL安装,配置Https访问","text":"检测初始安装nginx的时候没有开启ssl功能 查看是否开启ssl模块 /usr/local/nginx/sbin/nginx -V当未出现红框内的内部分，则表示没有开启ssl功能 开启ssl模块找到安装的源码包(带有版本号的位置) cd /usr/local/software/nginx-1.18.0 ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module make # 这里不要进行make install，否则就是覆盖安装 cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak # 备份 /usr/local/nginx/sbin/nginx -s stop # 停止服务 cp ./objs/nginx /usr/local/nginx/sbin/ # 将刚刚编译好的nginx覆盖掉原有的nginx当在此查看 /usr/local/nginx/sbin/nginx -V ，则表示开启成功 下载SSL证书将已获取到的 1.证书文件和 2.私钥文件从本地目录拷贝到 Nginx 服务器的 /usr/local/nginx/conf 目录下此处为 Nginx 默认安装目录，请根据实际情况操作 配置Https以下为本机配置为例 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475user root;worker_processes 1;error_log /usr/local/nginx/logs/nginx_error.log crit; events { worker_connections 1024;}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # 开启gzip压缩 gzip on; gzip_comp_level 5; gzip_min_length 1024; gzip_types text/plain application/x-javascript text/css application/xml text/javascript image/jpeg image/gif image/png; # 隐藏nginx版本信息 server_tokens off; server { listen 80; server_name www.zhuqiaolun.com; if ($scheme = http ) { return 301 https://www.zhuqiaolun.com$request_uri; } location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } # HTTPS server server { listen 443 ssl; server_name www.zhuqiaolun.com; root html; index index.html index.htm; ssl_certificate www.zhuqiaolun.com.crt; ssl_certificate_key www.zhuqiaolun.com.key; ssl_session_timeout 10m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_session_cache shared:SSL:10m; ssl_prefer_server_ciphers on; location / { root html/blog/; index index.html index.htm; #try_files $uri $uri/ /index.html; } location /file { alias html/file/; #目录文件服务器根目录 if ($request_filename ~* ^.*?\\.(html|doc|pdf|zip|docx|txt|mp4|rar)$) { add_header Content-Disposition attachment; add_header Content-Type application/octet-stream; } sendfile on; # 开启高效文件传输模式 autoindex on; # 开启目录文件列表 autoindex_exact_size on; # 显示出文件的确切大小，单位是bytes autoindex_localtime on; # 显示的文件时间为文件的服务器时间 } } } 扩展Nginx SSL性能调优 ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM; ssl_prefer_server_ciphers on; ssl_session_cache shared:SSL:10m; ssl_session_timeout 10m; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://www.zhuqiaolun.com/tags/nginx/"}]},{"title":"SpringBoot2.3.x整合Freemarker","slug":"2020/08/1597309130215/1597309130215","date":"2020-08-13T08:58:50.000Z","updated":"2025-06-05T09:52:35.631Z","comments":false,"path":"2020/08/1597309130215/1597309130215/","link":"","permalink":"https://www.zhuqiaolun.com/2020/08/1597309130215/1597309130215/","excerpt":"SpringBoot2.3.x整合Freemarker","text":"FreemarkerFreeMarker Template Language（FTL） 文件一般保存为 xxx.ftl严格依赖MVC模式，不依赖Servlet容器（不占用JVM内存）内建函数 依赖12345678910111213141516&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.2.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;&lt;/dependency&gt; &lt;!-- 将freemarker的html内容写入生成的文件中 --&gt;&lt;dependency&gt; &lt;groupId&gt;commons-io&lt;/groupId&gt; &lt;artifactId&gt;commons-io&lt;/artifactId&gt; &lt;version&gt;2.6&lt;/version&gt; &lt;/dependency&gt; 配置yml内容： 123456789101112131415161718192021spring: application: name: spring-boot-freemarker jackson: default-property-inclusion: non_null # 配置模版引擎 freemarker: cache: false #是否启用模板缓存 enabled: true #是否启用freemarker template-loader-path: classpath:/templates/ #设定模板的加载路径，多个以逗号分隔 suffix: .ftl #设定模板的后缀 content-type: text/html check-template-location: true #是否检查模板位置是否存在 charset: UTF-8 #模板编码 #一些常用配置 allow-request-override: false #是否允许HttpServletRequest属性覆盖(隐藏)控制器生成的同名模型属性 allow-session-override: false #是否允许HttpSession属性覆盖(隐藏)控制器生成的同名模型属性 expose-request-attributes: false #设定所有request的属性在merge到模板的时候，是否要都添加到model中 expose-session-attributes: false #是否在merge模板的时候，将HttpSession属性都添加到model中 expose-spring-macro-helpers: true #设定是否以springMacroRequestContext的形式暴露RequestContext给Spring’s macro library使用 prefer-file-system-access: true #是否优先从文件系统加载template，以支持热加载，默认为true 数据应用 ☞传送门 页面使用文件路径： 1234src/main/java/com/demon/freemarker/controller IndexController.javasrc/main/resources/templates index1.ftl 示例代码IndexController.java @Controller public class IndexController { /** * 路由 /index1 * 返回 index1 这里默认配置自动映射到目录(templages/)下的index1.ftl */ @GetMapping(\"/index1\") public String index(Model model){ model.addAttribute(\"content\",\"hello freemarker\"); return \"index1\"; } }index.ftl &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;freemarker&lt;/title&gt; &lt;/head&gt; &lt;body&gt; this is welcome ${content} &lt;/body&gt; &lt;/html&gt;运行示例 更多 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"freemarker","slug":"freemarker","permalink":"https://www.zhuqiaolun.com/tags/freemarker/"}]},{"title":"SpringBoot2.3.x 整合 Thymeleaf","slug":"2020/08/1597306338000/1597306338000","date":"2020-08-13T08:12:17.000Z","updated":"2021-07-02T03:24:58.412Z","comments":false,"path":"2020/08/1597306338000/1597306338000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/08/1597306338000/1597306338000/","excerpt":"SpringBoot2.3.x 整合 thymeleaf 模板 访问页面","text":"依赖12345678910&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.2.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;&lt;/dependency&gt; Thymeleaf (主推)轻量级的模板引擎（负责逻辑业务的不推荐，解析DOM或者XML会占用多的内存）可以直接在浏览器中打开且正确显示模板页面直接是html结尾，直接编辑 配置1234567891011121314151617181920212223spring: application: name: spring-boot-thymeleaf jackson: default-property-inclusion: non_null # 配置模版引擎, 是否开启thymeleaf缓存,本地为false，生产建议为true thymeleaf: # 是否启用模板缓存,开发时关闭缓存,不然没法看到实时页面 cache: false # 是否检查模板位置是否存在。 check-template: true # 是否为Web框架启用Thymeleaf视图分辨率。 enabled: true # 编码格式, 默认UTF-8 encoding: UTF-8 # 应用于模板的模板模式。另请参阅Thymeleaf的TemplateMode枚举。 mode: HTML servlet: content-type: text/html # 后缀 默认 .html suffix: .html # 模板文件存放位置 , 默认 classpath:/templates/ prefix: classpath:/templates/ 1234src/main/java/com/demon/freemarker/controller IndexController.javasrc/main/resources/templates index2.html 示例代码IndexController.java @Controller public class IndexController { /** * 路由 /index2 * 返回 index2 这里默认配置自动映射到目录(templages/)下的index2.html */ @GetMapping(\"/index2\") public String index(Model model){ model.addAttribute(\"content\",\"hello thymeleaf\"); return \"index2\"; } }index.html &lt;!DOCTYPE html&gt; &lt;html lang=\"en\" xmlns:th=\"http://www.thymeleaf.org\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Thymeleaf&lt;/title&gt; &lt;/head&gt; &lt;body&gt; this is welcome &lt;span th:text=\"${content}\"&gt;&lt;/span&gt; &lt;/body&gt; &lt;/html&gt;运行示例 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"Thymeleaf","slug":"Thymeleaf","permalink":"https://www.zhuqiaolun.com/tags/Thymeleaf/"}]},{"title":"MyCat 分库配置","slug":"2020/08/1596694227482/1596694227482","date":"2020-08-06T06:10:27.000Z","updated":"2021-03-10T06:30:38.014Z","comments":false,"path":"2020/08/1596694227482/1596694227482/","link":"","permalink":"https://www.zhuqiaolun.com/2020/08/1596694227482/1596694227482/","excerpt":"MyCat分库配置（sharding-by-intfile）","text":"创建数据库分别创建三个数据库：testdb_0，testdb_1，testdb_2 MyCat配置server.xml配置不变， &lt;user name=\"root\" defaultAccount=\"true\"&gt; &lt;property name=\"password\"&gt;123456&lt;/property&gt; &lt;property name=\"schemas\"&gt;TESTDB&lt;/property&gt; &lt;/user&gt;schema.xml配置如下： &lt;!-- 设置表的存储方式.schema name=\"TESTDB\" 与 server.xml中的 TESTDB 设置一致 --&gt; &lt;schema name=\"TESTDB\" checkSQLschema=\"true\" sqlMaxLimit=\"100\"&gt; &lt;!-- 分片规则：sharding-by-intfile --&gt; &lt;table name=\"t_users\" dataNode=\"node_db00,node_db01,node_db02\" rule=\"sharding-by-intfile\"&gt;&lt;/table&gt; &lt;/schema&gt; &lt;!-- 设置dataNode 对应的数据库,及 mycat 连接的地址dataHost --&gt; &lt;dataNode name=\"node_db00\" dataHost=\"dataHost01\" database=\"testdb_0\" /&gt; &lt;dataNode name=\"node_db01\" dataHost=\"dataHost01\" database=\"testdb_1\" /&gt; &lt;dataNode name=\"node_db02\" dataHost=\"dataHost01\" database=\"testdb_2\" /&gt; &lt;!-- mycat 逻辑主机dataHost对应的物理主机.其中也设置对应的mysql登陆信息 --&gt; &lt;dataHost name=\"dataHost01\" maxCon=\"1000\" minCon=\"10\" balance=\"1\" writeType=\"0\" dbType=\"mysql\" dbDriver=\"native\"&gt; &lt;heartbeat&gt;select user()&lt;/heartbeat&gt; &lt;writeHost host=\"hostM1\" url=\"127.0.0.1:3306\" user=\"root\" password=\"root\"/&gt; &lt;/dataHost&gt; rule.xml配置如下： &lt;tableRule name=\"sharding-by-intfile\"&gt; &lt;rule&gt; &lt;!-- columns:对应需要进行匹配规则的字段 --&gt; &lt;columns&gt;sex&lt;/columns&gt; &lt;algorithm&gt;hash-int&lt;/algorithm&gt; &lt;/rule&gt; &lt;/tableRule&gt; &lt;function name=\"hash-int\" class=\"io.mycat.route.function.PartitionByFileMap\"&gt; &lt;property name=\"mapFile\"&gt;partition-hash-int.txt&lt;/property&gt; &lt;property name=\"type\"&gt;1&lt;/property&gt; &lt;property name=\"defaultNode\"&gt;0&lt;/property&gt; &lt;/function&gt;说明：函数配置中，type默认值为0，0表示Integer，非零表示String， 所有的节点配置都是从defaultNode=0开始，及0代表第一个节点。defaultNode 默认节点:小于0表示不设置默认节点，大于等于0表示设置默认节点,默认节点的作用;枚举分片时,如果碰到不识别的枚举值，就让它路由到默认节点;如果不配置默认节点（defaultNode值小于0表示不配置默认节点），碰到不识别的枚举值就会报错; partition-hash-int.txt #10000=0 #10010=1 m=1 w=2说明：[sex=m]的数据放入node_db01，[sex=w]的数据放入node_db02，其它的数据[mw]放入node_db00，0：表示第一个dataNode[name=node_db00]节点，以下标选择1：表示第二个dataNode[name=node_db01]节点，以下标选择2：表示第三个dataNode[name=node_db02]节点，以下标选择注意以中文的分片规则，后续， 修改配置完成后，重启mycat服务，通过mycat插入数据即可看到结果 执行mysql -uroot -p123456 -P8066 -h 127.0.0.1 mysql&gt; show databases; mysql&gt; use TESTDB; mysql&gt; DROP TABLE IF EXISTS `t_users`; mysql&gt; CREATE TABLE `t_users` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(50) DEFAULT NULL, `sex` varchar(10) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; mysql&gt; set names gbk; mysql&gt; insert into t_users(`name`,sex)values('张三','m'); mysql&gt; insert into t_users(`name`,sex)values('李四','w'); mysql&gt; insert into t_users(`name`,sex)values('王五','mw'); 结果分片实现 数据结果 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/categories/MyCat/"}],"tags":[{"name":"myCat","slug":"myCat","permalink":"https://www.zhuqiaolun.com/tags/myCat/"}]},{"title":"在Windows10中安装MyCat环境","slug":"2020/08/1596610285582/1596610285582","date":"2020-08-05T06:51:25.000Z","updated":"2021-05-13T05:48:40.720Z","comments":false,"path":"2020/08/1596610285582/1596610285582/","link":"","permalink":"https://www.zhuqiaolun.com/2020/08/1596610285582/1596610285582/","excerpt":"在windows10中安装MyCat环境","text":"下载官网：Mycat数据库分库分表中间件，点击下载1.6.7.3 的Windows稳定版本链接：http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-win.tar.gz 解压目录如下： 安装由于软件本身就是绿色版本，只需放在指定目录下即可， mycat： bin：命令文件 catlet：空的,扩展 conf：配置文件(server.xml,schema.xml,rule.xml等) lib：依赖的jar包 logs：启动日志简单配置创建数据库在DB中创建数据库（test_mycat），创建表（t_user） 修改xml配置server.xml，rule.xml 不改变，schema.xml改动如下： &lt;?xml version=\"1.0\"?&gt; &lt;!DOCTYPE mycat:schema SYSTEM \"schema.dtd\"&gt; &lt;mycat:schema xmlns:mycat=\"http://io.mycat/\"&gt; &lt;!-- 设置表的存储方式.schema name=\"TESTDB\" 与 server.xml中的 TESTDB 设置一致 --&gt; &lt;schema name=\"TESTDB\" checkSQLschema=\"true\" sqlMaxLimit=\"100\"&gt; &lt;!-- auto sharding by id (long) --&gt; &lt;table name=\"t_user\" dataNode=\"dn1\"/&gt; &lt;/schema&gt; &lt;!-- 设置dataNode 对应的数据库,及 mycat 连接的地址dataHost --&gt; &lt;dataNode name=\"dn1\" dataHost=\"localhost1\" database=\"test_mycat\" /&gt; &lt;!-- mycat 逻辑主机dataHost对应的物理主机.其中也设置对应的mysql登陆信息 --&gt; &lt;dataHost name=\"localhost1\" maxCon=\"1000\" minCon=\"10\" balance=\"0\" writeType=\"0\" dbType=\"mysql\" dbDriver=\"native\" switchType=\"1\" slaveThreshold=\"100\"&gt; &lt;heartbeat&gt;select user()&lt;/heartbeat&gt; &lt;!-- can have multi write hosts --&gt; &lt;writeHost host=\"hostM1\" url=\"127.0.0.1:3306\" user=\"root\" password=\"root\"&gt; &lt;/writeHost&gt; &lt;/dataHost&gt; &lt;/mycat:schema&gt;启动本地启动双击bin目录下的startup_nowrap.bat文件 出现以下界面提示则启动成功： 服务启动以管理员的模式打开CMD命令,进入根目录下 安装服务 启动服务 当出现此启动错误：则需要将 -XX:MaxPermSize=512M 移除，该参数在jdk1.8版本中已放弃使用， 服务命令mycat.bat { console : Wrapper控制台 start : 服务启动 pause : 服务暂停 resume : 服务恢复 stop : 服务停止 restart : 服务重启 install : 服务安装 remove : 服务移除 status : 服务状态 }Navicat连接默认端口：8066用户名：root密码：server.xml的user配置，本次为 123456 查看连接： 查看数据： document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/categories/MyCat/"}],"tags":[{"name":"myCat","slug":"myCat","permalink":"https://www.zhuqiaolun.com/tags/myCat/"}]},{"title":"在Linux中安装MyCat环境","slug":"2020/08/1596536908607/1596536908607","date":"2020-08-04T10:28:28.000Z","updated":"2021-07-02T02:49:40.744Z","comments":false,"path":"2020/08/1596536908607/1596536908607/","link":"","permalink":"https://www.zhuqiaolun.com/2020/08/1596536908607/1596536908607/","excerpt":"在Linux中安装MyCat环境","text":"下载官网：Mycat数据库分库分表中间件，点击下载1.6.7.3 的Linux稳定版本链接：http://dl.mycat.org.cn/1.6.7.3/20190927161129/Mycat-server-1.6.7.3-release-20190927161129-linux.tar.gz 待续··· document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/categories/MyCat/"}],"tags":[{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/tags/MyCat/"}]},{"title":"Kafka使用 （SpringBoot调用）","slug":"2020/07/1595654393778/1595654393778","date":"2020-07-25T05:19:53.000Z","updated":"2021-03-10T06:31:03.114Z","comments":false,"path":"2020/07/1595654393778/1595654393778/","link":"","permalink":"https://www.zhuqiaolun.com/2020/07/1595654393778/1595654393778/","excerpt":"SpringBoot调用kafka服务","text":"依赖引入1234567891011121314151617181920212223&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.2.6.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;&lt;/parent&gt;&lt;!-- kafka start --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt; &lt;artifactId&gt;spring-kafka-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- kafka end --&gt; &lt;!-- fastjson --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.62&lt;/version&gt;&lt;/dependency&gt; yml配置1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950spring: # 基本配置 kafka: # 以逗号分隔的地址列表，用于建立与 Kafka 集群的初始连接 (kafka 默认的端口号为 9092) bootstrap-servers: 127.0.0.1:9092 # 定义生产者 producer: client-id: kafka.client.id # 发生错误后，消息重发的次数。 retries: 0 #当有多个消息需要被发送到同一个分区时，生产者会把它们放在同一个批次里。该参数指定了一个批次可以使用的内存大小，按照字节数计算。 batch-size: 16384 # 设置生产者内存缓冲区的大小。 buffer-memory: 33554432 # 键的序列化方式 key-serializer: org.apache.kafka.common.serialization.StringSerializer # 值的序列化方式 value-serializer: org.apache.kafka.common.serialization.StringSerializer # acks=0 ： 生产者在成功写入消息之前不会等待任何来自服务器的响应。 # acks=1 ： 只要集群的首领节点收到消息，生产者就会收到一个来自服务器成功响应。 # acks=all ：只有当所有参与复制的节点全部收到消息时，生产者才会收到一个来自服务器的成功响应。 acks: 1 # 定义消费者 consumer: # 自动提交的时间间隔 在 spring boot 2.X 版本中这里采用的是值的类型为 Duration 需要符合特定的格式，如 1S,1M,2H,5D auto-commit-interval: 3S # 该属性指定了消费者在读取一个没有偏移量的分区或者偏移量无效的情况下该作何处理： # latest（默认值）在偏移量无效的情况下，消费者将从最新的记录开始读取数据（在消费者启动之后生成的记录） # earliest ：在偏移量无效的情况下，消费者将从起始位置读取分区的记录 auto-offset-reset: earliest # 是否自动提交偏移量，默认值是 true,为了避免出现重复数据和数据丢失，可以把它设置为 false,然后手动提交偏移量 enable-auto-commit: true # 键的反序列化方式 key-deserializer: org.apache.kafka.common.serialization.StringDeserializer # 值的反序列化方式 value-deserializer: org.apache.kafka.common.serialization.StringDeserializer listener: # 在侦听器容器中运行的线程数(消费者个数即可) concurrency: 5 demon: #消费者配置 mqConfig: # 监听的主题topic topics: test,first,second,third topic: # 监听的主题first的消息执行类 first: com.demon.springbootkafka.listener.consumer.message.FirstMessage # 监听的主题second的消息执行类 second: com.demon.springbootkafka.listener.consumer.message.SecondMessage 类配置mq的消费者配置类： 123456789101112/** * @className: MqProperties.java * @description: mq的消费者配置类，映射 配置文件里面的值 * @author: Demon * @date 2020/6/16 18:00 */@Component@ConfigurationProperties(prefix = \"demon.mqConfig\")@Datapublic class MqConsumerTopicConfig { Map&lt;String,Class&lt;?&gt;&gt; topic;} 生产者KafKaProducerService 123456789101112131415161718192021222324252627282930313233343536373839404142package com.demon.springbootkafka.service;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeoutException;/** * @ClassName: KafKaProducerService * @Description: 生产者service * @Author: Demon * @Date: 2020/4/23 13:38 */public interface KafKaProducerService { /** * 发送标准消息没有回执 * @param topic 主题 * @param key key * @param data 内容 */ void sendStandardMessage(String topic, String key, String data); /** * 发送标准消息同步有阻塞 * @param topic 主题 * @param key key * @param data 内容 * @return 返回 * @throws InterruptedException 异常 * @throws ExecutionException 异常 * @throws TimeoutException 异常 */ Long sendStandardMessageSync(String topic, String key, String data) throws InterruptedException, ExecutionException, TimeoutException; /** * 发送标准消息异步无阻塞 * @param topic 主题 * @param key key * @param data 内容 */ void sendStandardMessageAsync(String topic, String key, String data);} KafKaProducerServiceImpl: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package com.demon.springbootkafka.service.impl;import lombok.extern.slf4j.Slf4j;import org.apache.kafka.clients.producer.ProducerRecord;import org.springframework.kafka.core.KafkaTemplate;import org.springframework.kafka.support.SendResult;import org.springframework.stereotype.Service;import org.springframework.util.concurrent.ListenableFuture;import org.springframework.util.concurrent.ListenableFutureCallback;import javax.annotation.Resource;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeUnit;import java.util.concurrent.TimeoutException;/** * @ClassName: KafKaProducerServiceImpl * @Description: 生产者service的实现，负责执行消息发送 * @Author: Demon * @Date: 2020/4/23 13:38 */@Slf4j@Servicepublic class KafKaProducerServiceImpl implements com.demon.springbootkafka.service.KafKaProducerService { @Resource private KafkaTemplate&lt;String, String&gt; kafkaTemplate; /** * 构建待发送的消息 * @param topic topic * @param key key * @param data data * @return 返回 */ private ProducerRecord&lt;String, String&gt; getRecord(String topic, String key, String data){ if(key == null){ return new ProducerRecord&lt;&gt;(topic,data); }else{ return new ProducerRecord&lt;&gt;(topic,key,data); } } @Override public void sendStandardMessage(String topic, String key, String data){ kafkaTemplate.send(getRecord(topic,key,data)); } @Override public Long sendStandardMessageSync(String topic, String key, String data) throws InterruptedException, ExecutionException, TimeoutException { SendResult&lt;String, String&gt; stringStringSendResult = kafkaTemplate.send(getRecord(topic, key, data)).get(1, TimeUnit.SECONDS); System.out.println(stringStringSendResult.getProducerRecord().timestamp()); return stringStringSendResult.getProducerRecord().timestamp(); } @Override public void sendStandardMessageAsync(String topic, String key, String data) { ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; sendResultListenableFuture = kafkaTemplate.send(getRecord(topic,key,data)); // 发送消息回调 //noinspection NullableProblems sendResultListenableFuture.addCallback(new ListenableFutureCallback&lt;SendResult&lt;String, String&gt;&gt;() { /** 发送成功回调方法 */ @Override public void onSuccess(SendResult&lt;String, String&gt; sendResultMap) { log.debug(\"发送消息成功：\" + sendResultMap); } /** 发送失败回调方法 */ @Override public void onFailure(Throwable throwable) { log.debug(\"发送消息失败：\"+ throwable.getMessage()); } }); }} 生产者监听KafkaSendResultHandler： 12345678910111213141516171819202122232425262728package com.demon.springbootkafka.listener.producer;import lombok.extern.slf4j.Slf4j;import org.apache.kafka.clients.producer.ProducerRecord;import org.apache.kafka.clients.producer.RecordMetadata;import org.springframework.kafka.support.ProducerListener;import org.springframework.stereotype.Component;/** * @ClassName: KafkaSendResultHandler * @Description: 发送消息结果回调 * @Author: Demon * @Date: 2020/4/23 13:55 */@Slf4j@Componentpublic class KafkaSendResultHandler implements ProducerListener { @Override public void onSuccess(ProducerRecord producerRecord, RecordMetadata recordMetadata) { log.info(\"发送消息监听成功 : \" + producerRecord.toString()); } @Override public void onError(ProducerRecord producerRecord, Exception exception) { log.info(\"发送消息监听失败 : \" + exception); }} 消费者KafkaConsumerService： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.demon.springbootkafka.listener.consumer;import com.demon.springbootkafka.config.MqConsumerTopicConfig;import lombok.extern.slf4j.Slf4j;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.springframework.kafka.annotation.KafkaListener;import org.springframework.stereotype.Component;import javax.annotation.Resource;import java.lang.reflect.Method;/** * @ClassName: KafkaConsumerService * @Description: 消费者监听消息,通过类的反射执行topic消息处理 * @Author: Demon * @Date: 2020/4/23 14:44 */@Slf4j@Componentpublic class KafkaConsumerService { @Resource private MqConsumerTopicConfig mqConsumerTopicConfig; @KafkaListener(topics = \"#{'${demon.mqConfig.topics}'.split(',')}\", groupId = \"test-group\") public void receive(ConsumerRecord&lt;String, Object&gt; record) { String topic = record.topic(); log.info(\"------ \" + topic + \" 消费者处理消息------\"); try { if (mqConsumerTopicConfig.getTopic().containsKey(topic)) { String classPath = mqConsumerTopicConfig.getTopic().get(topic).getName(); try { Class&lt;?&gt; c1s = Class.forName(classPath); //判断是否有实现ConsumerMessageExecute消息处理接口，否则不予执行 if (c1s.getInterfaces().length &gt; 0 &amp;&amp; c1s.getInterfaces()[0].equals(ConsumerMessageExecute.class)) { //获得Class的Method对象,参数为方法名,参数列表的类型Class对象 Method method = c1s.getMethod(\"execute\", ConsumerRecord.class); //invoke方法，参数为cls实例对象，和想要调用的方法参数 Boolean value = (Boolean) method.invoke(c1s.newInstance(), record); //输出invoke方法的返回值 System.out.println(\"execute方法的返回值：\" + value); } else { log.error(\"============ 调用class：{} 错误:{}\", classPath, \"此类没有实现 MessageExecute 接口！！！\"); } } catch (Exception e) { e.printStackTrace(); log.error(\"============ 调用class：{} 异常：{}\", classPath, e); } } else { log.error(\"============ {}不存在\", topic); } } catch (Exception e) { e.printStackTrace(); } }} ConsumerMessageExecute： 1234567891011121314151617181920package com.demon.springbootkafka.listener.consumer;import org.apache.kafka.clients.consumer.ConsumerRecord;/** * 消息执行统一接口 * @ClassName: MessageExecute * @Description: 消息实现接口，必须实现此接口，否则无法执行消息处理 * @Author: Demon * @Date: 2020/5/24 12:55 */public interface ConsumerMessageExecute { /** * 消费者 消息执行方法 * @param record 消息体 * @return 返回 */ boolean execute(ConsumerRecord&lt;String, Object&gt; record);} FirstMessage: 123456789101112131415161718package com.demon.springbootkafka.listener.consumer.message;import com.demon.springbootkafka.listener.consumer.ConsumerMessageExecute;import org.apache.kafka.clients.consumer.ConsumerRecord;/** * @ClassName: FirstMessage * @Description: 监听topic【first】的处理 * @Author: Demon * @Date: 2020/6/17 19:14 */public class FirstMessage implements ConsumerMessageExecute { @Override public boolean execute(ConsumerRecord&lt;String, Object&gt; record) { System.out.println(String.format(\"topic = %s, key = %s, value = %s \",record.topic(), record.key(), record.value())); return true; }} SecondMessage: 123456789101112131415161718package com.demon.springbootkafka.listener.consumer.message;import com.demon.springbootkafka.listener.consumer.ConsumerMessageExecute;import org.apache.kafka.clients.consumer.ConsumerRecord;/** * @ClassName: MessageUrgent * @Description: 监听topic【second】的处理 * @Author: Demon * @Date: 2020/6/17 19:15 */public class SecondMessage implements ConsumerMessageExecute { @Override public boolean execute(ConsumerRecord&lt;String, Object&gt; record) { System.out.println(String.format(\"topic = %s, key = %s, value = %s \",record.topic(), record.key(), record.value())); return true; }} 测试SpringBootKafkaApplicationTests： 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.demon.springbootkafka;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;import com.demon.springbootkafka.service.KafKaProducerService;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;import java.util.UUID;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeoutException;@SpringBootTestclass SpringBootKafkaApplicationTests { @Resource private KafKaProducerService kafKaProducerService; @Test void contextLoads() { System.out.println(System.currentTimeMillis()); } @Test void sendStandardMessage() { String topic = \"test\"; String key = UUID.randomUUID().toString(); String data = JSON.toJSONString(new JSONObject().put(\"time\",System.currentTimeMillis())); kafKaProducerService.sendStandardMessage(topic,key,data); } @Test void sendStandardMessageAsync() { String topic = \"test\"; String key = UUID.randomUUID().toString(); String data = JSON.toJSONString(new JSONObject().put(\"time\",System.currentTimeMillis())); kafKaProducerService.sendStandardMessageAsync(topic,key,data); } @Test void sendStandardMessageSync() { String topic = \"test\"; String key = UUID.randomUUID().toString(); JSONObject jsonObject = new JSONObject(true); jsonObject.put(\"time\",System.currentTimeMillis()); String data = jsonObject.toJSONString(); try { kafKaProducerService.sendStandardMessageSync(topic, key, data); } catch (InterruptedException | TimeoutException | ExecutionException e) { e.printStackTrace(); } }} 扩展KafkaConfig: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.demon.springbootkafka.config;import org.apache.kafka.clients.admin.AdminClient;import org.apache.kafka.clients.admin.AdminClientConfig;import org.springframework.boot.autoconfigure.kafka.KafkaProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.kafka.annotation.EnableKafka;import org.springframework.kafka.core.KafkaAdmin;import javax.annotation.Resource;import java.util.HashMap;import java.util.Map;/** * @ClassName: KafkaConfig * @Description: KafkaConfig 配置,操作topic * @Author: Demon * @Date: 2020/4/23 18:28 */@Configuration@EnableKafkapublic class KafkaConfig { @Resource private KafkaProperties kafkaProperties; /** * 创建一个kafka管理类，相当于rabbitMQ的管理类rabbitAdmin, * 没有此bean无法自定义的使用adminClient创建topic * @return 返回 */ @Bean public KafkaAdmin kafkaAdmin() { Map&lt;String, Object&gt; props = new HashMap&lt;&gt;(1); //配置Kafka实例的连接地址 //kafka的地址，不是zookeeper props.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaProperties.getBootstrapServers().get(0)); return new KafkaAdmin(props); } /** * kafka客户端，在spring中创建这个bean之后可以注入并且创建topic, * 用于集群环境，创建对个副本 * @return 返回 */ @Bean public AdminClient adminClient() { return AdminClient.create(kafkaAdmin().getConfig()); }} SpringBootKafkaApplicationTests_topic: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.demon.springbootkafka;import com.alibaba.fastjson.JSON;import org.apache.kafka.clients.admin.*;import org.junit.jupiter.api.Test;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;import org.springframework.boot.test.context.SpringBootTest;import org.springframework.transaction.annotation.EnableTransactionManagement;import javax.annotation.Resource;import java.util.ArrayList;import java.util.Collections;import java.util.Set;import java.util.concurrent.ExecutionException;@SpringBootTest@EnableAutoConfigurationclass SpringBootKafkaApplicationTests_topic { @Resource private AdminClient adminClient; @Test void contextLoads() { System.out.println(System.currentTimeMillis()); } @Test void listTopics(){ try { ListTopicsResult listTopics = adminClient.listTopics(); Set&lt;String&gt; topics = listTopics.names().get(); for (String topic : topics) { System.out.println(topic); } } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } } @Test void createTopic() { ArrayList&lt;NewTopic&gt; topics = new ArrayList&lt;&gt;(); NewTopic newTopic = new NewTopic(\"test1\", 2, (short) 1); topics.add(newTopic); CreateTopicsResult result = adminClient.createTopics(topics); System.out.println( JSON.toJSONString(result)); } @Test void deleteTopics() { DeleteTopicsResult deleteTopicsResult = adminClient.deleteTopics(Collections.singletonList(\"test1\")); System.out.println( JSON.toJSONString(deleteTopicsResult)); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://www.zhuqiaolun.com/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://www.zhuqiaolun.com/tags/kafka/"}]},{"title":"Kafka使用 （Java普通调用）","slug":"2020/07/1595649722982/1595649722982","date":"2020-07-25T04:02:02.000Z","updated":"2021-03-10T06:31:27.099Z","comments":false,"path":"2020/07/1595649722982/1595649722982/","link":"","permalink":"https://www.zhuqiaolun.com/2020/07/1595649722982/1595649722982/","excerpt":"Java调用kafka服务","text":"依赖引入1234567891011121314151617181920212223242526&lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka_2.11&lt;/artifactId&gt; &lt;version&gt;2.4.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt; &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt; &lt;version&gt;2.4.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt; &lt;version&gt;1.7.2&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.58&lt;/version&gt;&lt;/dependency&gt; Topic操作123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687import java.util.ArrayList;import java.util.Collections;import java.util.Properties;import java.util.Set;import java.util.concurrent.ExecutionException;import org.apache.kafka.clients.CommonClientConfigs;import org.apache.kafka.clients.admin.AdminClient;import org.apache.kafka.clients.admin.CreateTopicsResult;import org.apache.kafka.clients.admin.DeleteTopicsResult;import org.apache.kafka.clients.admin.ListTopicsResult;import org.apache.kafka.clients.admin.NewTopic;import org.junit.After;import org.junit.Before;import org.junit.Test;import com.alibaba.fastjson.JSONObject;/** * Topic操作 */public class CreateTopics { private static AdminClient adminClient = null; /** * 初始化adminClient */ @Before public void getAdminClient() { Properties props = new Properties(); props.put(CommonClientConfigs.BOOTSTRAP_SERVERS_CONFIG, \"127.0.0.1:9092\"); adminClient = AdminClient.create(props); } /** * 获取所有Topic */ @Test public void getTopicList() { try { ListTopicsResult listTopics = adminClient.listTopics(); Set&lt;String&gt; topics = listTopics.names().get(); for (String topic : topics) { System.out.println(topic); } } catch (InterruptedException | ExecutionException e) { e.printStackTrace(); } } /** * 创建Topic 创建了3个名为\"first\", \"second\",\"third\"，分区数为1，复制因子为1的Topic. * 创建完成，返回null */ @Test public void getCreateTopic() { ArrayList&lt;NewTopic&gt; topics = new ArrayList&lt;NewTopic&gt;(); topics.add(new NewTopic(\"test\", 4, (short) 1)); topics.add(new NewTopic(\"first\", 4, (short) 1)); topics.add(new NewTopic(\"second\", 4, (short) 1)); topics.add(new NewTopic(\"third\", 4, (short) 1)); CreateTopicsResult result = adminClient.createTopics(topics); try { System.out.println(result.all().get()); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } } /** * 删除Topic */ @Test public void getDeleteTopic() { DeleteTopicsResult deleteTopicsResult =adminClient.deleteTopics(Collections.singleton(\"test\")); System.out.println(JSONObject.toJSONString(deleteTopicsResult)); } /** * 关闭连接 */ @After public void afterClass() { adminClient.close(); }} 生产者普通生产者1234567891011121314public static void testProducer(String topic) { Properties props = new Properties(); props.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); props.put(\"acks\", \"all\"); props.put(\"retries\", 0); props.put(\"batch.size\", 16384); props.put(\"key.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); props.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;String, String&gt;(props); for (int i = 0; i &lt; 10; i++) { producer.send(new ProducerRecord&lt;String, String&gt;(topic, Integer.toString(i), Integer.toString(i))); } producer.close();} 事务生产者12345678910111213141516171819202122232425public static void testTransactionProducer(String topic) { Properties props = new Properties(); props.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); props.put(\"transactional.id\", \"my-transactional-id\"); props.put(\"acks\", \"all\"); props.put(\"batch.size\", 16384); KafkaProducer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props, new StringSerializer(),new StringSerializer()); producer.initTransactions(); try { producer.beginTransaction(); for (int i = 0; i &lt; 3; i++) { producer.send(new ProducerRecord&lt;&gt;(topic, Integer.toString(i), Integer.toString(i))); } producer.commitTransaction(); } catch (ProducerFencedException | OutOfOrderSequenceException | AuthorizationException e) { // We can't recover from these exceptions, so our only option is to close the // producer and exit. producer.close(); } catch (KafkaException e) { // For all other exceptions, just abort the transaction and try again. producer.abortTransaction(); } finally { producer.close(); }} 消费者1234567891011121314151617181920212223242526272829303132333435import java.time.Duration;import java.util.Arrays;import java.util.Properties;import org.apache.kafka.clients.consumer.ConsumerRecord;import org.apache.kafka.clients.consumer.ConsumerRecords;import org.apache.kafka.clients.consumer.KafkaConsumer;public class CustomConsumer { public static void main(String[] args) { Properties props = new Properties(); // 定义kakfa 服务的地址，不需要将所有broker指定上 props.put(\"bootstrap.servers\", \"127.0.0.1:9092\"); // 制定consumer group props.put(\"group.id\", \"custom_group_id\"); // 是否自动确认offset props.put(\"enable.auto.commit\", \"true\"); // 自动确认offset的时间间隔 props.put(\"auto.commit.interval.ms\", \"1000\"); // key的序列化类 props.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // value的序列化类 props.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); // 定义consumer KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props); // 消费者订阅的topic, 可同时订阅多个 consumer.subscribe(Arrays.asList(\"test\",\"first\", \"second\",\"third\")); while (true) { // 读取数据，读取超时时间为100ms ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(100)); for (ConsumerRecord&lt;String, String&gt; record : records) System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), record.value()); } }} 集群使用在配置中将bootstrap.servers，修改以下方式即可，需要将所有broker指定写上 1props.put(\"bootstrap.servers\", \"127.0.0.1:9092,127.0.0.2:9092,127.0.0.3:9092\"); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://www.zhuqiaolun.com/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://www.zhuqiaolun.com/tags/kafka/"}]},{"title":"kafka集群搭建 - 使用内置Zookeeper","slug":"2020/07/1595582052033/1595582052033","date":"2020-07-24T09:14:12.000Z","updated":"2021-03-10T06:10:20.514Z","comments":false,"path":"2020/07/1595582052033/1595582052033/","link":"","permalink":"https://www.zhuqiaolun.com/2020/07/1595582052033/1595582052033/","excerpt":"kafka集群搭建 - 使用内置Zookeeper","text":"下载官网下载地址：http://kafka.apache.org/downloads.html下载完成后复制一式三份，完成集群部署至少需要三台以及三台以上的服务。 kafka版本:kafka_2.12-2.5.0三台主机IP 127.0.0.1、127.0.0.2、127.0.0.3 kafka配置第一台server.properties： 12345678# 唯一值broker.id=1listeners=PLAINTEXT://127.0.0.1:9092# 建议填写服务器的数量值num.partitions=3 # 其他zk服务的连接zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181zookeeper.connection.timeout.ms=30000 第二台server.properties： 12345678# 唯一值broker.id=2listeners=PLAINTEXT://127.0.0.2:9092# 建议填写服务器的数量值num.partitions=3 # 其他zk服务的连接zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181zookeeper.connection.timeout.ms=30000 第三台server.properties： 12345678# 唯一值broker.id=3listeners=PLAINTEXT://127.0.0.3:9092# 建议填写服务器的数量值num.partitions=3 # 其他zk服务的连接zookeeper.connect=127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181zookeeper.connection.timeout.ms=30000 zookeeper配置zookeeper可统一配置，zookeeper.properties： 12345678910111213dataDir=D:\\\\kafka_2.12-2.5.0\\\\data\\\\zookeeperdataLogDir=D:\\\\kafka_2.12-2.5.0\\\\logs\\\\zookeeperclientPort=2181# maxClientCnxns = 0 # 注释掉该配置admin.enableServer=false#设置连接参数，添加如下配置tickTime=2000initLimit=10syncLimit=5#设置broker Id的服务地址server.1=127.0.0.1:2888:3888server.2=127.0.0.2:2888:3888server.3=127.0.0.3:2888:3888同时在zookeeper数据目录dataDir下添加id配置，在各台服务的zookeeper数据目录添加myid文件且无后缀名，写入各自服务broker.id属性值， document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://www.zhuqiaolun.com/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://www.zhuqiaolun.com/tags/kafka/"}]},{"title":"kafka单机搭建 - 使用内置Zookeeper","slug":"2020/07/1595581721604/1595581721604","date":"2020-07-24T09:08:41.000Z","updated":"2021-03-10T06:10:40.517Z","comments":false,"path":"2020/07/1595581721604/1595581721604/","link":"","permalink":"https://www.zhuqiaolun.com/2020/07/1595581721604/1595581721604/","excerpt":"kafka搭建 - 使用内置Zookeeper","text":"前言在刚开始学习Kafka的时候，安装Kafka时说Kafka依赖ZooKeeper，所以想要安装Kafka必须先安装ZooKeeper。但是在下载Kafka的时候，官网上说，Kafka 0.5.x版本以上已经自带ZooKeeper，不需要自己安装ZooKeeper。但在使用自带ZooKeeper也没有啥缺陷，反倒针对特定版本人家 Kafka 已经验证过其稳定性了。 下载官网下载地址：http://kafka.apache.org/downloads.html 配置解压文件打开 kafka_2.12-2.5.0\\config从文本编辑器里打开 server.properties,添加或者修改内容 12345listeners=PLAINTEXT://10.200.47.142:9092log.dirs=D:\\\\kafka_2.12-2.5.0\\\\logs\\\\kafkanum.partitions=4zookeeper.connect=127.0.0.1:2181zookeeper.connection.timeout.ms=30000 端口号可以被任意修改。如果端口号设置为小于1024，那么kafka需要以root身份启动，不指定的话，按照默认9092【service.properties】port = 19092【connect-distributed.properties 】bootstrap.servers=localhost:19092【producer.properties 】bootstrap.servers=localhost:19092【connect-standalone.properties 】bootstrap.servers=localhost:19092【consumer.properties 】bootstrap.servers=localhost:19092 从文本编辑器里打开 zookeeper.properties,添加或者修改内容 12dataDir=D:\\\\kafka_2.12-2.5.0\\\\data\\\\zookeeperdataLogDir=D:\\\\kafka_2.12-2.5.0\\\\logs\\\\zookeeper 启动在根目录下编写bat文件启动： 1.start-zookeeper.bat内容如下： 12@echo offstart cmd /c \"title zookeeper-21810 &amp;&amp; .\\bin\\windows\\zookeeper-server-start .\\config\\zookeeper.properties\" 2.start-kafka.bat 12@echo offstart cmd /c \"title kafka_2.11-2.4.1-9092 &amp;&amp; .\\bin\\windows\\kafka-server-start.bat .\\config\\server.properties\" 按照顺序启动，即可执行， document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Kafka","slug":"Kafka","permalink":"https://www.zhuqiaolun.com/categories/Kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://www.zhuqiaolun.com/tags/kafka/"}]},{"title":"发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三","slug":"2020/06/1592899073321/1592899073321","date":"2020-06-23T07:57:53.000Z","updated":"2025-02-07T09:55:21.873Z","comments":false,"path":"2020/06/1592899073321/1592899073321/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1592899073321/1592899073321/","excerpt":"使用 Java Service Wrapper 注册Windows服务（修改配置参数，新增对 jvm 的配置）","text":"前面是使用的配置会导致JVM不断重启，需要加JVM参数以及设置，同时设置服务开机启动； 配置文件新增配置参数如下： wrapper.jmx=false wrapper.on_exit.0=SHUTDOWN wrapper.on_exit.default=RESTART wrapper.ntservice.interactive = true # 服务开机启动 wrapper.ntservice.starttype=AUTO_START wrapper.tray = true # 监测JVM死锁 wrapper.java.monitor.deadlock = true wrapper.java.monitor.heap = true wrapper.java.monitor.gc.restart = true # Java Heap 初始化大小(单位：MB) wrapper.java.initmemory=128 # Java Heap 最大值(单位：MB) wrapper.java.maxmemory=128 # 32/64位选择，true为自动选择 wrapper.java.additional.auto_bits=TRUE检测JVM参数可以用jps+jmap监测即可jps:jmap -heap xxxxx 链接发布Java程序为Windows服务 （含有Java环境）一发布Java程序为Windows服务 （不含有Java环境）二发布Java程序为Windows服务 - Windows Service Wrapper 四 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"winsw","slug":"winsw","permalink":"https://www.zhuqiaolun.com/tags/winsw/"}]},{"title":"发布Java程序为Windows服务 （不含有Java环境）二","slug":"2020/06/1592898236483/1592898236483","date":"2020-06-23T07:43:56.000Z","updated":"2025-02-07T09:55:19.376Z","comments":false,"path":"2020/06/1592898236483/1592898236483/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1592898236483/1592898236483/","excerpt":"使用 Java Service Wrapper 注册Windows服务（不含有Java环境）","text":"前面在有Java环境的情况下的设置，现在假设我们不存在Java运行环境，也就是没有JRE与JDK，所以需要拷贝java安装目录下的JRE（包含bin目录和相关lib）目录到需要的服务目录下 拷贝JREJRE目录拷贝JRE目录到服务目录 修改配置文件利用拷贝过去的jre目录下的jar包和bin\\java.exe，修改wrapper.java.command的值 wrapper.java.command=../jre1.8.0_45/bin/java.exe链接发布Java程序为Windows服务 （含有Java环境）一发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三发布Java程序为Windows服务 - Windows Service Wrapper 四 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"winsw","slug":"winsw","permalink":"https://www.zhuqiaolun.com/tags/winsw/"}]},{"title":"发布Java程序为Windows服务 （含有Java环境）一","slug":"2020/06/1592889892770/1592889892770","date":"2020-06-23T05:24:52.000Z","updated":"2025-02-07T09:55:15.156Z","comments":false,"path":"2020/06/1592889892770/1592889892770/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1592889892770/1592889892770/","excerpt":"使用 Java Service Wrapper 注册Windows服务（含有Java环境）","text":"描述有时候我们希望我们java写的程序作为服务注册到系统中，Java Service Wrapper 是目前较为流行的将Java程序部署成Windows服务的解决方案 下载serviceWrapper包网址：https://www.krenger.ch/blog/category/windows/ 下载zip压缩文件 解压serviceWrapper包解压wrapper-windows-x86-64-3.5.43.zip解压出来的文件多，但有些不是必须要的 注册一个简单的服务准备一个目录 建议在非中文且不含有空格的目录下目录结构如下：lang目录是存放支持其他语言的语言包，一般用不到mylib目录是存放我们的程序包 然后将下载的wrapper目录下的文件拷贝到我们上面建的目录: ···\\bin\\InstallTestWrapper-NT.bat -&gt; D:\\test\\java-service-hello\\bin\\InstallTestWrapper-NT.bat ···\\bin\\StartTestWrapper-NT.bat -&gt; D:\\test\\java-service-hello\\bin\\StartTestWrapper-NT.bat ···\\bin\\StopTestWrapper-NT.bat -&gt; D:\\test\\java-service-hello\\bin\\StopTestWrapper-NT.bat ···\\bin\\TestWrapper.bat -&gt; D:\\test\\java-service-hello\\bin\\TestWrapper.bat ···\\bin\\UninstallTestWrapper-NT.bat -&gt; D:\\test\\java-service-hello\\bin\\UninstallTestWrapper-NT.bat ···\\bin\\wrapper.exe -&gt; D:\\test\\java-service-hello\\bin\\wrapper.exe ···\\conf\\wrapper.conf -&gt; D:\\test\\java-service-hello\\conf\\wrapper.conf ···\\lib\\wrapper.jar -&gt; D:\\test\\java-service-hello\\lib\\wrapper.jar ···\\lib\\wrapper.dll -&gt; D:\\test\\java-service-hello\\lib\\wrapper.dlljava程序123456789101112131415161718192021222324import java.io.File;import java.util.concurrent.TimeUnit;import cn.hutool.core.date.DateUtil;import cn.hutool.core.io.file.FileAppender;import cn.hutool.core.lang.UUID;public class JarHelloApp { public static void main(String[] args) { while (true) { try { System.out.println(\"Hello World!\"); String str = UUID.fastUUID().toString(); System.out.println(str); //每隔3秒创建文件并写入内容 FileAppender appender = new FileAppender(new File(\"D:\\\\test\\\\jar\\\\\"+str+\".txt\"), 16, true); TimeUnit.SECONDS.sleep(3); appender.append(DateUtil.now()); appender.flush(); appender.toString(); } catch (Exception e) { e.printStackTrace(); } } }} 引入的依赖 12345&lt;dependency&gt; &lt;groupId&gt;cn.hutool&lt;/groupId&gt; &lt;artifactId&gt;hutool-all&lt;/artifactId&gt; &lt;version&gt;5.3.7&lt;/version&gt;&lt;/dependency&gt; java程序打包由于采用eclipse所有打包流程：项目邮件 -&gt; Export -&gt; Java/Runnable JAR file -&gt; Next 导出项目设置 导出项目文件 将程序打成的包以及自己程序依赖的包放到mylib 修改配置文件文件路径：D:\\test\\java-service-hello\\conf\\wrapper.conf内容如下： # jdk或者jre的java.exe路径，可通过环境变量获取 wrapper.java.command=%JAVA_HOME%/bin/java.exe # wrapper.java.command=C:\\Java\\jre1.8.0_45\\bin\\java # 日志级别 wrapper.java.command.loglevel=INFO wrapper.java.mainclass=org.tanukisoftware.wrapper.WrapperSimpleApp # 执行的程序的main方法的类的路径 wrapper.app.parameter.1=com.demon.jar_hello.JarHelloApp # 依赖的包，第一个是wrapper包，第二个是自己打的包以及程序依赖包 wrapper.java.classpath.1=../lib/wrapper.jar wrapper.java.classpath.2=../mylib/*.jar # 固定写法，依赖的wrapper的包 wrapper.java.library.path.1=../lib # 日志配置 按照日期每天创建文件 wrapper.logfile=../logs/wrapper.YYYYMMDD.log wrapper.logfile.rollmode=DATE # 服务名称以及描述信息 wrapper.console.title=jar hello Server wrapper.name=jarhelloserver wrapper.displayname=jar hello Server wrapper.description=jar hello Server # 更多配置可对 jvm 配置测试注册服务在服务目录下的bin目录下双击 TestWrapper.bat 文件，当程序执行正确时则表示可以注册服务控制台测试 注册服务在服务目录下执行（管理员模式） 注册服务命令 bin\\wrapper.exe -i ..\\conf\\wrapper.confcmd结果服务结果 启动服务命令 net start jarhelloserver 或者 bin\\wrapper.exe -t ..\\conf\\wrapper.confcmd结果服务结果 停止服务命令 net stop jarhelloserver 或者 bin\\wrapper.exe -p ..\\conf\\wrapper.conf cmd结果 服务结果 删除服务命令 sc delete jarhelloserver 或者 bin\\wrapper.exe -r ..\\conf\\wrapper.conf cmd结果 扩展 一由于使用命名操作复杂，故在服务目录创建bat文件 install-service.bat @echo off start cmd /c \"title install-service &amp;&amp; bin\\wrapper.exe -i ..\\conf\\wrapper.conf\"uninstall-service.bat @echo off start cmd /c \"title uninstall-service &amp;&amp; bin\\wrapper.exe -r ..\\conf\\wrapper.conf\"start-service.bat @echo off start cmd /c \"title start-service &amp;&amp; bin\\wrapper.exe -t ..\\conf\\wrapper.conf\"stop-service.bat @echo off start cmd /c \"title stop-service &amp;&amp; bin\\wrapper.exe -p ..\\conf\\wrapper.conf\"扩展 二我们可以用上面的service wrapper的bin包中的bat文件进行服务操作将下载解压后的wrapper-windows\\bin中的部分文件复制到我们的服务\\bin目录下我们只需要点击上面的bat文件即可实现上面的操作： 安装服务：InstallTestWrapper-NT.bat 查询服务：QueryTestWrapper-NT.bat 开启服务：StartTestWrapper-NT.bat 停止服务：StopTestWrapper-NT.bat 测试服务：TestWrapper.bat 卸载服务：UninstallTestWrapper-NT.bat链接发布Java程序为Windows服务 （不含有Java环境）二发布Java程序为Windows服务 （修改配置参数，新增对 jvm 的配置）三发布Java程序为Windows服务 - Windows Service Wrapper 四 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"}],"tags":[{"name":"winsw","slug":"winsw","permalink":"https://www.zhuqiaolun.com/tags/winsw/"}]},{"title":"SpringBoot配置RestTemplate","slug":"2020/06/1592881660483/1592881660483","date":"2020-06-23T03:07:40.000Z","updated":"2022-08-16T08:11:51.565Z","comments":false,"path":"2020/06/1592881660483/1592881660483/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1592881660483/1592881660483/","excerpt":"SpringBoot配置RestTemplate","text":"以下为2种配置方式,均可实现实现远程调用，jar引入只要其一即可； 方式一：RestTemplate + HttpClients 方式二：RestTemplate + OkHttp3 依赖123456789101112131415161718&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;&gt;2.4.0&lt;/version&gt; &lt;relativePath/&gt;&lt;/parent&gt;&lt;dependency&gt; &lt;!-- 不需要版本号 --&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;3.9.1&lt;/version&gt;&lt;/dependency&gt; 配置RestTemplate + HttpClients123456789101112131415161718192021222324252627282930313233343536373839import org.apache.http.conn.ssl.SSLConnectionSocketFactory;import org.apache.http.conn.ssl.TrustStrategy;import org.apache.http.impl.client.CloseableHttpClient;import org.apache.http.impl.client.HttpClients;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.http.client.HttpComponentsClientHttpRequestFactory;import org.springframework.web.client.RestTemplate;import javax.net.ssl.SSLContext;import java.security.KeyManagementException;import java.security.KeyStoreException;import java.security.NoSuchAlgorithmException;import java.security.cert.X509Certificate;/** * className RestTemplateConfig * author demon * createTime 2021/6/8 13:09 * description RestTemplate + HttpClients 实现远程调用 */@Configurationclass RestTemplateConfig { @Bean public RestTemplate restTemplate() throws KeyStoreException, NoSuchAlgorithmException, KeyManagementException { TrustStrategy acceptingTrustStrategy = (X509Certificate[] chain, String authType) -&gt; true; SSLContext sslContext = org.apache.http.ssl.SSLContexts.custom().loadTrustMaterial(null, acceptingTrustStrategy).build(); SSLConnectionSocketFactory csf = new SSLConnectionSocketFactory(sslContext); CloseableHttpClient httpClient = HttpClients.custom().setSSLSocketFactory(csf).build(); //使用httpclient的factory HttpComponentsClientHttpRequestFactory requestFactory = new HttpComponentsClientHttpRequestFactory(); // 请求连接超时时间 毫秒 requestFactory.setConnectTimeout(1000 * 60); // 从链接池获取连接超时时间 毫秒 requestFactory.setConnectionRequestTimeout(6000); // 获取数据超时时间 毫秒 requestFactory.setReadTimeout(1000 * 360); requestFactory.setHttpClient(httpClient); return new RestTemplate(requestFactory); }} RestTemplate + OkHttp3123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128import lombok.extern.slf4j.Slf4j;import okhttp3.ConnectionPool;import okhttp3.OkHttpClient;import org.springframework.boot.web.client.RestTemplateBuilder;import org.springframework.context.annotation.Bean;import org.springframework.http.HttpHeaders;import org.springframework.http.HttpMethod;import org.springframework.http.client.ClientHttpRequestInterceptor;import org.springframework.http.client.ClientHttpResponse;import org.springframework.http.client.OkHttp3ClientHttpRequestFactory;import org.springframework.stereotype.Component;import org.springframework.web.client.ResponseErrorHandler;import org.springframework.web.client.RestTemplate;import javax.net.ssl.SSLContext;import javax.net.ssl.SSLSocketFactory;import javax.net.ssl.TrustManager;import javax.net.ssl.X509TrustManager;import java.io.IOException;import java.net.URI;import java.security.KeyManagementException;import java.security.NoSuchAlgorithmException;import java.security.SecureRandom;import java.security.cert.X509Certificate;import java.time.Instant;import java.time.LocalDateTime;import java.time.ZoneId;import java.time.format.DateTimeFormatter;import java.util.concurrent.TimeUnit;/** * className RestTemplateConfig * author demon * createTime 2021/6/8 13:09 * description RestTemplate + OkHttp3 实现远程调用 */@Slf4j@Componentpublic class RestTemplateConfig { /** * 基于OkHttp3配置RestTemplate */ @Bean public RestTemplate restTemplate(RestTemplateBuilder restTemplateBuilder) { RestTemplate restTemplate = restTemplateBuilder .errorHandler(new ResponseErrorHandler() { @Override public boolean hasError(ClientHttpResponse clientHttpResponse) throws IOException { return clientHttpResponse.getStatusCode().value() != 200 &amp;&amp; clientHttpResponse.getStatusCode().value() != 302; } @Override public void handleError(ClientHttpResponse clientHttpResponse) { } @Override public void handleError(URI url, HttpMethod method, ClientHttpResponse response) throws IOException { log.error(\"=======================ERROR============================\"); log.error(\"DateTime：{}\", LocalDateTime.ofInstant(Instant.ofEpochMilli(response.getHeaders().getDate()), ZoneId.systemDefault()).format(DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\"))); log.error(\"HOST:{}，URI：{}\", url.getHost(), url.getPath()); log.error(\"Method：{}\", method.name()); log.error(\"Exception：{}\", response.getStatusCode()); log.error(\"========================================================\"); } }) .interceptors((ClientHttpRequestInterceptor) (httpRequest, bytes, clientHttpRequestExecution) -&gt; { HttpHeaders headers = httpRequest.getHeaders(); // 加入自定义字段 headers.add(\"Content-Type\", \"application/json;charset=UTF-8\"); return clientHttpRequestExecution.execute(httpRequest, bytes); }) .build(); restTemplate.setRequestFactory(new OkHttp3ClientHttpRequestFactory(new OkHttpClient.Builder() // 整个流程耗费的超时时间 .callTimeout(180, TimeUnit.SECONDS) // 读取耗时 .readTimeout(60, TimeUnit.SECONDS) // 写入耗时 .writeTimeout(60, TimeUnit.SECONDS) // 三次握手 + SSL建立耗时 .connectTimeout(60, TimeUnit.SECONDS) .sslSocketFactory(sslSocketFactory(), x509TrustManager()) // 当连接失败，尝试重连 .retryOnConnectionFailure(true) // 最大空闲连接数及连接的保活时间进行配置 .connectionPool(new ConnectionPool(200, 5, TimeUnit.MINUTES)) // 绕过需要SSL证书验证的HTTPS的请求 .hostnameVerifier((s, sslSession) -&gt; true) .build())); return restTemplate; } @Bean public SSLSocketFactory sslSocketFactory() { try { // 信任任何链接 SSLContext sslContext = SSLContext.getInstance(\"TLS\"); sslContext.init(null, new TrustManager[]{x509TrustManager()}, new SecureRandom()); return sslContext.getSocketFactory(); } catch (NoSuchAlgorithmException | KeyManagementException e) { e.printStackTrace(); } return null; } @Bean public X509TrustManager x509TrustManager() { return new X509TrustManager() { @Override public void checkClientTrusted(X509Certificate[] x509Certificates, String s) { } @Override public void checkServerTrusted(X509Certificate[] x509Certificates, String s) { } @Override public X509Certificate[] getAcceptedIssuers() { return new X509Certificate[0]; } }; }} 测试123456789101112@Slf4j@SpringBootTestclass SpringBootApiApplicationTests { @Resource private RestTemplate restTemplate; @Test void contextLoads(){ String url = \"https://www.baidu.com/\"; String resp = restTemplate.getForObject(url, String.class); System.out.println(resp); }} 结果 RestTemplate简单使用RestTemplate封装使用 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"}],"tags":[{"name":"RestTemplate","slug":"RestTemplate","permalink":"https://www.zhuqiaolun.com/tags/RestTemplate/"}]},{"title":"RabbitMq：使用交换机topic+routingKey的模式 - 优先级 (spring-boot)","slug":"2020/06/1591944668470/1591944668470","date":"2020-06-12T06:51:08.000Z","updated":"2021-03-10T06:31:46.325Z","comments":false,"path":"2020/06/1591944668470/1591944668470/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1591944668470/1591944668470/","excerpt":"使用交换机topic+routingKey的模式 - 优先级 (spring-boot)","text":"引入的maven依赖12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt; &lt;version&gt;2.3.0.RELEASE&lt;/version&gt;&lt;/dependency&gt; yml配置12345678910111213141516171819202122232425262728spring: rabbitmq: addresses: 127.0.0.1:5672 username: guest password: guest connection-timeout: 15000 virtual-host: / # 开启消息发送到交换器（Exchange）后触发回调 publisher-confirm-type: simple # 开启消息发送到队列（Queue）后触发回调 publisher-returns: true listener: direct: # 开启ACK acknowledge-mode: manual # 开启手动 ，否则confirm自动确认 simple: # 开启ACK # 消息接收确认，可选模式：NONE（不确认）、AUTO（自动确认）、MANUAL（手动确认） acknowledge-mode: manual # 最小线程数量 concurrency: 10 # 最大线程数量 max-concurrency: 10 # 每个消费者可能未完成的最大未确认消息数量 prefetch: 1 template: # 交换机找不到QUEUE时，会调用Basic.Return 命令将消息返回给生产者 mandatory: true 声明绑定关系123456789101112131415161718192021222324252627282930313233343536373839404142/** * 初始化项目 就会创建 交换器，路由，队列，如果在服务中存在交换器的属性或者队列的属性不同，则会出现异常 * @return 返回 */@Configurationpublic class RabbitMqConfig { private static final String PRIORITY_QUEUE_NAME = \"priority.topic_demo\"; private static final String PRIORITY_TOPIC_ROUTING_KEY = \"priority.topic.routingKey\"; private static final String PRIORITY_EXCHANGE_NAME = \"priority.topic.exchange.name\"; /** * 声明消息队列 * @return 返回 */ @Bean(PRIORITY_QUEUE_NAME) public Queue priorityTopicDemo(){ Map&lt;String, Object&gt; arguments = new HashMap&lt;&gt;(1); arguments.put(\"x-max-priority\", 255); return new Queue(PRIORITY_QUEUE_NAME,true, false, false,arguments); } /** * 声明了一个Topic类型的交换机，durable是持久化（重启rabbitmq这个交换机不会被自动删除） * @return 返回 */ @Bean(PRIORITY_EXCHANGE_NAME) public Exchange priorityTopicExchangeName(){ return ExchangeBuilder.topicExchange(PRIORITY_EXCHANGE_NAME).durable(true).build(); } /** * 声明队列和交换机绑定关系，并且指定RoutingKey * @param queue 队列 * @param exchange 交换机 * @return 返回 */ @Bean public Binding queueBindingTopic(@Qualifier(PRIORITY_QUEUE_NAME) Queue queue,@Qualifier(PRIORITY_EXCHANGE_NAME) Exchange exchange){ return BindingBuilder.bind(queue).to(exchange).with(PRIORITY_TOPIC_ROUTING_KEY).noargs(); }} 生产者123456789101112131415161718192021222324252627@Component@Slf4jpublic class HelloSender { @Resource private RabbitTemplate rabbitTemplate; /** * 通过exchange和routingKey的方式 * rabbitTemplate.sendAndReceive(String exchange, String routingKey, Message message) * @param messageId 消息ID * @param exchange 交换机 * @param routingKey 路由 * @param priority 优先级 * @param content 内容 */ public void sendAndReceive(String messageId, String exchange, String routingKey, Integer priority, String content) { Message message = MessageBuilder.withBody(content.getBytes(Charset.forName(\"UTF-8\"))) .setContentType(MessageProperties.CONTENT_TYPE_TEXT_PLAIN) .setMessageId(messageId) .setPriority(priority) .build(); CorrelationData correlationData = new CorrelationData(); correlationData.setId(messageId); this.rabbitTemplate.convertAndSend(exchange, routingKey, message,correlationData); }} 消费者123456789101112131415161718192021222324252627@Component@Slf4jpublic class HelloReceiver { /** * @param message 队列消息对象 */ @RabbitListener(queues = TopicData.PRIORITY_QUEUE_NAME) public void queueNameTest1(Channel channel, Message message) { try { String stringBuilder = \"消息ID: \" + message.getMessageProperties().getMessageId() + \"；\" + \"优先级: \" + message.getMessageProperties().getPriority() + \"；\" + \"消息内容: \" + new String(message.getBody(), StandardCharsets.UTF_8); //告诉服务器收到这条消息 已经被我消费了 可以在队列删掉 这样以后就不会再发了 否则消息服务器以为这条消息没处理掉 后续还会在发 channel.basicAck(message.getMessageProperties().getDeliveryTag(),true); log.info(stringBuilder); } catch (IOException e) { e.printStackTrace(); try { //当发生异常时丢弃这条消息，或者 另行处理 channel.basicNack(message.getMessageProperties().getDeliveryTag(), false,false); System.out.println(\"receiver fail\"); } catch (IOException e1) { e1.printStackTrace(); } } }} 回调自定义 RabbitTemplate.ConfirmCallback 实现类 1234567891011@Slf4jpublic class RabbitConfirmCallBack implements RabbitTemplate.ConfirmCallback{ @Override public void confirm(CorrelationData correlationData, boolean ack, String cause) { log.info(\"收到回调，成功发送到broker\"); log.info(\"消息唯一标识: {}\", correlationData.getId()); log.info(\"确认状态: {}\", ack); log.info(\"造成原因: {}\", cause); }} 自定义 RabbitTemplate.ConfirmCallback 实现类 12345678910111213@Slf4jpublic class RabbitReturnCallback implements RabbitTemplate.ReturnCallback{ @Override public void returnedMessage(Message message, int replyCode, String replyText, String exchange, String routingKey) { log.info(\"收到回调，交换机找不到队列\"); log.info(\"消息主体: {}\", message); log.info(\"回复编码: {}\", replyCode); log.info(\"回复内容: {}\", replyText); log.info(\"交换器: {}\", exchange); log.info(\"路由键: {}\", routingKey); }} 添加回调，配置 rabbitTemplate 123456789101112@Component@AllArgsConstructorpublic class RabbitTemplateInitializingBean implements InitializingBean { private final RabbitTemplate rabbitTemplate; @Override public void afterPropertiesSet(){ rabbitTemplate.setConfirmCallback(new RabbitConfirmCallBack()); rabbitTemplate.setReturnCallback(new RabbitReturnCallback()); }} 测试123456789101112131415161718@SpringBootTestclass SpringBootRabbitmqExampleApplicationTest { @Resource private HelloSender helloSender; @Test void content(){ Random r = new Random(); int number = 1; for (int i = 0; i &lt; number ; i++) { String messageId = UUID.randomUUID().toString().replace(\"-\",\"\"); String exchange = \"priority.topic.exchange.name\"; String routingKey = \"priority.topic.routingKey\"; Integer priority = r.nextInt(255); String content = \"这是第[\"+i+\"]个消息\"; helloSender.sendAndReceive(messageId, exchange, routingKey, priority, content); } }} 结果： 当删除交换机时的执行错误 当删除队列时的执行错误 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"RabbitMq","slug":"RabbitMq","permalink":"https://www.zhuqiaolun.com/categories/RabbitMq/"}],"tags":[{"name":"rabbitMq","slug":"rabbitMq","permalink":"https://www.zhuqiaolun.com/tags/rabbitMq/"}]},{"title":"RabbitMq：使用交换机topic+routingKey的模式 - 优先级","slug":"2020/06/1591941634146/1591941634146","date":"2020-06-12T06:00:34.000Z","updated":"2021-03-10T06:32:08.566Z","comments":false,"path":"2020/06/1591941634146/1591941634146/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1591941634146/1591941634146/","excerpt":"使用交换机topic+routingKey的模式 - 优先级","text":"引入的maven依赖 123456789101112131415&lt;dependency&gt; &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt; &lt;artifactId&gt;amqp-client&lt;/artifactId&gt; &lt;version&gt;5.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.30&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.30&lt;/version&gt;&lt;/dependency&gt; 生产者123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import com.rabbitmq.client.AMQP;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import com.rabbitmq.client.ConnectionFactory;import java.io.IOException;import java.util.HashMap;import java.util.Map;import java.util.UUID;import java.util.concurrent.TimeoutException;public class PriorityProducer { public final static String QUEUENAME = \"priority.topic_demo\";// 队列名称 public final static String HOST = \"localhost\"; // 主机名 public final static String USERNAME = \"guest\"; //用户名 public final static String PASSWORD = \"guest\"; //密码 public final static String EXCHANGE_NAME = \"priority.topic.exchange.name\"; //交换机 public final static String ROUTING_KEY = \"priority.topic.routingKey\"; //路由 public static void main(String[] arggs) throws IOException, TimeoutException { ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setPassword(USERNAME); connectionFactory.setUsername(PASSWORD); connectionFactory.setPort(5672); connectionFactory.setHost(HOST); Connection connection = connectionFactory.newConnection(); Channel channel = connection.createChannel(); // 创建交换机 channel.exchangeDeclare(EXCHANGE_NAME, \"topic\", true); // 创建优先级 Map&lt;String, Object&gt; args = new HashMap&lt;String, Object&gt;(); args.put(\"x-max-priority\", 255);//定义优先级最大值 channel.queueDeclare(QUEUENAME, true, false, false, args); channel.queueBind(QUEUENAME, EXCHANGE_NAME, ROUTING_KEY); // 发送优先级消息 for (int i = 0; i &lt; 10; i++) { AMQP.BasicProperties.Builder builder = new AMQP.BasicProperties.Builder(); builder.messageId(UUID.randomUUID().toString()); if (i % 2 != 0) { builder.priority(i); //判断 新增 优先级 }else{ builder.priority(0); } AMQP.BasicProperties properties = builder.build(); System.out.println( (\"messages-\" + i)); channel.basicPublish(EXCHANGE_NAME, ROUTING_KEY, properties, (\"messages-\" + i).getBytes()); } channel.close(); connection.close(); System.out.println(\"客户端信息发送完毕！\"); }} 消费者1234567891011121314151617181920212223242526272829303132333435import com.rabbitmq.client.AMQP.BasicProperties;import com.rabbitmq.client.Channel;import com.rabbitmq.client.Connection;import com.rabbitmq.client.ConnectionFactory;import com.rabbitmq.client.DefaultConsumer;import com.rabbitmq.client.Envelope;import java.io.IOException;import java.util.concurrent.TimeoutException;public class PriorityConsumer { public final static String QUEUENAME = \"priority.topic_demo\";// 队列名称 public final static String HOST = \"localhost\"; // 主机名 public final static String USERNAME = \"guest\"; public final static String PASSWORD = \"guest\"; public final static String EXCHANGE_NAME = \"priority.topic.exchange.name\"; public final static String ROUTING_KEY = \"priority.topic.routingKey\"; public static void main(String[] args) throws IOException, TimeoutException, InterruptedException { ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setPassword(PASSWORD); connectionFactory.setUsername(USERNAME); connectionFactory.setPort(5672); connectionFactory.setHost(HOST); Connection connection = connectionFactory.newConnection(); Channel channel = connection.createChannel(); DefaultConsumer c = new DefaultConsumer(channel) { @Override public void handleDelivery(String consumerTag, Envelope envelope, BasicProperties properties, byte[] body) throws IOException { System.out.println(properties.getMessageId()+\" - \"+properties.getPriority()+\" - \"+ new String(body)); } }; channel.basicConsume(QUEUENAME, true, c); System.out.println(\"消费端开启···\"); }} 结果：生产者： 消费者：当生产者在适度发送消息消费时 (没有消息积累) 当生产者在过度发送消息消费时 (有消息积累) 具有优先级的先执行操作，先进后出。消费者可多个，当交换机和路由和队列名相同时则不会进行重复消费，在生产者发出消息后会进行轮询分发消费。 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"RabbitMq","slug":"RabbitMq","permalink":"https://www.zhuqiaolun.com/categories/RabbitMq/"}],"tags":[{"name":"rabbitMq","slug":"rabbitMq","permalink":"https://www.zhuqiaolun.com/tags/rabbitMq/"}]},{"title":"在Windows下安装RabbitMQ及配置","slug":"2020/06/1591869892000/1591869892000","date":"2020-06-11T10:04:52.000Z","updated":"2021-05-13T05:48:17.358Z","comments":false,"path":"2020/06/1591869892000/1591869892000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1591869892000/1591869892000/","excerpt":"Windows下RabbitMQ安装及配置","text":"介绍rabbitMQ是一个在AMQP协议标准基础上完整的，可服用的企业消息系统。它遵循Mozilla Public License开源协议，采用 Erlang 实现的工业级的消息队列(MQ)服务器，Rabbit MQ 是建立在Erlang OTP平台上。 安装 Erlang下载地址：​https://www.erlang.org/downloads，下载与系统对应的版本文件安装时，一路 next 即可安装完成设置环境变量， &nbsp;&nbsp;变量名：ERLANG_HOME &nbsp;&nbsp;变量值：D:\\erl-23.0（安装根目录） 修改环境变量path，增加Erlang变量至path，%ERLANG_HOME%\\bin;打开cmd命令框，输入erl至此，Erlang 安装完成 安装 RabbitMq下载地址：https://www.rabbitmq.com/install-windows-manual.html本文选择解压缩安装 rabbitmq-server-windows-3.8.4.zip配置环境变量： &nbsp;&nbsp;变量名：RABBITMQ_SERVER &nbsp;&nbsp;变量值：D:\\rabbitmq_server-3.8.4（安装根目录）打开cmd命令框，进入 安装目录安装插件，命令：rabbitmq-plugins.bat enable rabbitmq_management启动：rabbitmq-server.batrabbitmq启动成功，浏览器中http://localhost:15672，输入guest,guest进入rabbitMQ管理控制台：至此，rabbitMQ安装部署完成。 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"RabbitMq","slug":"RabbitMq","permalink":"https://www.zhuqiaolun.com/categories/RabbitMq/"}],"tags":[{"name":"rabbitMq","slug":"rabbitMq","permalink":"https://www.zhuqiaolun.com/tags/rabbitMq/"}]},{"title":"修改hexo文章目录位置","slug":"2020/06/1591760460000/1591760460000","date":"2020-06-10T03:41:00.000Z","updated":"2021-03-11T05:44:27.728Z","comments":false,"path":"2020/06/1591760460000/1591760460000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/06/1591760460000/1591760460000/","excerpt":"修改hexo创建文章名称规则","text":"打开 根目录下的 node_modules 找到 hexo 添加前缀时间戳新增文章操作： hexo new helloINFO Created: D:\\workspace-webstorm\\demon\\blog\\myblog\\source_posts\\1591933260490-hello.md 添加前缀路径新增文章操作： $ hexo new helloD:\\workspace-webstorm\\demon\\blog\\myblog\\source_posts\\1601024145664/1601024145664INFO Created: D:\\workspace-webstorm\\demon\\blog\\myblog\\source_posts\\1601024145664\\1601024145664.md 添加年月前缀路径新增文章操作： $ hexo new helloD:\\workspace-webstorm\\demon\\blog\\myblog\\source_posts\\2021\\03\\1615440974493/1615440974493INFO Created: D:\\workspace-webstorm\\demon\\blog\\myblog\\source_posts\\2021\\03\\1615440974493\\1615440974493.md 创建 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.zhuqiaolun.com/categories/Blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://www.zhuqiaolun.com/tags/hexo/"}]},{"title":"如何让hexo博客被百度收录","slug":"2020/05/1590766728000/1590766728000","date":"2020-05-29T15:38:48.000Z","updated":"2021-03-10T02:42:54.241Z","comments":false,"path":"2020/05/1590766728000/1590766728000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590766728000/1590766728000/","excerpt":"hexo博客被百度收录","text":"​前言​博客，分享才是真理。 HTTPS认证​找到 百度站长平台 -&gt; HTTPS认证认证似乎能加速百度收录速度在认证中，需要下载百度的专属识别文件，放在项目根目录，然后进行测试验证即可配置301 server { listen 80; server_name www.zhuqiaolun.com; if ($scheme = http ) { return 301 https://www.zhuqiaolun.com$request_uri; } location / { root html; index index.html index.htm; } }认证结果： 安装网站地图插件先安装sitemap插件，生成网站地图 npm install hexo-generator-sitemap --save npm install hexo-generator-baidu-sitemap --save12修改配置文件​修改博客根路径下的_config.yml配置文件中的url站点地址 url: https://www.zhuqiaolun.com/ # 在这儿填写你的博客域名 root: / permalink: :year/:month/:day/:title/ permalink_defaults: pretty_urls: trailing_index: true # Set to false to remove trailing 'index.html' from permalinks trailing_html: true # Set to false to remove trailing '.html' from permalinks验证xml文件​执行命令 hexo s 完之后就会在博客路径下生成 sitemap.xml 文件和 baidusitemap.xml 文件，可以通过 https://www.zhuqiaolun.com/baidusitemap.xml 查看该文件是否生成sitemap.xml文件是搜索引擎通用的文件baidusitemap.xml是百度专用的sitemap文件 向百度提交链接​找到 百度站长平台-&gt;普通收录 -&gt; 资源提交 -&gt; sitemap在其中填写百度专用的baidusitemap.xml的请求路径 https://www.zhuqiaolun.com/baidusitemap.xml 收录结果通过认证之后进入baidusitemap提交，响应速度超快，不到5分钟就把链接收录完成 查询收录结果访问 百度站长工具 输入网址地址，点击查询，即可看到结果 快捷查看百度网站 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Blog","slug":"Blog","permalink":"https://www.zhuqiaolun.com/categories/Blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://www.zhuqiaolun.com/tags/hexo/"}]},{"title":"在Linux中安装Nginx环境","slug":"2020/05/1590376771000/1590376771000","date":"2020-05-25T03:19:31.000Z","updated":"2024-08-13T07:00:52.026Z","comments":false,"path":"2020/05/1590376771000/1590376771000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590376771000/1590376771000/","excerpt":"在Linux中安装nginx环境","text":"下载nginxnginx 官网下载地址：http://nginx.org/en/download.htmlnginx 文件下载地址：https://nginx.org/download/ 下载稳定（Stable version）版本即可:Windows：http://nginx.org/download/nginx-1.18.0.zipLinux：http://nginx.org/download/nginx-1.18.0.tar.gz 上传nginxmkdir /usr/local/software # 创建软件安装目录 cd /usr/local/software # 进入软件安装目录 rz # 上传nginx文件，需要安装 yum install lrzsz ll # 查看上传文件 tar -zxvf nginx-1.18.0.tar.gz # 解压文件到当前目录 检测nginx环境在安装nginx前首先要确认系统中安装了gcc、zlib 、zlib-devel、pcre、pcre-devel、openssl、openssl-develLinux下检查是否安装过某软件包： yum list installed | grep gcc # 查看是否安装了gcc yum list installed | grep pcre yum list installed | grep pcre-devel yum list installed | grep zlib yum list installed | grep zlib-devel yum list installed | grep openssl yum list installed | grep openssl-devel 在此发现只安装了gcc和openssl，其他都没有安装，所以需要安装前置环境，输入以下命令： yum -y install zlib zlib-devel pcre pcre-devel openssl openssl-devel # 一键安装 至此前置软件安装结束，下面进入正式安装nginx 安装nginxcd /usr/local/software/nginx-1.18.0 # 进入nginx的安装根目录 配置nginx安装目录./configure --prefix=/usr/local/nginx # 配置nginx安装目录，执行完成后不会产生nginx目录执行完成后会出现一个 Makefile 的文件 编译并安装make &amp;&amp; make install # 编译、安装，执行完成后会产生nginx目录 cd /usr/local/nginx/ # 进入nginx目录nginx目录内容 测试是否安装成功./sbin/nginx -t出现 test is successful 表示安装成功，同时会生成一些文件 启动nginxcd /usr/local/nginx/sbin # 进入启动目录 ./nginx # 启动nginx，默认读取 /usr/local/nginx/conf 目录下的 nginx.conf 配置文件 ps -ef | grep nginx # 查看nginx是否启动当出现 worker process 则表示运行成功 另 执行命令： ps -A | grep nginx ，如果返回结果的话，也说明有nginx在运行，服务已经启动 访问nginxcurl http://localhost # 默认端口为：80当出现 Welcome to nginx! 则表示访问成功 修改nginx.confcd /usr/local/nginx/conf/ # 进入nginx配置文件目录 vim nginx.conf # 进入编辑文件模式1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192user root;worker_processes 1;error_log /usr/local/nginx/logs/nginx_error.log crit; events { worker_connections 1024;}http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; # 开启gzip压缩 gzip on; gzip_comp_level 5; gzip_min_length 1024; gzip_types text/plain application/x-javascript text/css application/xml text/javascript image/jpeg image/gif image/png; # 隐藏nginx版本信息 server_tokens off; server { listen 80; server_name www.zhuqiaolun.com; charset utf-8; if ($scheme = http ) { return 301 https://www.zhuqiaolun.com$request_uri; } location / { root html; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root html; } } # HTTPS server server { listen 443 ssl; server_name www.zhuqiaolun.com; root html; index index.html index.htm; ssl_certificate www.zhuqiaolun.com.pem; ssl_certificate_key www.zhuqiaolun.com.key; ssl_session_timeout 5m; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_session_cache shared:SSL:5m; ssl_prefer_server_ciphers on; location / { root html/blog/; index index.html index.htm; #try_files $uri $uri/ /index.html; } location /video/ { root /usr/local/nginx/html/video/; mp4; mp4_buffer_size 1m;#处理mp4初始内存大小 mp4_max_buffer_size 50m;#处理mp4最大内存大小 limit_rate 150k; #限速 limit_rate_after 20m; #在20m后限速 } location /file { charset utf-8; alias html/file/; #目录文件服务器根目录 if ($request_filename ~* ^.*?\\.(html|doc|pdf|zip|docx|txt|mp4|rar)$) { add_header Content-Disposition attachment; add_header Content-Type application/octet-stream; } autoindex on; # 开启目录文件列表 autoindex_exact_size on; # 显示出文件的确切大小，单位是bytes autoindex_localtime on; # 显示的文件时间为文件的服务器时间 } location /picture { charset utf-8; alias html/picture/; #目录文件服务器根目录 autoindex on; # 如果你想列出文件夹中的文件，可以打开这个选项 expires 30d; # 设置浏览器缓存过期时间 } }} 修改完成后使用 /usr/local/nginx/sbin/nginx -t 命令检测语句是否修改正确，如出现 test is successful，则表示正确 扩展/usr/local/nginx/sbin/nginx # 启动服务 /usr/local/nginx/sbin/nginx -s stop # 停止服务 /usr/local/nginx/sbin/nginx -s reload # 重启服务 /usr/local/nginx/sbin/nginx -t # 检测语句 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"}],"tags":[{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/tags/Nginx/"}]},{"title":"使本地git与Github连接","slug":"2020/05/1590309165000/1590309165000","date":"2020-05-24T08:32:45.000Z","updated":"2021-03-10T06:11:41.009Z","comments":false,"path":"2020/05/1590309165000/1590309165000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590309165000/1590309165000/","excerpt":"使本地git与Github连接","text":"创建github账号在 github 中创建一个账号，如有账号则不需创建 配置github账户安装成功后打开Git Bash Here，执行命令 git config –global -e 操作进入全局配置文件 1git config --global -e 按 i 进行编辑以下内容： [user] name = zhuqiaolun # github的Username email =zhuqlchina@163.com # github的Email按下ESC，输入 :wq 保存退出 输入以下命令禁用自动转换，防止 Git 提交时报错warning: LF will be replaced by CRLF in 1git config --global core.autocrlf false 输入以下命令查看配置 1git config -l 生成ssh认证输入以下命令，回车会让你输入存放保存ssh key的地址，它给了一个默认地址就是括号了那里，再回车就是你选择了默认地址，然后会让你输入密码并且确认密码，ok生成了，过程如下图 1ssh-keygen -t rsa -C \"zhuqlchina@163.com\" # github的Email 按照你存放ssk key的地址，去复制key，比如我的在下图这个位置，打开id_rsa.pub,复制里面的key 配置ssh认证登录 github ,setting -&gt; SSH and GPG keys -&gt; new SSH key输入key后 点击 Add SSH key 完成 验证ssh认证在git bash 下输入命令，如在前面设置过密码则会提示输入密码，那输入设置的密码即可 1ssh -T git@github.com 拉去github文件到本地仓库 选好本地仓库的目录，进去鼠标右键-&gt;Git Bash Here,输入以下命令拉去github上面的代码并进入拉去的代码目录 1git clone https://github.com/zhuqiaolun/spring-boot-code # repositories的url 修改内容后则需要提交文件 提交代码到远程仓库输入命令，查看修改了哪些文件，出现的红色字则为修改了内容的文件 1git status 修改文件状态，将本地文件更新全部提交到暂缓区 1.全部修改 1git add . # 更新文件状态，将文件添加到暂存区，注意后面一个点 2.修改只提交的文件 1touch .gitignore # 创建忽略提交的文件 在里面添加 不必要提交的文件路径或者文件名，过滤文件夹设置：.idea 表示过滤这个文件夹过滤文件设置：*.iml 输入命令： 1git add .gitignore # 更新单个文件状态 当前需要的文件变成绿色后，就可以提交了，先提交本地在提交远程，中间有可能要输入用户密码验证 12git commit -m '相关注释文字' #提交到本地仓库git push origin master #提交到远程仓库 查看远程github 扩展从本地上传代码到github上操作：在git bash 下输入命令1、仓库初始化git init2、连接仓库，没有则需新建git remote add origin 仓库地址3、查看状态git status4、将文件添加到暂存区git add 状态里的新文件5、将文件添加到仓库git commit -m’相关注释文字’6、将本地代码提交到远程仓库git push origin master ssh和https提交代码时其实都需要验证，ssh用的是key， https用的是登录名和密码的方式 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Git","slug":"Git","permalink":"https://www.zhuqiaolun.com/categories/Git/"}],"tags":[{"name":"Github","slug":"Github","permalink":"https://www.zhuqiaolun.com/tags/Github/"}]},{"title":"Java反射机制","slug":"2020/05/1590300096000/1590300096000","date":"2020-05-24T06:01:36.000Z","updated":"2021-03-01T06:43:07.216Z","comments":false,"path":"2020/05/1590300096000/1590300096000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590300096000/1590300096000/","excerpt":"Java反射机制","text":"什么是反射JAVA反射机制是在运行状态中，对于任意一个类。都能都知道这个类的所有属性和方法，对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称之为java语言的反射机制； 反射的作用反射类： java.lang.reflect反编译： .class –à .java通过反射机制可以访问java对象中的属性，方法，构造方法，自定义方法 创建Class对象的三种方式实例对象： 1234567891011121314public class Person { private String name; private int age ; // 构造方法（无参，有参） // get 方法·· // set 方法·· // 自定义一个执行方法，方法名称：execute， // 参数1：name，类型：String.class // 参数2：age，类型：int.class public String execute(String name, int age) { return \"姓名:\" + name + \"；年龄：\"+ age; }} 创建Class对象的方式一对象.getClass()，获取Person类中的字节码文件 1Class&lt;?&gt; class1 = new Person().getClass(); 创建Class对象的方式二.class，一个明确的类，任意一个类型都有一个静态的class属性 1Class&lt;?&gt; class2 = Person.class; 创建Class对象的方式三 （推荐）必须是全路径名称，如：com.demon.hello.Person，如找不到则出现异常：ClassNotFoundException 12345try { Class&lt;?&gt; class3 = Class.forName(classPath); } catch (ClassNotFoundException e) { e.printStackTrace(); } 获取类的实例获取class类型之后，可以创建该类型的对象，如：class3.newInstance() 执行类的方法获得class类型的Method对象，根据方法参数定义填写参数类型说明 参数类型与需要反射的类的参数类型保持一致，如int.class不要写成Integer.classinvoke方法，参数为cls实例对象，和想要调用的方法参数输出invoke方法的返回值(返回值类型可为方法定义的返回值类型，强制转化即可) // 第一个参数为方法名,第二个参数为参数name的类型Class对象，第三个参数为参数age的类型Class对象 Method method2 = class3.getMethod(\"execute\", String.class, int.class); Object obj = method1.invoke(c1s.newInstance(), \"张三\", 30); System.out.println(\"execute方法的返回值：\" + value); // 姓名:张三；年龄：30扩展在获取创建类型的对象后，获取根据类的方法判断该执行类是否满足执行条件，如是否有实现接口：c1s.getInterfaces()，返回是一个数组，是否有注解类：c1s.getAnnotation(aCls.class)，参数为注解类.class，更多查看 api ··· document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"安装Java环境","slug":"2020/05/1590236390000/1590236390000","date":"2020-05-23T12:19:50.000Z","updated":"2023-11-23T10:11:41.038Z","comments":false,"path":"2020/05/1590236390000/1590236390000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590236390000/1590236390000/","excerpt":"安装Java环境","text":"下载JDK由于是安装在服务器，所以只需jre即可，选择对应的系统版本点击下载，没有登陆则跳转登陆页面，账号：1097305826@qq.com密码：Qwert@123456 Windows新建JAVA_HOME 变量 12变量名：JAVA_HOME变量值：电脑上JDK安装的绝对路径，如：C:\\Java\\jdk1.8.0_45 新建/修改 CLASSPATH 变量 12变量名：CLASSPATH变量值：.;%JAVA_HOME%\\lib\\dt.jar;%JAVA_HOME%\\lib\\tools.jar; 修改Path 变量新建两条路径： 12%JAVA_HOME%\\bin%JAVA_HOME%\\jre\\bin 验证JDK环境变量使用 java -version 查看环境是否安装完全 Linux上传JDK到服务器安装命令 yum install -y lrzsz 工具，此为在Xshell下使用，rz:上传，sz:下载在local下创建java目录，在弹出的窗口中选择要上传的jdk压缩文件，上传文件到Linux上java安装目录并解压，此时安装目录为：/usr/local/java/jdk1.8.0_231 mkdir /use/local/java # 创建目录 cd /use/local/java # 进入目录 rz # 上传文件 tar -zxvf jdk-8u231-linux-x64.tar.gz # 解压文件 配置JDK环境变量使用 vim /etc/profile 命令进入编辑器，添加以下内容： set java environment JAVA_HOME=/usr/local/java/jdk1.8.0_231 JRE_HOME=$JAVA_HOME/jre CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin export JAVA_HOME JRE_HOME CLASS_PATH PATH使用 Esc wq 对内容保存并退出使用 source /etc/profile 让内容生效 验证JDK环境变量使用 java -version 查看环境是否安装完全 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"}]},{"title":"在idea中创建项目与github关联","slug":"2020/05/1590142873000/1590142873000","date":"2020-05-22T10:21:13.000Z","updated":"2024-08-16T08:29:21.406Z","comments":false,"path":"2020/05/1590142873000/1590142873000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590142873000/1590142873000/","excerpt":"在idea中创建项目与github关联","text":"在IDEA中配置git在IDEA中设置Git，在File–&gt;Setting-&gt;Version Control–&gt;Git ，git安装环境变量成功会自动识别安装路径，点击Test，测试是否设置成功 在IDEA中连接github中心在IDEA中，File–&gt;Setting-&gt;Version Control–&gt;GibHub，点击右侧 “ + “ 按钮，建议在Server的中添加[https://]，Login为Github的账户，Password为Github的密码，点击Log In，成功则显示， 创建本地仓库在IDEA中，VCS–&gt;Import into Version Control–&gt;Create Git Repository 在弹窗中选择项目所在的位置 点击OK，此时项目文件全部变成红色，同时在项目目录下生成一个隐藏的.git的文件目录 上传文件到本地仓库在IDEA中，选择项目鼠标右键–&gt; git –&gt; Add，此时项目文件变成绿色，此时文件只处于本地库的暂存区，并没有同步到github版本库中 同步到本地github版本在IDEA中，选择项目鼠标右键–&gt; git –&gt; Commit Directory，出现提交弹窗，在弹窗勾掉.idea排除不必要的文件，在弹窗中输入Commit Message，否则不允许提交，点击commit，此时项目文件从暂存区真正进入本地github版本库中，项目文件变成白色 上传项目到GitHub中在IDEA中，选择项目，VCS–&gt;Import into Version Control–&gt;Share Project on GitHub，在弹框中自动输入仓库名，输入描述，选择要Share的链接， 点击Share，即可上传，中间会弹窗输入GitHub的用户名和密码（已输入过用户名和密码并记住的不会再次弹框输入），上传成功后IDEA右下角会给出提示 同步结束此至，可访问github上查看 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"IDEA","slug":"IDEA","permalink":"https://www.zhuqiaolun.com/categories/IDEA/"}],"tags":[{"name":"Github","slug":"Github","permalink":"https://www.zhuqiaolun.com/tags/Github/"}]},{"title":"在Windows上安装git-v2.26.2","slug":"2020/05/1590132000000/1590132000000","date":"2020-05-22T07:20:00.000Z","updated":"2023-07-24T07:32:40.069Z","comments":false,"path":"2020/05/1590132000000/1590132000000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1590132000000/1590132000000/","excerpt":"在Windows上安装git-v2.26.2","text":"下载git官网下载并安装 git 进入自动识别系统， 点击自动弹出下载窗口 安装包下载地址：https://gitforwindows.org/官网慢，可以用国内的镜像：https://npm.taobao.org/mirrors/git-for-windows/ 安装git下载结束后，双击进行安装，如已安装点击运行则为修复版本 是否显示桌面图，可不勾选，在安装结束后鼠标右键有选项显示 此项完全不修改PATH变量值，仅在Git Bash中使用Git，绝对安全，所以cmd的git –version 无效 Git命令与Linux一样，所以最好在OpenSSL中操作命令 启用文件缓存 在桌面或者文件目录空白处点击鼠标右键，选择 Git Bash Here 选项，即可打开命令界面 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"Git","slug":"Git","permalink":"https://www.zhuqiaolun.com/categories/Git/"}],"tags":[{"name":"Git","slug":"Git","permalink":"https://www.zhuqiaolun.com/tags/Git/"}]},{"title":"Hello World","slug":"2020/05/1589344022000/1589344022000","date":"2020-05-13T04:27:02.000Z","updated":"2023-09-11T05:21:08.806Z","comments":false,"path":"2020/05/1589344022000/1589344022000/","link":"","permalink":"https://www.zhuqiaolun.com/2020/05/1589344022000/1589344022000/","excerpt":"『你好,世界』","text":"『你好,世界』Java1234567public class HelloWorld{ public static void main(String[] args) { System.out.println( \"Hello, World!\" ); }} C12345#include &lt;stdio.h&gt;int main(){ printf(\"Hello, World!\");} Python 31print(\"Hello, World!\") 可以使用单引号’’，双引号”” 或三引号””” “””或’’’ ‘’’ C++123456#include &lt;iostream&gt;using namespace std;int main(){ cout&lt;&lt;\"Hello, World!\"&lt;&lt;endl;} C#12345678910namespace HelloWorld{ class Program { static void Main(string[] args) { System.Console.Write(\"Hello, World!\"); } }} VB12345Module MainFrm Sub Main() System.Console.WriteLine(\"Hello, World!\") End SubEnd Module JavaScript1alert (\"Hello, World!\"); 1document.write(\"Hello, World!\"); PHP123&lt;?php echo 'Hello, world!';?&gt; SQL1SELECT 列名称 FROM 表名称 Object-C12345#import &lt;stdio.h&gt;int main(int argc,const char *argv[]){ printf(\"Hello World\");} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });","categories":[{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"}],"tags":[{"name":"other","slug":"other","permalink":"https://www.zhuqiaolun.com/tags/other/"}]}],"categories":[{"name":"Logger","slug":"Logger","permalink":"https://www.zhuqiaolun.com/categories/Logger/"},{"name":"JavaFx","slug":"JavaFx","permalink":"https://www.zhuqiaolun.com/categories/JavaFx/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/categories/SpringBoot/"},{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/categories/MySql/"},{"name":"J-Package","slug":"J-Package","permalink":"https://www.zhuqiaolun.com/categories/J-Package/"},{"name":"OceanBase","slug":"OceanBase","permalink":"https://www.zhuqiaolun.com/categories/OceanBase/"},{"name":"RabbitMq","slug":"RabbitMq","permalink":"https://www.zhuqiaolun.com/categories/RabbitMq/"},{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/categories/Redis/"},{"name":"SVN","slug":"SVN","permalink":"https://www.zhuqiaolun.com/categories/SVN/"},{"name":"kubernetes","slug":"kubernetes","permalink":"https://www.zhuqiaolun.com/categories/kubernetes/"},{"name":"J-Tools","slug":"J-Tools","permalink":"https://www.zhuqiaolun.com/categories/J-Tools/"},{"name":"IDEA","slug":"IDEA","permalink":"https://www.zhuqiaolun.com/categories/IDEA/"},{"name":"Tomcat","slug":"Tomcat","permalink":"https://www.zhuqiaolun.com/categories/Tomcat/"},{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/categories/MyBatis/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/categories/ElasticSearch/"},{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/categories/Maven/"},{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/categories/Go-FastDfs/"},{"name":"Linux","slug":"Linux","permalink":"https://www.zhuqiaolun.com/categories/Linux/"},{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/categories/Nginx/"},{"name":"Windows","slug":"Windows","permalink":"https://www.zhuqiaolun.com/categories/Windows/"},{"name":"WebService","slug":"WebService","permalink":"https://www.zhuqiaolun.com/categories/WebService/"},{"name":"Blog","slug":"Blog","permalink":"https://www.zhuqiaolun.com/categories/Blog/"},{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/categories/Java/"},{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/categories/MyCat/"},{"name":"Kafka","slug":"Kafka","permalink":"https://www.zhuqiaolun.com/categories/Kafka/"},{"name":"Git","slug":"Git","permalink":"https://www.zhuqiaolun.com/categories/Git/"}],"tags":[{"name":"log4j","slug":"log4j","permalink":"https://www.zhuqiaolun.com/tags/log4j/"},{"name":"ProgressIndicator","slug":"ProgressIndicator","permalink":"https://www.zhuqiaolun.com/tags/ProgressIndicator/"},{"name":"Alert","slug":"Alert","permalink":"https://www.zhuqiaolun.com/tags/Alert/"},{"name":"TableView","slug":"TableView","permalink":"https://www.zhuqiaolun.com/tags/TableView/"},{"name":"MongoDb","slug":"MongoDb","permalink":"https://www.zhuqiaolun.com/tags/MongoDb/"},{"name":"Quartz","slug":"Quartz","permalink":"https://www.zhuqiaolun.com/tags/Quartz/"},{"name":"MySql","slug":"MySql","permalink":"https://www.zhuqiaolun.com/tags/MySql/"},{"name":"log4j2","slug":"log4j2","permalink":"https://www.zhuqiaolun.com/tags/log4j2/"},{"name":"innosetup","slug":"innosetup","permalink":"https://www.zhuqiaolun.com/tags/innosetup/"},{"name":"exe4j","slug":"exe4j","permalink":"https://www.zhuqiaolun.com/tags/exe4j/"},{"name":"OceanBase","slug":"OceanBase","permalink":"https://www.zhuqiaolun.com/tags/OceanBase/"},{"name":"rabbitMq","slug":"rabbitMq","permalink":"https://www.zhuqiaolun.com/tags/rabbitMq/"},{"name":"Redis","slug":"Redis","permalink":"https://www.zhuqiaolun.com/tags/Redis/"},{"name":"subversion","slug":"subversion","permalink":"https://www.zhuqiaolun.com/tags/subversion/"},{"name":"k8s","slug":"k8s","permalink":"https://www.zhuqiaolun.com/tags/k8s/"},{"name":"OkHttp3","slug":"OkHttp3","permalink":"https://www.zhuqiaolun.com/tags/OkHttp3/"},{"name":"QR","slug":"QR","permalink":"https://www.zhuqiaolun.com/tags/QR/"},{"name":"IDEA","slug":"IDEA","permalink":"https://www.zhuqiaolun.com/tags/IDEA/"},{"name":"tomcat","slug":"tomcat","permalink":"https://www.zhuqiaolun.com/tags/tomcat/"},{"name":"Xml","slug":"Xml","permalink":"https://www.zhuqiaolun.com/tags/Xml/"},{"name":"Json","slug":"Json","permalink":"https://www.zhuqiaolun.com/tags/Json/"},{"name":"Map","slug":"Map","permalink":"https://www.zhuqiaolun.com/tags/Map/"},{"name":"SpringBoot","slug":"SpringBoot","permalink":"https://www.zhuqiaolun.com/tags/SpringBoot/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"https://www.zhuqiaolun.com/tags/ElasticSearch/"},{"name":"Kibana","slug":"Kibana","permalink":"https://www.zhuqiaolun.com/tags/Kibana/"},{"name":"pom","slug":"pom","permalink":"https://www.zhuqiaolun.com/tags/pom/"},{"name":"Yaml","slug":"Yaml","permalink":"https://www.zhuqiaolun.com/tags/Yaml/"},{"name":"logback","slug":"logback","permalink":"https://www.zhuqiaolun.com/tags/logback/"},{"name":"Snowflake","slug":"Snowflake","permalink":"https://www.zhuqiaolun.com/tags/Snowflake/"},{"name":"Go-FastDfs","slug":"Go-FastDfs","permalink":"https://www.zhuqiaolun.com/tags/Go-FastDfs/"},{"name":"freemarker","slug":"freemarker","permalink":"https://www.zhuqiaolun.com/tags/freemarker/"},{"name":"RedisTemplate","slug":"RedisTemplate","permalink":"https://www.zhuqiaolun.com/tags/RedisTemplate/"},{"name":"RestTemplate","slug":"RestTemplate","permalink":"https://www.zhuqiaolun.com/tags/RestTemplate/"},{"name":"firewall","slug":"firewall","permalink":"https://www.zhuqiaolun.com/tags/firewall/"},{"name":"command","slug":"command","permalink":"https://www.zhuqiaolun.com/tags/command/"},{"name":"Vue","slug":"Vue","permalink":"https://www.zhuqiaolun.com/tags/Vue/"},{"name":"nssm","slug":"nssm","permalink":"https://www.zhuqiaolun.com/tags/nssm/"},{"name":"Java","slug":"Java","permalink":"https://www.zhuqiaolun.com/tags/Java/"},{"name":"MyBatis","slug":"MyBatis","permalink":"https://www.zhuqiaolun.com/tags/MyBatis/"},{"name":"hexo","slug":"hexo","permalink":"https://www.zhuqiaolun.com/tags/hexo/"},{"name":"Maven","slug":"Maven","permalink":"https://www.zhuqiaolun.com/tags/Maven/"},{"name":"chrome","slug":"chrome","permalink":"https://www.zhuqiaolun.com/tags/chrome/"},{"name":"CheckBox","slug":"CheckBox","permalink":"https://www.zhuqiaolun.com/tags/CheckBox/"},{"name":"VBox","slug":"VBox","permalink":"https://www.zhuqiaolun.com/tags/VBox/"},{"name":"TreeView","slug":"TreeView","permalink":"https://www.zhuqiaolun.com/tags/TreeView/"},{"name":"halo","slug":"halo","permalink":"https://www.zhuqiaolun.com/tags/halo/"},{"name":"Email","slug":"Email","permalink":"https://www.zhuqiaolun.com/tags/Email/"},{"name":"Zip","slug":"Zip","permalink":"https://www.zhuqiaolun.com/tags/Zip/"},{"name":"Excel","slug":"Excel","permalink":"https://www.zhuqiaolun.com/tags/Excel/"},{"name":"winsw","slug":"winsw","permalink":"https://www.zhuqiaolun.com/tags/winsw/"},{"name":"nginx","slug":"nginx","permalink":"https://www.zhuqiaolun.com/tags/nginx/"},{"name":"Jackson","slug":"Jackson","permalink":"https://www.zhuqiaolun.com/tags/Jackson/"},{"name":"Thymeleaf","slug":"Thymeleaf","permalink":"https://www.zhuqiaolun.com/tags/Thymeleaf/"},{"name":"myCat","slug":"myCat","permalink":"https://www.zhuqiaolun.com/tags/myCat/"},{"name":"MyCat","slug":"MyCat","permalink":"https://www.zhuqiaolun.com/tags/MyCat/"},{"name":"kafka","slug":"kafka","permalink":"https://www.zhuqiaolun.com/tags/kafka/"},{"name":"Nginx","slug":"Nginx","permalink":"https://www.zhuqiaolun.com/tags/Nginx/"},{"name":"Github","slug":"Github","permalink":"https://www.zhuqiaolun.com/tags/Github/"},{"name":"Git","slug":"Git","permalink":"https://www.zhuqiaolun.com/tags/Git/"},{"name":"other","slug":"other","permalink":"https://www.zhuqiaolun.com/tags/other/"}]}